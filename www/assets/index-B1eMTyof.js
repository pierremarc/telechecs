var ga=Object.defineProperty;var ma=(e,t,n)=>t in e?ga(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var re=(e,t,n)=>ma(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const cs="none",ls="some",or={tag:cs},sr=e=>({tag:ls,value:e}),_a=e=>typeof e=="object"&&e!==null&&"tag"in e&&(e.tag===cs||e.tag===ls),ir=e=>e.tag==="none",Se=e=>t=>ir(t)?or:sr(e(t.value)),Yt=e=>t=>ir(t)?e:t.value,us=e=>t=>ir(t)?e():t.value,Ze=e=>e==null?or:sr(e),kt=(e,t,n)=>n(t(e));function w(e,t,n){function r(l,i){var h;Object.defineProperty(l,"_zod",{value:l._zod??{},enumerable:!1}),(h=l._zod).traits??(h.traits=new Set),l._zod.traits.add(e),t(l,i);for(const c in a.prototype)c in l||Object.defineProperty(l,c,{value:a.prototype[c].bind(l)});l._zod.constr=a,l._zod.def=i}const o=(n==null?void 0:n.Parent)??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function a(l){var i;const h=n!=null&&n.Parent?new s:this;r(h,l),(i=h._zod).deferred??(i.deferred=[]);for(const c of h._zod.deferred)c();return h}return Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:l=>{var i,h;return n!=null&&n.Parent&&l instanceof n.Parent?!0:(h=(i=l==null?void 0:l._zod)==null?void 0:i.traits)==null?void 0:h.has(e)}}),Object.defineProperty(a,"name",{value:e}),a}class zt extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const hs={};function ft(e){return hs}function va(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function ba(e,t){return typeof t=="bigint"?t.toString():t}function fs(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function ar(e){return e==null}function cr(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function wa(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=Number.parseInt(e.toFixed(o).replace(".","")),a=Number.parseInt(t.toFixed(o).replace(".",""));return s%a/10**o}function se(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function lr(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function ps(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function Tt(e){return JSON.stringify(e)}function Qn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const ka=fs(()=>{if(typeof navigator<"u"&&(navigator!=null&&navigator.userAgent.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function qr(e){if(Qn(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(Qn(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}const ya=new Set(["string","number","symbol"]);function xt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gt(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function O(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Ea(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Ca={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Sa(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return gt(e,{...e._zod.def,shape:n,checks:[]})}function Aa(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return gt(e,{...e._zod.def,shape:n,checks:[]})}function $a(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return lr(this,"shape",r),r},checks:[]};return gt(e,n)}function Ta(e,t){return gt(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return lr(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function Ia(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)o[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return gt(t,{...t._zod.def,shape:o,checks:[]})}function Pa(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)o[s]=new e({type:"nonoptional",innerType:r[s]});return gt(t,{...t._zod.def,shape:o,checks:[]})}function Zt(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function ur(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Xt(e){return typeof e=="string"?e:e==null?void 0:e.message}function pt(e,t,n){var o,s,a,l,i,h;const r={...e,path:e.path??[]};if(!e.message){const c=Xt((a=(s=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:s.error)==null?void 0:a.call(s,e))??Xt((l=t==null?void 0:t.error)==null?void 0:l.call(t,e))??Xt((i=n.customError)==null?void 0:i.call(n,e))??Xt((h=n.localeError)==null?void 0:h.call(n,e))??"Invalid input";r.message=c}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function hr(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Ot(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const ds=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,ba,2)},enumerable:!0})},gs=w("$ZodError",ds),ms=w("$ZodError",ds,{Parent:Error});function Za(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function za(e,t){const n=t||function(s){return s.message},r={_errors:[]},o=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(l=>o({issues:l}));else if(a.code==="invalid_key")o({issues:a.issues});else if(a.code==="invalid_element")o({issues:a.issues});else if(a.path.length===0)r._errors.push(n(a));else{let l=r,i=0;for(;i<a.path.length;){const h=a.path[i];i===a.path.length-1?(l[h]=l[h]||{_errors:[]},l[h]._errors.push(n(a))):l[h]=l[h]||{_errors:[]},l=l[h],i++}}};return o(e),r}const Oa=e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new zt;if(a.issues.length){const l=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>pt(i,s,ft())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return a.value},Ra=e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const l=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>pt(i,s,ft())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return a.value},_s=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new zt;return s.issues.length?{success:!1,error:new(e??gs)(s.issues.map(a=>pt(a,o,ft())))}:{success:!0,data:s.value}},Na=_s(ms),vs=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(a=>pt(a,o,ft())))}:{success:!0,data:s.value}},La=vs(ms),xa=/^[cC][^\s-]{8,}$/,Ma=/^[0-9a-z]+$/,Fa=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Da=/^[0-9a-vA-V]{20}$/,Ua=/^[A-Za-z0-9]{27}$/,ja=/^[a-zA-Z0-9_-]{21}$/,Ka=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,qa=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Gr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,Ga=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Ba="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Wa(){return new RegExp(Ba,"u")}const Ha=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Va=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Qa=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Ja=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ya=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,bs=/^[A-Za-z0-9_-]*$/,Xa=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,ec=/^\+(?:[0-9]){6,14}[0-9]$/,ws="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",tc=new RegExp(`^${ws}$`);function ks(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function nc(e){return new RegExp(`^${ks(e)}$`)}function rc(e){let t=`${ws}T${ks(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}const oc=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},sc=/^\d+$/,ic=/^-?\d+(?:\.\d+)?/i,ac=/true|false/i,cc=/^[^A-Z]*$/,lc=/^[^a-z]*$/,Ae=w("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),ys={number:"number",bigint:"bigint",object:"date"},Es=w("$ZodCheckLessThan",(e,t)=>{Ae.init(e,t);const n=ys[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Cs=w("$ZodCheckGreaterThan",(e,t)=>{Ae.init(e,t);const n=ys[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),uc=w("$ZodCheckMultipleOf",(e,t)=>{Ae.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):wa(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),hc=w("$ZodCheckNumberFormat",(e,t)=>{var a;Ae.init(e,t),t.format=t.format||"float64";const n=(a=t.format)==null?void 0:a.includes("int"),r=n?"int":"number",[o,s]=Ca[t.format];e._zod.onattach.push(l=>{const i=l._zod.bag;i.format=t.format,i.minimum=o,i.maximum=s,n&&(i.pattern=sc)}),e._zod.check=l=>{const i=l.value;if(n){if(!Number.isInteger(i)){l.issues.push({expected:r,format:t.format,code:"invalid_type",input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?l.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):l.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}i<o&&l.issues.push({origin:"number",input:i,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),i>s&&l.issues.push({origin:"number",input:i,code:"too_big",maximum:s,inst:e})}}),fc=w("$ZodCheckMaxLength",(e,t)=>{Ae.init(e,t),e._zod.when=n=>{const r=n.value;return!ar(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const s=hr(r);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),pc=w("$ZodCheckMinLength",(e,t)=>{Ae.init(e,t),e._zod.when=n=>{const r=n.value;return!ar(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const s=hr(r);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),dc=w("$ZodCheckLengthEquals",(e,t)=>{Ae.init(e,t),e._zod.when=n=>{const r=n.value;return!ar(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,o=r.length;if(o===t.length)return;const s=hr(r),a=o>t.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),_n=w("$ZodCheckStringFormat",(e,t)=>{var n;Ae.init(e,t),e._zod.onattach.push(r=>{const o=r._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),gc=w("$ZodCheckRegex",(e,t)=>{_n.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),mc=w("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=cc),_n.init(e,t)}),_c=w("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=lc),_n.init(e,t)}),vc=w("$ZodCheckIncludes",(e,t)=>{Ae.init(e,t);const n=xt(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),bc=w("$ZodCheckStartsWith",(e,t)=>{Ae.init(e,t);const n=new RegExp(`^${xt(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),wc=w("$ZodCheckEndsWith",(e,t)=>{Ae.init(e,t);const n=new RegExp(`.*${xt(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),kc=w("$ZodCheckOverwrite",(e,t)=>{Ae.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class yc{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(a=>a),o=Math.min(...r.map(a=>a.length-a.trimStart().length)),s=r.map(a=>a.slice(o)).map(a=>" ".repeat(this.indent*2)+a);for(const a of s)this.content.push(a)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}}const Ec={major:4,minor:0,patch:0},ae=w("$ZodType",(e,t)=>{var o;var n;e??(e={}),se(e._zod,"id",()=>t.type+"_"+ps(10)),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Ec;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const s of r)for(const a of s._zod.onattach)a(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const s=(a,l,i)=>{let h=Zt(a),c;for(const k of l){if(k._zod.when){if(!k._zod.when(a))continue}else if(h)continue;const g=a.issues.length,C=k._zod.check(a);if(C instanceof Promise&&(i==null?void 0:i.async)===!1)throw new zt;if(c||C instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await C,a.issues.length!==g&&(h||(h=Zt(a,g)))});else{if(a.issues.length===g)continue;h||(h=Zt(a,g))}}return c?c.then(()=>a):a};e._zod.run=(a,l)=>{const i=e._zod.parse(a,l);if(i instanceof Promise){if(l.async===!1)throw new zt;return i.then(h=>s(h,r,l))}return s(i,r,l)}}e["~standard"]={validate:s=>{var a;try{const l=Na(e,s);return l.success?{value:l.data}:{issues:(a=l.error)==null?void 0:a.issues}}catch{return La(e,s).then(i=>{var h;return i.success?{value:i.data}:{issues:(h=i.error)==null?void 0:h.issues}})}},vendor:"zod",version:1}}),fr=w("$ZodString",(e,t)=>{var n;ae.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??oc(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),oe=w("$ZodStringFormat",(e,t)=>{_n.init(e,t),fr.init(e,t)}),Cc=w("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=qa),oe.init(e,t)}),Sc=w("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Gr(r))}else t.pattern??(t.pattern=Gr());oe.init(e,t)}),Ac=w("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Ga),oe.init(e,t)}),$c=w("$ZodURL",(e,t)=>{oe.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Xa.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Tc=w("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Wa()),oe.init(e,t)}),Ic=w("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=ja),oe.init(e,t)}),Pc=w("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=xa),oe.init(e,t)}),Zc=w("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Ma),oe.init(e,t)}),zc=w("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Fa),oe.init(e,t)}),Oc=w("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Da),oe.init(e,t)}),Rc=w("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Ua),oe.init(e,t)}),Nc=w("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=rc(t)),oe.init(e,t)}),Lc=w("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=tc),oe.init(e,t)}),xc=w("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=nc(t)),oe.init(e,t)}),Mc=w("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Ka),oe.init(e,t)}),Fc=w("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Ha),oe.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),Dc=w("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Va),oe.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),Uc=w("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=Qa),oe.init(e,t)}),jc=w("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Ja),oe.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Ss(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Kc=w("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Ya),oe.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Ss(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function qc(e){if(!bs.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Ss(n)}const Gc=w("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=bs),oe.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{qc(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),Bc=w("$ZodE164",(e,t)=>{t.pattern??(t.pattern=ec),oe.init(e,t)});function Wc(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const Hc=w("$ZodJWT",(e,t)=>{oe.init(e,t),e._zod.check=n=>{Wc(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),As=w("$ZodNumber",(e,t)=>{ae.init(e,t),e._zod.pattern=e._zod.bag.pattern??ic,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),Vc=w("$ZodNumber",(e,t)=>{hc.init(e,t),As.init(e,t)}),Qc=w("$ZodBoolean",(e,t)=>{ae.init(e,t),e._zod.pattern=ac,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),Jc=w("$ZodUnknown",(e,t)=>{ae.init(e,t),e._zod.parse=n=>n}),Yc=w("$ZodNever",(e,t)=>{ae.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function Br(e,t,n){e.issues.length&&t.issues.push(...ur(n,e.issues)),t.value[n]=e.value}const Xc=w("$ZodArray",(e,t)=>{ae.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let a=0;a<o.length;a++){const l=o[a],i=t.element._zod.run({value:l,issues:[]},r);i instanceof Promise?s.push(i.then(h=>Br(h,n,a))):Br(i,n,a)}return s.length?Promise.all(s).then(()=>n):n}});function en(e,t,n){e.issues.length&&t.issues.push(...ur(n,e.issues)),t.value[n]=e.value}function Wr(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...ur(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const el=w("$ZodObject",(e,t)=>{ae.init(e,t);const n=fs(()=>{const k=Object.keys(t.shape);for(const C of k)if(!(t.shape[C]instanceof ae))throw new Error(`Invalid element at key "${C}": expected a Zod schema`);const g=Ea(t.shape);return{shape:t.shape,keys:k,keySet:new Set(k),numKeys:k.length,optionalKeys:new Set(g)}});se(e._zod,"propValues",()=>{const k=t.shape,g={};for(const C in k){const S=k[C]._zod;if(S.values){g[C]??(g[C]=new Set);for(const K of S.values)g[C].add(K)}}return g});const r=k=>{const g=new yc(["shape","payload","ctx"]),{keys:C,optionalKeys:S}=n.value,K=N=>{const U=Tt(N);return`shape[${U}]._zod.run({ value: input[${U}], issues: [] }, ctx)`};g.write("const input = payload.value;");const q=Object.create(null);for(const N of C)q[N]=ps(15);g.write("const newResult = {}");for(const N of C)if(S.has(N)){const U=q[N];g.write(`const ${U} = ${K(N)};`);const Q=Tt(N);g.write(`
        if (${U}.issues.length) {
          if (input[${Q}] === undefined) {
            if (${Q} in input) {
              newResult[${Q}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${U}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${Q}, ...iss.path] : [${Q}],
              }))
            );
          }
        } else if (${U}.value === undefined) {
          if (${Q} in input) newResult[${Q}] = undefined;
        } else {
          newResult[${Q}] = ${U}.value;
        }
        `)}else{const U=q[N];g.write(`const ${U} = ${K(N)};`),g.write(`
          if (${U}.issues.length) payload.issues = payload.issues.concat(${U}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Tt(N)}, ...iss.path] : [${Tt(N)}]
          })));`),g.write(`newResult[${Tt(N)}] = ${U}.value`)}g.write("payload.value = newResult;"),g.write("return payload;");const B=g.compile();return(N,U)=>B(k,N,U)};let o;const s=Qn,a=!hs.jitless,i=a&&ka.value,{catchall:h}=t;let c;e._zod.parse=(k,g)=>{c??(c=n.value);const C=k.value;if(!s(C))return k.issues.push({expected:"object",code:"invalid_type",input:C,inst:e}),k;const S=[];if(a&&i&&(g==null?void 0:g.async)===!1&&g.jitless!==!0)o||(o=r(t.shape)),k=o(k,g);else{k.value={};const U=c.shape;for(const Q of c.keys){const Oe=U[Q],Ke=Oe._zod.run({value:C[Q],issues:[]},g),nt=Oe._zod.optin==="optional"&&Oe._zod.optout==="optional";Ke instanceof Promise?S.push(Ke.then(vt=>nt?Wr(vt,k,Q,C):en(vt,k,Q))):nt?Wr(Ke,k,Q,C):en(Ke,k,Q)}}if(!h)return S.length?Promise.all(S).then(()=>k):k;const K=[],q=c.keySet,B=h._zod,N=B.def.type;for(const U of Object.keys(C)){if(q.has(U))continue;if(N==="never"){K.push(U);continue}const Q=B.run({value:C[U],issues:[]},g);Q instanceof Promise?S.push(Q.then(Oe=>en(Oe,k,U))):en(Q,k,U)}return K.length&&k.issues.push({code:"unrecognized_keys",keys:K,input:C,inst:e}),S.length?Promise.all(S).then(()=>k):k}});function Hr(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(s=>pt(s,r,ft())))}),t}const tl=w("$ZodUnion",(e,t)=>{ae.init(e,t),se(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),se(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>cr(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const s=[];for(const a of t.options){const l=a._zod.run({value:n.value,issues:[]},r);if(l instanceof Promise)s.push(l),o=!0;else{if(l.issues.length===0)return l;s.push(l)}}return o?Promise.all(s).then(a=>Hr(a,n,e,r)):Hr(s,n,e,r)}}),nl=w("$ZodIntersection",(e,t)=>{ae.init(e,t),e._zod.parse=(n,r)=>{const{value:o}=n,s=t.left._zod.run({value:o,issues:[]},r),a=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||a instanceof Promise?Promise.all([s,a]).then(([i,h])=>Vr(n,i,h)):Vr(n,s,a)}});function Jn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(qr(e)&&qr(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const a=Jn(e[s],t[s]);if(!a.valid)return{valid:!1,mergeErrorPath:[s,...a.mergeErrorPath]};o[s]=a.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],a=Jn(o,s);if(!a.valid)return{valid:!1,mergeErrorPath:[r,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Vr(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),Zt(e))return e;const r=Jn(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const rl=w("$ZodEnum",(e,t)=>{ae.init(e,t);const n=va(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(r=>ya.has(typeof r)).map(r=>typeof r=="string"?xt(r):r.toString()).join("|")})$`),e._zod.parse=(r,o)=>{const s=r.value;return e._zod.values.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),ol=w("$ZodLiteral",(e,t)=>{ae.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?xt(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),sl=w("$ZodTransform",(e,t)=>{ae.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(a=>(n.value=a,n));if(o instanceof Promise)throw new zt;return n.value=o,n}}),il=w("$ZodOptional",(e,t)=>{ae.init(e,t),e._zod.optin="optional",e._zod.optout="optional",se(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),se(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${cr(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),al=w("$ZodNullable",(e,t)=>{ae.init(e,t),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),se(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${cr(n.source)}|null)$`):void 0}),se(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),cl=w("$ZodDefault",(e,t)=>{ae.init(e,t),e._zod.optin="optional",se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Qr(s,t)):Qr(o,t)}});function Qr(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const ll=w("$ZodPrefault",(e,t)=>{ae.init(e,t),e._zod.optin="optional",se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),ul=w("$ZodNonOptional",(e,t)=>{ae.init(e,t),se(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Jr(s,e)):Jr(o,e)}});function Jr(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const hl=w("$ZodCatch",(e,t)=>{ae.init(e,t),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>pt(a,r,ft()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>pt(s,r,ft()))},input:n.value}),n.issues=[]),n)}}),fl=w("$ZodPipe",(e,t)=>{ae.init(e,t),se(e._zod,"values",()=>t.in._zod.values),se(e._zod,"optin",()=>t.in._zod.optin),se(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>Yr(s,t,r)):Yr(o,t,r)}});function Yr(e,t,n){return Zt(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const pl=w("$ZodReadonly",(e,t)=>{ae.init(e,t),se(e._zod,"propValues",()=>t.innerType._zod.propValues),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(Xr):Xr(o)}});function Xr(e){return e.value=Object.freeze(e.value),e}const dl=w("$ZodCustom",(e,t)=>{Ae.init(e,t),ae.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>eo(s,n,r,e));eo(o,n,r,e)}});function eo(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(Ot(o))}}class gl{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function ml(){return new gl}const tn=ml();function _l(e,t){return new e({type:"string",...O(t)})}function vl(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...O(t)})}function to(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...O(t)})}function bl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...O(t)})}function wl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...O(t)})}function kl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...O(t)})}function yl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...O(t)})}function $s(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...O(t)})}function El(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...O(t)})}function Cl(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...O(t)})}function Sl(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...O(t)})}function Al(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...O(t)})}function $l(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...O(t)})}function Tl(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...O(t)})}function Il(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...O(t)})}function Pl(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...O(t)})}function Zl(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...O(t)})}function zl(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...O(t)})}function Ol(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...O(t)})}function Rl(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...O(t)})}function Nl(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...O(t)})}function Ll(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...O(t)})}function xl(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...O(t)})}function Ml(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...O(t)})}function Fl(e,t){return new e({type:"string",format:"date",check:"string_format",...O(t)})}function Dl(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...O(t)})}function Ul(e,t){return new e({type:"string",format:"duration",check:"string_format",...O(t)})}function jl(e,t){return new e({type:"number",checks:[],...O(t)})}function Kl(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...O(t)})}function ql(e,t){return new e({type:"boolean",...O(t)})}function Gl(e){return new e({type:"unknown"})}function Bl(e,t){return new e({type:"never",...O(t)})}function no(e,t){return new Es({check:"less_than",...O(t),value:e,inclusive:!1})}function In(e,t){return new Es({check:"less_than",...O(t),value:e,inclusive:!0})}function ro(e,t){return new Cs({check:"greater_than",...O(t),value:e,inclusive:!1})}function Pn(e,t){return new Cs({check:"greater_than",...O(t),value:e,inclusive:!0})}function oo(e,t){return new uc({check:"multiple_of",...O(t),value:e})}function Ts(e,t){return new fc({check:"max_length",...O(t),maximum:e})}function pn(e,t){return new pc({check:"min_length",...O(t),minimum:e})}function Is(e,t){return new dc({check:"length_equals",...O(t),length:e})}function Wl(e,t){return new gc({check:"string_format",format:"regex",...O(t),pattern:e})}function Hl(e){return new mc({check:"string_format",format:"lowercase",...O(e)})}function Vl(e){return new _c({check:"string_format",format:"uppercase",...O(e)})}function Ql(e,t){return new vc({check:"string_format",format:"includes",...O(t),includes:e})}function Jl(e,t){return new bc({check:"string_format",format:"starts_with",...O(t),prefix:e})}function Yl(e,t){return new wc({check:"string_format",format:"ends_with",...O(t),suffix:e})}function Mt(e){return new kc({check:"overwrite",tx:e})}function Xl(e){return Mt(t=>t.normalize(e))}function eu(){return Mt(e=>e.trim())}function tu(){return Mt(e=>e.toLowerCase())}function nu(){return Mt(e=>e.toUpperCase())}function ru(e,t,n){return new e({type:"array",element:t,...O(n)})}function ou(e,t,n){return new e({type:"custom",check:"custom",fn:t,...O(n)})}const su=w("ZodISODateTime",(e,t)=>{Nc.init(e,t),ce.init(e,t)});function iu(e){return Ml(su,e)}const au=w("ZodISODate",(e,t)=>{Lc.init(e,t),ce.init(e,t)});function cu(e){return Fl(au,e)}const lu=w("ZodISOTime",(e,t)=>{xc.init(e,t),ce.init(e,t)});function uu(e){return Dl(lu,e)}const hu=w("ZodISODuration",(e,t)=>{Mc.init(e,t),ce.init(e,t)});function fu(e){return Ul(hu,e)}const pu=(e,t)=>{gs.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>za(e,n)},flatten:{value:n=>Za(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},vn=w("ZodError",pu,{Parent:Error}),du=Oa(vn),gu=Ra(vn),mu=_s(vn),_u=vs(vn),le=w("ZodType",(e,t)=>(ae.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>gt(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>du(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>mu(e,n,r),e.parseAsync=async(n,r)=>gu(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>_u(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(uh(n,r)),e.superRefine=n=>e.check(hh(n)),e.overwrite=n=>e.check(Mt(n)),e.optional=()=>ao(e),e.nullable=()=>co(e),e.nullish=()=>ao(co(e)),e.nonoptional=n=>nh(e,n),e.array=()=>ju(e),e.or=n=>Y([e,n]),e.and=n=>Bu(e,n),e.transform=n=>lo(e,Qu(n)),e.default=n=>Xu(e,n),e.prefault=n=>th(e,n),e.catch=n=>oh(e,n),e.pipe=n=>lo(e,n),e.readonly=()=>ah(e),e.describe=n=>{const r=e.clone();return tn.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=tn.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return tn.get(e);const r=e.clone();return tn.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Ps=w("_ZodString",(e,t)=>{fr.init(e,t),le.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(Wl(...r)),e.includes=(...r)=>e.check(Ql(...r)),e.startsWith=(...r)=>e.check(Jl(...r)),e.endsWith=(...r)=>e.check(Yl(...r)),e.min=(...r)=>e.check(pn(...r)),e.max=(...r)=>e.check(Ts(...r)),e.length=(...r)=>e.check(Is(...r)),e.nonempty=(...r)=>e.check(pn(1,...r)),e.lowercase=r=>e.check(Hl(r)),e.uppercase=r=>e.check(Vl(r)),e.trim=()=>e.check(eu()),e.normalize=(...r)=>e.check(Xl(...r)),e.toLowerCase=()=>e.check(tu()),e.toUpperCase=()=>e.check(nu())}),vu=w("ZodString",(e,t)=>{fr.init(e,t),Ps.init(e,t),e.email=n=>e.check(vl(bu,n)),e.url=n=>e.check($s(Zs,n)),e.jwt=n=>e.check(xl(Nu,n)),e.emoji=n=>e.check(El(ku,n)),e.guid=n=>e.check(to(so,n)),e.uuid=n=>e.check(bl(nn,n)),e.uuidv4=n=>e.check(wl(nn,n)),e.uuidv6=n=>e.check(kl(nn,n)),e.uuidv7=n=>e.check(yl(nn,n)),e.nanoid=n=>e.check(Cl(yu,n)),e.guid=n=>e.check(to(so,n)),e.cuid=n=>e.check(Sl(Eu,n)),e.cuid2=n=>e.check(Al(Cu,n)),e.ulid=n=>e.check($l(Su,n)),e.base64=n=>e.check(Rl(zu,n)),e.base64url=n=>e.check(Nl(Ou,n)),e.xid=n=>e.check(Tl(Au,n)),e.ksuid=n=>e.check(Il($u,n)),e.ipv4=n=>e.check(Pl(Tu,n)),e.ipv6=n=>e.check(Zl(Iu,n)),e.cidrv4=n=>e.check(zl(Pu,n)),e.cidrv6=n=>e.check(Ol(Zu,n)),e.e164=n=>e.check(Ll(Ru,n)),e.datetime=n=>e.check(iu(n)),e.date=n=>e.check(cu(n)),e.time=n=>e.check(uu(n)),e.duration=n=>e.check(fu(n))});function $(e){return _l(vu,e)}const ce=w("ZodStringFormat",(e,t)=>{oe.init(e,t),Ps.init(e,t)}),bu=w("ZodEmail",(e,t)=>{Ac.init(e,t),ce.init(e,t)}),so=w("ZodGUID",(e,t)=>{Cc.init(e,t),ce.init(e,t)}),nn=w("ZodUUID",(e,t)=>{Sc.init(e,t),ce.init(e,t)}),Zs=w("ZodURL",(e,t)=>{$c.init(e,t),ce.init(e,t)});function wu(e){return $s(Zs,e)}const ku=w("ZodEmoji",(e,t)=>{Tc.init(e,t),ce.init(e,t)}),yu=w("ZodNanoID",(e,t)=>{Ic.init(e,t),ce.init(e,t)}),Eu=w("ZodCUID",(e,t)=>{Pc.init(e,t),ce.init(e,t)}),Cu=w("ZodCUID2",(e,t)=>{Zc.init(e,t),ce.init(e,t)}),Su=w("ZodULID",(e,t)=>{zc.init(e,t),ce.init(e,t)}),Au=w("ZodXID",(e,t)=>{Oc.init(e,t),ce.init(e,t)}),$u=w("ZodKSUID",(e,t)=>{Rc.init(e,t),ce.init(e,t)}),Tu=w("ZodIPv4",(e,t)=>{Fc.init(e,t),ce.init(e,t)}),Iu=w("ZodIPv6",(e,t)=>{Dc.init(e,t),ce.init(e,t)}),Pu=w("ZodCIDRv4",(e,t)=>{Uc.init(e,t),ce.init(e,t)}),Zu=w("ZodCIDRv6",(e,t)=>{jc.init(e,t),ce.init(e,t)}),zu=w("ZodBase64",(e,t)=>{Kc.init(e,t),ce.init(e,t)}),Ou=w("ZodBase64URL",(e,t)=>{Gc.init(e,t),ce.init(e,t)}),Ru=w("ZodE164",(e,t)=>{Bc.init(e,t),ce.init(e,t)}),Nu=w("ZodJWT",(e,t)=>{Hc.init(e,t),ce.init(e,t)}),zs=w("ZodNumber",(e,t)=>{As.init(e,t),le.init(e,t),e.gt=(r,o)=>e.check(ro(r,o)),e.gte=(r,o)=>e.check(Pn(r,o)),e.min=(r,o)=>e.check(Pn(r,o)),e.lt=(r,o)=>e.check(no(r,o)),e.lte=(r,o)=>e.check(In(r,o)),e.max=(r,o)=>e.check(In(r,o)),e.int=r=>e.check(D(r)),e.safe=r=>e.check(D(r)),e.positive=r=>e.check(ro(0,r)),e.nonnegative=r=>e.check(Pn(0,r)),e.negative=r=>e.check(no(0,r)),e.nonpositive=r=>e.check(In(0,r)),e.multipleOf=(r,o)=>e.check(oo(r,o)),e.step=(r,o)=>e.check(oo(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function ze(e){return jl(zs,e)}const Lu=w("ZodNumberFormat",(e,t)=>{Vc.init(e,t),zs.init(e,t)});function D(e){return Kl(Lu,e)}const xu=w("ZodBoolean",(e,t)=>{Qc.init(e,t),le.init(e,t)});function G(e){return ql(xu,e)}const Mu=w("ZodUnknown",(e,t)=>{Jc.init(e,t),le.init(e,t)});function io(){return Gl(Mu)}const Fu=w("ZodNever",(e,t)=>{Yc.init(e,t),le.init(e,t)});function Du(e){return Bl(Fu,e)}const Uu=w("ZodArray",(e,t)=>{Xc.init(e,t),le.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(pn(n,r)),e.nonempty=n=>e.check(pn(1,n)),e.max=(n,r)=>e.check(Ts(n,r)),e.length=(n,r)=>e.check(Is(n,r)),e.unwrap=()=>e.element});function ju(e,t){return ru(Uu,e,t)}const Ku=w("ZodObject",(e,t)=>{el.init(e,t),le.init(e,t),se(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>Wu(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:io()}),e.loose=()=>e.clone({...e._zod.def,catchall:io()}),e.strict=()=>e.clone({...e._zod.def,catchall:Du()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>$a(e,n),e.merge=n=>Ta(e,n),e.pick=n=>Sa(e,n),e.omit=n=>Aa(e,n),e.partial=(...n)=>Ia(Os,e,n[0]),e.required=(...n)=>Pa(Rs,e,n[0])});function P(e,t){const n={type:"object",get shape(){return lr(this,"shape",{...e}),this.shape},...O(t)};return new Ku(n)}const qu=w("ZodUnion",(e,t)=>{tl.init(e,t),le.init(e,t),e.options=t.options});function Y(e,t){return new qu({type:"union",options:e,...O(t)})}const Gu=w("ZodIntersection",(e,t)=>{nl.init(e,t),le.init(e,t)});function Bu(e,t){return new Gu({type:"intersection",left:e,right:t})}const Yn=w("ZodEnum",(e,t)=>{rl.init(e,t),le.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const a of r)if(n.has(a))s[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new Yn({...t,checks:[],...O(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const a of r)if(n.has(a))delete s[a];else throw new Error(`Key ${a} not found in enum`);return new Yn({...t,checks:[],...O(o),entries:s})}});function Wu(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new Yn({type:"enum",entries:n,...O(t)})}const Hu=w("ZodLiteral",(e,t)=>{ol.init(e,t),le.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function p(e,t){return new Hu({type:"literal",values:Array.isArray(e)?e:[e],...O(t)})}const Vu=w("ZodTransform",(e,t)=>{sl.init(e,t),le.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=s=>{if(typeof s=="string")n.issues.push(Ot(s,n.value,t));else{const a=s;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=n.value),a.inst??(a.inst=e),a.continue??(a.continue=!0),n.issues.push(Ot(a))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function Qu(e){return new Vu({type:"transform",transform:e})}const Os=w("ZodOptional",(e,t)=>{il.init(e,t),le.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ao(e){return new Os({type:"optional",innerType:e})}const Ju=w("ZodNullable",(e,t)=>{al.init(e,t),le.init(e,t),e.unwrap=()=>e._zod.def.innerType});function co(e){return new Ju({type:"nullable",innerType:e})}const Yu=w("ZodDefault",(e,t)=>{cl.init(e,t),le.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Xu(e,t){return new Yu({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const eh=w("ZodPrefault",(e,t)=>{ll.init(e,t),le.init(e,t),e.unwrap=()=>e._zod.def.innerType});function th(e,t){return new eh({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Rs=w("ZodNonOptional",(e,t)=>{ul.init(e,t),le.init(e,t),e.unwrap=()=>e._zod.def.innerType});function nh(e,t){return new Rs({type:"nonoptional",innerType:e,...O(t)})}const rh=w("ZodCatch",(e,t)=>{hl.init(e,t),le.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function oh(e,t){return new rh({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const sh=w("ZodPipe",(e,t)=>{fl.init(e,t),le.init(e,t),e.in=t.in,e.out=t.out});function lo(e,t){return new sh({type:"pipe",in:e,out:t})}const ih=w("ZodReadonly",(e,t)=>{pl.init(e,t),le.init(e,t)});function ah(e){return new ih({type:"readonly",innerType:e})}const ch=w("ZodCustom",(e,t)=>{dl.init(e,t),le.init(e,t)});function lh(e,t){const n=new Ae({check:"custom",...O(t)});return n._zod.check=e,n}function uh(e,t={}){return ou(ch,e,t)}function hh(e,t){const n=lh(r=>(r.addIssue=o=>{if(typeof o=="string")r.issues.push(Ot(o,r.value,n._zod.def));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=n),s.continue??(s.continue=!n._zod.def.abort),r.issues.push(Ot(s))}},e(r.value,r)),t);return n}const uo=Y([p("en"),p("fr")]),fh=e=>{switch(e){case"Pawn":return"p";case"Knight":return"n";case"Bishop":return"b";case"Rook":return"r";case"Queen":return"q";case"King":return"k"}},Zn=e=>{switch(e){case"p":return"Pawn";case"n":return"Knight";case"b":return"Bishop";case"r":return"Rook";case"q":return"Queen";case"k":return"King"}},Xn=["A","B","C","D","E","F","G","H"],Ns=["1","2","3","4","5","6","7","8"],ph=e=>{switch(e){case"1":return"8";case"2":return"7";case"3":return"6";case"4":return"5";case"5":return"4";case"6":return"3";case"7":return"2";case"8":return"1"}},Qe=e=>e[0],zn=e=>e[1],Ls=(e,t)=>e+t,Ce=()=>null,dh=(e,t,n,r,o,s,a)=>({_tag:"Normal",role:e,from:t,to:n,capture:r,promotion:o,check:s,checkmate:a}),gh=(e,t,n,r)=>({_tag:"EnPassant",from:e,to:t,check:n,checkmate:r}),rn=(e,t,n,r)=>({_tag:"Castle",king:e,rook:t,check:n,checkmate:r}),pr=e=>{switch(e._tag){case"Castle":return"King";case"EnPassant":return"Pawn";case"Normal":return e.role}},xs=e=>{switch(e._tag){case"Castle":switch(e.king){case"E1":return e.rook==="H1"?"G1":"C1";case"E8":return e.rook==="H8"?"G8":"C8"}case"EnPassant":case"Normal":return e.to}},mh=e=>{switch(e._tag){case"Castle":return e.king;case"EnPassant":case"Normal":return e.from}},_h=e=>{switch(e._tag){case"Castle":return!1;case"EnPassant":return!0;case"Normal":return e.capture!==null}},vh=e=>[mh(e),xs(e),e._tag==="Normal"&&e.promotion!==null?fh(e.promotion):""].join("").toLowerCase(),Ms=e=>e==="black"?"white":"black",bn=()=>({_tag:"none"}),bh=e=>({_tag:"role",role:e}),wh=(e,t)=>({_tag:"candidates",role:e,candidates:t}),kh=e=>({_tag:"move",move:e}),dn=e=>{switch(e._tag){case"role":case"candidates":return e.role;case"move":return pr(e.move)}},dr=e=>({...e,timestamp:Date.now()}),yh=e=>({_tag:"sending",since:Date.now(),request:e}),Eh=(e,t)=>({_tag:"sent",since:Date.now(),request:e,cancel:t}),Fs=(e,t)=>dr({from:e,body:t}),Ch=({username:e,text:t})=>Fs(e,t),Sh=e=>({_tag:"claim",at:e}),Ah=(e,t)=>{const n=[[]];for(let r=0;r<t.length;r++){let o=Math.floor(r/e);o===n.length&&n.push([]),n[o].push(t[r])}return n},$h=["localhost","127.0.0.1","10\\..+","172\\.16\\..+","192\\.168\\..+"].map(e=>new RegExp(e)),Th=e=>$h.some(t=>t.test(e)),Ds=[[15,10],[30,20],[40,30],[60,30],[90,30],[120,30]],gr=(e,t,n=" ")=>(t=t>>0,n=String(typeof n<"u"?n:" "),e.length>t?String(e):(t=t-e.length,t>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(e))),mt=(e,t)=>(t((r,o)=>{e.setAttribute(r,o.toString())}),e),me=(e,t)=>(t((r,o)=>{e.addEventListener(r,o)}),e);function Ee(e){for(;e.firstChild;)Ih(e.firstChild);return e}function Ih(e,t=!1){t||Ee(e);const n=e.parentNode;n&&n.removeChild(e)}const Ph=e=>document.createElement(e),ho=e=>t=>t.appendChild(document.createTextNode(e)),wn=(e,t)=>{const n=Ph(e);return n.setAttribute("class",t),n},Zh=e=>t=>{typeof t=="number"?ho(t.toLocaleString())(e):ho(t)(e)},zh=e=>t=>{e.appendChild(t)},fo=(e,t)=>{typeof t=="number"||typeof t=="string"?Zh(e)(t):zh(e)(t)},mr=e=>t=>{_a(t)?Se(n=>fo(e,n))(t):fo(e,t)},ee=e=>(...t)=>{const n=mr(e);Ee(e),t.forEach(n)},Oh=e=>t=>t.classList.contains(e),_r=(...e)=>t=>(t.classList.add(...e),t),vr=(...e)=>t=>(t.classList.remove(...e),t),qe=(e,t,n)=>{const r=wn(e,t);return n.forEach(mr(r)),r},u=(e,...t)=>qe("div",e,t),We=(...e)=>qe("p","",e),et=(e,...t)=>qe("span",e,t),gn=(e,...t)=>qe("h1",e,t),Rh=(e,...t)=>qe("h2",e,t),Nh=(e,...t)=>qe("pre",e,t),Lh=(e,t)=>mt(wn("input",e),n=>n("type",t)),Rt=(e,t,...n)=>mt(qe("a",e,n),r=>r("href",t)),xh=(e,t)=>{const n=wn("img",e);return n.setAttribute("src",t),n},Mh=(e,t)=>mt(wn("audio",e),n=>{n("src",t)}),br=(e,t,...n)=>{const r=qe("details",e,[qe("summary","",[t])]),o=mr(r);return n.forEach(o),r};var On,po;function Fh(){if(po)return On;po=1;function e(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function t(i,h,c,k,g){const C={move:i,variations:g};return h&&(C.suffix=h),c&&(C.nag=c),k!==null&&(C.comment=k),C}function n(...i){const[h,...c]=i;let k=h;for(const g of c)g!==null&&(k.variations=[g,...g.variations],g.variations=[],k=g);return h}function r(i,h){if(h.marker&&h.marker.comment){let c=h.root;for(;;){const k=c.variations[0];if(!k){c.comment=h.marker.comment;break}c=k}}return{headers:i,root:h.root,result:(h.marker&&h.marker.result)??void 0}}function o(i,h){function c(){this.constructor=i}c.prototype=h.prototype,i.prototype=new c}function s(i,h,c,k){var g=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(g,s.prototype),g.expected=h,g.found=c,g.location=k,g.name="SyntaxError",g}o(s,Error);function a(i,h,c){return c=c||" ",i.length>h?i:(h-=i.length,c+=c.repeat(h),i+c.slice(0,h))}s.prototype.format=function(i){var h="Error: "+this.message;if(this.location){var c=null,k;for(k=0;k<i.length;k++)if(i[k].source===this.location.source){c=i[k].text.split(/\r\n|\n|\r/g);break}var g=this.location.start,C=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(g):g,S=this.location.source+":"+C.line+":"+C.column;if(c){var K=this.location.end,q=a("",C.line.toString().length," "),B=c[g.line-1],N=g.line===K.line?K.column:B.length+1,U=N-g.column||1;h+=`
 --> `+S+`
`+q+` |
`+C.line+" | "+B+`
`+q+" | "+a("",g.column-1," ")+a("",U,"^")}else h+=`
 at `+S}return h},s.buildMessage=function(i,h){var c={literal:function(B){return'"'+g(B.text)+'"'},class:function(B){var N=B.parts.map(function(U){return Array.isArray(U)?C(U[0])+"-"+C(U[1]):C(U)});return"["+(B.inverted?"^":"")+N.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(B){return B.description}};function k(B){return B.charCodeAt(0).toString(16).toUpperCase()}function g(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(N){return"\\x0"+k(N)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(N){return"\\x"+k(N)})}function C(B){return B.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(N){return"\\x0"+k(N)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(N){return"\\x"+k(N)})}function S(B){return c[B.type](B)}function K(B){var N=B.map(S),U,Q;if(N.sort(),N.length>0){for(U=1,Q=1;U<N.length;U++)N[U-1]!==N[U]&&(N[Q]=N[U],Q++);N.length=Q}switch(N.length){case 1:return N[0];case 2:return N[0]+" or "+N[1];default:return N.slice(0,-1).join(", ")+", or "+N[N.length-1]}}function q(B){return B?'"'+g(B)+'"':"end of input"}return"Expected "+K(i)+" but "+q(h)+" found."};function l(i,h){h=h!==void 0?h:{};var c={},k=h.grammarSource,g={pgn:Mr},C=Mr,S="[",K='"',q="]",B=".",N="O-O-O",U="O-O",Q="0-0-0",Oe="0-0",Ke="$",nt="{",vt="}",rt=";",Gt="(",An=")",St="1-0",ot="0-1",Bt="1/2-1/2",b="*",d=/^[a-zA-Z]/,y=/^[^"]/,T=/^[0-9]/,Z=/^[.]/,I=/^[a-zA-Z1-8\-=]/,V=/^[+#]/,H=/^[!?]/,ne=/^[^}]/,M=/^[^\r\n]/,J=/^[ \t\r\n]/,pe=Ie("tag pair"),Re=de("[",!1),Me=de('"',!1),st=de("]",!1),Ge=Ie("tag name"),ve=Ue([["a","z"],["A","Z"]],!1,!1),Fe=Ie("tag value"),it=Ue(['"'],!0,!1),bt=Ie("move number"),De=Ue([["0","9"]],!1,!1),Ne=de(".",!1),Be=Ue(["."],!1,!1),At=Ie("standard algebraic notation"),Wt=de("O-O-O",!1),$n=de("O-O",!1),Ht=de("0-0-0",!1),at=de("0-0",!1),Vt=Ue([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Ti=Ue(["+","#"],!1,!1),Ii=Ie("suffix annotation"),zr=Ue(["!","?"],!1,!1),Pi=Ie("NAG"),Zi=de("$",!1),zi=Ie("brace comment"),Oi=de("{",!1),Or=Ue(["}"],!0,!1),Ri=de("}",!1),Ni=Ie("rest of line comment"),Li=de(";",!1),Rr=Ue(["\r",`
`],!0,!1),xi=Ie("variation"),Mi=de("(",!1),Fi=de(")",!1),Di=Ie("game termination marker"),Ui=de("1-0",!1),ji=de("0-1",!1),Ki=de("1/2-1/2",!1),qi=de("*",!1),Gi=Ie("whitespace"),Nr=Ue([" ","	","\r",`
`],!1,!1),Bi=function(f,_){return r(f,_)},Wi=function(f){return Object.fromEntries(f)},Hi=function(f,_){return[f,_]},Vi=function(f,_){return{root:f,marker:_}},Qi=function(f,_){return n(e(f),..._.flat())},Ji=function(f,_,v,L,x){return t(f,_,v,L,x)},Yi=function(f){return f},Xi=function(f){return f.replace(/[\r\n]+/g," ")},ea=function(f){return f.trim()},ta=function(f){return f},na=function(f,_){return{result:f,comment:_}},m=h.peg$currPos|0,wt=[{line:1,column:1}],Le=m,Qt=h.peg$maxFailExpected||[],A=h.peg$silentFails|0,$t;if(h.startRule){if(!(h.startRule in g))throw new Error(`Can't start parsing from rule "`+h.startRule+'".');C=g[h.startRule]}function de(f,_){return{type:"literal",text:f,ignoreCase:_}}function Ue(f,_,v){return{type:"class",parts:f,inverted:_,ignoreCase:v}}function ra(){return{type:"end"}}function Ie(f){return{type:"other",description:f}}function Lr(f){var _=wt[f],v;if(_)return _;if(f>=wt.length)v=wt.length-1;else for(v=f;!wt[--v];);for(_=wt[v],_={line:_.line,column:_.column};v<f;)i.charCodeAt(v)===10?(_.line++,_.column=1):_.column++,v++;return wt[f]=_,_}function xr(f,_,v){var L=Lr(f),x=Lr(_),X={source:k,start:{offset:f,line:L.line,column:L.column},end:{offset:_,line:x.line,column:x.column}};return X}function R(f){m<Le||(m>Le&&(Le=m,Qt=[]),Qt.push(f))}function oa(f,_,v){return new s(s.buildMessage(f,_),f,_,v)}function Mr(){var f,_,v;return f=m,_=sa(),v=ca(),f=Bi(_,v),f}function sa(){var f,_,v;for(f=m,_=[],v=Fr();v!==c;)_.push(v),v=Fr();return v=ke(),f=Wi(_),f}function Fr(){var f,_,v,L,x,X,ct;return A++,f=m,ke(),i.charCodeAt(m)===91?(_=S,m++):(_=c,A===0&&R(Re)),_!==c?(ke(),v=ia(),v!==c?(ke(),i.charCodeAt(m)===34?(L=K,m++):(L=c,A===0&&R(Me)),L!==c?(x=aa(),i.charCodeAt(m)===34?(X=K,m++):(X=c,A===0&&R(Me)),X!==c?(ke(),i.charCodeAt(m)===93?(ct=q,m++):(ct=c,A===0&&R(st)),ct!==c?f=Hi(v,x):(m=f,f=c)):(m=f,f=c)):(m=f,f=c)):(m=f,f=c)):(m=f,f=c),A--,f===c&&A===0&&R(pe),f}function ia(){var f,_,v;if(A++,f=m,_=[],v=i.charAt(m),d.test(v)?m++:(v=c,A===0&&R(ve)),v!==c)for(;v!==c;)_.push(v),v=i.charAt(m),d.test(v)?m++:(v=c,A===0&&R(ve));else _=c;return _!==c?f=i.substring(f,m):f=_,A--,f===c&&(_=c,A===0&&R(Ge)),f}function aa(){var f,_,v;for(A++,f=m,_=[],v=i.charAt(m),y.test(v)?m++:(v=c,A===0&&R(it));v!==c;)_.push(v),v=i.charAt(m),y.test(v)?m++:(v=c,A===0&&R(it));return f=i.substring(f,m),A--,_=c,A===0&&R(Fe),f}function ca(){var f,_,v;return f=m,_=Dr(),ke(),v=da(),v===c&&(v=null),ke(),f=Vi(_,v),f}function Dr(){var f,_,v,L;for(f=m,_=Tn(),_===c&&(_=null),v=[],L=Ur();L!==c;)v.push(L),L=Ur();return f=Qi(_,v),f}function Ur(){var f,_,v,L,x,X,ct,Jt;if(f=m,ke(),la(),ke(),_=ua(),_!==c){for(v=ha(),v===c&&(v=null),L=[],x=jr();x!==c;)L.push(x),x=jr();for(x=ke(),X=Tn(),X===c&&(X=null),ct=[],Jt=Kr();Jt!==c;)ct.push(Jt),Jt=Kr();f=Ji(_,v,L,X,ct)}else m=f,f=c;return f}function la(){var f,_,v,L,x,X;for(A++,f=m,_=[],v=i.charAt(m),T.test(v)?m++:(v=c,A===0&&R(De));v!==c;)_.push(v),v=i.charAt(m),T.test(v)?m++:(v=c,A===0&&R(De));if(i.charCodeAt(m)===46?(v=B,m++):(v=c,A===0&&R(Ne)),v!==c){for(L=ke(),x=[],X=i.charAt(m),Z.test(X)?m++:(X=c,A===0&&R(Be));X!==c;)x.push(X),X=i.charAt(m),Z.test(X)?m++:(X=c,A===0&&R(Be));_=[_,v,L,x],f=_}else m=f,f=c;return A--,f===c&&(_=c,A===0&&R(bt)),f}function ua(){var f,_,v,L,x,X;if(A++,f=m,_=m,i.substr(m,5)===N?(v=N,m+=5):(v=c,A===0&&R(Wt)),v===c&&(i.substr(m,3)===U?(v=U,m+=3):(v=c,A===0&&R($n)),v===c&&(i.substr(m,5)===Q?(v=Q,m+=5):(v=c,A===0&&R(Ht)),v===c&&(i.substr(m,3)===Oe?(v=Oe,m+=3):(v=c,A===0&&R(at)),v===c))))if(v=m,L=i.charAt(m),d.test(L)?m++:(L=c,A===0&&R(ve)),L!==c){if(x=[],X=i.charAt(m),I.test(X)?m++:(X=c,A===0&&R(Vt)),X!==c)for(;X!==c;)x.push(X),X=i.charAt(m),I.test(X)?m++:(X=c,A===0&&R(Vt));else x=c;x!==c?(L=[L,x],v=L):(m=v,v=c)}else m=v,v=c;return v!==c?(L=i.charAt(m),V.test(L)?m++:(L=c,A===0&&R(Ti)),L===c&&(L=null),v=[v,L],_=v):(m=_,_=c),_!==c?f=i.substring(f,m):f=_,A--,f===c&&(_=c,A===0&&R(At)),f}function ha(){var f,_,v;for(A++,f=m,_=[],v=i.charAt(m),H.test(v)?m++:(v=c,A===0&&R(zr));v!==c;)_.push(v),_.length>=2?v=c:(v=i.charAt(m),H.test(v)?m++:(v=c,A===0&&R(zr)));return _.length<1?(m=f,f=c):f=_,A--,f===c&&(_=c,A===0&&R(Ii)),f}function jr(){var f,_,v,L,x;if(A++,f=m,ke(),i.charCodeAt(m)===36?(_=Ke,m++):(_=c,A===0&&R(Zi)),_!==c){if(v=m,L=[],x=i.charAt(m),T.test(x)?m++:(x=c,A===0&&R(De)),x!==c)for(;x!==c;)L.push(x),x=i.charAt(m),T.test(x)?m++:(x=c,A===0&&R(De));else L=c;L!==c?v=i.substring(v,m):v=L,v!==c?f=Yi(v):(m=f,f=c)}else m=f,f=c;return A--,f===c&&A===0&&R(Pi),f}function Tn(){var f;return f=fa(),f===c&&(f=pa()),f}function fa(){var f,_,v,L,x;if(A++,f=m,i.charCodeAt(m)===123?(_=nt,m++):(_=c,A===0&&R(Oi)),_!==c){for(v=m,L=[],x=i.charAt(m),ne.test(x)?m++:(x=c,A===0&&R(Or));x!==c;)L.push(x),x=i.charAt(m),ne.test(x)?m++:(x=c,A===0&&R(Or));v=i.substring(v,m),i.charCodeAt(m)===125?(L=vt,m++):(L=c,A===0&&R(Ri)),L!==c?f=Xi(v):(m=f,f=c)}else m=f,f=c;return A--,f===c&&(_=c,A===0&&R(zi)),f}function pa(){var f,_,v,L,x;if(A++,f=m,i.charCodeAt(m)===59?(_=rt,m++):(_=c,A===0&&R(Li)),_!==c){for(v=m,L=[],x=i.charAt(m),M.test(x)?m++:(x=c,A===0&&R(Rr));x!==c;)L.push(x),x=i.charAt(m),M.test(x)?m++:(x=c,A===0&&R(Rr));v=i.substring(v,m),f=ea(v)}else m=f,f=c;return A--,f===c&&(_=c,A===0&&R(Ni)),f}function Kr(){var f,_,v,L;return A++,f=m,ke(),i.charCodeAt(m)===40?(_=Gt,m++):(_=c,A===0&&R(Mi)),_!==c?(v=Dr(),v!==c?(ke(),i.charCodeAt(m)===41?(L=An,m++):(L=c,A===0&&R(Fi)),L!==c?f=ta(v):(m=f,f=c)):(m=f,f=c)):(m=f,f=c),A--,f===c&&A===0&&R(xi),f}function da(){var f,_,v;return A++,f=m,i.substr(m,3)===St?(_=St,m+=3):(_=c,A===0&&R(Ui)),_===c&&(i.substr(m,3)===ot?(_=ot,m+=3):(_=c,A===0&&R(ji)),_===c&&(i.substr(m,7)===Bt?(_=Bt,m+=7):(_=c,A===0&&R(Ki)),_===c&&(i.charCodeAt(m)===42?(_=b,m++):(_=c,A===0&&R(qi))))),_!==c?(ke(),v=Tn(),v===c&&(v=null),f=na(_,v)):(m=f,f=c),A--,f===c&&(_=c,A===0&&R(Di)),f}function ke(){var f,_;for(A++,f=[],_=i.charAt(m),J.test(_)?m++:(_=c,A===0&&R(Nr));_!==c;)f.push(_),_=i.charAt(m),J.test(_)?m++:(_=c,A===0&&R(Nr));return A--,_=c,A===0&&R(Gi),f}if($t=C(),h.peg$library)return{peg$result:$t,peg$currPos:m,peg$FAILED:c,peg$maxFailExpected:Qt,peg$maxFailPos:Le};if($t!==c&&m===i.length)return $t;throw $t!==c&&m<i.length&&R(ra()),oa(Qt,Le<i.length?i.charAt(Le):null,Le<i.length?xr(Le,Le+1):xr(Le,Le))}return On={StartRules:["pgn"],SyntaxError:s,parse:l},On}var Dh=Fh();/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const un=0xffffffffffffffffn;function Rn(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function go(e,t){return e*t&un}function Uh(e){return function(){let t=BigInt(e&un),n=BigInt(e>>64n&un);const r=go(Rn(go(t,5n),7n),9n);return n^=t,t=(Rn(t,24n)^n^n<<16n)&un,n=Rn(n,37n),e=n<<64n|t,r}}const kn=Uh(0xa187eb39cdcaed8f31c4b365b102e01en),jh=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>kn()))),Kh=Array.from({length:8},()=>kn()),qh=Array.from({length:16},()=>kn()),Nn=kn(),we="w",Pe="b",ue="p",er="n",hn="b",Pt="r",Je="q",fe="k",Ln="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class on{constructor(t,n){re(this,"color");re(this,"from");re(this,"to");re(this,"piece");re(this,"captured");re(this,"promotion");re(this,"flags");re(this,"san");re(this,"lan");re(this,"before");re(this,"after");const{color:r,piece:o,from:s,to:a,flags:l,captured:i,promotion:h}=n,c=ge(s),k=ge(a);this.color=r,this.piece=o,this.from=c,this.to=k,this.san=t._moveToSan(n,t._moves({legal:!0})),this.lan=c+k,this.before=t.fen(),t._makeMove(n),this.after=t.fen(),t._undoMove(),this.flags="";for(const g in W)W[g]&l&&(this.flags+=lt[g]);i&&(this.captured=i),h&&(this.promotion=h,this.lan+=h)}isCapture(){return this.flags.indexOf(lt.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(lt.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(lt.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(lt.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(lt.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(lt.BIG_PAWN)>-1}}const be=-1,lt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},W={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},tr={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Gh={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Bh={...tr,...Gh},F={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},xn={b:[16,32,17,15],w:[-16,-32,-17,-15]},mo={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Wh=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Hh=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Vh={p:1,n:2,b:4,r:8,q:16,k:32},Qh="pnbrqkPNBRQK",_o=[er,hn,Pt,Je],Jh=7,Yh=6,Xh=1,ef=0,sn={[fe]:W.KSIDE_CASTLE,[Je]:W.QSIDE_CASTLE},He={w:[{square:F.a1,flag:W.QSIDE_CASTLE},{square:F.h1,flag:W.KSIDE_CASTLE}],b:[{square:F.a8,flag:W.QSIDE_CASTLE},{square:F.h8,flag:W.KSIDE_CASTLE}]},tf={b:Xh,w:Yh};function ut(e){return e>>4}function Nt(e){return e&15}function Us(e){return"0123456789".indexOf(e)!==-1}function ge(e){const t=Nt(e),n=ut(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function It(e){return e===we?Pe:we}function nf(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=t[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<o.length;a++){let l=0,i=!1;for(let h=0;h<o[a].length;h++)if(Us(o[a][h])){if(i)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(o[a][h],10),i=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[a][h]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,i=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:l}of s){if(!l.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((t[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(o[0]+o[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function rf(e,t){const n=e.from,r=e.to,o=e.piece;let s=0,a=0,l=0;for(let i=0,h=t.length;i<h;i++){const c=t[i].from,k=t[i].to,g=t[i].piece;o===g&&n!==c&&r===k&&(s++,ut(n)===ut(c)&&a++,Nt(n)===Nt(c)&&l++)}return s>0?a>0&&l>0?ge(n):l>0?ge(n).charAt(1):ge(n).charAt(0):""}function Ve(e,t,n,r,o,s=void 0,a=W.NORMAL){const l=ut(r);if(o===ue&&(l===Jh||l===ef))for(let i=0;i<_o.length;i++){const h=_o[i];e.push({color:t,from:n,to:r,piece:o,captured:s,promotion:h,flags:a|W.PROMOTION})}else e.push({color:t,from:n,to:r,piece:o,captured:s,flags:a})}function vo(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:ue:(t=t.toLowerCase(),t==="o"?fe:t)}function Mn(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class wr{constructor(t=Ln,{skipValidation:n=!1}={}){re(this,"_board",new Array(128));re(this,"_turn",we);re(this,"_header",{});re(this,"_kings",{w:be,b:be});re(this,"_epSquare",-1);re(this,"_halfMoves",0);re(this,"_moveNumber",0);re(this,"_history",[]);re(this,"_comments",{});re(this,"_castling",{w:0,b:0});re(this,"_hash",0n);re(this,"_positionCount",new Map);this.load(t,{skipValidation:n})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:be,b:be},this._turn=we,this._castling={w:0,b:0},this._epSquare=be,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Bh},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:n=!1,preserveHeaders:r=!1}={}){let o=t.split(/\s+/);if(o.length>=2&&o.length<6){const l=["-","-","0","1"];t=o.concat(l.slice(-(6-o.length))).join(" ")}if(o=t.split(/\s+/),!n){const{ok:l,error:i}=nf(t);if(!l)throw new Error(i)}const s=o[0];let a=0;this.clear({preserveHeaders:r});for(let l=0;l<s.length;l++){const i=s.charAt(l);if(i==="/")a+=8;else if(Us(i))a+=parseInt(i,10);else{const h=i<"a"?we:Pe;this._put({type:i.toLowerCase(),color:h},ge(a)),a++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=W.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=W.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=W.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=W.QSIDE_CASTLE),this._epSquare=o[3]==="-"?be:F[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var a,l;let n=0,r="";for(let i=F.a8;i<=F.h1;i++){if(this._board[i]){n>0&&(r+=n,n=0);const{color:h,type:c}=this._board[i];r+=h===we?c.toUpperCase():c.toLowerCase()}else n++;i+1&136&&(n>0&&(r+=n),i!==F.h1&&(r+="/"),n=0,i+=8)}let o="";this._castling[we]&W.KSIDE_CASTLE&&(o+="K"),this._castling[we]&W.QSIDE_CASTLE&&(o+="Q"),this._castling[Pe]&W.KSIDE_CASTLE&&(o+="k"),this._castling[Pe]&W.QSIDE_CASTLE&&(o+="q"),o=o||"-";let s="-";if(this._epSquare!==be)if(t)s=ge(this._epSquare);else{const i=this._epSquare+(this._turn===we?16:-16),h=[i+1,i-1];for(const c of h){if(c&136)continue;const k=this._turn;if(((a=this._board[c])==null?void 0:a.color)===k&&((l=this._board[c])==null?void 0:l.type)===ue){this._makeMove({color:k,from:c,to:this._epSquare,piece:ue,captured:ue,flags:W.EP_CAPTURE});const g=!this._isKingAttacked(k);if(this._undoMove(),g){s=ge(this._epSquare);break}}}}return[r,this._turn,o,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:n,type:r}=this._board[t],o={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[r];return jh[o][s][t]}_epKey(){return this._epSquare===be?0n:Kh[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return qh[t]}_computeHash(){let t=0n;for(let n=F.a8;n<=F.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(t^=this._pieceKey(n))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=Nn),t}_updateSetup(t){this._history.length>0||(t!==Ln?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Ln)}get(t){return this._board[F[t]]}findPiece(t){var r;const n=[];for(let o=F.a8;o<=F.h1;o++){if(o&136){o+=7;continue}!this._board[o]||((r=this._board[o])==null?void 0:r.color)!==t.color||this._board[o].color===t.color&&this._board[o].type===t.type&&n.push(ge(o))}return n}put({type:t,color:n},r){return this._put({type:t,color:n},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,n){this._hash^=this._pieceKey(t),this._board[t]=n,this._hash^=this._pieceKey(t)}_put({type:t,color:n},r){if(Qh.indexOf(t.toLowerCase())===-1||!(r in F))return!1;const o=F[r];if(t==fe&&!(this._kings[n]==be||this._kings[n]==o))return!1;const s=this._board[o];return s&&s.type===fe&&(this._kings[s.color]=be),this._set(o,{type:t,color:n}),t===fe&&(this._kings[n]=o),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const n=this.get(t);return this._clear(F[t]),n&&n.type===fe&&(this._kings[n.color]=be),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var r,o,s,a,l,i,h,c,k,g,C,S;this._hash^=this._castlingKey();const t=((r=this._board[F.e1])==null?void 0:r.type)===fe&&((o=this._board[F.e1])==null?void 0:o.color)===we,n=((s=this._board[F.e8])==null?void 0:s.type)===fe&&((a=this._board[F.e8])==null?void 0:a.color)===Pe;(!t||((l=this._board[F.a1])==null?void 0:l.type)!==Pt||((i=this._board[F.a1])==null?void 0:i.color)!==we)&&(this._castling.w&=-65),(!t||((h=this._board[F.h1])==null?void 0:h.type)!==Pt||((c=this._board[F.h1])==null?void 0:c.color)!==we)&&(this._castling.w&=-33),(!n||((k=this._board[F.a8])==null?void 0:k.type)!==Pt||((g=this._board[F.a8])==null?void 0:g.color)!==Pe)&&(this._castling.b&=-65),(!n||((C=this._board[F.h8])==null?void 0:C.type)!==Pt||((S=this._board[F.h8])==null?void 0:S.color)!==Pe)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,a;if(this._epSquare===be)return;const t=this._epSquare+(this._turn===we?-16:16),n=this._epSquare+(this._turn===we?16:-16),r=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==It(this._turn)||((a=this._board[n])==null?void 0:a.type)!==ue){this._hash^=this._epKey(),this._epSquare=be;return}const o=l=>{var i,h;return!(l&136)&&((i=this._board[l])==null?void 0:i.color)===this._turn&&((h=this._board[l])==null?void 0:h.type)===ue};r.some(o)||(this._hash^=this._epKey(),this._epSquare=be)}_attacked(t,n,r){const o=[];for(let s=F.a8;s<=F.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==t)continue;const a=this._board[s],l=s-n;if(l===0)continue;const i=l+119;if(Wh[i]&Vh[a.type]){if(a.type===ue){if(l>0&&a.color===we||l<=0&&a.color===Pe)if(r)o.push(ge(s));else return!0;continue}if(a.type==="n"||a.type==="k")if(r){o.push(ge(s));continue}else return!0;const h=Hh[i];let c=s+h,k=!1;for(;c!==n;){if(this._board[c]!=null){k=!0;break}c+=h}if(!k)if(r){o.push(ge(s));continue}else return!0}}return r?o:!1}attackers(t,n){return n?this._attacked(n,F[t],!0):this._attacked(this._turn,F[t],!0)}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(It(t),n)}hash(){return this._hash.toString(16)}isAttacked(t,n){return this._attacked(n,F[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let r=0,o=0;for(let s=F.a8;s<=F.h1;s++){if(o=(o+1)%2,s&136){s+=7;continue}const a=this._board[s];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===hn&&n.push(o),r++)}if(r===2)return!0;if(r===3&&(t[hn]===1||t[er]===1))return!0;if(r===t[hn]+2){let s=0;const a=n.length;for(let l=0;l<a;l++)s+=n[l];if(s===0||s===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:r=void 0}={}){const o=this._moves({square:n,piece:r});return t?o.map(s=>new on(this,s)):o.map(s=>this._moveToSan(s,o))}_moves({legal:t=!0,piece:n=void 0,square:r=void 0}={}){var C;const o=r?r.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),a=[],l=this._turn,i=It(l);let h=F.a8,c=F.h1,k=!1;if(o)if(o in F)h=c=F[o],k=!0;else return[];for(let S=h;S<=c;S++){if(S&136){S+=7;continue}if(!this._board[S]||this._board[S].color===i)continue;const{type:K}=this._board[S];let q;if(K===ue){if(s&&s!==K)continue;q=S+xn[l][0],this._board[q]||(Ve(a,l,S,q,ue),q=S+xn[l][1],tf[l]===ut(S)&&!this._board[q]&&Ve(a,l,S,q,ue,void 0,W.BIG_PAWN));for(let B=2;B<4;B++)q=S+xn[l][B],!(q&136)&&(((C=this._board[q])==null?void 0:C.color)===i?Ve(a,l,S,q,ue,this._board[q].type,W.CAPTURE):q===this._epSquare&&Ve(a,l,S,q,ue,ue,W.EP_CAPTURE))}else{if(s&&s!==K)continue;for(let B=0,N=mo[K].length;B<N;B++){const U=mo[K][B];for(q=S;q+=U,!(q&136);){if(!this._board[q])Ve(a,l,S,q,K);else{if(this._board[q].color===l)break;Ve(a,l,S,q,K,this._board[q].type,W.CAPTURE);break}if(K===er||K===fe)break}}}}if((s===void 0||s===fe)&&(!k||c===this._kings[l])){if(this._castling[l]&W.KSIDE_CASTLE){const S=this._kings[l],K=S+2;!this._board[S+1]&&!this._board[K]&&!this._attacked(i,this._kings[l])&&!this._attacked(i,S+1)&&!this._attacked(i,K)&&Ve(a,l,this._kings[l],K,fe,void 0,W.KSIDE_CASTLE)}if(this._castling[l]&W.QSIDE_CASTLE){const S=this._kings[l],K=S-2;!this._board[S-1]&&!this._board[S-2]&&!this._board[S-3]&&!this._attacked(i,this._kings[l])&&!this._attacked(i,S-1)&&!this._attacked(i,K)&&Ve(a,l,this._kings[l],K,fe,void 0,W.QSIDE_CASTLE)}}if(!t||this._kings[l]===-1)return a;const g=[];for(let S=0,K=a.length;S<K;S++)this._makeMove(a[S]),this._isKingAttacked(l)||g.push(a[S]),this._undoMove();return g}move(t,{strict:n=!1}={}){let r=null;if(typeof t=="string")r=this._moveFromSan(t,n);else if(typeof t=="object"){const s=this._moves();for(let a=0,l=s.length;a<l;a++)if(t.from===ge(s[a].from)&&t.to===ge(s[a].to)&&(!("promotion"in s[a])||t.promotion===s[a].promotion)){r=s[a];break}}if(!r)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const o=new on(this,r);return this._makeMove(r),this._incPositionCount(),o}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,n){this._hash^=this._pieceKey(t),this._board[n]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(n)}_makeMove(t){var o,s,a,l;const n=this._turn,r=It(n);if(this._push(t),this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&W.EP_CAPTURE&&(this._turn===Pe?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:n})),this._board[t.to].type===fe){if(this._kings[n]=t.to,t.flags&W.KSIDE_CASTLE){const i=t.to-1,h=t.to+1;this._movePiece(h,i)}else if(t.flags&W.QSIDE_CASTLE){const i=t.to+1,h=t.to-2;this._movePiece(h,i)}this._castling[n]=0}if(this._castling[n]){for(let i=0,h=He[n].length;i<h;i++)if(t.from===He[n][i].square&&this._castling[n]&He[n][i].flag){this._castling[n]^=He[n][i].flag;break}}if(this._castling[r]){for(let i=0,h=He[r].length;i<h;i++)if(t.to===He[r][i].square&&this._castling[r]&He[r][i].flag){this._castling[r]^=He[r][i].flag;break}}if(this._hash^=this._castlingKey(),t.flags&W.BIG_PAWN){let i;n===Pe?i=t.to-16:i=t.to+16,!(t.to-1&136)&&((o=this._board[t.to-1])==null?void 0:o.type)===ue&&((s=this._board[t.to-1])==null?void 0:s.color)===r||!(t.to+1&136)&&((a=this._board[t.to+1])==null?void 0:a.type)===ue&&((l=this._board[t.to+1])==null?void 0:l.color)===r?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=be}else this._epSquare=be;t.piece===ue?this._halfMoves=0:t.flags&(W.CAPTURE|W.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===Pe&&this._moveNumber++,this._turn=r,this._hash^=Nn}undo(){const t=this._hash,n=this._undoMove();if(n){const r=new on(this,n);return this._decPositionCount(t),r}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Nn;const r=this._turn,o=It(r);if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:r})),n.captured)if(n.flags&W.EP_CAPTURE){let s;r===Pe?s=n.to-16:s=n.to+16,this._set(s,{type:ue,color:o})}else this._set(n.to,{type:n.captured,color:o});if(n.flags&(W.KSIDE_CASTLE|W.QSIDE_CASTLE)){let s,a;n.flags&W.KSIDE_CASTLE?(s=n.to+1,a=n.to-1):(s=n.to-2,a=n.to+1),this._movePiece(a,s)}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const r=[];let o=!1;for(const g in this._header)this._header[g]&&r.push(`[${g} "${this._header[g]}"]`+t),o=!0;o&&this._history.length&&r.push(t);const s=g=>{const C=this._comments[this.fen()];if(typeof C<"u"){const S=g.length>0?" ":"";g=`${g}${S}{${C}}`}return g},a=[];for(;this._history.length>0;)a.push(this._undoMove());const l=[];let i="";for(a.length===0&&l.push(s(""));a.length>0;){i=s(i);const g=a.pop();if(!g)break;if(!this._history.length&&g.color==="b"){const C=`${this._moveNumber}. ...`;i=i?`${i} ${C}`:C}else g.color==="w"&&(i.length&&l.push(i),i=this._moveNumber+".");i=i+" "+this._moveToSan(g,this._moves({legal:!0})),this._makeMove(g)}if(i.length&&l.push(s(i)),l.push(this._header.Result||"*"),n===0)return r.join("")+l.join(" ");const h=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},c=function(g,C){for(const S of C.split(" "))if(S){if(g+S.length>n){for(;h();)g--;r.push(t),g=0}r.push(S),g+=S.length,r.push(" "),g++}return h()&&g--,g};let k=0;for(let g=0;g<l.length;g++){if(k+l[g].length>n&&l[g].includes("{")){k=c(k,l[g]);continue}k+l[g].length>n&&g!==0?(r[r.length-1]===" "&&r.pop(),r.push(t),k=0):g!==0&&(r.push(" "),k++),r.push(l[g]),k+=l[g].length}return r.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}setHeader(t,n){return this._header[t]=n??tr[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=tr[t]||null,!0):!1}getHeaders(){const t={};for(const[n,r]of Object.entries(this._header))r!==null&&(t[n]=r);return t}loadPgn(t,{strict:n=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(t=t.replace(new RegExp(r,"g"),`
`));const o=Dh.parse(t);this.reset();const s=o.headers;let a="";for(const h in s)h.toLowerCase()==="fen"&&(a=s[h]),this.header(h,s[h]);if(!n)a&&this.load(a,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let l=o.root;for(;l;){if(l.move){const h=this._moveFromSan(l.move,n);if(h==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(h),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const i=o.result;i&&Object.keys(this._header).length&&this._header.Result!==i&&this.setHeader("Result",i)}_moveToSan(t,n){let r="";if(t.flags&W.KSIDE_CASTLE)r="O-O";else if(t.flags&W.QSIDE_CASTLE)r="O-O-O";else{if(t.piece!==ue){const o=rf(t,n);r+=t.piece.toUpperCase()+o}t.flags&(W.CAPTURE|W.EP_CAPTURE)&&(t.piece===ue&&(r+=ge(t.from)[0]),r+="x"),r+=ge(t.to),t.promotion&&(r+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(t,n=!1){let r=Mn(t);n||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O"));let o=vo(r),s=this._moves({legal:!0,piece:o});for(let g=0,C=s.length;g<C;g++)if(r===Mn(this._moveToSan(s[g],s)))return s[g];if(n)return null;let a,l,i,h,c,k=!1;if(l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(a=l[1],i=l[2],h=l[3],c=l[4],i.length==1&&(k=!0)):(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(a=l[1],i=l[2],h=l[3],c=l[4],i.length==1&&(k=!0))),o=vo(r),s=this._moves({legal:!0,piece:a||o}),!h)return null;for(let g=0,C=s.length;g<C;g++)if(i){if((!a||a.toLowerCase()==s[g].piece)&&F[i]==s[g].from&&F[h]==s[g].to&&(!c||c.toLowerCase()==s[g].promotion))return s[g];if(k){const S=ge(s[g].from);if((!a||a.toLowerCase()==s[g].piece)&&F[h]==s[g].to&&(i==S[0]||i==S[1])&&(!c||c.toLowerCase()==s[g].promotion))return s[g]}}else if(r===Mn(this._moveToSan(s[g],s)).replace("x",""))return s[g];return null}ascii(){let t=`   +------------------------+
`;for(let n=F.a8;n<=F.h1;n++){if(Nt(n)===0&&(t+=" "+"87654321"[ut(n)]+" |"),this._board[n]){const r=this._board[n].type,s=this._board[n].color===we?r.toUpperCase():r.toLowerCase();t+=" "+s+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let r=0;const o=this._turn;for(let s=0,a=n.length;s<a;s++)this._makeMove(n[s]),this._isKingAttacked(o)||(t-1>0?r+=this.perft(t-1):r++),this._undoMove();return r}turn(){return this._turn}board(){const t=[];let n=[];for(let r=F.a8;r<=F.h1;r++)this._board[r]==null?n.push(null):n.push({square:ge(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t}squareColor(t){if(t in F){const n=F[t];return(ut(n)+Nt(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],r=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;t?r.push(new on(this,o)):r.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return r}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const n=this._positionCount.get(t)??0;n===1?this._positionCount.delete(t):this._positionCount.set(t,n-1)}_pruneComments(){const t=[],n={},r=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)t.push(this._undoMove());for(r(this.fen());;){const o=t.pop();if(!o)break;this._makeMove(o),r(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const o of[fe,Je])n[o]!==void 0&&(n[o]?this._castling[t]|=sn[o]:this._castling[t]&=~sn[o]);this._updateCastlingRights();const r=this.getCastlingRights(t);return(n[fe]===void 0||n[fe]===r[fe])&&(n[Je]===void 0||n[Je]===r[Je])}getCastlingRights(t){return{[fe]:(this._castling[t]&sn[fe])!==0,[Je]:(this._castling[t]&sn[Je])!==0}}moveNumber(){return this._moveNumber}}const of=["Pawn","Bishop","Knight","Rook","Queen","King"],js="",Ks="",qs="",Gs="",Bs="",kr="",Ws="",Hs="",Vs="",Qs="",Js="",yr="",Ys=_r("hidden"),Xs=vr("hidden"),Er=e=>{const t=e.slice(0,2),n=e.slice(2,4),r=e[4];return{from:t,to:n,promotion:r}},yt=e=>e.split(" ").filter(t=>t.trim().length>0),Fn=new Map,sf=(e,t)=>`${e}/${t}`,yn=(e,t)=>{const n=sf(e,t);if(Fn.has(n))return Fn.get(n);const r=new wr;(t===void 0?yt(e):yt(e).slice(0,t)).forEach(a=>r.move(Er(a)));const s=r.moves({verbose:!0}).map(a=>{r.move(a);const l=ei(a,r.isCheck(),r.isCheckmate());return r.undo(),l});return Fn.set(n,s),s},af=e=>{const t=new wr;return yt(e).forEach(n=>t.move(Er(n))),t.fen()},ei=(e,t,n)=>e.isKingsideCastle()?e.color=="w"?rn("E1","H1",t,n):rn("E8","H8",t,n):e.isQueensideCastle()?e.color=="w"?rn("E1","A1",t,n):rn("E8","A8",t,n):e.isEnPassant()?gh(e.from.toUpperCase(),e.to.toUpperCase(),t,n):dh(Zn(e.piece),e.from.toUpperCase(),e.to.toUpperCase(),e.isCapture()?Zn(e.captured):null,e.isPromotion()?Zn(e.promotion):null,t,n),cf=e=>{const t=Cr(e);return t.length>0?t[t.length-1]:null},Cr=e=>{const t=new wr,n=[];for(const r of yt(e)){const o=t.move(Er(r));n.push(ei(o,t.isCheck(),t.isCheckmate()))}return n},lf=()=>{},uf=e=>{const t=Math.floor(e/3600),n=e-t*60*60,r=Math.floor(n/60),o=Math.floor(n-r*60);return u("remaining",[t,r,o].map(s=>gr(s.toString(),2,"0")).join(":"))},Ct=()=>{const e=E("lichess/game-state");return e?yt(e.moves).length%2===0?"white":"black":null},ti=()=>{const e=Ft();return e?Ms(e):null},Ft=()=>{const e=E("lichess/game-info");return e?e.color:null},bo=()=>{const e=E("lichess/game-state");return e?Cr(e.moves):[]},ni=()=>E("lang")??"en",ri=()=>bn(),hf=()=>"home";let Ye={lang:Ce(),screen:hf(),clock:Ce(),input:ri(),"input-san/file":Ce(),"input-san/rank":Ce(),started:!1,lockScreen:!1,online:!0,fullscreen:!1,ratedChallenge:!1,challengeColor:"random","lichess/host":"https://lichess.org","lichess/user":Ce(),"lichess/stream-events":[],"lichess/challenges":[],"lichess/current-challenge":Ce(),"lichess/my-challenge":Ce(),"lichess/game-info":Ce(),"lichess/game-state":Ce(),"lichess/opponent":Ce(),"lichess/following":[],"lichess/chat":Ce(),"lichess/seek":Ce(),"lichess/arena-created":[],"lichess/arena-started":[],"lichess/arena-join":Ce(),"lichess/claim":Ce()};const oi=["lang"],ff=()=>oi.map(e=>{const t=localStorage.getItem(e);t!==null&&(Ye[e]=JSON.parse(t))});ff();let Lt=[];const Sr=()=>{const e=new Set,t=(o,s)=>{let a=E(o);return Ye[o]=s(a),oi.includes(o)&&localStorage.setItem(o,JSON.stringify(Ye[o])),o!=="clock"&&(console.groupCollapsed(o),console.debug("from",a),console.debug("to",Ye[o]),console.groupEnd()),e.add(o),E(o)};return{dispatch:t,assign:(o,s)=>t(o,()=>s),end:()=>{setTimeout(()=>{for(const o of e){const s=Lt.filter(([a,l])=>a==o);for(const a of s){const l=a[1];l(o),e.delete(o)}}},0)}}},Dt=e=>e(Sr()),wo=Sr(),Xe=(e,t)=>(wo.dispatch(e,t),wo.end(),E(e)),pf=(e,t)=>Se(n=>z(e,n))(t(E(e))),z=(e,t)=>Xe(e,()=>t),E=e=>JSON.parse(JSON.stringify(Ye[e])),_t=e=>Ye[e],df=()=>Object.keys(Ye),te=(...e)=>t=>Lt=Lt.concat(e.map(n=>[n,t])),gf=e=>Lt=Lt.filter(([t,n])=>e(t));Th(document.location.hostname)&&Object.assign(window,{UcuiState:Ye});const mf=(e,t)=>Array.isArray(t)?t.map(n=>`${e}=${encodeURIComponent(n)}`).join("&"):`${e}=${encodeURIComponent(t)}`,Ar=e=>Object.keys(e).map(t=>mf(t,e[t])).join("&"),_f=(e,t)=>`${e}?${Ar(t)}`,vf=(e="application/json")=>{const t=new Headers;return e!=="none"&&t.append("Content-Type",e),{mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},si=e=>(t,n,r)=>{const o={method:"GET",...vf(),...r};return e(n,o).then(s=>s.json()).then(s=>{try{return t.parse(s)}catch{throw console.error("Failed to parse obj from",n),console.error("=>",s),s}})},bf=si(fetch),ii=(e="application/x-www-form-urlencoded")=>{const t={};return e!=="none"&&(t["Content-Type"]=e),{method:"POST",mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},ai=e=>(t,n,r,o)=>{const s={method:"POST",...ii(),...o};return typeof r=="string"?(s.headers["Content-Type"]="text/plain",s.body=r):s.body=Ar(r),e(n,s).then(a=>a.json()).then(a=>{try{return t.parse(a)}catch{throw console.error("Failed to parse obj from",n),console.error("=>",a),a}})},wf=ai(fetch),je=Y([p("white"),p("black")]),ci=Y([p("lobby"),p("friend"),p("ai"),p("api"),p("tournament"),p("position"),p("import"),p("importlive"),p("simul"),p("relay"),p("pool"),p("swiss"),p("arena")]),kf=Y([P({id:p(10),name:p("created")}),P({id:p(20),name:p("started")}),P({id:p(25),name:p("aborted")}),P({id:p(30),name:p("mate")}),P({id:p(31),name:p("resign")}),P({id:p(32),name:p("stalemate")}),P({id:p(33),name:p("timeout")}),P({id:p(34),name:p("draw")}),P({id:p(35),name:p("outoftime")}),P({id:p(36),name:p("cheat")}),P({id:p(37),name:p("noStart")}),P({id:p(38),name:p("unknownFinish")}),P({id:p(60),name:p("variantEnd")})]),En=Y([p("ultraBullet"),p("bullet"),p("blitz"),p("rapid"),p("classical"),p("correspondence")]),yf=P({id:$(),username:$(),rating:ze(),ratingDiff:ze().optional()}),Ef=P({id:$().nullable(),username:$(),rating:ze().optional(),ai:ze()}),Cn=P({bot:G(),board:G()}),Ut=Y([p("standard"),p("chess960"),p("crazyhouse"),p("antichess"),p("atomic"),p("horde"),p("kingOfTheHill"),p("racingKings"),p("threeCheck"),p("fromPosition")]),jt=P({key:Ut,name:$(),short:$().optional()}),li=P({id:$(),fullId:$(),gameId:$(),fen:$(),color:je,lastMove:$(),source:ci,status:kf,variant:jt,speed:En,perf:$(),rated:G(),hasMoved:G(),opponent:Y([yf,Ef]),isMyTurn:G(),secondsLeft:ze().optional(),compat:Cn,winner:je.optional(),ratingDiff:ze().optional(),tournamentId:$().optional()}),Cf=P({type:p("gameStart"),game:li}),Sf=P({type:p("gameFinish"),game:li}),Af=Y([p("created"),p("offline"),p("canceled"),p("declined"),p("accepted")]),ko=P({id:$(),name:$(),rating:ze(),title:$().nullable(),flair:$().optional(),patron:G().optional(),provisional:G().optional(),online:G().optional(),lag:ze().optional()}),$f=P({type:p("clock"),limit:ze(),increment:ze(),show:$()}),Tf=P({type:p("correspondence"),daysPerTurn:ze()}),If=P({type:p("unlimited")}),Pf=Y([$f,Tf,If]),dt=P({id:$(),url:wu(),status:Af,challenger:ko,destUser:ko.nullable(),variant:jt,rated:G(),speed:En,timeControl:Pf,color:Y([je,p("random")]),finalColor:je,perf:P({icon:$(),name:$()}),direction:Y([p("in"),p("out")]).optional(),initialFen:$().optional(),rematchOf:$().optional()}),$r=Y([p("ultraBullet"),p("bullet"),p("blitz"),p("rapid"),p("classical"),p("correspondence"),p("chess960"),p("crazyhouse"),p("antichess"),p("atomic"),p("horde"),p("kingOfTheHill"),p("racingKings"),p("threeCheck")]),ui=Y([p("created"),p("started"),p("aborted"),p("mate"),p("resign"),p("stalemate"),p("timeout"),p("draw"),p("outoftime"),p("cheat"),p("noStart"),p("unknownFinish"),p("variantEnd")]);P({id:$(),fullId:$(),status:P({id:D(),name:ui}),variant:jt,rated:G(),speed:En,perf:$r,direction:Y([p("in"),p("out")]).optional(),fen:$().optional(),turns:D().optional(),source:ci.optional(),createdAt:ze().optional(),player:je.optional()});const Zf=P({type:p("challenge"),challenge:dt,compat:Cn.optional()}),zf=P({type:p("challengeCanceled"),challenge:dt,compat:Cn.optional()}),Of=Y([p("generic"),p("later"),p("tooFast"),p("tooSlow"),p("timeControl"),p("rated"),p("casual"),p("standard"),p("variant"),p("noBot"),p("onlyBot")]),Rf=dt.extend({declineReason:$(),declineReasonKey:Of}),Nf=P({type:p("challengeDeclined"),challenge:Rf,compat:Cn.optional()}),Lf=Y([Cf,Sf,Zf,zf,Nf]);P({in:dt.array(),out:dt.array()});const hi=Y([p("noAbort"),p("noRematch"),p("noGiveTime"),p("noClaimWin"),p("noEarlyDraw")]),xf=P({rated:G(),"clock.limit":D(),"clock.increment":D(),color:Y([je,p("random")]),variant:Ut,fen:$().optional(),keepAliveStream:G(),rules:hi.optional()});P({time:D(),increment:D(),rated:G().optional(),color:Y([je,p("random")]),variant:Ut,ratingRange:$().optional()});const Mf=P({id:$()}),Ff=Y([p(1),p(2),p(3),p(4),p(5),p(7),p(10),p(14)]),Df=P({rated:G(),days:Ff,color:Y([je,p("random")]),variant:Ut,fen:$().optional(),keepAliveStream:G(),rules:hi.optional()});Y([xf,Df]);P({"clock.limit":D(),"clock.increment":D(),color:Y([je,p("random")]),variant:Ut,fen:$().optional(),level:Y([p(1),p(2),p(3),p(4),p(5),p(6),p(7),p(8)])});const tt=P({ok:G()}),Uf=P({initial:D(),increment:D()}),jf=P({name:$()}),Sn=Y([p("GM"),p("WGM"),p("IM"),p("WIM"),p("FM"),p("WFM"),p("NM"),p("CM"),p("WCM"),p("WNM"),p("LM"),p("BOT")]),Kf=P({id:$(),name:$(),title:Sn.nullable(),rating:D().nullable(),provisional:G().optional()}),qf=P({aiLevel:D()}),yo=Y([Kf,qf]),fi=P({type:p("gameState"),moves:$(),wtime:D(),btime:D(),winc:D(),binc:D(),status:ui,winner:je.optional(),wdraw:G().optional(),bdraw:G().optional(),wtakeback:G().optional(),btakeback:G().optional()}),Gf=P({type:p("gameFull"),id:$(),variant:jt,clock:Uf.optional(),speed:En,perf:jf,rated:G(),createdAt:D(),white:yo,black:yo,initialFen:$(),state:fi,tournamentId:$().optional()}),Bf=P({type:p("chatLine"),room:Y([p("player"),p("spectator")]),username:$(),text:$()}),Wf=P({type:p("opponentGone"),gone:G(),claimWinInSeconds:D().optional()}),Hf=Y([fi,Gf,Bf,Wf]);P({gameId:$(),move:$(),offeringDraw:G().optional()});const Dn=P({runs:D(),score:D()}),ye=P({games:D(),rating:D(),rd:D(),prog:D(),prov:G().optional()}),Vf=P({chess960:ye.optional(),atomic:ye.optional(),racingKings:ye.optional(),ultraBullet:ye.optional(),blitz:ye.optional(),kingOfTheHill:ye.optional(),threeCheck:ye.optional(),antichess:ye.optional(),crazyhouse:ye.optional(),bullet:ye.optional(),correspondence:ye.optional(),horde:ye.optional(),puzzle:ye.optional(),classical:ye.optional(),rapid:ye.optional(),storm:Dn.optional(),racer:Dn.optional(),streak:Dn.optional()}),Qf=P({flag:$().optional(),location:$().optional(),bio:$().optional(),realName:$().optional(),fideRating:D().optional(),uscfRating:D().optional(),ecfRating:D().optional(),cfcRating:D().optional(),rcfRating:D().optional(),dsbRating:D().optional(),links:$().optional()}),Jf=P({total:D(),tv:D()}),pi=P({id:$(),username:$(),url:$().optional(),perfs:Vf.optional(),title:Sn.optional(),flair:$().optional(),createdAt:D().optional(),disabled:G().optional(),tosViolation:G().optional(),profile:Qf.optional(),seenAt:D().optional(),playTime:Jf.optional(),patron:G().optional(),verified:G().optional()}),Yf=P({id:$(),name:$(),flair:$().optional(),title:Sn.optional(),online:G().optional(),playing:G().optional(),streaming:G().optional(),patron:G().optional()});P({ids:$(),withSignal:G().optional(),withGameIds:G().optional(),withGameMetas:G().optional()});const Xf=Y([p(10),p(20),p(30)]),ep=P({key:$r,name:$(),position:D(),icon:$().optional()}),Eo=P({perf:$r.optional(),rating:D()}),tp=P({eco:$().optional(),name:$(),fen:$(),url:$().optional()}),np=P({name:$(),fen:$()}),rp=Y([tp,np]),op=P({id:$(),name:$(),flair:$().optional(),title:Sn.optional(),patron:G().optional()}),sp=P({limit:D(),increment:D()}),Un=P({id:$(),createdBy:$(),system:p("arena"),minutes:D(),clock:sp,rated:G(),fullName:$(),nbPlayers:D(),variant:jt,startsAt:D(),finishesAt:D(),status:Xf,perf:ep,secondsToStart:D().optional(),hasMaxRating:G().optional(),maxRating:Eo.optional(),minRating:Eo.optional(),minRatedGames:P({nb:D()}).optional(),botsAllowed:G().optional(),minAccountAgeInDays:D().optional(),onlyTitled:G().optional(),teamMember:$().optional(),private:G().optional(),position:rp.optional(),schedule:P({freq:$().optional(),speed:$().optional()}).optional(),teamBattle:P({teams:$().array().optional(),nbLeaders:D().optional()}).optional(),winner:op.optional()}),ip=P({created:Un.array(),started:Un.array(),finished:Un.array()}),_e=e=>[E("lichess/host"),e].join("/api"),ap=(e,t)=>{const n=_t("lichess/user");if(n){const r=n.streamer(Lf,_e("/stream/event"));return r.onMessage(e),r.onClose(t),!0}return!1},cp=(e,t)=>{const n=_t("lichess/user");return n?(n.streamer(Hf,_e(`/board/game/stream/${e}`)).onMessage(t),!0):!1},lp=(e,t)=>{const n=_t("lichess/user");if(n){const r=n.streamer(pi,_e("/rel/following"));return r.onMessage(e),t&&r.onClose(t),!0}return!1},di=(e=!1)=>{const t=_t("lichess/user");if(t)return si(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),bf},xe=(e=!1)=>{const t=_t("lichess/user");if(t)return ai(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),wf},up=e=>xe()(tt,_e(`/challenge/${e}/accept`),{}),hp=(e,t)=>xe()(tt,_e(`/challenge/${e}/decline`),{reason:t}),fp=(e,t)=>xe()(tt,_e(`/board/game/${e}/move/${t}`),{}),gi=e=>xe()(tt,_e(`/board/game/${e}/resign`),{}),fn=(e,t)=>xe()(tt,_e(`/board/game/${e}/draw/${t}`),{}),mi=e=>xe()(pi.array(),_e("/users"),e).then(n=>{for(const r of n)if(r.id===e)return r;throw new Error("Failed to get a user with id: "+e)}),pp=(e,t)=>xe()(dt,_e(`/challenge/${e}`),t),dp=e=>xe()(dt,_e("/challenge/ai"),e),gp=e=>di()(Yf.array(),_f(_e("/users/status"),{ids:e.join(",")})),mp=()=>fetch([E("lichess/host"),"__ping"].join("/"),{mode:"no-cors",cache:"default",redirect:"follow",credentials:"same-origin"}),_p=(e,t)=>{const n=_t("lichess/user");return n?new Promise((r,o)=>{n.streamer(Mf,_e("/board/seek"),a=>{r(a)},{...ii(),body:Ar(e)}).onClose(t)}):Promise.reject("no-config")},vp=()=>di()(ip,_e("/tournament")),bp=e=>xe()(tt,_e(`/tournament/${e}/join`),{pairMeAsap:!0}),wp=e=>xe()(tt,_e(`/tournament/${e}/withdraw`),{pairMeAsap:!0}),kp=e=>xe()(tt,_e(`/board/game/${e}/claim-victory`),{}),yp={"home/link-git":{en:"Source code & feedback",fr:"Code source & retours"},"home/connect":{en:"Connect",fr:"Connecter"},"home/challenges":{en:"Challenges",fr:"Dfis"},"home/challenge-accept":{en:"Accept",fr:"Accepter"},"home/challenge-decline":{en:"Decline",fr:"Dcliner"},"home/challenge-wait":{en:"Waiting to be challenged",fr:"En attente d'un dfi"}},Ep={"button/home":{en:"Home",fr:"Accueil"},"button/players":{en:"Players",fr:"Partenaires"},"button/create":{en:"Create a game",fr:"Initier une partie"}},Cp={"players/classic":{en:"Classic",fr:"Classique"},"players/rapid":{en:"Rapid",fr:"Rapide"},"players/username":{en:"Username",fr:"Bon d'utilisateurice"},"players/search":{en:"Search",fr:"Recherchez"},"players/find":{en:"Find player",fr:"Trouver une partenaire"},"players/ai":{en:"Play with Lichess AI",fr:"Jouer avec l'automate"},"players/ai-level":{en:"Level",fr:"Niveau"},"players/following":{en:"Players you follow",fr:"Les joueureuses que vous suivez "}},Sp={"end/aborted":{en:"Game has been aborted",fr:"La partie a t annule"},"end/mate":{en:"Mate",fr:"chec et mat"},"end/resign":{en:"Resigned",fr:"Abandon"},"end/stalemate":{en:"Stalemate",fr:"Pat"},"end/timeout":{en:"Flagged",fr:"Perdue au temps"},"end/outoftime":{en:"Flagged",fr:"Perdue au temps"},"end/draw":{en:"Draw",fr:"Partie nulle"},"end/cheat":{en:"Cheat!",fr:"Triche"},"end/noStart":{en:"Game didn't dtart",fr:"La partie n'a pas commenc"}},Ap={"challenge/rated":{en:"Rated",fr:"Class"},"challenge/casual":{en:"Casual",fr:"Amical"}},$p={"home/tagline":{en:()=>We(et("ucui","Tlchecs "),"is a ",Rt("",E("lichess/host")," Lichess")," client for players who prefer to play over the board."),fr:()=>We(et("ucui","Tlchecs "),"est une interface  ",Rt("",E("lichess/host")," Lichess")," pour les joueuses et joueurs qui prfrent jouer sur un chiquier.")},"home/description":{en:()=>u("",We(`
            Connect this page with your Lichess account to create games or challenge players 
            from here.  
            `),We(`
            Once a game starts, you'll be presented with a black 
            screen where you'll see your opponent moves when they play, 
            and an input widget to enter your moves when it's your turn.
            And that will be all of it. 
            `),We("Enjoy!")),fr:()=>u("",We(`
            Connectez cette page  votre compte Lichess pour commencer  jouer.  
            `),We(`
            Lorsqu'une partie commence, les coups de l'adversaire 
            vous seront prsents de manire textuelle. 
            Et  votre tour de jouer, une interface de saisie 
            vous permettra de transmettre votre coup. 
            `),We("Bonne partie!"))}},Tp={"clock/flagged":{en:"Flag",fr:"Tomb"}},Ip={"arena/arena":{en:"Arenas",fr:"Arnes"},"arena/created":{en:"Created",fr:" venir"},"arena/started":{en:"Started",fr:"En cours"},"arena/join":{en:"Join",fr:"Rejoindre"},"arena/waiting":{en:"Waiting to be paired",fr:"En attente d'appariement"},"arena/leave":{en:"Leave arena",fr:"Se retirer"},"arena/info":{en:`
    We only display arenas that are started or about to start, 
    and with time controls which feel compatible with this application. 
    And we do not support starting positions, yet.
    `,fr:`
    Ne sont montres que les arnes qui sont en cours ou sur
    le point de commencer. De plus, ne sont pas montes celles
    dont le contle du temps est compatible avec l'usage 
    de cette application. 
    `}},Pp={...yp,...Ep,...Cp,...Sp,...Ap,...Tp,...Ip},Zp={...$p},j=e=>Pp[e][ni()],Co=e=>Zp[e][ni()](),zp=()=>{const e=document.location,n=new URL(e.href).searchParams.get("lang");if(n){try{const r=uo.parse(n);z("lang",r)}catch{console.error("Failed to recognize lang",n)}return}if(E("lang")===null){try{const r=uo.parse(navigator.language.split("-")[0]);z("lang",r)}catch{console.error("Failed to set lang from navigator",navigator.language)}return}},_i=e=>{const t=E("lichess/game-info"),n=E("lichess/game-state");if(vi(),t&&n&&n.status==="started"){const r=window.setInterval(e,500);z("clock",{interval:r,gameId:t.gameId})}},vi=()=>{const e=E("clock");e&&(clearInterval(e.interval),z("clock",null))},Op=e=>{const t=E("clock"),n=E("lichess/game-state");!n&&t?vi():n&&n.status==="started"&&!t&&_i(e)},Rp=e=>{const t=u("time white active","--:--"),n=u("time black","--:--");e.append(u("clock",t,n)),jn({white:t,black:n}),To({white:t,black:n}),te("lichess/game-state")(()=>{Op(()=>jn({white:t,black:n})),To({white:t,black:n})}),_i(()=>{jn({white:t,black:n})})},So="--:--",Np=()=>u("flag",j("clock/flagged")),Lp=()=>{const e=E("lichess/game-info"),t=E("lichess/game-state"),n=Ct();if(t&&e&&n){if(yt(t.moves).length<2)return{white:an(t.wtime),black:an(t.btime)};const r=Date.now()-t.timestamp,o=n==="white"?t.wtime-r:t.wtime,s=n==="black"?t.btime-r:t.btime;return{white:an(o),black:an(s)}}else return{white:So,black:So}},jn=({white:e,black:t})=>{const n=ee(e),r=ee(t),o=Lp();n(o.white),r(o.black)},{floor:Kn}=Math,an=e=>{if(e<=0)return Np();const t=e/1e3,n=Kn(t%60),r=Kn(t/60%60),o=Kn(t/60/60),s=n<10?`0${n.toFixed(0)}`:`${n.toFixed(0)}`,a=r<10?`0${r.toFixed(0)}`:`${r.toFixed(0)}`,l=o<10?`0${o.toFixed(0)}`:`${o.toFixed(0)}`;return t>=3600?`${l}:${a}:${s}`:`${a}:${s}`},xp=vr("active"),Mp=_r("active"),Ao=Oh("active"),$o=(e,t)=>t&&!Ao(e)?Mp(e):!t&&Ao(e)?xp(e):void 0,To=({white:e,black:t})=>{const n=Ct();$o(e,n=="white"),$o(t,n=="black")},qn=(e,t=null,n=null,r,o,s=null)=>({_tag:"Normal",role:e,capture:r,to:o,rank:n,file:t,promotion:s}),Io=e=>({_tag:"Castle",side:e}),Fp=(e,t,n)=>e.filter(r=>{switch(r._tag){case"Castle":return!1;case"EnPassant":return t=="Pawn"&&r.to===n;default:return n===r.to&&t===r.role}}),Dp=(e,t)=>{switch(e._tag){case"Normal":{if(e.role==="Pawn")return qn("Pawn",e.capture!==null?Qe(e.from):null,null,e.capture!==null,e.to,e.promotion);{let n=!1,r=!1,o=!1;for(const s of t)s._tag==="Normal"&&e.from!=s.from&&e.role==s.role&&e.to==s.to&&e.promotion==s.promotion&&(n=!0,zn(e.from)==zn(s.from)&&(o=!0),Qe(e.from)==Qe(s.from)&&(r=!0));return qn(e.role,n&&(!r||o)?Qe(e.from):null,r?zn(e.from):null,e.capture!==null,e.to,e.promotion)}}case"EnPassant":return qn("Pawn",Qe(e.from),null,!0,e.to,null);case"Castle":return Qe(e.rook)<Qe(e.king)?Io("QueenSide"):Io("KingSide")}},Po=e=>{switch(e){case"Pawn":return"P";case"Rook":return"R";case"Knight":return"N";case"Bishop":return"B";case"Queen":return"Q";case"King":return"K"}},Zo=(e,t)=>{switch(e){case"Pawn":return t==="white"?Ws:js;case"Rook":return t==="white"?Hs:Ks;case"Knight":return t==="white"?Vs:qs;case"Bishop":return t==="white"?Qs:Gs;case"Queen":return t==="white"?Js:Bs;case"King":return t==="white"?yr:kr}},Up=(e,t)=>{let n=[];return t._tag==="Normal"&&t.role!=="Pawn"&&(n=Fp(e,t.role,t.to)),Dp(t,n)},jp=(e,t)=>({symbol:e,color:t,withAnnotation:!1}),bi=()=>({symbol:!0,color:"white",withAnnotation:!1}),Kp=(e,t,{symbol:n,color:r,withAnnotation:o})=>{const s=[];switch(t._tag){case"Normal":{t.role!=="Pawn"&&s.push(n?Zo(t.role,r):Po(t.role)),t.file!==null&&s.push(t.file.toLowerCase()),t.rank!==null&&s.push(t.rank),t.capture&&s.push("x"),s.push(t.to.toLowerCase()),t.promotion!==null&&s.push("=",n?Zo(t.promotion,r):Po(t.promotion));break}case"Castle":{t.side==="KingSide"?s.push("O","-","O"):s.push("O","-","O","-","O");break}case"null":s.push("--")}return o&&(e.checkmate?s.push("#"):e.check&&s.push("+")),s.join("")},Tr=(e,t,n)=>Kp(e,Up(t,e),n),he=(e,t)=>({name:e,className:t??e}),qp=e=>(typeof e=="string"?e:e.className).toLowerCase().split(" ").join("-"),Gp=e=>typeof e=="string"||e instanceof HTMLElement?e:e.name,ie=(e,t)=>me(u(`button button-${qp(e)}`,Gp(e)),n=>n("click",t)),Kt=(e,t)=>ie(t,()=>z("screen",e)),qt=()=>Kt("home",j("button/home")),Bp=()=>Kt("seek",j("button/create")),zo=(e,t)=>{const n=E("lichess/game-info"),r=E("lichess/game-state"),o=Ct(),s=Ft();if(n&&r&&o&&s){const a=ee(t);if(ee(e)(et("name",n.opponent.username)),o===s){const i=Cr(r.moves),h=i.pop();if(h){const c=Tr(h,yn(r.moves,i.length),{...bi(),withAnnotation:!0});a(c)}else a(u("idle",`Your turn to play ${o}`))}else a(u("opponent-think",""))}},Wp=e=>{Ee(e),Ys(e);const t=E("lichess/claim"),n=E("lichess/game-info");if(t&&n){Xs(e);const r=Date.now();if(r>t.at)e.append(ie(he("Claim Victory","claim-victory"),()=>{kp(n.gameId).finally(()=>{z("lichess/claim",null)})}));else{const o=Math.round((t.at-r)/1e3);e.append(u("waiting",`Opponent gone, claim in ${o} seconds`))}}},Hp=e=>{const t=u("info"),n=u("state"),r=u("gone hidden"),o=u("engine",r,t,n);te("lichess/game-state")(()=>zo(t,n)),te("lichess/claim")(()=>Wp(r)),zo(t,n),e.append(o)};let cn=null;const Vp=(e,{body:t,from:n})=>{Ee(e),e.classList.remove("hidden"),e.append(u("message",u("from",n),u("text",t)),ie("close",()=>{e.classList.add("hidden"),z("lichess/chat",null)})),cn!==null&&clearTimeout(cn),cn=window.setTimeout(()=>{z("lichess/chat",null),e.classList.add("hidden"),cn=null},4e3)},Qp=e=>{const t=u("chat-box hidden");e.append(t),te("lichess/chat")(()=>{const n=E("lichess/chat");n?Vp(t,n):(t.classList.add("hidden"),Ee(t))})},Et=(e,t)=>{z("lichess/chat",Fs(e,t)),nr("challenge")},Gn=e=>{const t=mt(Mh("-",e),n=>n("preload","auto"));return document.body.append(t),t},Jp={move:Gn("/lichess-sounds/Move.ogg"),capture:Gn("/lichess-sounds/Capture.ogg"),challenge:Gn("/lichess-sounds/NewChallenge.ogg")},nr=e=>{Jp[e].play().catch(t=>Et("Tlchecs",`Could not play a sound because of: ${t}`))},Yp=e=>Dt(({assign:t,end:n})=>(t("input",bn()),t("lichess/game-state",dr(e.state)),t("started",!0),n(),!0)),Xp=Se(e=>{_h(e)?nr("capture"):nr("move")}),ed=e=>Dt(({assign:t,end:n})=>(t("input",bn()),t("lichess/game-state",dr(e)),Ft()===Ct()&&Xp(Ze(cf(e.moves))),n(),!0)),td=e=>(z("lichess/chat",Ch(e)),!0),nd=e=>(e.gone&&e.claimWinInSeconds!==void 0?z("lichess/claim",Sh(Date.now()+e.claimWinInSeconds*1e3)):e.gone||(z("lichess/claim",null),Et("Lichess","Your opponent is back!")),!0),rd=e=>{switch(e.type){case"gameFull":return Yp(e);case"gameState":return ed(e);case"chatLine":return td(e);case"opponentGone":return nd(e)}},od=e=>cp(e,rd),sd=e=>{const t=E("lichess/game-info");t&&fp(t.gameId,vh(e))},id=e=>z("input-san/file",e),ad=e=>z("input-san/rank",e),Ir=e=>{e("input-san/file",null),e("input-san/rank",null)},Oo=(e,t)=>{switch(e){case"Pawn":return t==="black"?js:Ws;case"Rook":return t==="black"?Ks:Hs;case"Knight":return t==="black"?qs:Vs;case"Bishop":return t==="black"?Gs:Qs;case"Queen":return t==="black"?Bs:Js;case"King":return t==="black"?kr:yr}},cd=(e,t)=>t.some(n=>{switch(n._tag){case"Normal":return n.role===e;case"Castle":return e==="King";case"EnPassant":return e==="Pawn"}}),Ro=e=>e?"selected":"",No=(e,t)=>of.map(n=>cd(n,t)?me(u(`piece ${n}  ${Ro(e===n)}`,Oo(n,"black")),r=>r("click",()=>Dt(({assign:o,end:s})=>{Ir(o),e===n?o("input",ri()):o("input",bh(n)),s()}))):u(`piece ${n}  ${Ro(e===n)}`,Oo(n,"white"))),ld=e=>Dt(({assign:t,end:n})=>{Ir(t),t("input",kh(e)),n(),sd(e)}),ud=e=>t=>e.filter(n=>{switch(n._tag){case"Castle":{switch(t){case"G1":return n.king==="E1"&&n.rook=="H1";case"C1":return n.king==="E1"&&n.rook=="A1";case"G8":return n.king==="E8"&&n.rook=="H8";case"C8":return n.king==="E8"&&n.rook=="A8"}return!1}case"Normal":case"EnPassant":return n.to===t}}),hd=e=>t=>me(u("move",Tr(t,yn(e.moves),jp(!0,"black"))),n=>n("click",()=>{z("input-san/file",null),ld(t)})),fd=e=>{const t=E("lichess/game-state");return t?e.map(hd(t)):[]},pd=(e,t,n)=>{const r=new Set(n.map(xs).map(Qe));return Xn.map(o=>o===t?u(`button-select file file-${o} selected`,o.toLowerCase()):r.has(o)?me(u(`button-select file file-${o} candidate`,o.toLowerCase()),s=>s("click",()=>Dt(({assign:a,end:l})=>{Ir(a),a("input",{_tag:"role",role:dn(e)}),l(),id(o)}))):u(`button-select file file-${o} nothing`,o.toLowerCase()))},dd=(e,t,n)=>{const r=ud(n.filter(o=>pr(o)===dn(e)));return Ns.map(o=>{if(t===null)return u(`button-select rank rank-${o} nothing`,o.toLowerCase());const s=Ls(t,o),a=r(s);return a.length===0?u(`button-select rank rank-${o} nothing`,o.toLowerCase()):o===E("input-san/rank")?u(`button-select rank rank-${o} selected`,o.toLowerCase()):me(u(`button-select rank rank-${o} candidate`,o.toLowerCase()),l=>l("click",()=>{ad(o);const i=dn(e);i&&z("input",wh(i,a))}))})},gd=(e,t)=>{const n=e._tag==="candidates"?e.candidates:[],r=n.length===0?u("select hidden"):u("select",...fd(n)),o=E("input-san/file"),s=u("square-select files",...pd(e,o,t)),a=u("square-select ranks",...dd(e,o,t));return[r,a,s]},md=e=>{const t=u("pieces"),n=u("moves"),r=u("input input-san",n,t);e.append(r);const o=()=>{const s=E("lichess/game-state");if(s&&Ct()===Ft()){const a=ee(t),l=ee(n),i=E("input"),h=yn(s.moves);if(i._tag!=="none"&&h.length>0){const c=dn(i);a(...No(c,h)),l(...gd(i,h.filter(k=>pr(k)===c))),Xs(n)}else a(...No(null,h)),Ee(n),Ys(n)}else Ee(n),Ee(t)};te("lichess/game-state","lichess/game-info","input","input-san/file","input-san/rank")(o),o()};let rr=null;const _d=e=>rr=e,mn=e=>{rr!==null&&(e?rr.requestFullscreen().then(()=>z("fullscreen",!0)).catch(t=>console.warn("failed to enter fullscreen",t)):document.exitFullscreen().then(()=>z("fullscreen",!1)).catch(t=>console.warn("failed to exit fullscreen",t)))},vd=e=>{z("lichess/current-challenge",e),z("lichess/challenges",[]),z("input",bn()),up(e.id)},bd=e=>{Xe("lichess/challenges",t=>t.filter(n=>n.id!==e.id)),hp(e.id,"generic")},wd=e=>{const t=u("lock locked"),n=_r("locked"),r=vr("locked"),o=()=>E("lockScreen")?n(t):r(t);te("lockScreen")(o),o(),e.append(t)},Lo="",Bn="",kd="",yd="1.",Ed=()=>E("fullscreen")?ie(he(Lo,"fullscreen-off"),()=>mn(!1)):ie(he(Lo,"fullscreen-on"),()=>mn(!0)),Cd=e=>{const t=Ft(),n=ti();if(e&&t&&n){if(t==="white"&&e.wdraw||t==="black"&&e.bdraw)return"me";if(n==="white"&&e.wdraw||n==="black"&&e.bdraw)return"other"}return"none"},Sd=(e,t)=>{switch(Cd(e)){case"me":return ie(he(Bn,"draw-waiting"),lf);case"other":return u("draw-answer",u("icon",Bn),ie(he("Accept","draw-accept"),()=>fn(t.fullId,"yes")),ie(he("Decline","draw-decline"),()=>{fn(t.fullId,"no"),Xe("lichess/game-state",n=>n&&{...n,bdraw:!1,wdraw:!1})}));case"none":return ie(he(Bn,"draw-offer"),()=>fn(t.fullId,"yes"))}},Ad=e=>ie(he(kd,"resign"),()=>gi(e.fullId)),$d=(...e)=>{const t=u("anti-slip on",...e);let n=null;return t.addEventListener("click",()=>{n||(t.classList.remove("on"),n=window.setTimeout(()=>{n=null,t.classList.add("on")},6e3))}),t},Td=e=>{const t=u("game-actions actions-view"),n=u("game-actions actions-game"),r=()=>{const o=E("lichess/game-state"),s=E("lichess/game-info");ee(t)(Ed(),Kt("movelist",yd)),o&&s?ee(n)($d(Sd(o,s),Ad(s))):Ee(n)};r(),e.append(t,n),te("lichess/game-info","lichess/game-state","fullscreen")(r)},Id=e=>{Hp(e),Td(e),md(e),Rp(e),wd(e)};var $e={},xo;function Pd(){return xo||(xo=1,function(e){var t=$e&&$e.__extends||function(){var b=function(d,y){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,Z){T.__proto__=Z}||function(T,Z){for(var I in Z)Z.hasOwnProperty(I)&&(T[I]=Z[I])},b(d,y)};return function(d,y){b(d,y);function T(){this.constructor=d}d.prototype=y===null?Object.create(y):(T.prototype=y.prototype,new T)}}(),n=$e&&$e.__assign||function(){return n=Object.assign||function(b){for(var d,y=1,T=arguments.length;y<T;y++){d=arguments[y];for(var Z in d)Object.prototype.hasOwnProperty.call(d,Z)&&(b[Z]=d[Z])}return b},n.apply(this,arguments)},r=$e&&$e.__awaiter||function(b,d,y,T){function Z(I){return I instanceof y?I:new y(function(V){V(I)})}return new(y||(y=Promise))(function(I,V){function H(J){try{M(T.next(J))}catch(pe){V(pe)}}function ne(J){try{M(T.throw(J))}catch(pe){V(pe)}}function M(J){J.done?I(J.value):Z(J.value).then(H,ne)}M((T=T.apply(b,d||[])).next())})},o=$e&&$e.__generator||function(b,d){var y={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},T,Z,I,V;return V={next:H(0),throw:H(1),return:H(2)},typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function H(M){return function(J){return ne([M,J])}}function ne(M){if(T)throw new TypeError("Generator is already executing.");for(;y;)try{if(T=1,Z&&(I=M[0]&2?Z.return:M[0]?Z.throw||((I=Z.return)&&I.call(Z),0):Z.next)&&!(I=I.call(Z,M[1])).done)return I;switch(Z=0,I&&(M=[M[0]&2,I.value]),M[0]){case 0:case 1:I=M;break;case 4:return y.label++,{value:M[1],done:!1};case 5:y.label++,Z=M[1],M=[0];continue;case 7:M=y.ops.pop(),y.trys.pop();continue;default:if(I=y.trys,!(I=I.length>0&&I[I.length-1])&&(M[0]===6||M[0]===2)){y=0;continue}if(M[0]===3&&(!I||M[1]>I[0]&&M[1]<I[3])){y.label=M[1];break}if(M[0]===6&&y.label<I[1]){y.label=I[1],I=M;break}if(I&&y.label<I[2]){y.label=I[2],y.ops.push(M);break}I[2]&&y.ops.pop(),y.trys.pop();continue}M=d.call(b,y)}catch(J){M=[6,J],Z=0}finally{T=I=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}},s=$e&&$e.__spreadArrays||function(){for(var b=0,d=0,y=arguments.length;d<y;d++)b+=arguments[d].length;for(var T=Array(b),Z=0,d=0;d<y;d++)for(var I=arguments[d],V=0,H=I.length;V<H;V++,Z++)T[Z]=I[V];return T};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function b(){}return b.prototype.toString=function(){return"ErrorOAuth2"},b}();e.ErrorOAuth2=a;var l=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnknown"},d}(a);e.ErrorUnknown=l;var i=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorNoAuthCode"},d}(a);e.ErrorNoAuthCode=i;var h=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidReturnedStateParam"},d}(a);e.ErrorInvalidReturnedStateParam=h;var c=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidJson"},d}(a);e.ErrorInvalidJson=c;var k=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidScope"},d}(a);e.ErrorInvalidScope=k;var g=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidRequest"},d}(a);e.ErrorInvalidRequest=g;var C=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidToken"},d}(a);e.ErrorInvalidToken=C;var S=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAuthenticationGrant"},d}(a);e.ErrorAuthenticationGrant=S;var K=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnauthorizedClient"},d}(S);e.ErrorUnauthorizedClient=K;var q=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessDenied"},d}(S);e.ErrorAccessDenied=q;var B=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedResponseType"},d}(S);e.ErrorUnsupportedResponseType=B;var N=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorServerError"},d}(S);e.ErrorServerError=N;var U=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorTemporarilyUnavailable"},d}(S);e.ErrorTemporarilyUnavailable=U;var Q=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessTokenResponse"},d}(a);e.ErrorAccessTokenResponse=Q;var Oe=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidClient"},d}(Q);e.ErrorInvalidClient=Oe;var Ke=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidGrant"},d}(Q);e.ErrorInvalidGrant=Ke;var nt=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedGrantType"},d}(Q);e.ErrorUnsupportedGrantType=nt;var vt=function(){function b(){this.realm="",this.error=""}return b}();e.ErrorWWWAuthenticate=vt,e.RawErrorToErrorClassMap={invalid_request:g,invalid_grant:Ke,unauthorized_client:K,access_denied:q,unsupported_response_type:B,invalid_scope:k,server_error:N,temporarily_unavailable:U,invalid_client:Oe,unsupported_grant_type:nt,invalid_json:c,invalid_token:C};function rt(b){return new(e.RawErrorToErrorClassMap[b]||l)}e.toErrorClass=rt;function Gt(b){var d=b.slice(7).replace(/"/g,"").split(", ").map(function(y){var T,Z=y.split("="),I=Z[0],V=Z[1];return T={},T[I]=V,T}).reduce(function(y,T){return n(n({},y),T)},{});return{realm:d.realm,error:d.error}}e.fromWWWAuthenticateHeaderStringToObject=Gt;var An="Authorization",St="WWW-Authenticate";e.LOCALSTORAGE_ID="oauth2authcodepkce",e.LOCALSTORAGE_STATE=e.LOCALSTORAGE_ID+"-state",e.RECOMMENDED_CODE_VERIFIER_LENGTH=96,e.RECOMMENDED_STATE_LENGTH=32;var ot="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",Bt=function(){function b(d){return this.state={},this.config=d,this.recoverState(),this}return b.prototype.decorateFetchHTTPClient=function(d){var y=this;return function(T,Z){for(var I=[],V=2;V<arguments.length;V++)I[V-2]=arguments[V];return y.state.isHTTPDecoratorActive?y.getAccessToken().then(function(H){var ne=H.token,M=Object.assign({},Z);return M.headers||(M.headers={}),M.headers[An]="Bearer "+ne.value,d.apply(void 0,s([T,M],I))}).then(function(H){if(H.ok||!H.headers.has(St.toLowerCase()))return H;var ne=rt(Gt(H.headers.get(St.toLowerCase())).error);return ne instanceof C&&y.config.onAccessTokenExpiry(function(){return y.exchangeRefreshTokenForAccessToken()}),Promise.reject(ne)}):d.apply(void 0,s([T,Z],I))}},b.prototype.isReturningFromAuthServer=function(){var d=b.extractParamFromUrl(location.href,"error");if(d)return Promise.reject(rt(d));var y=b.extractParamFromUrl(location.href,"code");if(!y)return Promise.resolve(!1);var T=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),Z=b.extractParamFromUrl(location.href,"state");return Z!==T.stateQueryParam?(console.warn("state query string parameter doesn't match the one sent! Possible malicious activity somewhere."),Promise.reject(new h)):(T.authorizationCode=y,T.hasAuthCodeBeenExchangedForAccessToken=!1,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(T)),this.setState(T),Promise.resolve(!0))},b.prototype.fetchAuthorizationCode=function(d){return r(this,void 0,void 0,function(){var y,T,Z,I,V,H,ne,M,J,pe,Re;return o(this,function(Me){switch(Me.label){case 0:return this.assertStateAndConfigArePresent(),y=this.config,T=y.clientId,Z=y.extraAuthorizationParams,I=y.redirectUrl,V=y.scopes,[4,b.generatePKCECodes()];case 1:return H=Me.sent(),ne=H.codeChallenge,M=H.codeVerifier,J=b.generateRandomState(e.RECOMMENDED_STATE_LENGTH),this.state=n(n({},this.state),{codeChallenge:ne,codeVerifier:M,stateQueryParam:J,isHTTPDecoratorActive:!0}),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state)),pe=this.config.authorizationUrl+"?response_type=code&"+("client_id="+encodeURIComponent(T)+"&")+("redirect_uri="+encodeURIComponent(I)+"&")+("scope="+encodeURIComponent(V.join(" "))+"&")+("state="+J+"&")+("code_challenge="+encodeURIComponent(ne)+"&")+"code_challenge_method=S256",(Z||d)&&(Re=n(n({},Z),d),pe=pe+"&"+b.objectToQueryString(Re)),location.replace(pe),[2]}})})},b.prototype.getAccessToken=function(){var d=this;this.assertStateAndConfigArePresent();var y=this.config.onAccessTokenExpiry,T=this.state,Z=T.accessToken,I=T.authorizationCode,V=T.explicitlyExposedTokens,H=T.hasAuthCodeBeenExchangedForAccessToken,ne=T.refreshToken,M=T.scopes;return I?this.authCodeForAccessTokenRequest?this.authCodeForAccessTokenRequest:!this.isAuthorized()||!H?(this.authCodeForAccessTokenRequest=this.exchangeAuthCodeForAccessToken(),this.authCodeForAccessTokenRequest):ne&&this.isAccessTokenExpired()?y(function(){return d.exchangeRefreshTokenForAccessToken()}):Promise.resolve({token:Z,explicitlyExposedTokens:V,scopes:M,refreshToken:ne}):Promise.reject(new i)},b.prototype.exchangeRefreshTokenForAccessToken=function(){var d=this,y;this.assertStateAndConfigArePresent();var T=this.config,Z=T.extraRefreshParams,I=T.clientId,V=T.tokenUrl,H=this.state.refreshToken;H||console.warn("No refresh token is present.");var ne=V,M="grant_type=refresh_token&"+("refresh_token="+((y=H)===null||y===void 0?void 0:y.value)+"&")+("client_id="+I);return Z&&(M=ne+"&"+b.objectToQueryString(Z)),fetch(ne,{method:"POST",body:M,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(J){return J.status>=400?J.json().then(function(pe){return Promise.reject(pe)}):J.json()}).then(function(J){var pe=J.access_token,Re=J.expires_in,Me=J.refresh_token,st=J.scope,Ge=d.config.explicitlyExposedTokens,ve=[],Fe={},it={value:pe,expiry:new Date(Date.now()+parseInt(Re)*1e3).toString()};if(d.state.accessToken=it,Me){var bt={value:Me};d.state.refreshToken=bt}Ge&&(Fe=Object.fromEntries(Ge.map(function(Ne){return[Ne,J[Ne]]}).filter(function(Ne){Ne[0];var Be=Ne[1];return Be!==void 0})),d.state.explicitlyExposedTokens=Fe),st&&(ve=st.split(" "),d.state.scopes=ve),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d.state));var De={token:it,scopes:ve};return Ge&&(De.explicitlyExposedTokens=Fe),De}).catch(function(J){var pe=d.config.onInvalidGrant,Re=J.error||"There was a network error.";switch(Re){case"invalid_grant":pe(function(){return d.fetchAuthorizationCode()});break}return Promise.reject(rt(Re))})},b.prototype.getGrantedScopes=function(){return this.state.scopes},b.prototype.isHTTPDecoratorActive=function(d){this.state.isHTTPDecoratorActive=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state))},b.prototype.isAuthorized=function(){return!!this.state.accessToken},b.prototype.isAccessTokenExpired=function(){var d=this.state.accessToken;return!!(d&&new Date>=new Date(d.expiry))},b.prototype.reset=function(){this.setState({}),this.authCodeForAccessTokenRequest=void 0},b.prototype.assertStateAndConfigArePresent=function(){if(!this.state||!this.config)throw console.error("state:",this.state,"config:",this.config),new Error("state or config is not set.")},b.prototype.exchangeAuthCodeForAccessToken=function(d){var y=this;this.assertStateAndConfigArePresent();var T=this.state,Z=T.authorizationCode,I=Z===void 0?d:Z,V=T.codeVerifier,H=V===void 0?"":V,ne=this.config,M=ne.clientId,J=ne.onInvalidGrant,pe=ne.redirectUrl;H?I||console.warn("No authorization grant code is being passed."):console.warn("No code verifier is being sent.");var Re=this.config.tokenUrl,Me="grant_type=authorization_code&"+("code="+encodeURIComponent(I||"")+"&")+("redirect_uri="+encodeURIComponent(pe)+"&")+("client_id="+encodeURIComponent(M)+"&")+("code_verifier="+H);return fetch(Re,{method:"POST",body:Me,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(st){var Ge=st.json().catch(function(ve){return{error:"invalid_json"}});return st.ok?Ge.then(function(ve){var Fe=ve.access_token,it=ve.expires_in,bt=ve.refresh_token,De=ve.scope,Ne=y.config.explicitlyExposedTokens,Be=[],At={};y.state.hasAuthCodeBeenExchangedForAccessToken=!0,y.authCodeForAccessTokenRequest=void 0;var Wt={value:Fe,expiry:new Date(Date.now()+parseInt(it)*1e3).toString()};if(y.state.accessToken=Wt,bt){var $n={value:bt};y.state.refreshToken=$n}Ne&&(At=Object.fromEntries(Ne.map(function(at){return[at,ve[at]]}).filter(function(at){at[0];var Vt=at[1];return Vt!==void 0})),y.state.explicitlyExposedTokens=At),De&&(Be=De.split(" "),y.state.scopes=Be),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(y.state));var Ht={token:Wt,scopes:Be};return Ne&&(Ht.explicitlyExposedTokens=At),Ht}):Ge.then(function(ve){var Fe=ve.error;switch(Fe){case"invalid_grant":J(function(){return y.fetchAuthorizationCode()});break}return Promise.reject(rt(Fe))})})},b.prototype.recoverState=function(){return this.state=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),this},b.prototype.setState=function(d){return this.state=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d)),this},b.base64urlEncode=function(d){var y=btoa(d);return y=y.replace(/\+/g,"-"),y=y.replace(/\//g,"_"),y=y.replace(/=/g,""),y},b.extractParamFromUrl=function(d,y){var T=d.split("?");if(T.length<2)return"";T=T[1].split("#");var Z=T[0].split("&").reduce(function(V,H){return V.concat(H.split("="))},[]);if(Z.length<2)return"";var I=Z.indexOf(y);return decodeURIComponent(I>=0?Z[I+1]:"")},b.objectToQueryString=function(d){return Object.entries(d).map(function(y){var T=y[0],Z=y[1];return T+"="+encodeURIComponent(Z)}).join("&")},b.generatePKCECodes=function(){var d=new Uint32Array(e.RECOMMENDED_CODE_VERIFIER_LENGTH);crypto.getRandomValues(d);var y=b.base64urlEncode(Array.from(d).map(function(T){return ot[T%ot.length]}).join(""));return crypto.subtle.digest("SHA-256",new TextEncoder().encode(y)).then(function(T){for(var Z=new Uint8Array(T),I="",V=Z.byteLength,H=0;H<V;H++)I+=String.fromCharCode(Z[H]);return I}).then(b.base64urlEncode).then(function(T){return{codeChallenge:T,codeVerifier:y}})},b.generateRandomState=function(d){var y=new Uint32Array(d);return crypto.getRandomValues(y),Array.from(y).map(function(T){return ot[T%ot.length]}).join("")},b}();e.OAuth2AuthCodePKCE=Bt}($e)),$e}var Zd=Pd();const zd=new RegExp(`
`),Od=(e,t,n,r,o)=>e(n,o).then(s=>s.body).then(s=>{if(s==null)throw new Error("Response body is NULL");const a=s.getReader();return r&&r(()=>{a.cancel()}),new ReadableStream({start(l){const i=new TextDecoder,h=()=>{a.read().then(({done:c,value:k})=>{if(c){console.log("done",c),l.close();return}i.decode(k).split(zd).map(C=>{if(C.trim().length>0)try{const K=JSON.parse(C),q=t.parse(K);console.log("stream",q),l.enqueue(q)}catch{console.error(`[${n}] Failed to make an object out of chunk:`,C)}}),h()})};h()}}).getReader()}),Rd=e=>(t,n,r,o)=>{const s=[],a=[];let l=[];const i=C=>{const S=()=>{C.read().then(({done:K,value:q})=>{k(Ze(q)),K?g():setTimeout(S,0)}).catch(g)};S()},h=C=>{l.length>0&&(l.forEach(C),l=[]),s.push(C)},c=C=>{a.push(C)},k=Se(C=>{s.length>0?s.find(S=>!S(C)):l.push(C)}),g=()=>{a.forEach(C=>C())};return Od(e,t,n,r,o).then(i).catch(()=>setTimeout(g,200)),{onMessage:h,onClose:c}},Nd="/",Ld=(...e)=>{var t="/",n=new RegExp(t+"{1,}","g");return e.join(t).replace(n,t)},xd=(...e)=>Ld(Nd,...e),Md=["board:play","challenge:read","follow:read","tournament:write"],Fd=`ucui-${location.host}`,Mo=`${location.protocol}//${location.host}${xd()}`,Dd=()=>{const e=E("lichess/host");let t=null;const n=new Zd.OAuth2AuthCodePKCE({authorizationUrl:`${e}/oauth`,tokenUrl:`${e}/api/token`,clientId:Fd,scopes:Md,redirectUrl:Mo,onAccessTokenExpiry:i=>i(),onInvalidGrant:console.warn}),r=async()=>{try{await n.getAccessToken()&&await a()}catch(i){console.error(i)}if(!t)try{await n.isReturningFromAuthServer()&&(await a(),history.replaceState({auth:!0},"authenticate",Mo))}catch(i){console.error(i)}},o=async()=>{await n.fetchAuthorizationCode()},s=async()=>{t&&await t.httpClient(`${e}/api/token`,{method:"DELETE"}),localStorage.clear(),t=null},a=async()=>{const i=n.decorateFetchHTTPClient(window.fetch),c={...await(await i(`${e}/api/account`)).json(),httpClient:i,streamer:Rd(i)};if(c.error)throw c.error;t=c};return{init:r,login:o,logout:s,user:()=>Se(i=>({id:i.id,username:i.username,streamer:i.streamer,httpClient:i.httpClient}))(Ze(t))}},ht=Dd();ht.init().then(()=>{Se(t=>z("lichess/user",t))(ht.user())});let ln=!1;const wi=()=>{ln||(ln=!0,E("lichess/user")?(z("online",!0),ap(t=>(Xe("lichess/stream-events",n=>n.concat(t)),!0),()=>{ln=!1,z("online",!1),window.setTimeout(wi,2e4)})):ln=!1)},Ud=()=>me(u("button button-login",j("home/connect")),e=>e("click",async()=>{const t=us(()=>{ht.login().then(()=>{n(ht.user())})}),n=Se(r=>{z("lichess/user",r)});kt(ht.user(),n,t)})),jd=()=>me(u("button button-logout",""),e=>e("click",()=>ht.logout().then(()=>z("lichess/user",null)))),Kd=e=>t=>{wi(),Ee(e),e.append(u("user",u("username",Rt("",`${E("lichess/host")}/@/${t.id}`,t.username)),jd()))},qd=e=>()=>{Ee(e),e.append(Ud())},Gd=e=>{const t=Se(Kd(e)),n=us(qd(e)),r=te("lichess/user"),o=()=>{kt(ht.user(),t,n)};r(o),o()},Fo=e=>{lp(t=>(Xe("lichess/following",n=>n.filter(r=>r.id!==t.id).concat(t)),!1),async()=>{const t=await gp(E("lichess/following").map(n=>n.id));for(const n of t){const r=e.querySelector(`[data-id="${n.id}"]`);r&&(n.online?r.classList.add("online"):r.classList.remove("online"))}})},Bd=Se(({classical:e,rapid:t})=>u("perfs",u("classical",`${j("players/classic")}: ${e?e.rating:"?"}`),u("rapid",`${j("players/rapid")}: ${t?t.rating:"?"}`))),Wd=e=>me(u("result",u("username",e.username),Bd(Ze(e.perfs))),t=>t("click",()=>{z("lichess/opponent",e),z("screen","challenge")})),Hd=()=>{const e=mt(Lh("","search"),r=>r("placeholder",j("players/username"))),t=u("results"),n=me(u("button submit",j("players/search")),r=>r("click",()=>{const o=e.value;mi(o).then(s=>ee(t)(Wd(s)))}));return u("lookup",u("section",u("title",j("players/find"))),u("search-block",e,n),t)},Do=e=>mt(u("user",me(u("username",e.username),t=>t("click",()=>{z("lichess/opponent",e),z("screen","challenge")})),u("activity")),t=>t("data-id",e.id)),Vd=e=>me(u(`level level-${e}`,`${e}`),t=>t("click",()=>{z("lichess/opponent",{_tag:"lichess-ai",level:e}),z("screen","challenge")})),Qd=[1,2,3,4,5,6,7,8],Jd=()=>u("user lichess-ai",u("section",j("players/ai")),u("levels",u("label",j("players/ai-level")),...Qd.map(Vd))),ki=e=>{const t=u("users",...E("lichess/following").map(Do)),n=ie(he("","refresh"),()=>{Fo(t)}),r=u("section",u("title",j("players/following")),n);e.append(u("players-inner",r,t,Jd(),Hd())),te("lichess/following")(()=>{ee(t)(...E("lichess/following").map(Do))}),Fo(t)},Yd=e=>{switch(e.type){case"clock":return e.show;case"correspondence":return`${e.daysPerTurn} day`;case"unlimited":return"unlimited"}},Xd=e=>u("challenge",u("spec",u("challenger",e.challenger.name),u("time",Yd(e.timeControl))),u("actions",me(u("button button-accept",j("home/challenge-accept")),t=>t("click",()=>{vd(e),z("screen","game")})),me(u("button button-decline",j("home/challenge-decline")),t=>t("click",()=>{bd(e)})))),Uo=()=>{const e=E("lichess/challenges");return e.length>0?e.map(Xd):[u("waiting",j("home/challenge-wait"))]},jo=()=>u("footer",Rt("link","https://github.com/pierremarc/telechecs",j("home/link-git"))),eg=()=>u("intro",Co("home/tagline"),xh("board-image","https://raw.githubusercontent.com/pierremarc/telechecs/main/picture.jpg"),Co("home/description")),tg=()=>{const e=u("challenges",...Uo()),t=ee(e);return te("lichess/challenges")(()=>{t(...Uo())}),u("challenge-block",u("section",u("title",j("home/challenges"))),e)},ng=()=>u("section create-game",Bp()),rg=()=>u("section areana",ie(he(j("arena/arena"),"arena"),()=>{vp().then(({created:e,started:t})=>{z("lichess/arena-created",e),z("lichess/arena-started",t)}),z("screen","arena")})),Ko=e=>{const t=ee(e),n=()=>{const r=u("login");Gd(r);const o=u("header",u("title","Tlchecs"),r);if(E("lichess/user")){const s=u("players");ki(s),t(u("home",o,s,tg(),ng(),rg(),jo()))}else t(u("home",o,eg(),jo()))};n(),te("lichess/user")(n)},og="wakeLock"in navigator,sg=()=>{if(og){const e=te(...df().filter(i=>i!=="lockScreen"));let t=null;const n=i=>pf("lockScreen",h=>h!==i?sr(i):or),r=()=>E("screen")==="game"?t===null?!0:!t.released:!1,o=()=>!!(E("screen")!=="game"&&t&&!t.released),s=()=>{navigator.wakeLock.request("screen").then(i=>{t=i,console.log("WakeLock acquired"),n(!0),t.addEventListener("release",()=>{n(!1),console.log("Navigator released lock sentinel")})}).catch(i=>{console.error("failed to lock screen",i),Et("Tlchecs",`Failed to lock screen: ${i}`)})},a=()=>{n(!1),t&&!t.released&&t.release().then(()=>{t=null}).catch(i=>console.error("failed to release wakelock",i))},l=()=>{r()?s():o()&&a()};e(l),l()}},yi=[["P","Pawn"],["B","Bishop"],["N","Knight"],["R","Rook"],["Q","Queen"],["K","King"]],ig=yi.map(e=>e[0]),ag=e=>{const t=parseInt(e,10);if(!Number.isNaN(t))return[t,null];const n=yi.find(o=>o[0]===e.toUpperCase()),r=ig.indexOf(e)>=0?"white":"black";return[1,{role:n[1],color:r}]},cg=(e,t)=>{try{const r=e.split(" ")[0].split("/");return Ns.map((o,s)=>{const a=r[s],l=Xn.map(()=>null);let i=0;return a.split("").forEach(h=>{const[c,k]=ag(h);for(let g=0;g<c;g++)l[i+g]=k;i+=c}),Xn.map((h,c)=>t(Ls(h,ph(o)),l[c]))})}catch(n){return console.error("Failed to procees FEN",n),[[]]}},lg=(e,t)=>{switch(e){case"Pawn":return t==="black"?"":"";case"Rook":return t==="black"?"":"";case"Knight":return t==="black"?"":"";case"Bishop":return t==="black"?"":"";case"Queen":return t==="black"?"":"";case"King":return t==="black"?"":""}},ug=(e,t)=>t===null?u(`square empty ${e}`,""):u(`square ${e}`,lg(t.role,t.color)),hg=e=>u("board",...cg(e,ug).map(t=>u("rank",...t))),fg=e=>{switch(e.name){case"aborted":return j("end/aborted");case"mate":return j("end/mate");case"resign":return j("end/resign");case"stalemate":return j("end/stalemate");case"timeout":return j("end/timeout");case"draw":return j("end/draw");case"outoftime":return j("end/outoftime");case"cheat":return j("end/cheat");case"noStart":return j("end/noStart");case"created":case"started":case"unknownFinish":case"variantEnd":return"Don't know..."}},pg=e=>u("status",fg(e.status)),Wn=({winner:e})=>e===void 0?" - ":e==="white"?" 1 - 0":"0 - 1",Ei=e=>e.color===e.winner?u("result won",Wn(e)):Ms(e.color)===e.winner?u("result lost",Wn(e)):u("result draw",Wn(e)),dg=Se(e=>u("section",ie("Rematch",()=>{mi(e).then(t=>{z("lichess/opponent",t),z("screen","challenge")})}))),gg=e=>u("section",Kt("movelist","Review the game"),mt(Rt("link",`${E("lichess/host")}/${e.gameId}`,"Review the game on Lichess"),t=>t("target","_blank"))),mg=e=>Se(t=>{ee(e)(Ei(t),pg(t),dg(Ze(t.opponent.id)),gg(t))}),_g=e=>{const t=u("info"),n=mg(t),r=u("header",u("title","End of game"),qt());n(Ze(E("lichess/game-info"))),te("lichess/game-info")(()=>n(Ze(E("lichess/game-info")))),e.append(u("end",r,t))},vg={_tag:"pending"},bg=()=>Ct()===ti()?bo().concat(vg):bo(),wg=(e,t,n)=>et("move",Tr(t,yn(e.moves,n),{...bi(),withAnnotation:!0}),"  "),kg=()=>Si(()=>u("hidden"),u("pending")),Hn=(e,t,n)=>{switch(t._tag){case"pending":return kg();default:return wg(e,t,n)}},qo=e=>et("normal",`${e+1}. `),Go=Se(e=>Ah(2,bg()).map(([t,n],r)=>{const o=r*2;return t&&n?u("ply",qo(r),et("moves",Hn(e,t,o),Hn(e,n,o+1))):t?u("ply",qo(r),et("moves",Hn(e,t,o))):u("empty")})),Bo=Se(e=>{const t=hg(af(e.moves));return br("pos-details","Position",u("top",u("r","1"),t),u("f","a"))}),yg=e=>me(u("button","Resign"),t=>t("click",()=>gi(e.gameId))),Eg=e=>me(u("button","Draw"),t=>t("click",()=>fn(e.gameId,"yes"))),Ci=(e,t)=>{const n=E("lichess/game-info");return n&&n.status.name==="started"?e(n):t},Si=(e,t)=>{const n=E("lichess/game-info");return n&&n.status.name!=="created"&&n.status.name!=="started"?e(n):t},Wo=()=>Ci(e=>[Eg(e),yg(e)],[]),Ho=()=>Si(Ei,u("no-outcome")),Vo=()=>[Rh("title","Moves"),Ci(()=>me(u("to-game  to-button",""),e=>e("click",()=>z("screen","game"))),qt())],Cg=e=>{const t=u("moves",...kt(Ze(E("lichess/game-state")),Go,Yt([u("no-moves")]))),n=u("position",kt(Ze(E("lichess/game-state")),Bo,Yt(u("no-board")))),r=u("header",...Vo()),o=u("actions",...Wo()),s=u("outcome",Ho());e.append(u("movelist",r,u("listing",t),s,n,o));const a=ee(t),l=ee(n),i=ee(s),h=ee(o),c=ee(r),k=te("lichess/game-state"),g=te("lichess/game-state"),C=te("started","lichess/game-info");k(()=>{a(...kt(Ze(E("lichess/game-state")),Go,Yt([u("no-moves")])))}),g(()=>{l(kt(Ze(E("lichess/game-state")),Bo,Yt(u("no-board"))))}),C(()=>{c(...Vo()),h(...Wo()),i(Ho())})},Sg=e=>{const t=u("events"),n=gn("","Events"),r=()=>{Ee(t),E("lichess/stream-events").forEach(o=>t.append(u("event"),Nh("json",JSON.stringify(o,void 0,4))))};r(),e.append(n,t),te("lichess/stream-events")(r)},Pr=e=>"_tag"in e&&e._tag==="lichess-ai",Ag=(e,t,n)=>({color:n,"clock.increment":t,"clock.limit":e*60,keepAliveStream:!1,rated:E("ratedChallenge"),variant:"standard"}),$g=(e,t,n,r)=>({color:n,"clock.increment":t,"clock.limit":e*60,variant:"standard",level:r}),Qo=e=>{switch(e){case"white":return yr;case"black":return kr;case"random":return""}},Tg=(e,t,n,r)=>me(r,o=>o("click",()=>{Pr(e)?dp($g(t,n,E("challengeColor"),e.level)).then(s=>z("lichess/my-challenge",s)):pp(e.username,Ag(t,n,E("challengeColor"))).then(s=>z("lichess/my-challenge",s))})),Jo=e=>Pr(e)?`LichessAI ${e.level}`:e.username,Ig=(e,[t,n])=>u("challenge-create",Tg(e,t,n,u("time-control",u("time",t),u("label","minutes"),u("increment","+ .",gr(n.toString(),2,"0"))))),Yo=()=>E("ratedChallenge")?u("toggle",u("selected",j("challenge/rated")),ie(he(j("challenge/casual"),"casual"),()=>z("ratedChallenge",!1))):u("toggle",ie(he(j("challenge/rated"),"rated"),()=>z("ratedChallenge",!0)),u("selected",j("challenge/casual"))),Vn=(e,t)=>t?u("selected",Qo(e)):ie(he(Qo(e),e),()=>z("challengeColor",e)),Xo=()=>u("select",Vn("white",E("challengeColor")==="white"),Vn("random",E("challengeColor")==="random"),Vn("black",E("challengeColor")==="black")),Pg=e=>{const t=E("lichess/opponent");if(t){const n=u("choices",...Ds.map(s=>Ig(t,s))),r=u("rated-selector",Yo()),o=u("color-selector",Xo());e.append(u("challenge-page",u("header",u("title",`Challenge ${Jo(t)}`),qt()),Pr(t)?u("config",o):u("config",o,r),n)),te("lichess/my-challenge")(()=>{ee(n)(u("waiting",`Waiting for ${Jo(t)} answer.`))}),te("ratedChallenge")(()=>{ee(r)(Yo())}),te("challengeColor")(()=>{ee(o)(Xo())})}},Zg=3e3,zg=3e3;let es=null;const Og=e=>{const t=Date.now();mp().then(()=>{const n=Date.now()-t,r=Math.max(0,Math.min(100,100-Math.round(n*100/zg)));e(r)}).catch(()=>e(0))},Rg=e=>{es===null&&(es=window.setInterval(()=>{E("online")||Og(e)},Zg),window.addEventListener("offline",()=>e(0)))},Ng=e=>e>0&&!E("online")?z("online",!0):e===0&&E("online")?z("online",!1):void 0,Lg=e=>{Rg(Ng);const t=u("online-status ok",u("icon"),u("label","Currently offline..."));te("online")(()=>{const n=E("online");n&&t.classList.contains("nok")?(t.classList.remove("nok"),t.classList.add("ok")):!n&&t.classList.contains("ok")&&(t.classList.remove("ok"),t.classList.add("nok"))}),e.append(t)},xg=(e,t)=>({color:"random",increment:t,time:e,rated:E("ratedChallenge"),variant:"standard"}),Mg=()=>z("lichess/seek",null),Fg=(e,t,n)=>me(n,r=>r("click",()=>{const o=xg(e,t);z("lichess/seek",yh(o)),_p(o,Mg).then(s=>z("lichess/seek",Eh(o,s)))})),Dg=([e,t])=>u("challenge-create",Fg(e,t,u("time-control",u("time",e),u("label","minutes"),u("increment","+ .",gr(t.toString(),2,"0"))))),ts=()=>E("ratedChallenge")?u("toggle",u("selected",j("challenge/rated")),ie(he(j("challenge/casual"),"casual"),()=>z("ratedChallenge",!1))):u("toggle",ie(he(j("challenge/rated"),"rated"),()=>z("ratedChallenge",!0)),u("selected",j("challenge/casual"))),ns=e=>{const t=_t("lichess/seek");t===null?e(...Ds.map(Dg)):t._tag==="sending"?e(u("waiting","Offer ",et("italic","en route"))):t._tag==="sent"&&e(u("waiting","Waiting for someone, anyone."),ie(he("Stop waiting","stop-waiting"),()=>{t.cancel()}))},Ug=e=>{const t=u("choices"),n=u("rated-selector",ts());e.append(u("challenge-page",u("header",u("title","Create game"),qt()),u("config",n),t)),ns(ee(t)),te("lichess/seek","lichess/game-info")(()=>{ns(ee(t))}),te("ratedChallenge")(()=>{ee(n)(ts())})},rs=()=>{const e=E("lichess/arena-join");e&&(clearInterval(e.interval),wp(e.id).then(()=>z("lichess/arena-join",null)))},Ai=e=>{const t=()=>{const r=E("lichess/arena-join"),o=E("lichess/game-state");r&&(o===null||o.status!=="started")&&Date.now()-r.since>6e4&&(clearInterval(r.interval),z("lichess/arena-join",null),n())},n=()=>{bp(e).then(()=>{z("lichess/arena-join",{id:e,since:Date.now(),interval:window.setInterval(t,5e3)})}).catch(r=>Et("The Server",r.error))};n()},os=e=>e.toLocaleTimeString().slice(0,5),jg=e=>u("time-control",`${e.limit/60}+${e.increment}`),Te=(e,t)=>t===void 0?u("info undefined",u("key",e)):u("info",u("key",e),u("value",t)),$i=e=>{var t,n;return[Te("Created by",e.createdBy),Te("Start time",os(new Date(e.startsAt))),Te("End time",os(new Date(e.finishesAt))),Te("Rated",e.rated?"Yes":"No"),Te("Players",e.nbPlayers),Te("Variant",e.variant.name),Te("Type",e.perf.name),Te("Max rating",(t=e.maxRating)==null?void 0:t.rating),Te("Min rating",(n=e.minRating)==null?void 0:n.rating),Te("Bots",e.botsAllowed?"Yes":"No"),Te("Min account age",e.minAccountAgeInDays),Te("Only titled",e.onlyTitled?"Yes":"No"),Te("Team member",e.teamMember)]},Kg=e=>e.increment>=3?e.limit>=5*60:e.limit>=10*60,ss=({clock:e,variant:t,position:n})=>n===void 0&&t.key==="standard"&&Kg(e),Zr=({fullName:e,clock:t,nbPlayers:n})=>u("arena-title",u("name",e),u("players",`(${n})`),jg(t)),qg=e=>br("tournament",Zr(e),ie(he(j("arena/join"),"join"),()=>Ai(e.id)),...$i(e)),Gg=e=>{const t=e.startsAt,n=u("countdown"),r=u("join",n),s=setInterval(()=>{if(E("screen")!=="arena"&&s!==null){clearInterval(s);return}const l=t-Date.now(),i=ee(r);l<0?(s!==null&&clearInterval(s),i(ie(he(j("arena/join"),"join"),()=>Ai(e.id))),a&&a.classList.remove("created")):i(uf(l/1e3))},1e3),a=br("tournament created",Zr(e),r,...$i(e));return a},Bg=e=>{const t=E("lichess/arena-started").concat(E("lichess/arena-created")).find(n=>n.id===e.id);return t===void 0?u("join",gn("",j("arena/waiting")),ie(he(j("arena/leave"),"leave"),rs)):u("join",Zr(t),gn("",j("arena/waiting")),ie(he(j("arena/leave"),"leave"),rs))},is=e=>{const t=E("lichess/arena-join");t?ee(e)(Bg(t)):ee(e)(u("help",j("arena/info")),...E("lichess/arena-started").filter(ss).map(qg),...E("lichess/arena-created").filter(ss).map(Gg))},Wg=e=>{const t=u("section",gn("",j("arena/started")),u("inner"));e.append(u("arena-page",u("header",u("title",j("arena/arena")),qt()),t)),is(t),te("lichess/arena-created","lichess/arena-started","lichess/arena-join")(()=>is(t))},Hg=(e,t)=>{Ee(e),e.classList.remove("hidden");const n=E("lichess/arena-started").concat(E("lichess/arena-created")).find(o=>o.id===t.id),r=n===void 0?"Tournament":n.fullName;e.append(u("title",Kt("arena",r)))},Vg=e=>{const t=u("arena-persist hidden");e.append(t),te("lichess/arena-join","screen")(()=>{const n=E("lichess/arena-join"),r=E("screen");n&&r!=="arena"&&r!=="game"?Hg(t,n):(t.classList.add("hidden"),Ee(t))})},as=()=>{const e=te("lichess/stream-events"),{assign:t,end:n}=Sr(),r=i=>{t("lichess/game-info",i.game),t("lichess/challenges",[]),t("screen","game"),od(i.game.gameId)},o=i=>{t("lichess/current-challenge",null),t("lichess/game-info",i.game),t("screen","end-game")},s=i=>{i.challenge.status==="created"&&(Xe("lichess/challenges",h=>h.concat(i.challenge)),E("screen")!=="home"&&Et(i.challenge.challenger.name,"Shall we play?"))},a=i=>{Xe("lichess/challenges",h=>h.filter(c=>c.id===i.challenge.id))},l=i=>{Et(i.challenge.challenger.name,"Sorry, but no."),Xe("lichess/challenges",h=>h.filter(c=>c.id===i.challenge.id))};e(()=>{const i=E("lichess/stream-events");if(i.length>0){const h=i[i.length-1];switch(h.type){case"challenge":s(h);break;case"gameStart":r(h);break;case"gameFinish":o(h);break;case"challengeCanceled":a(h);break;case"challengeDeclined":l(h);break}}n()})},Qg=e=>{zp(),_d(e),sg(),Ko(e),Qp(document.body),Vg(document.body),Lg(document.body),as();let t=["screen","lockScreen","lichess/chat","online"];te("screen")(()=>{switch(gf(n=>t.includes(n)),as(),Ee(e),E("screen")){case"home":return Ko(e);case"events":return Sg(e);case"game":return Id(e);case"movelist":return mn(!1),Cg(e);case"challenge":return Pg(e);case"seek":return Ug(e);case"follow":return ki(e);case"end-game":return mn(!1),_g(e);case"arena":return Wg(e)}})};Se(Qg)(Ze(document.querySelector("#app")));
//# sourceMappingURL=index-B1eMTyof.js.map
