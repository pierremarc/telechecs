var Oi=Object.defineProperty;var Ri=(e,t,n)=>t in e?Oi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ee=(e,t,n)=>Ri(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const So="none",Ao="some",Gn={tag:So},qn=e=>({tag:Ao,value:e}),Ni=e=>typeof e=="object"&&e!==null&&"tag"in e&&(e.tag===So||e.tag===Ao),Bn=e=>e.tag==="none",Se=e=>t=>Bn(t)?Gn:qn(e(t.value)),_r=e=>t=>Bn(t)?e:t.value,$o=e=>t=>Bn(t)?e():t.value,Le=e=>e==null?Gn:qn(e),cn=(e,t,n)=>n(t(e)),xi=e=>{switch(e){case"Pawn":return"p";case"Knight":return"n";case"Bishop":return"b";case"Rook":return"r";case"Queen":return"q";case"King":return"k"}},bt=e=>{switch(e){case"p":return"Pawn";case"n":return"Knight";case"b":return"Bishop";case"r":return"Rook";case"q":return"Queen";case"k":return"King"}},vr=["A","B","C","D","E","F","G","H"],br=["1","2","3","4","5","6","7","8"],Ge=e=>e[0],rn=e=>e[1],Li=(e,t)=>e+t,To=(e,t,n,r,o)=>({_tag:"Normal",role:e,from:t,to:n,capture:r,promotion:o}),Io=(e,t)=>({_tag:"EnPassant",from:e,to:t}),Be=(e,t)=>({_tag:"Castle",king:e,rook:t}),Po=e=>{switch(e._tag){case"Castle":return"King";case"EnPassant":return"Pawn";case"Normal":return e.role}},Fi=e=>{switch(e._tag){case"Castle":switch(e.king){case"E1":return e.rook==="H1"?"G1":"C1";case"E8":return e.rook==="H8"?"G8":"C8"}case"EnPassant":case"Normal":return e.to}},Ui=e=>{switch(e._tag){case"Castle":return e.king;case"EnPassant":case"Normal":return e.from}},Di=e=>[Ui(e),Fi(e),e._tag==="Normal"&&e.promotion!==null?xi(e.promotion):""].join("").toLowerCase(),Zo=e=>e==="black"?"white":"black",un=()=>({_tag:"none"}),Mi=e=>({_tag:"role",role:e}),ji=e=>({_tag:"move",move:e}),zo=e=>{switch(e._tag){case"none":return null;case"role":return e.role;case"move":return Po(e.move)}},hn=e=>({...e,timestamp:Date.now()}),Ki=(e,t)=>{const n=[[]];for(let r=0;r<t.length;r++){let o=Math.floor(r/e);o===n.length&&n.push([]),n[o].push(t[r])}return n},Gi=["localhost","127.0.0.1","10\\..+","172\\.16\\..+","192\\.168\\..+"].map(e=>new RegExp(e)),qi=e=>Gi.some(t=>t.test(e)),Oo=[[20,0],[30,0],[40,0],[60,0]],Ne=(e,t)=>(t((r,o)=>{e.setAttribute(r,o.toString())}),e),de=(e,t)=>(t((r,o)=>{e.addEventListener(r,o)}),e);function Pe(e){for(;e.firstChild;)Bi(e.firstChild);return e}function Bi(e,t=!1){t||Pe(e);const n=e.parentNode;n&&n.removeChild(e)}const Wi=e=>document.createElement(e),kr=e=>t=>t.appendChild(document.createTextNode(e)),fn=(e,t)=>{const n=Wi(e);return n.setAttribute("class",t),n},Hi=e=>t=>{typeof t=="number"?kr(t.toLocaleString())(e):kr(t)(e)},Vi=e=>t=>{e.appendChild(t)},wr=(e,t)=>{typeof t=="number"||typeof t=="string"?Hi(e)(t):Vi(e)(t)},Ro=e=>t=>{Ni(t)?Se(n=>wr(e,n))(t):wr(e,t)},le=e=>(...t)=>{const n=Ro(e);Pe(e),t.forEach(n)},Qi=e=>t=>t.classList.contains(e),rt=(...e)=>t=>(t.classList.add(...e),t),pn=(...e)=>t=>(t.classList.remove(...e),t),ft=(e,t,n)=>{const r=fn(e,t);return n.forEach(Ro(r)),r},p=(e,...t)=>ft("div",e,t),Wt=(...e)=>ft("p","",e),kt=(e,...t)=>ft("span",e,t),Ji=(e,...t)=>ft("h1",e,t),Yi=(e,...t)=>ft("h2",e,t),Xi=(e,...t)=>ft("pre",e,t),ea=(e,t)=>Ne(fn("input",e),n=>n("type",t)),dn=(e,t,...n)=>Ne(ft("a",e,n),r=>r("href",t)),ta=(e,t)=>{const n=fn("img",e);return n.setAttribute("src",t),n},na=(e,t)=>Ne(fn("audio",e),n=>{n("src",t)});var Cn,Er;function ra(){if(Er)return Cn;Er=1;function e(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function t(i,h,c,w,f){const C={move:i,variations:f};return h&&(C.suffix=h),c&&(C.nag=c),w!==null&&(C.comment=w),C}function n(...i){const[h,...c]=i;let w=h;for(const f of c)f!==null&&(w.variations=[f,...f.variations],f.variations=[],w=f);return h}function r(i,h){if(h.marker&&h.marker.comment){let c=h.root;for(;;){const w=c.variations[0];if(!w){c.comment=h.marker.comment;break}c=w}}return{headers:i,root:h.root,result:(h.marker&&h.marker.result)??void 0}}function o(i,h){function c(){this.constructor=i}c.prototype=h.prototype,i.prototype=new c}function s(i,h,c,w){var f=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(f,s.prototype),f.expected=h,f.found=c,f.location=w,f.name="SyntaxError",f}o(s,Error);function a(i,h,c){return c=c||" ",i.length>h?i:(h-=i.length,c+=c.repeat(h),i+c.slice(0,h))}s.prototype.format=function(i){var h="Error: "+this.message;if(this.location){var c=null,w;for(w=0;w<i.length;w++)if(i[w].source===this.location.source){c=i[w].text.split(/\r\n|\n|\r/g);break}var f=this.location.start,C=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(f):f,y=this.location.source+":"+C.line+":"+C.column;if(c){var M=this.location.end,G=a("",C.line.toString().length," "),j=c[f.line-1],Z=f.line===M.line?M.column:j.length+1,D=Z-f.column||1;h+=`
 --> `+y+`
`+G+` |
`+C.line+" | "+j+`
`+G+" | "+a("",f.column-1," ")+a("",D,"^")}else h+=`
 at `+y}return h},s.buildMessage=function(i,h){var c={literal:function(j){return'"'+f(j.text)+'"'},class:function(j){var Z=j.parts.map(function(D){return Array.isArray(D)?C(D[0])+"-"+C(D[1]):C(D)});return"["+(j.inverted?"^":"")+Z.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(j){return j.description}};function w(j){return j.charCodeAt(0).toString(16).toUpperCase()}function f(j){return j.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Z){return"\\x0"+w(Z)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Z){return"\\x"+w(Z)})}function C(j){return j.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Z){return"\\x0"+w(Z)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Z){return"\\x"+w(Z)})}function y(j){return c[j.type](j)}function M(j){var Z=j.map(y),D,H;if(Z.sort(),Z.length>0){for(D=1,H=1;D<Z.length;D++)Z[D-1]!==Z[D]&&(Z[H]=Z[D],H++);Z.length=H}switch(Z.length){case 1:return Z[0];case 2:return Z[0]+" or "+Z[1];default:return Z.slice(0,-1).join(", ")+", or "+Z[Z.length-1]}}function G(j){return j?'"'+f(j)+'"':"end of input"}return"Expected "+M(i)+" but "+G(h)+" found."};function l(i,h){h=h!==void 0?h:{};var c={},w=h.grammarSource,f={pgn:hr},C=hr,y="[",M='"',G="]",j=".",Z="O-O-O",D="O-O",H="0-0-0",Ae="0-0",xe="$",Ve="{",dt="}",Qe=";",Dt="(",wn=")",yt="1-0",Je="0-1",Mt="1/2-1/2",b="*",d=/^[a-zA-Z]/,E=/^[^"]/,A=/^[0-9]/,T=/^[.]/,$=/^[a-zA-Z1-8\-=]/,B=/^[+#]/,q=/^[!?]/,X=/^[^}]/,L=/^[^\r\n]/,V=/^[ \t\r\n]/,ue=Ee("tag pair"),$e=he("[",!1),Ze=he('"',!1),Ye=he("]",!1),De=Ee("tag name"),ge=Re([["a","z"],["A","Z"]],!1,!1),ze=Ee("tag value"),Xe=Re(['"'],!0,!1),gt=Ee("move number"),Oe=Re([["0","9"]],!1,!1),Te=he(".",!1),Me=Re(["."],!1,!1),Ct=Ee("standard algebraic notation"),jt=he("O-O-O",!1),En=he("O-O",!1),Kt=he("0-0-0",!1),et=he("0-0",!1),Gt=Re([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Bs=Re(["+","#"],!1,!1),Ws=Ee("suffix annotation"),sr=Re(["!","?"],!1,!1),Hs=Ee("NAG"),Vs=he("$",!1),Qs=Ee("brace comment"),Js=he("{",!1),ir=Re(["}"],!0,!1),Ys=he("}",!1),Xs=Ee("rest of line comment"),ei=he(";",!1),ar=Re(["\r",`
`],!0,!1),ti=Ee("variation"),ni=he("(",!1),ri=he(")",!1),oi=Ee("game termination marker"),si=he("1-0",!1),ii=he("0-1",!1),ai=he("1/2-1/2",!1),ci=he("*",!1),li=Ee("whitespace"),cr=Re([" ","	","\r",`
`],!1,!1),ui=function(u,_){return r(u,_)},hi=function(u){return Object.fromEntries(u)},fi=function(u,_){return[u,_]},pi=function(u,_){return{root:u,marker:_}},di=function(u,_){return n(e(u),..._.flat())},gi=function(u,_,v,z,O){return t(u,_,v,z,O)},mi=function(u){return u},_i=function(u){return u.replace(/[\r\n]+/g," ")},vi=function(u){return u.trim()},bi=function(u){return u},ki=function(u,_){return{result:u,comment:_}},m=h.peg$currPos|0,mt=[{line:1,column:1}],Ie=m,qt=h.peg$maxFailExpected||[],S=h.peg$silentFails|0,St;if(h.startRule){if(!(h.startRule in f))throw new Error(`Can't start parsing from rule "`+h.startRule+'".');C=f[h.startRule]}function he(u,_){return{type:"literal",text:u,ignoreCase:_}}function Re(u,_,v){return{type:"class",parts:u,inverted:_,ignoreCase:v}}function wi(){return{type:"end"}}function Ee(u){return{type:"other",description:u}}function lr(u){var _=mt[u],v;if(_)return _;if(u>=mt.length)v=mt.length-1;else for(v=u;!mt[--v];);for(_=mt[v],_={line:_.line,column:_.column};v<u;)i.charCodeAt(v)===10?(_.line++,_.column=1):_.column++,v++;return mt[u]=_,_}function ur(u,_,v){var z=lr(u),O=lr(_),J={source:w,start:{offset:u,line:z.line,column:z.column},end:{offset:_,line:O.line,column:O.column}};return J}function P(u){m<Ie||(m>Ie&&(Ie=m,qt=[]),qt.push(u))}function Ei(u,_,v){return new s(s.buildMessage(u,_),u,_,v)}function hr(){var u,_,v;return u=m,_=yi(),v=Ai(),u=ui(_,v),u}function yi(){var u,_,v;for(u=m,_=[],v=fr();v!==c;)_.push(v),v=fr();return v=ve(),u=hi(_),u}function fr(){var u,_,v,z,O,J,tt;return S++,u=m,ve(),i.charCodeAt(m)===91?(_=y,m++):(_=c,S===0&&P($e)),_!==c?(ve(),v=Ci(),v!==c?(ve(),i.charCodeAt(m)===34?(z=M,m++):(z=c,S===0&&P(Ze)),z!==c?(O=Si(),i.charCodeAt(m)===34?(J=M,m++):(J=c,S===0&&P(Ze)),J!==c?(ve(),i.charCodeAt(m)===93?(tt=G,m++):(tt=c,S===0&&P(Ye)),tt!==c?u=fi(v,O):(m=u,u=c)):(m=u,u=c)):(m=u,u=c)):(m=u,u=c)):(m=u,u=c),S--,u===c&&S===0&&P(ue),u}function Ci(){var u,_,v;if(S++,u=m,_=[],v=i.charAt(m),d.test(v)?m++:(v=c,S===0&&P(ge)),v!==c)for(;v!==c;)_.push(v),v=i.charAt(m),d.test(v)?m++:(v=c,S===0&&P(ge));else _=c;return _!==c?u=i.substring(u,m):u=_,S--,u===c&&(_=c,S===0&&P(De)),u}function Si(){var u,_,v;for(S++,u=m,_=[],v=i.charAt(m),E.test(v)?m++:(v=c,S===0&&P(Xe));v!==c;)_.push(v),v=i.charAt(m),E.test(v)?m++:(v=c,S===0&&P(Xe));return u=i.substring(u,m),S--,_=c,S===0&&P(ze),u}function Ai(){var u,_,v;return u=m,_=pr(),ve(),v=zi(),v===c&&(v=null),ve(),u=pi(_,v),u}function pr(){var u,_,v,z;for(u=m,_=yn(),_===c&&(_=null),v=[],z=dr();z!==c;)v.push(z),z=dr();return u=di(_,v),u}function dr(){var u,_,v,z,O,J,tt,Bt;if(u=m,ve(),$i(),ve(),_=Ti(),_!==c){for(v=Ii(),v===c&&(v=null),z=[],O=gr();O!==c;)z.push(O),O=gr();for(O=ve(),J=yn(),J===c&&(J=null),tt=[],Bt=mr();Bt!==c;)tt.push(Bt),Bt=mr();u=gi(_,v,z,J,tt)}else m=u,u=c;return u}function $i(){var u,_,v,z,O,J;for(S++,u=m,_=[],v=i.charAt(m),A.test(v)?m++:(v=c,S===0&&P(Oe));v!==c;)_.push(v),v=i.charAt(m),A.test(v)?m++:(v=c,S===0&&P(Oe));if(i.charCodeAt(m)===46?(v=j,m++):(v=c,S===0&&P(Te)),v!==c){for(z=ve(),O=[],J=i.charAt(m),T.test(J)?m++:(J=c,S===0&&P(Me));J!==c;)O.push(J),J=i.charAt(m),T.test(J)?m++:(J=c,S===0&&P(Me));_=[_,v,z,O],u=_}else m=u,u=c;return S--,u===c&&(_=c,S===0&&P(gt)),u}function Ti(){var u,_,v,z,O,J;if(S++,u=m,_=m,i.substr(m,5)===Z?(v=Z,m+=5):(v=c,S===0&&P(jt)),v===c&&(i.substr(m,3)===D?(v=D,m+=3):(v=c,S===0&&P(En)),v===c&&(i.substr(m,5)===H?(v=H,m+=5):(v=c,S===0&&P(Kt)),v===c&&(i.substr(m,3)===Ae?(v=Ae,m+=3):(v=c,S===0&&P(et)),v===c))))if(v=m,z=i.charAt(m),d.test(z)?m++:(z=c,S===0&&P(ge)),z!==c){if(O=[],J=i.charAt(m),$.test(J)?m++:(J=c,S===0&&P(Gt)),J!==c)for(;J!==c;)O.push(J),J=i.charAt(m),$.test(J)?m++:(J=c,S===0&&P(Gt));else O=c;O!==c?(z=[z,O],v=z):(m=v,v=c)}else m=v,v=c;return v!==c?(z=i.charAt(m),B.test(z)?m++:(z=c,S===0&&P(Bs)),z===c&&(z=null),v=[v,z],_=v):(m=_,_=c),_!==c?u=i.substring(u,m):u=_,S--,u===c&&(_=c,S===0&&P(Ct)),u}function Ii(){var u,_,v;for(S++,u=m,_=[],v=i.charAt(m),q.test(v)?m++:(v=c,S===0&&P(sr));v!==c;)_.push(v),_.length>=2?v=c:(v=i.charAt(m),q.test(v)?m++:(v=c,S===0&&P(sr)));return _.length<1?(m=u,u=c):u=_,S--,u===c&&(_=c,S===0&&P(Ws)),u}function gr(){var u,_,v,z,O;if(S++,u=m,ve(),i.charCodeAt(m)===36?(_=xe,m++):(_=c,S===0&&P(Vs)),_!==c){if(v=m,z=[],O=i.charAt(m),A.test(O)?m++:(O=c,S===0&&P(Oe)),O!==c)for(;O!==c;)z.push(O),O=i.charAt(m),A.test(O)?m++:(O=c,S===0&&P(Oe));else z=c;z!==c?v=i.substring(v,m):v=z,v!==c?u=mi(v):(m=u,u=c)}else m=u,u=c;return S--,u===c&&S===0&&P(Hs),u}function yn(){var u;return u=Pi(),u===c&&(u=Zi()),u}function Pi(){var u,_,v,z,O;if(S++,u=m,i.charCodeAt(m)===123?(_=Ve,m++):(_=c,S===0&&P(Js)),_!==c){for(v=m,z=[],O=i.charAt(m),X.test(O)?m++:(O=c,S===0&&P(ir));O!==c;)z.push(O),O=i.charAt(m),X.test(O)?m++:(O=c,S===0&&P(ir));v=i.substring(v,m),i.charCodeAt(m)===125?(z=dt,m++):(z=c,S===0&&P(Ys)),z!==c?u=_i(v):(m=u,u=c)}else m=u,u=c;return S--,u===c&&(_=c,S===0&&P(Qs)),u}function Zi(){var u,_,v,z,O;if(S++,u=m,i.charCodeAt(m)===59?(_=Qe,m++):(_=c,S===0&&P(ei)),_!==c){for(v=m,z=[],O=i.charAt(m),L.test(O)?m++:(O=c,S===0&&P(ar));O!==c;)z.push(O),O=i.charAt(m),L.test(O)?m++:(O=c,S===0&&P(ar));v=i.substring(v,m),u=vi(v)}else m=u,u=c;return S--,u===c&&(_=c,S===0&&P(Xs)),u}function mr(){var u,_,v,z;return S++,u=m,ve(),i.charCodeAt(m)===40?(_=Dt,m++):(_=c,S===0&&P(ni)),_!==c?(v=pr(),v!==c?(ve(),i.charCodeAt(m)===41?(z=wn,m++):(z=c,S===0&&P(ri)),z!==c?u=bi(v):(m=u,u=c)):(m=u,u=c)):(m=u,u=c),S--,u===c&&S===0&&P(ti),u}function zi(){var u,_,v;return S++,u=m,i.substr(m,3)===yt?(_=yt,m+=3):(_=c,S===0&&P(si)),_===c&&(i.substr(m,3)===Je?(_=Je,m+=3):(_=c,S===0&&P(ii)),_===c&&(i.substr(m,7)===Mt?(_=Mt,m+=7):(_=c,S===0&&P(ai)),_===c&&(i.charCodeAt(m)===42?(_=b,m++):(_=c,S===0&&P(ci))))),_!==c?(ve(),v=yn(),v===c&&(v=null),u=ki(_,v)):(m=u,u=c),S--,u===c&&(_=c,S===0&&P(oi)),u}function ve(){var u,_;for(S++,u=[],_=i.charAt(m),V.test(_)?m++:(_=c,S===0&&P(cr));_!==c;)u.push(_),_=i.charAt(m),V.test(_)?m++:(_=c,S===0&&P(cr));return S--,_=c,S===0&&P(li),u}if(St=C(),h.peg$library)return{peg$result:St,peg$currPos:m,peg$FAILED:c,peg$maxFailExpected:qt,peg$maxFailPos:Ie};if(St!==c&&m===i.length)return St;throw St!==c&&m<i.length&&P(wi()),Ei(qt,Ie<i.length?i.charAt(Ie):null,Ie<i.length?ur(Ie,Ie+1):ur(Ie,Ie))}return Cn={StartRules:["pgn"],SyntaxError:s,parse:l},Cn}var oa=ra();/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const on=0xffffffffffffffffn;function Sn(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function yr(e,t){return e*t&on}function sa(e){return function(){let t=BigInt(e&on),n=BigInt(e>>64n&on);const r=yr(Sn(yr(t,5n),7n),9n);return n^=t,t=(Sn(t,24n)^n^n<<16n)&on,n=Sn(n,37n),e=n<<64n|t,r}}const gn=sa(0xa187eb39cdcaed8f31c4b365b102e01en),ia=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>gn()))),aa=Array.from({length:8},()=>gn()),ca=Array.from({length:16},()=>gn()),An=gn(),_e="w",ye="b",ie="p",Fn="n",sn="b",Tt="r",qe="q",ce="k",$n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Ht{constructor(t,n){ee(this,"color");ee(this,"from");ee(this,"to");ee(this,"piece");ee(this,"captured");ee(this,"promotion");ee(this,"flags");ee(this,"san");ee(this,"lan");ee(this,"before");ee(this,"after");const{color:r,piece:o,from:s,to:a,flags:l,captured:i,promotion:h}=n,c=pe(s),w=pe(a);this.color=r,this.piece=o,this.from=c,this.to=w,this.san=t._moveToSan(n,t._moves({legal:!0})),this.lan=c+w,this.before=t.fen(),t._makeMove(n),this.after=t.fen(),t._undoMove(),this.flags="";for(const f in K)K[f]&l&&(this.flags+=nt[f]);i&&(this.captured=i),h&&(this.promotion=h,this.lan+=h)}isCapture(){return this.flags.indexOf(nt.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(nt.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(nt.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(nt.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(nt.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(nt.BIG_PAWN)>-1}}const me=-1,nt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},K={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Un={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},la={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},ua={...Un,...la},U={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Tn={b:[16,32,17,15],w:[-16,-32,-17,-15]},Cr={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ha=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],fa=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],pa={p:1,n:2,b:4,r:8,q:16,k:32},da="pnbrqkPNBRQK",Sr=[Fn,sn,Tt,qe],ga=7,ma=6,_a=1,va=0,Vt={[ce]:K.KSIDE_CASTLE,[qe]:K.QSIDE_CASTLE},je={w:[{square:U.a1,flag:K.QSIDE_CASTLE},{square:U.h1,flag:K.KSIDE_CASTLE}],b:[{square:U.a8,flag:K.QSIDE_CASTLE},{square:U.h8,flag:K.KSIDE_CASTLE}]},ba={b:_a,w:ma};function st(e){return e>>4}function Pt(e){return e&15}function No(e){return"0123456789".indexOf(e)!==-1}function pe(e){const t=Pt(e),n=st(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function At(e){return e===_e?ye:_e}function ka(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=t[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<o.length;a++){let l=0,i=!1;for(let h=0;h<o[a].length;h++)if(No(o[a][h])){if(i)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(o[a][h],10),i=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[a][h]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,i=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:l}of s){if(!l.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((t[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(o[0]+o[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function wa(e,t){const n=e.from,r=e.to,o=e.piece;let s=0,a=0,l=0;for(let i=0,h=t.length;i<h;i++){const c=t[i].from,w=t[i].to,f=t[i].piece;o===f&&n!==c&&r===w&&(s++,st(n)===st(c)&&a++,Pt(n)===Pt(c)&&l++)}return s>0?a>0&&l>0?pe(n):l>0?pe(n).charAt(1):pe(n).charAt(0):""}function Ke(e,t,n,r,o,s=void 0,a=K.NORMAL){const l=st(r);if(o===ie&&(l===ga||l===va))for(let i=0;i<Sr.length;i++){const h=Sr[i];e.push({color:t,from:n,to:r,piece:o,captured:s,promotion:h,flags:a|K.PROMOTION})}else e.push({color:t,from:n,to:r,piece:o,captured:s,flags:a})}function Ar(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:ie:(t=t.toLowerCase(),t==="o"?ce:t)}function In(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class xo{constructor(t=$n,{skipValidation:n=!1}={}){ee(this,"_board",new Array(128));ee(this,"_turn",_e);ee(this,"_header",{});ee(this,"_kings",{w:me,b:me});ee(this,"_epSquare",-1);ee(this,"_halfMoves",0);ee(this,"_moveNumber",0);ee(this,"_history",[]);ee(this,"_comments",{});ee(this,"_castling",{w:0,b:0});ee(this,"_hash",0n);ee(this,"_positionCount",new Map);this.load(t,{skipValidation:n})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:me,b:me},this._turn=_e,this._castling={w:0,b:0},this._epSquare=me,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...ua},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:n=!1,preserveHeaders:r=!1}={}){let o=t.split(/\s+/);if(o.length>=2&&o.length<6){const l=["-","-","0","1"];t=o.concat(l.slice(-(6-o.length))).join(" ")}if(o=t.split(/\s+/),!n){const{ok:l,error:i}=ka(t);if(!l)throw new Error(i)}const s=o[0];let a=0;this.clear({preserveHeaders:r});for(let l=0;l<s.length;l++){const i=s.charAt(l);if(i==="/")a+=8;else if(No(i))a+=parseInt(i,10);else{const h=i<"a"?_e:ye;this._put({type:i.toLowerCase(),color:h},pe(a)),a++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=K.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=K.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=K.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=K.QSIDE_CASTLE),this._epSquare=o[3]==="-"?me:U[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var a,l;let n=0,r="";for(let i=U.a8;i<=U.h1;i++){if(this._board[i]){n>0&&(r+=n,n=0);const{color:h,type:c}=this._board[i];r+=h===_e?c.toUpperCase():c.toLowerCase()}else n++;i+1&136&&(n>0&&(r+=n),i!==U.h1&&(r+="/"),n=0,i+=8)}let o="";this._castling[_e]&K.KSIDE_CASTLE&&(o+="K"),this._castling[_e]&K.QSIDE_CASTLE&&(o+="Q"),this._castling[ye]&K.KSIDE_CASTLE&&(o+="k"),this._castling[ye]&K.QSIDE_CASTLE&&(o+="q"),o=o||"-";let s="-";if(this._epSquare!==me)if(t)s=pe(this._epSquare);else{const i=this._epSquare+(this._turn===_e?16:-16),h=[i+1,i-1];for(const c of h){if(c&136)continue;const w=this._turn;if(((a=this._board[c])==null?void 0:a.color)===w&&((l=this._board[c])==null?void 0:l.type)===ie){this._makeMove({color:w,from:c,to:this._epSquare,piece:ie,captured:ie,flags:K.EP_CAPTURE});const f=!this._isKingAttacked(w);if(this._undoMove(),f){s=pe(this._epSquare);break}}}}return[r,this._turn,o,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:n,type:r}=this._board[t],o={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[r];return ia[o][s][t]}_epKey(){return this._epSquare===me?0n:aa[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return ca[t]}_computeHash(){let t=0n;for(let n=U.a8;n<=U.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(t^=this._pieceKey(n))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=An),t}_updateSetup(t){this._history.length>0||(t!==$n?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load($n)}get(t){return this._board[U[t]]}findPiece(t){var r;const n=[];for(let o=U.a8;o<=U.h1;o++){if(o&136){o+=7;continue}!this._board[o]||((r=this._board[o])==null?void 0:r.color)!==t.color||this._board[o].color===t.color&&this._board[o].type===t.type&&n.push(pe(o))}return n}put({type:t,color:n},r){return this._put({type:t,color:n},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,n){this._hash^=this._pieceKey(t),this._board[t]=n,this._hash^=this._pieceKey(t)}_put({type:t,color:n},r){if(da.indexOf(t.toLowerCase())===-1||!(r in U))return!1;const o=U[r];if(t==ce&&!(this._kings[n]==me||this._kings[n]==o))return!1;const s=this._board[o];return s&&s.type===ce&&(this._kings[s.color]=me),this._set(o,{type:t,color:n}),t===ce&&(this._kings[n]=o),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const n=this.get(t);return this._clear(U[t]),n&&n.type===ce&&(this._kings[n.color]=me),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var r,o,s,a,l,i,h,c,w,f,C,y;this._hash^=this._castlingKey();const t=((r=this._board[U.e1])==null?void 0:r.type)===ce&&((o=this._board[U.e1])==null?void 0:o.color)===_e,n=((s=this._board[U.e8])==null?void 0:s.type)===ce&&((a=this._board[U.e8])==null?void 0:a.color)===ye;(!t||((l=this._board[U.a1])==null?void 0:l.type)!==Tt||((i=this._board[U.a1])==null?void 0:i.color)!==_e)&&(this._castling.w&=-65),(!t||((h=this._board[U.h1])==null?void 0:h.type)!==Tt||((c=this._board[U.h1])==null?void 0:c.color)!==_e)&&(this._castling.w&=-33),(!n||((w=this._board[U.a8])==null?void 0:w.type)!==Tt||((f=this._board[U.a8])==null?void 0:f.color)!==ye)&&(this._castling.b&=-65),(!n||((C=this._board[U.h8])==null?void 0:C.type)!==Tt||((y=this._board[U.h8])==null?void 0:y.color)!==ye)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,a;if(this._epSquare===me)return;const t=this._epSquare+(this._turn===_e?-16:16),n=this._epSquare+(this._turn===_e?16:-16),r=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==At(this._turn)||((a=this._board[n])==null?void 0:a.type)!==ie){this._hash^=this._epKey(),this._epSquare=me;return}const o=l=>{var i,h;return!(l&136)&&((i=this._board[l])==null?void 0:i.color)===this._turn&&((h=this._board[l])==null?void 0:h.type)===ie};r.some(o)||(this._hash^=this._epKey(),this._epSquare=me)}_attacked(t,n,r){const o=[];for(let s=U.a8;s<=U.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==t)continue;const a=this._board[s],l=s-n;if(l===0)continue;const i=l+119;if(ha[i]&pa[a.type]){if(a.type===ie){if(l>0&&a.color===_e||l<=0&&a.color===ye)if(r)o.push(pe(s));else return!0;continue}if(a.type==="n"||a.type==="k")if(r){o.push(pe(s));continue}else return!0;const h=fa[i];let c=s+h,w=!1;for(;c!==n;){if(this._board[c]!=null){w=!0;break}c+=h}if(!w)if(r){o.push(pe(s));continue}else return!0}}return r?o:!1}attackers(t,n){return n?this._attacked(n,U[t],!0):this._attacked(this._turn,U[t],!0)}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(At(t),n)}hash(){return this._hash.toString(16)}isAttacked(t,n){return this._attacked(n,U[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let r=0,o=0;for(let s=U.a8;s<=U.h1;s++){if(o=(o+1)%2,s&136){s+=7;continue}const a=this._board[s];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===sn&&n.push(o),r++)}if(r===2)return!0;if(r===3&&(t[sn]===1||t[Fn]===1))return!0;if(r===t[sn]+2){let s=0;const a=n.length;for(let l=0;l<a;l++)s+=n[l];if(s===0||s===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:r=void 0}={}){const o=this._moves({square:n,piece:r});return t?o.map(s=>new Ht(this,s)):o.map(s=>this._moveToSan(s,o))}_moves({legal:t=!0,piece:n=void 0,square:r=void 0}={}){var C;const o=r?r.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),a=[],l=this._turn,i=At(l);let h=U.a8,c=U.h1,w=!1;if(o)if(o in U)h=c=U[o],w=!0;else return[];for(let y=h;y<=c;y++){if(y&136){y+=7;continue}if(!this._board[y]||this._board[y].color===i)continue;const{type:M}=this._board[y];let G;if(M===ie){if(s&&s!==M)continue;G=y+Tn[l][0],this._board[G]||(Ke(a,l,y,G,ie),G=y+Tn[l][1],ba[l]===st(y)&&!this._board[G]&&Ke(a,l,y,G,ie,void 0,K.BIG_PAWN));for(let j=2;j<4;j++)G=y+Tn[l][j],!(G&136)&&(((C=this._board[G])==null?void 0:C.color)===i?Ke(a,l,y,G,ie,this._board[G].type,K.CAPTURE):G===this._epSquare&&Ke(a,l,y,G,ie,ie,K.EP_CAPTURE))}else{if(s&&s!==M)continue;for(let j=0,Z=Cr[M].length;j<Z;j++){const D=Cr[M][j];for(G=y;G+=D,!(G&136);){if(!this._board[G])Ke(a,l,y,G,M);else{if(this._board[G].color===l)break;Ke(a,l,y,G,M,this._board[G].type,K.CAPTURE);break}if(M===Fn||M===ce)break}}}}if((s===void 0||s===ce)&&(!w||c===this._kings[l])){if(this._castling[l]&K.KSIDE_CASTLE){const y=this._kings[l],M=y+2;!this._board[y+1]&&!this._board[M]&&!this._attacked(i,this._kings[l])&&!this._attacked(i,y+1)&&!this._attacked(i,M)&&Ke(a,l,this._kings[l],M,ce,void 0,K.KSIDE_CASTLE)}if(this._castling[l]&K.QSIDE_CASTLE){const y=this._kings[l],M=y-2;!this._board[y-1]&&!this._board[y-2]&&!this._board[y-3]&&!this._attacked(i,this._kings[l])&&!this._attacked(i,y-1)&&!this._attacked(i,M)&&Ke(a,l,this._kings[l],M,ce,void 0,K.QSIDE_CASTLE)}}if(!t||this._kings[l]===-1)return a;const f=[];for(let y=0,M=a.length;y<M;y++)this._makeMove(a[y]),this._isKingAttacked(l)||f.push(a[y]),this._undoMove();return f}move(t,{strict:n=!1}={}){let r=null;if(typeof t=="string")r=this._moveFromSan(t,n);else if(typeof t=="object"){const s=this._moves();for(let a=0,l=s.length;a<l;a++)if(t.from===pe(s[a].from)&&t.to===pe(s[a].to)&&(!("promotion"in s[a])||t.promotion===s[a].promotion)){r=s[a];break}}if(!r)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const o=new Ht(this,r);return this._makeMove(r),this._incPositionCount(),o}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,n){this._hash^=this._pieceKey(t),this._board[n]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(n)}_makeMove(t){var o,s,a,l;const n=this._turn,r=At(n);if(this._push(t),this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&K.EP_CAPTURE&&(this._turn===ye?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:n})),this._board[t.to].type===ce){if(this._kings[n]=t.to,t.flags&K.KSIDE_CASTLE){const i=t.to-1,h=t.to+1;this._movePiece(h,i)}else if(t.flags&K.QSIDE_CASTLE){const i=t.to+1,h=t.to-2;this._movePiece(h,i)}this._castling[n]=0}if(this._castling[n]){for(let i=0,h=je[n].length;i<h;i++)if(t.from===je[n][i].square&&this._castling[n]&je[n][i].flag){this._castling[n]^=je[n][i].flag;break}}if(this._castling[r]){for(let i=0,h=je[r].length;i<h;i++)if(t.to===je[r][i].square&&this._castling[r]&je[r][i].flag){this._castling[r]^=je[r][i].flag;break}}if(this._hash^=this._castlingKey(),t.flags&K.BIG_PAWN){let i;n===ye?i=t.to-16:i=t.to+16,!(t.to-1&136)&&((o=this._board[t.to-1])==null?void 0:o.type)===ie&&((s=this._board[t.to-1])==null?void 0:s.color)===r||!(t.to+1&136)&&((a=this._board[t.to+1])==null?void 0:a.type)===ie&&((l=this._board[t.to+1])==null?void 0:l.color)===r?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=me}else this._epSquare=me;t.piece===ie?this._halfMoves=0:t.flags&(K.CAPTURE|K.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===ye&&this._moveNumber++,this._turn=r,this._hash^=An}undo(){const t=this._hash,n=this._undoMove();if(n){const r=new Ht(this,n);return this._decPositionCount(t),r}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=An;const r=this._turn,o=At(r);if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:r})),n.captured)if(n.flags&K.EP_CAPTURE){let s;r===ye?s=n.to-16:s=n.to+16,this._set(s,{type:ie,color:o})}else this._set(n.to,{type:n.captured,color:o});if(n.flags&(K.KSIDE_CASTLE|K.QSIDE_CASTLE)){let s,a;n.flags&K.KSIDE_CASTLE?(s=n.to+1,a=n.to-1):(s=n.to-2,a=n.to+1),this._movePiece(a,s)}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const r=[];let o=!1;for(const f in this._header)this._header[f]&&r.push(`[${f} "${this._header[f]}"]`+t),o=!0;o&&this._history.length&&r.push(t);const s=f=>{const C=this._comments[this.fen()];if(typeof C<"u"){const y=f.length>0?" ":"";f=`${f}${y}{${C}}`}return f},a=[];for(;this._history.length>0;)a.push(this._undoMove());const l=[];let i="";for(a.length===0&&l.push(s(""));a.length>0;){i=s(i);const f=a.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const C=`${this._moveNumber}. ...`;i=i?`${i} ${C}`:C}else f.color==="w"&&(i.length&&l.push(i),i=this._moveNumber+".");i=i+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(i.length&&l.push(s(i)),l.push(this._header.Result||"*"),n===0)return r.join("")+l.join(" ");const h=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},c=function(f,C){for(const y of C.split(" "))if(y){if(f+y.length>n){for(;h();)f--;r.push(t),f=0}r.push(y),f+=y.length,r.push(" "),f++}return h()&&f--,f};let w=0;for(let f=0;f<l.length;f++){if(w+l[f].length>n&&l[f].includes("{")){w=c(w,l[f]);continue}w+l[f].length>n&&f!==0?(r[r.length-1]===" "&&r.pop(),r.push(t),w=0):f!==0&&(r.push(" "),w++),r.push(l[f]),w+=l[f].length}return r.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}setHeader(t,n){return this._header[t]=n??Un[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Un[t]||null,!0):!1}getHeaders(){const t={};for(const[n,r]of Object.entries(this._header))r!==null&&(t[n]=r);return t}loadPgn(t,{strict:n=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(t=t.replace(new RegExp(r,"g"),`
`));const o=oa.parse(t);this.reset();const s=o.headers;let a="";for(const h in s)h.toLowerCase()==="fen"&&(a=s[h]),this.header(h,s[h]);if(!n)a&&this.load(a,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let l=o.root;for(;l;){if(l.move){const h=this._moveFromSan(l.move,n);if(h==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(h),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const i=o.result;i&&Object.keys(this._header).length&&this._header.Result!==i&&this.setHeader("Result",i)}_moveToSan(t,n){let r="";if(t.flags&K.KSIDE_CASTLE)r="O-O";else if(t.flags&K.QSIDE_CASTLE)r="O-O-O";else{if(t.piece!==ie){const o=wa(t,n);r+=t.piece.toUpperCase()+o}t.flags&(K.CAPTURE|K.EP_CAPTURE)&&(t.piece===ie&&(r+=pe(t.from)[0]),r+="x"),r+=pe(t.to),t.promotion&&(r+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(t,n=!1){let r=In(t);n||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O"));let o=Ar(r),s=this._moves({legal:!0,piece:o});for(let f=0,C=s.length;f<C;f++)if(r===In(this._moveToSan(s[f],s)))return s[f];if(n)return null;let a,l,i,h,c,w=!1;if(l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(a=l[1],i=l[2],h=l[3],c=l[4],i.length==1&&(w=!0)):(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(a=l[1],i=l[2],h=l[3],c=l[4],i.length==1&&(w=!0))),o=Ar(r),s=this._moves({legal:!0,piece:a||o}),!h)return null;for(let f=0,C=s.length;f<C;f++)if(i){if((!a||a.toLowerCase()==s[f].piece)&&U[i]==s[f].from&&U[h]==s[f].to&&(!c||c.toLowerCase()==s[f].promotion))return s[f];if(w){const y=pe(s[f].from);if((!a||a.toLowerCase()==s[f].piece)&&U[h]==s[f].to&&(i==y[0]||i==y[1])&&(!c||c.toLowerCase()==s[f].promotion))return s[f]}}else if(r===In(this._moveToSan(s[f],s)).replace("x",""))return s[f];return null}ascii(){let t=`   +------------------------+
`;for(let n=U.a8;n<=U.h1;n++){if(Pt(n)===0&&(t+=" "+"87654321"[st(n)]+" |"),this._board[n]){const r=this._board[n].type,s=this._board[n].color===_e?r.toUpperCase():r.toLowerCase();t+=" "+s+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let r=0;const o=this._turn;for(let s=0,a=n.length;s<a;s++)this._makeMove(n[s]),this._isKingAttacked(o)||(t-1>0?r+=this.perft(t-1):r++),this._undoMove();return r}turn(){return this._turn}board(){const t=[];let n=[];for(let r=U.a8;r<=U.h1;r++)this._board[r]==null?n.push(null):n.push({square:pe(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t}squareColor(t){if(t in U){const n=U[t];return(st(n)+Pt(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],r=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;t?r.push(new Ht(this,o)):r.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return r}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const n=this._positionCount.get(t)??0;n===1?this._positionCount.delete(t):this._positionCount.set(t,n-1)}_pruneComments(){const t=[],n={},r=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)t.push(this._undoMove());for(r(this.fen());;){const o=t.pop();if(!o)break;this._makeMove(o),r(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const o of[ce,qe])n[o]!==void 0&&(n[o]?this._castling[t]|=Vt[o]:this._castling[t]&=~Vt[o]);this._updateCastlingRights();const r=this.getCastlingRights(t);return(n[ce]===void 0||n[ce]===r[ce])&&(n[qe]===void 0||n[qe]===r[qe])}getCastlingRights(t){return{[ce]:(this._castling[t]&Vt[ce])!==0,[qe]:(this._castling[t]&Vt[qe])!==0}}moveNumber(){return this._moveNumber}}const Ea=["Pawn","Bishop","Knight","Rook","Queen","King"],Lo="♟",Fo="♜",Uo="♞",Do="♝",Mo="♛",jo="♚",Ko="♙",Go="♖",qo="♘",Bo="♗",Wo="♕",Ho="♔",ya=rt("hidden"),Vo=pn("hidden"),Qo=e=>{const t=e.slice(0,2),n=e.slice(2,4),r=e[4];return{from:t,to:n,promotion:r}},Zt=e=>e.split(" ").filter(t=>t.trim().length>0),Wn=(e,t)=>{const n=new xo;return(t===void 0?Zt(e):Zt(e).slice(0,t)).forEach(o=>n.move(Qo(o))),n.moves({verbose:!0}).map(o=>o.isKingsideCastle()?o.color=="w"?Be("E1","H1"):Be("E8","H8"):o.isQueensideCastle()?o.color=="w"?Be("E1","A1"):Be("E8","A8"):o.isEnPassant()?Io(o.from.toUpperCase(),o.to.toUpperCase()):To(bt(o.piece),o.from.toUpperCase(),o.to.toUpperCase(),o.isCapture()?bt(o.captured):null,o.isPromotion()?bt(o.promotion):null))},Ca=e=>e.isKingsideCastle()?e.color=="w"?Be("E1","H1"):Be("E8","H8"):e.isQueensideCastle()?e.color=="w"?Be("E1","A1"):Be("E8","A8"):e.isEnPassant()?Io(e.from.toUpperCase(),e.to.toUpperCase()):To(bt(e.piece),e.from.toUpperCase(),e.to.toUpperCase(),e.isCapture()?bt(e.captured):null,e.isPromotion()?bt(e.promotion):null),Jo=e=>{const t=new xo;return Zt(e).forEach(n=>t.move(Qo(n))),t.history({verbose:!0}).map(Ca)},Sa=()=>{},wt=()=>{const e=x("lichess/game-state");return e?Zt(e.moves).length%2===0?"white":"black":null},Yo=()=>{const e=at();return e?Zo(e):null},at=()=>{const e=x("lichess/game-info");return e?e.color:null},$r=()=>{const e=x("lichess/game-state");return e?Jo(e.moves):[]},Xo=()=>un(),Aa=()=>"home";let We={screen:Aa(),clock:null,input:Xo(),started:!1,lockScreen:!1,online:!0,fullscreen:!1,"lichess/host":"https://lichess.org","lichess/user":null,"lichess/stream-events":[],"lichess/challenges":[],"lichess/current-challenge":null,"lichess/my-challenge":null,"lichess/game-info":null,"lichess/game-state":null,"lichess/opponent":null,"lichess/following":[],"lichess/chat":null,"lichess/seek":null};const es=[],$a=()=>es.map(e=>{const t=localStorage.getItem(e);t!==null&&(We[e]=JSON.parse(t))});$a();let zt=[];const ct=(e,t)=>{let n=x(e);We[e]=t(n),es.includes(e)&&localStorage.setItem(e,JSON.stringify(We[e]));const r=zt.filter(([o,s])=>o==e);for(const o of r){const s=o[1];s(e)}return e!=="clock"&&(console.groupCollapsed(e),console.debug("from",n),console.debug("to",We[e]),console.debug("subscribers",r),console.groupEnd()),x(e)},Ta=(e,t)=>Se(n=>F(e,n))(t(x(e))),F=(e,t)=>ct(e,()=>t),x=e=>JSON.parse(JSON.stringify(We[e])),Et=e=>We[e],Ia=()=>Object.keys(We),ae=(...e)=>t=>zt=zt.concat(e.map(n=>[n,t])),Pa=e=>zt=zt.filter(([t,n])=>e(t));qi(document.location.hostname)&&Object.assign(window,{UcuiState:We});const Za=(e,t)=>Array.isArray(t)?t.map(n=>`${e}=${encodeURIComponent(n)}`).join("&"):`${e}=${encodeURIComponent(t)}`,Hn=e=>Object.keys(e).map(t=>Za(t,e[t])).join("&"),za=(e,t)=>`${e}?${Hn(t)}`,Oa=(e="application/json")=>{const t=new Headers;return e!=="none"&&t.append("Content-Type",e),{mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},ts=e=>(t,n,r)=>{const o={method:"GET",...Oa(),...r};return e(n,o).then(s=>{if(s.ok)return s.json();throw s}).then(s=>t.parse(s))},Ra=ts(fetch),ns=(e="application/x-www-form-urlencoded")=>{const t={};return e!=="none"&&(t["Content-Type"]=e),{method:"POST",mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},rs=e=>(t,n,r,o)=>{const s={method:"POST",...ns(),...o};return typeof r=="string"?(s.headers["Content-Type"]="text/plain",s.body=r):s.body=Hn(r),e(n,s).then(a=>{if(a.ok)return a.json();throw a}).then(a=>t.parse(a))},Na=rs(fetch);function k(e,t,n){function r(l,i){var h;Object.defineProperty(l,"_zod",{value:l._zod??{},enumerable:!1}),(h=l._zod).traits??(h.traits=new Set),l._zod.traits.add(e),t(l,i);for(const c in a.prototype)c in l||Object.defineProperty(l,c,{value:a.prototype[c].bind(l)});l._zod.constr=a,l._zod.def=i}const o=(n==null?void 0:n.Parent)??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function a(l){var i;const h=n!=null&&n.Parent?new s:this;r(h,l),(i=h._zod).deferred??(i.deferred=[]);for(const c of h._zod.deferred)c();return h}return Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:l=>{var i,h;return n!=null&&n.Parent&&l instanceof n.Parent?!0:(h=(i=l==null?void 0:l._zod)==null?void 0:i.traits)==null?void 0:h.has(e)}}),Object.defineProperty(a,"name",{value:e}),a}class Ot extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const os={};function lt(e){return os}function xa(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function La(e,t){return typeof t=="bigint"?t.toString():t}function ss(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Vn(e){return e==null}function Qn(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Fa(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=Number.parseInt(e.toFixed(o).replace(".","")),a=Number.parseInt(t.toFixed(o).replace(".",""));return s%a/10**o}function ne(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function mn(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function is(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function $t(e){return JSON.stringify(e)}function Dn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Ua=ss(()=>{if(typeof navigator<"u"&&(navigator!=null&&navigator.userAgent.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Tr(e){if(Dn(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(Dn(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}const Da=new Set(["string","number","symbol"]);function xt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pt(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function I(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Ma(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const ja={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Ka(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return pt(e,{...e._zod.def,shape:n,checks:[]})}function Ga(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return pt(e,{...e._zod.def,shape:n,checks:[]})}function qa(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return mn(this,"shape",r),r},checks:[]};return pt(e,n)}function Ba(e,t){return pt(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return mn(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function Wa(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)o[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return pt(t,{...t._zod.def,shape:o,checks:[]})}function Ha(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)o[s]=new e({type:"nonoptional",innerType:r[s]});return pt(t,{...t._zod.def,shape:o,checks:[]})}function It(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function Jn(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Qt(e){return typeof e=="string"?e:e==null?void 0:e.message}function ut(e,t,n){var o,s,a,l,i,h;const r={...e,path:e.path??[]};if(!e.message){const c=Qt((a=(s=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:s.error)==null?void 0:a.call(s,e))??Qt((l=t==null?void 0:t.error)==null?void 0:l.call(t,e))??Qt((i=n.customError)==null?void 0:i.call(n,e))??Qt((h=n.localeError)==null?void 0:h.call(n,e))??"Invalid input";r.message=c}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function Yn(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Rt(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const as=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,La,2)},enumerable:!0})},cs=k("$ZodError",as),ls=k("$ZodError",as,{Parent:Error});function Va(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function Qa(e,t){const n=t||function(s){return s.message},r={_errors:[]},o=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(l=>o({issues:l}));else if(a.code==="invalid_key")o({issues:a.issues});else if(a.code==="invalid_element")o({issues:a.issues});else if(a.path.length===0)r._errors.push(n(a));else{let l=r,i=0;for(;i<a.path.length;){const h=a.path[i];i===a.path.length-1?(l[h]=l[h]||{_errors:[]},l[h]._errors.push(n(a))):l[h]=l[h]||{_errors:[]},l=l[h],i++}}};return o(e),r}const Ja=e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new Ot;if(a.issues.length){const l=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>ut(i,s,lt())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return a.value},Ya=e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const l=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>ut(i,s,lt())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return a.value},us=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new Ot;return s.issues.length?{success:!1,error:new(e??cs)(s.issues.map(a=>ut(a,o,lt())))}:{success:!0,data:s.value}},Xa=us(ls),hs=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(a=>ut(a,o,lt())))}:{success:!0,data:s.value}},ec=hs(ls),tc=/^[cC][^\s-]{8,}$/,nc=/^[0-9a-z]+$/,rc=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,oc=/^[0-9a-vA-V]{20}$/,sc=/^[A-Za-z0-9]{27}$/,ic=/^[a-zA-Z0-9_-]{21}$/,ac=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,cc=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Ir=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,lc=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,uc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function hc(){return new RegExp(uc,"u")}const fc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,pc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,dc=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,gc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mc=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,fs=/^[A-Za-z0-9_-]*$/,_c=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,vc=/^\+(?:[0-9]){6,14}[0-9]$/,ps="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bc=new RegExp(`^${ps}$`);function ds(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function kc(e){return new RegExp(`^${ds(e)}$`)}function wc(e){let t=`${ps}T${ds(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}const Ec=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},yc=/^\d+$/,Cc=/^-?\d+(?:\.\d+)?/i,Sc=/true|false/i,Ac=/^[^A-Z]*$/,$c=/^[^a-z]*$/,be=k("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),gs={number:"number",bigint:"bigint",object:"date"},ms=k("$ZodCheckLessThan",(e,t)=>{be.init(e,t);const n=gs[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),_s=k("$ZodCheckGreaterThan",(e,t)=>{be.init(e,t);const n=gs[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Tc=k("$ZodCheckMultipleOf",(e,t)=>{be.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Fa(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Ic=k("$ZodCheckNumberFormat",(e,t)=>{var a;be.init(e,t),t.format=t.format||"float64";const n=(a=t.format)==null?void 0:a.includes("int"),r=n?"int":"number",[o,s]=ja[t.format];e._zod.onattach.push(l=>{const i=l._zod.bag;i.format=t.format,i.minimum=o,i.maximum=s,n&&(i.pattern=yc)}),e._zod.check=l=>{const i=l.value;if(n){if(!Number.isInteger(i)){l.issues.push({expected:r,format:t.format,code:"invalid_type",input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?l.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):l.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}i<o&&l.issues.push({origin:"number",input:i,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),i>s&&l.issues.push({origin:"number",input:i,code:"too_big",maximum:s,inst:e})}}),Pc=k("$ZodCheckMaxLength",(e,t)=>{be.init(e,t),e._zod.when=n=>{const r=n.value;return!Vn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const s=Yn(r);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Zc=k("$ZodCheckMinLength",(e,t)=>{be.init(e,t),e._zod.when=n=>{const r=n.value;return!Vn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const s=Yn(r);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),zc=k("$ZodCheckLengthEquals",(e,t)=>{be.init(e,t),e._zod.when=n=>{const r=n.value;return!Vn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,o=r.length;if(o===t.length)return;const s=Yn(r),a=o>t.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),_n=k("$ZodCheckStringFormat",(e,t)=>{var n;be.init(e,t),e._zod.onattach.push(r=>{const o=r._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),Oc=k("$ZodCheckRegex",(e,t)=>{_n.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Rc=k("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Ac),_n.init(e,t)}),Nc=k("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=$c),_n.init(e,t)}),xc=k("$ZodCheckIncludes",(e,t)=>{be.init(e,t);const n=xt(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),Lc=k("$ZodCheckStartsWith",(e,t)=>{be.init(e,t);const n=new RegExp(`^${xt(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),Fc=k("$ZodCheckEndsWith",(e,t)=>{be.init(e,t);const n=new RegExp(`.*${xt(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),Uc=k("$ZodCheckOverwrite",(e,t)=>{be.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Dc{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(a=>a),o=Math.min(...r.map(a=>a.length-a.trimStart().length)),s=r.map(a=>a.slice(o)).map(a=>" ".repeat(this.indent*2)+a);for(const a of s)this.content.push(a)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}}const Mc={major:4,minor:0,patch:0},re=k("$ZodType",(e,t)=>{var o;var n;e??(e={}),ne(e._zod,"id",()=>t.type+"_"+is(10)),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Mc;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const s of r)for(const a of s._zod.onattach)a(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const s=(a,l,i)=>{let h=It(a),c;for(const w of l){if(w._zod.when){if(!w._zod.when(a))continue}else if(h)continue;const f=a.issues.length,C=w._zod.check(a);if(C instanceof Promise&&(i==null?void 0:i.async)===!1)throw new Ot;if(c||C instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await C,a.issues.length!==f&&(h||(h=It(a,f)))});else{if(a.issues.length===f)continue;h||(h=It(a,f))}}return c?c.then(()=>a):a};e._zod.run=(a,l)=>{const i=e._zod.parse(a,l);if(i instanceof Promise){if(l.async===!1)throw new Ot;return i.then(h=>s(h,r,l))}return s(i,r,l)}}e["~standard"]={validate:s=>{var a;try{const l=Xa(e,s);return l.success?{value:l.data}:{issues:(a=l.error)==null?void 0:a.issues}}catch{return ec(e,s).then(i=>{var h;return i.success?{value:i.data}:{issues:(h=i.error)==null?void 0:h.issues}})}},vendor:"zod",version:1}}),Xn=k("$ZodString",(e,t)=>{var n;re.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??Ec(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),te=k("$ZodStringFormat",(e,t)=>{_n.init(e,t),Xn.init(e,t)}),jc=k("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=cc),te.init(e,t)}),Kc=k("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Ir(r))}else t.pattern??(t.pattern=Ir());te.init(e,t)}),Gc=k("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=lc),te.init(e,t)}),qc=k("$ZodURL",(e,t)=>{te.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:_c.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Bc=k("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=hc()),te.init(e,t)}),Wc=k("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=ic),te.init(e,t)}),Hc=k("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=tc),te.init(e,t)}),Vc=k("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=nc),te.init(e,t)}),Qc=k("$ZodULID",(e,t)=>{t.pattern??(t.pattern=rc),te.init(e,t)}),Jc=k("$ZodXID",(e,t)=>{t.pattern??(t.pattern=oc),te.init(e,t)}),Yc=k("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=sc),te.init(e,t)}),Xc=k("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=wc(t)),te.init(e,t)}),el=k("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=bc),te.init(e,t)}),tl=k("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=kc(t)),te.init(e,t)}),nl=k("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=ac),te.init(e,t)}),rl=k("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=fc),te.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),ol=k("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=pc),te.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),sl=k("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=dc),te.init(e,t)}),il=k("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=gc),te.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function vs(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const al=k("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=mc),te.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{vs(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function cl(e){if(!fs.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return vs(n)}const ll=k("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=fs),te.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{cl(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),ul=k("$ZodE164",(e,t)=>{t.pattern??(t.pattern=vc),te.init(e,t)});function hl(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const fl=k("$ZodJWT",(e,t)=>{te.init(e,t),e._zod.check=n=>{hl(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),bs=k("$ZodNumber",(e,t)=>{re.init(e,t),e._zod.pattern=e._zod.bag.pattern??Cc,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),pl=k("$ZodNumber",(e,t)=>{Ic.init(e,t),bs.init(e,t)}),dl=k("$ZodBoolean",(e,t)=>{re.init(e,t),e._zod.pattern=Sc,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),gl=k("$ZodUnknown",(e,t)=>{re.init(e,t),e._zod.parse=n=>n}),ml=k("$ZodNever",(e,t)=>{re.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function Pr(e,t,n){e.issues.length&&t.issues.push(...Jn(n,e.issues)),t.value[n]=e.value}const _l=k("$ZodArray",(e,t)=>{re.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let a=0;a<o.length;a++){const l=o[a],i=t.element._zod.run({value:l,issues:[]},r);i instanceof Promise?s.push(i.then(h=>Pr(h,n,a))):Pr(i,n,a)}return s.length?Promise.all(s).then(()=>n):n}});function Jt(e,t,n){e.issues.length&&t.issues.push(...Jn(n,e.issues)),t.value[n]=e.value}function Zr(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...Jn(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const vl=k("$ZodObject",(e,t)=>{re.init(e,t);const n=ss(()=>{const w=Object.keys(t.shape);for(const C of w)if(!(t.shape[C]instanceof re))throw new Error(`Invalid element at key "${C}": expected a Zod schema`);const f=Ma(t.shape);return{shape:t.shape,keys:w,keySet:new Set(w),numKeys:w.length,optionalKeys:new Set(f)}});ne(e._zod,"propValues",()=>{const w=t.shape,f={};for(const C in w){const y=w[C]._zod;if(y.values){f[C]??(f[C]=new Set);for(const M of y.values)f[C].add(M)}}return f});const r=w=>{const f=new Dc(["shape","payload","ctx"]),{keys:C,optionalKeys:y}=n.value,M=Z=>{const D=$t(Z);return`shape[${D}]._zod.run({ value: input[${D}], issues: [] }, ctx)`};f.write("const input = payload.value;");const G=Object.create(null);for(const Z of C)G[Z]=is(15);f.write("const newResult = {}");for(const Z of C)if(y.has(Z)){const D=G[Z];f.write(`const ${D} = ${M(Z)};`);const H=$t(Z);f.write(`
        if (${D}.issues.length) {
          if (input[${H}] === undefined) {
            if (${H} in input) {
              newResult[${H}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${D}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${H}, ...iss.path] : [${H}],
              }))
            );
          }
        } else if (${D}.value === undefined) {
          if (${H} in input) newResult[${H}] = undefined;
        } else {
          newResult[${H}] = ${D}.value;
        }
        `)}else{const D=G[Z];f.write(`const ${D} = ${M(Z)};`),f.write(`
          if (${D}.issues.length) payload.issues = payload.issues.concat(${D}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${$t(Z)}, ...iss.path] : [${$t(Z)}]
          })));`),f.write(`newResult[${$t(Z)}] = ${D}.value`)}f.write("payload.value = newResult;"),f.write("return payload;");const j=f.compile();return(Z,D)=>j(w,Z,D)};let o;const s=Dn,a=!os.jitless,i=a&&Ua.value,{catchall:h}=t;let c;e._zod.parse=(w,f)=>{c??(c=n.value);const C=w.value;if(!s(C))return w.issues.push({expected:"object",code:"invalid_type",input:C,inst:e}),w;const y=[];if(a&&i&&(f==null?void 0:f.async)===!1&&f.jitless!==!0)o||(o=r(t.shape)),w=o(w,f);else{w.value={};const D=c.shape;for(const H of c.keys){const Ae=D[H],xe=Ae._zod.run({value:C[H],issues:[]},f),Ve=Ae._zod.optin==="optional"&&Ae._zod.optout==="optional";xe instanceof Promise?y.push(xe.then(dt=>Ve?Zr(dt,w,H,C):Jt(dt,w,H))):Ve?Zr(xe,w,H,C):Jt(xe,w,H)}}if(!h)return y.length?Promise.all(y).then(()=>w):w;const M=[],G=c.keySet,j=h._zod,Z=j.def.type;for(const D of Object.keys(C)){if(G.has(D))continue;if(Z==="never"){M.push(D);continue}const H=j.run({value:C[D],issues:[]},f);H instanceof Promise?y.push(H.then(Ae=>Jt(Ae,w,D))):Jt(H,w,D)}return M.length&&w.issues.push({code:"unrecognized_keys",keys:M,input:C,inst:e}),y.length?Promise.all(y).then(()=>w):w}});function zr(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(s=>ut(s,r,lt())))}),t}const bl=k("$ZodUnion",(e,t)=>{re.init(e,t),ne(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),ne(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>Qn(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const s=[];for(const a of t.options){const l=a._zod.run({value:n.value,issues:[]},r);if(l instanceof Promise)s.push(l),o=!0;else{if(l.issues.length===0)return l;s.push(l)}}return o?Promise.all(s).then(a=>zr(a,n,e,r)):zr(s,n,e,r)}}),kl=k("$ZodIntersection",(e,t)=>{re.init(e,t),e._zod.parse=(n,r)=>{const{value:o}=n,s=t.left._zod.run({value:o,issues:[]},r),a=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||a instanceof Promise?Promise.all([s,a]).then(([i,h])=>Or(n,i,h)):Or(n,s,a)}});function Mn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Tr(e)&&Tr(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const a=Mn(e[s],t[s]);if(!a.valid)return{valid:!1,mergeErrorPath:[s,...a.mergeErrorPath]};o[s]=a.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],a=Mn(o,s);if(!a.valid)return{valid:!1,mergeErrorPath:[r,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Or(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),It(e))return e;const r=Mn(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const wl=k("$ZodEnum",(e,t)=>{re.init(e,t);const n=xa(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(r=>Da.has(typeof r)).map(r=>typeof r=="string"?xt(r):r.toString()).join("|")})$`),e._zod.parse=(r,o)=>{const s=r.value;return e._zod.values.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),El=k("$ZodLiteral",(e,t)=>{re.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?xt(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),yl=k("$ZodTransform",(e,t)=>{re.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(a=>(n.value=a,n));if(o instanceof Promise)throw new Ot;return n.value=o,n}}),Cl=k("$ZodOptional",(e,t)=>{re.init(e,t),e._zod.optin="optional",e._zod.optout="optional",ne(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),ne(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Qn(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),Sl=k("$ZodNullable",(e,t)=>{re.init(e,t),ne(e._zod,"optin",()=>t.innerType._zod.optin),ne(e._zod,"optout",()=>t.innerType._zod.optout),ne(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Qn(n.source)}|null)$`):void 0}),ne(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),Al=k("$ZodDefault",(e,t)=>{re.init(e,t),e._zod.optin="optional",ne(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Rr(s,t)):Rr(o,t)}});function Rr(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const $l=k("$ZodPrefault",(e,t)=>{re.init(e,t),e._zod.optin="optional",ne(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Tl=k("$ZodNonOptional",(e,t)=>{re.init(e,t),ne(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Nr(s,e)):Nr(o,e)}});function Nr(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Il=k("$ZodCatch",(e,t)=>{re.init(e,t),ne(e._zod,"optin",()=>t.innerType._zod.optin),ne(e._zod,"optout",()=>t.innerType._zod.optout),ne(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>ut(a,r,lt()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>ut(s,r,lt()))},input:n.value}),n.issues=[]),n)}}),Pl=k("$ZodPipe",(e,t)=>{re.init(e,t),ne(e._zod,"values",()=>t.in._zod.values),ne(e._zod,"optin",()=>t.in._zod.optin),ne(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>xr(s,t,r)):xr(o,t,r)}});function xr(e,t,n){return It(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const Zl=k("$ZodReadonly",(e,t)=>{re.init(e,t),ne(e._zod,"propValues",()=>t.innerType._zod.propValues),ne(e._zod,"optin",()=>t.innerType._zod.optin),ne(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(Lr):Lr(o)}});function Lr(e){return e.value=Object.freeze(e.value),e}const zl=k("$ZodCustom",(e,t)=>{be.init(e,t),re.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>Fr(s,n,r,e));Fr(o,n,r,e)}});function Fr(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(Rt(o))}}class Ol{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function Rl(){return new Ol}const Yt=Rl();function Nl(e,t){return new e({type:"string",...I(t)})}function xl(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...I(t)})}function Ur(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...I(t)})}function Ll(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...I(t)})}function Fl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...I(t)})}function Ul(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...I(t)})}function Dl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...I(t)})}function ks(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...I(t)})}function Ml(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...I(t)})}function jl(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...I(t)})}function Kl(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...I(t)})}function Gl(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...I(t)})}function ql(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...I(t)})}function Bl(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...I(t)})}function Wl(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...I(t)})}function Hl(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...I(t)})}function Vl(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...I(t)})}function Ql(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...I(t)})}function Jl(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...I(t)})}function Yl(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...I(t)})}function Xl(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...I(t)})}function eu(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...I(t)})}function tu(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...I(t)})}function nu(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...I(t)})}function ru(e,t){return new e({type:"string",format:"date",check:"string_format",...I(t)})}function ou(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...I(t)})}function su(e,t){return new e({type:"string",format:"duration",check:"string_format",...I(t)})}function iu(e,t){return new e({type:"number",checks:[],...I(t)})}function au(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...I(t)})}function cu(e,t){return new e({type:"boolean",...I(t)})}function lu(e){return new e({type:"unknown"})}function uu(e,t){return new e({type:"never",...I(t)})}function Dr(e,t){return new ms({check:"less_than",...I(t),value:e,inclusive:!1})}function Pn(e,t){return new ms({check:"less_than",...I(t),value:e,inclusive:!0})}function Mr(e,t){return new _s({check:"greater_than",...I(t),value:e,inclusive:!1})}function Zn(e,t){return new _s({check:"greater_than",...I(t),value:e,inclusive:!0})}function jr(e,t){return new Tc({check:"multiple_of",...I(t),value:e})}function ws(e,t){return new Pc({check:"max_length",...I(t),maximum:e})}function ln(e,t){return new Zc({check:"min_length",...I(t),minimum:e})}function Es(e,t){return new zc({check:"length_equals",...I(t),length:e})}function hu(e,t){return new Oc({check:"string_format",format:"regex",...I(t),pattern:e})}function fu(e){return new Rc({check:"string_format",format:"lowercase",...I(e)})}function pu(e){return new Nc({check:"string_format",format:"uppercase",...I(e)})}function du(e,t){return new xc({check:"string_format",format:"includes",...I(t),includes:e})}function gu(e,t){return new Lc({check:"string_format",format:"starts_with",...I(t),prefix:e})}function mu(e,t){return new Fc({check:"string_format",format:"ends_with",...I(t),suffix:e})}function Lt(e){return new Uc({check:"overwrite",tx:e})}function _u(e){return Lt(t=>t.normalize(e))}function vu(){return Lt(e=>e.trim())}function bu(){return Lt(e=>e.toLowerCase())}function ku(){return Lt(e=>e.toUpperCase())}function wu(e,t,n){return new e({type:"array",element:t,...I(n)})}function Eu(e,t,n){return new e({type:"custom",check:"custom",fn:t,...I(n)})}const yu=k("ZodISODateTime",(e,t)=>{Xc.init(e,t),oe.init(e,t)});function Cu(e){return nu(yu,e)}const Su=k("ZodISODate",(e,t)=>{el.init(e,t),oe.init(e,t)});function Au(e){return ru(Su,e)}const $u=k("ZodISOTime",(e,t)=>{tl.init(e,t),oe.init(e,t)});function Tu(e){return ou($u,e)}const Iu=k("ZodISODuration",(e,t)=>{nl.init(e,t),oe.init(e,t)});function Pu(e){return su(Iu,e)}const Zu=(e,t)=>{cs.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Qa(e,n)},flatten:{value:n=>Va(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},vn=k("ZodError",Zu,{Parent:Error}),zu=Ja(vn),Ou=Ya(vn),Ru=us(vn),Nu=hs(vn),se=k("ZodType",(e,t)=>(re.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>pt(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>zu(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>Ru(e,n,r),e.parseAsync=async(n,r)=>Ou(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>Nu(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check($h(n,r)),e.superRefine=n=>e.check(Th(n)),e.overwrite=n=>e.check(Lt(n)),e.optional=()=>qr(e),e.nullable=()=>Br(e),e.nullish=()=>qr(Br(e)),e.nonoptional=n=>bh(e,n),e.array=()=>sh(e),e.or=n=>Y([e,n]),e.and=n=>lh(e,n),e.transform=n=>Wr(e,ph(n)),e.default=n=>mh(e,n),e.prefault=n=>vh(e,n),e.catch=n=>wh(e,n),e.pipe=n=>Wr(e,n),e.readonly=()=>Ch(e),e.describe=n=>{const r=e.clone();return Yt.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=Yt.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Yt.get(e);const r=e.clone();return Yt.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),ys=k("_ZodString",(e,t)=>{Xn.init(e,t),se.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(hu(...r)),e.includes=(...r)=>e.check(du(...r)),e.startsWith=(...r)=>e.check(gu(...r)),e.endsWith=(...r)=>e.check(mu(...r)),e.min=(...r)=>e.check(ln(...r)),e.max=(...r)=>e.check(ws(...r)),e.length=(...r)=>e.check(Es(...r)),e.nonempty=(...r)=>e.check(ln(1,...r)),e.lowercase=r=>e.check(fu(r)),e.uppercase=r=>e.check(pu(r)),e.trim=()=>e.check(vu()),e.normalize=(...r)=>e.check(_u(...r)),e.toLowerCase=()=>e.check(bu()),e.toUpperCase=()=>e.check(ku())}),xu=k("ZodString",(e,t)=>{Xn.init(e,t),ys.init(e,t),e.email=n=>e.check(xl(Lu,n)),e.url=n=>e.check(ks(Cs,n)),e.jwt=n=>e.check(tu(Xu,n)),e.emoji=n=>e.check(Ml(Uu,n)),e.guid=n=>e.check(Ur(Kr,n)),e.uuid=n=>e.check(Ll(Xt,n)),e.uuidv4=n=>e.check(Fl(Xt,n)),e.uuidv6=n=>e.check(Ul(Xt,n)),e.uuidv7=n=>e.check(Dl(Xt,n)),e.nanoid=n=>e.check(jl(Du,n)),e.guid=n=>e.check(Ur(Kr,n)),e.cuid=n=>e.check(Kl(Mu,n)),e.cuid2=n=>e.check(Gl(ju,n)),e.ulid=n=>e.check(ql(Ku,n)),e.base64=n=>e.check(Yl(Qu,n)),e.base64url=n=>e.check(Xl(Ju,n)),e.xid=n=>e.check(Bl(Gu,n)),e.ksuid=n=>e.check(Wl(qu,n)),e.ipv4=n=>e.check(Hl(Bu,n)),e.ipv6=n=>e.check(Vl(Wu,n)),e.cidrv4=n=>e.check(Ql(Hu,n)),e.cidrv6=n=>e.check(Jl(Vu,n)),e.e164=n=>e.check(eu(Yu,n)),e.datetime=n=>e.check(Cu(n)),e.date=n=>e.check(Au(n)),e.time=n=>e.check(Tu(n)),e.duration=n=>e.check(Pu(n))});function N(e){return Nl(xu,e)}const oe=k("ZodStringFormat",(e,t)=>{te.init(e,t),ys.init(e,t)}),Lu=k("ZodEmail",(e,t)=>{Gc.init(e,t),oe.init(e,t)}),Kr=k("ZodGUID",(e,t)=>{jc.init(e,t),oe.init(e,t)}),Xt=k("ZodUUID",(e,t)=>{Kc.init(e,t),oe.init(e,t)}),Cs=k("ZodURL",(e,t)=>{qc.init(e,t),oe.init(e,t)});function Fu(e){return ks(Cs,e)}const Uu=k("ZodEmoji",(e,t)=>{Bc.init(e,t),oe.init(e,t)}),Du=k("ZodNanoID",(e,t)=>{Wc.init(e,t),oe.init(e,t)}),Mu=k("ZodCUID",(e,t)=>{Hc.init(e,t),oe.init(e,t)}),ju=k("ZodCUID2",(e,t)=>{Vc.init(e,t),oe.init(e,t)}),Ku=k("ZodULID",(e,t)=>{Qc.init(e,t),oe.init(e,t)}),Gu=k("ZodXID",(e,t)=>{Jc.init(e,t),oe.init(e,t)}),qu=k("ZodKSUID",(e,t)=>{Yc.init(e,t),oe.init(e,t)}),Bu=k("ZodIPv4",(e,t)=>{rl.init(e,t),oe.init(e,t)}),Wu=k("ZodIPv6",(e,t)=>{ol.init(e,t),oe.init(e,t)}),Hu=k("ZodCIDRv4",(e,t)=>{sl.init(e,t),oe.init(e,t)}),Vu=k("ZodCIDRv6",(e,t)=>{il.init(e,t),oe.init(e,t)}),Qu=k("ZodBase64",(e,t)=>{al.init(e,t),oe.init(e,t)}),Ju=k("ZodBase64URL",(e,t)=>{ll.init(e,t),oe.init(e,t)}),Yu=k("ZodE164",(e,t)=>{ul.init(e,t),oe.init(e,t)}),Xu=k("ZodJWT",(e,t)=>{fl.init(e,t),oe.init(e,t)}),Ss=k("ZodNumber",(e,t)=>{bs.init(e,t),se.init(e,t),e.gt=(r,o)=>e.check(Mr(r,o)),e.gte=(r,o)=>e.check(Zn(r,o)),e.min=(r,o)=>e.check(Zn(r,o)),e.lt=(r,o)=>e.check(Dr(r,o)),e.lte=(r,o)=>e.check(Pn(r,o)),e.max=(r,o)=>e.check(Pn(r,o)),e.int=r=>e.check(Q(r)),e.safe=r=>e.check(Q(r)),e.positive=r=>e.check(Mr(0,r)),e.nonnegative=r=>e.check(Zn(0,r)),e.negative=r=>e.check(Dr(0,r)),e.nonpositive=r=>e.check(Pn(0,r)),e.multipleOf=(r,o)=>e.check(jr(r,o)),e.step=(r,o)=>e.check(jr(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Fe(e){return iu(Ss,e)}const eh=k("ZodNumberFormat",(e,t)=>{pl.init(e,t),Ss.init(e,t)});function Q(e){return au(eh,e)}const th=k("ZodBoolean",(e,t)=>{dl.init(e,t),se.init(e,t)});function W(e){return cu(th,e)}const nh=k("ZodUnknown",(e,t)=>{gl.init(e,t),se.init(e,t)});function Gr(){return lu(nh)}const rh=k("ZodNever",(e,t)=>{ml.init(e,t),se.init(e,t)});function As(e){return uu(rh,e)}const oh=k("ZodArray",(e,t)=>{_l.init(e,t),se.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(ln(n,r)),e.nonempty=n=>e.check(ln(1,n)),e.max=(n,r)=>e.check(ws(n,r)),e.length=(n,r)=>e.check(Es(n,r)),e.unwrap=()=>e.element});function sh(e,t){return wu(oh,e,t)}const $s=k("ZodObject",(e,t)=>{vl.init(e,t),se.init(e,t),ne(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>uh(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Gr()}),e.loose=()=>e.clone({...e._zod.def,catchall:Gr()}),e.strict=()=>e.clone({...e._zod.def,catchall:As()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>qa(e,n),e.merge=n=>Ba(e,n),e.pick=n=>Ka(e,n),e.omit=n=>Ga(e,n),e.partial=(...n)=>Wa(Ts,e,n[0]),e.required=(...n)=>Ha(Is,e,n[0])});function ih(e,t){const n={type:"object",get shape(){return mn(this,"shape",{...e}),this.shape},...I(t)};return new $s(n)}function R(e,t){return new $s({type:"object",get shape(){return mn(this,"shape",{...e}),this.shape},catchall:As(),...I(t)})}const ah=k("ZodUnion",(e,t)=>{bl.init(e,t),se.init(e,t),e.options=t.options});function Y(e,t){return new ah({type:"union",options:e,...I(t)})}const ch=k("ZodIntersection",(e,t)=>{kl.init(e,t),se.init(e,t)});function lh(e,t){return new ch({type:"intersection",left:e,right:t})}const jn=k("ZodEnum",(e,t)=>{wl.init(e,t),se.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const a of r)if(n.has(a))s[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new jn({...t,checks:[],...I(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const a of r)if(n.has(a))delete s[a];else throw new Error(`Key ${a} not found in enum`);return new jn({...t,checks:[],...I(o),entries:s})}});function uh(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new jn({type:"enum",entries:n,...I(t)})}const hh=k("ZodLiteral",(e,t)=>{El.init(e,t),se.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function g(e,t){return new hh({type:"literal",values:Array.isArray(e)?e:[e],...I(t)})}const fh=k("ZodTransform",(e,t)=>{yl.init(e,t),se.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=s=>{if(typeof s=="string")n.issues.push(Rt(s,n.value,t));else{const a=s;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=n.value),a.inst??(a.inst=e),a.continue??(a.continue=!0),n.issues.push(Rt(a))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function ph(e){return new fh({type:"transform",transform:e})}const Ts=k("ZodOptional",(e,t)=>{Cl.init(e,t),se.init(e,t),e.unwrap=()=>e._zod.def.innerType});function qr(e){return new Ts({type:"optional",innerType:e})}const dh=k("ZodNullable",(e,t)=>{Sl.init(e,t),se.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Br(e){return new dh({type:"nullable",innerType:e})}const gh=k("ZodDefault",(e,t)=>{Al.init(e,t),se.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function mh(e,t){return new gh({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const _h=k("ZodPrefault",(e,t)=>{$l.init(e,t),se.init(e,t),e.unwrap=()=>e._zod.def.innerType});function vh(e,t){return new _h({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Is=k("ZodNonOptional",(e,t)=>{Tl.init(e,t),se.init(e,t),e.unwrap=()=>e._zod.def.innerType});function bh(e,t){return new Is({type:"nonoptional",innerType:e,...I(t)})}const kh=k("ZodCatch",(e,t)=>{Il.init(e,t),se.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function wh(e,t){return new kh({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Eh=k("ZodPipe",(e,t)=>{Pl.init(e,t),se.init(e,t),e.in=t.in,e.out=t.out});function Wr(e,t){return new Eh({type:"pipe",in:e,out:t})}const yh=k("ZodReadonly",(e,t)=>{Zl.init(e,t),se.init(e,t)});function Ch(e){return new yh({type:"readonly",innerType:e})}const Sh=k("ZodCustom",(e,t)=>{zl.init(e,t),se.init(e,t)});function Ah(e,t){const n=new be({check:"custom",...I(t)});return n._zod.check=e,n}function $h(e,t={}){return Eu(Sh,e,t)}function Th(e,t){const n=Ah(r=>(r.addIssue=o=>{if(typeof o=="string")r.issues.push(Rt(o,r.value,n._zod.def));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=n),s.continue??(s.continue=!n._zod.def.abort),r.issues.push(Rt(s))}},e(r.value,r)),t);return n}const Ue=Y([g("white"),g("black")]),Ih=Y([g("lobby"),g("friend"),g("ai"),g("api"),g("tournament"),g("position"),g("import"),g("importlive"),g("simul"),g("relay"),g("pool"),g("swiss")]),Ph=Y([R({id:g(10),name:g("created")}),R({id:g(20),name:g("started")}),R({id:g(25),name:g("aborted")}),R({id:g(30),name:g("mate")}),R({id:g(31),name:g("resign")}),R({id:g(32),name:g("stalemate")}),R({id:g(33),name:g("timeout")}),R({id:g(34),name:g("draw")}),R({id:g(35),name:g("outoftime")}),R({id:g(36),name:g("cheat")}),R({id:g(37),name:g("noStart")}),R({id:g(38),name:g("unknownFinish")}),R({id:g(60),name:g("variantEnd")})]),er=Y([g("ultraBullet"),g("bullet"),g("blitz"),g("rapid"),g("classical"),g("correspondence")]),Zh=R({id:N(),username:N(),rating:Fe()}),zh=R({id:N().nullable(),username:N(),rating:Fe().optional(),ai:Fe()}),bn=R({bot:W(),board:W()}),Ft=Y([g("standard"),g("chess960"),g("crazyhouse"),g("antichess"),g("atomic"),g("horde"),g("kingOfTheHill"),g("racingKings"),g("threeCheck"),g("fromPosition")]),tr=R({key:Ft,name:N(),short:N().optional()}),Ps=R({id:N(),fullId:N(),gameId:N(),fen:N(),color:Ue,lastMove:N(),source:Ih,status:Ph,variant:tr,speed:er,perf:N(),rated:W(),hasMoved:W(),opponent:Y([Zh,zh]),isMyTurn:W(),secondsLeft:Fe().optional(),compat:bn,winner:Ue.optional()}),Oh=R({type:g("gameStart"),game:Ps}),Rh=R({type:g("gameFinish"),game:Ps}),Nh=Y([g("created"),g("offline"),g("canceled"),g("declined"),g("accepted")]),Hr=R({id:N(),name:N(),rating:Fe(),title:N().nullable(),flair:N().optional(),patron:W().optional(),provisional:W().optional(),online:W().optional(),lag:Fe().optional()}),xh=R({type:g("clock"),limit:Fe(),increment:Fe(),show:N()}),Lh=R({type:g("correspondence"),daysPerTurn:Fe()}),Fh=R({type:g("unlimited")}),Uh=Y([xh,Lh,Fh]),ht=R({id:N(),url:Fu(),status:Nh,challenger:Hr,destUser:Hr.nullable(),variant:tr,rated:W(),speed:er,timeControl:Uh,color:Y([Ue,g("random")]),finalColor:Ue,perf:R({icon:N(),name:N()}),direction:Y([g("in"),g("out")]).optional(),initialFen:N().optional()}),Dh=R({type:g("challenge"),challenge:ht,compat:bn.optional()}),Mh=R({type:g("challengeCanceled"),challenge:ht,compat:bn.optional()}),jh=Y([g("generic"),g("later"),g("tooFast"),g("tooSlow"),g("timeControl"),g("rated"),g("casual"),g("standard"),g("variant"),g("noBot"),g("onlyBot")]),Kh=ht.extend({declineReason:N(),declineReasonKey:jh}),Gh=R({type:g("challengeDeclined"),challenge:Kh,compat:bn.optional()}),qh=Y([Oh,Rh,Dh,Mh,Gh]);R({in:ht.array(),out:ht.array()});const Zs=Y([g("noAbort"),g("noRematch"),g("noGiveTime"),g("noClaimWin"),g("noEarlyDraw")]),Bh=R({rated:W(),"clock.limit":Q(),"clock.increment":Q(),color:Y([Ue,g("random")]),variant:Ft,fen:N().optional(),keepAliveStream:W(),rules:Zs.optional()});R({limit:Q(),increment:Q(),rated:W().optional(),color:Y([Ue,g("random")]),variant:Ft,ratingRange:N().optional()});const Wh=R({id:N()}),Hh=Y([g(1),g(2),g(3),g(4),g(5),g(7),g(10),g(14)]),Vh=R({rated:W(),days:Hh,color:Y([Ue,g("random")]),variant:Ft,fen:N().optional(),keepAliveStream:W(),rules:Zs.optional()});Y([Bh,Vh]);R({"clock.limit":Q(),"clock.increment":Q(),color:Y([Ue,g("random")]),variant:Ft,fen:N().optional(),level:Y([g(1),g(2),g(3),g(4),g(5),g(6),g(7),g(8)])});const Ut=R({ok:W()}),Qh=R({initial:Q(),increment:Q()}),Jh=R({name:N()}),nr=Y([g("GM"),g("WGM"),g("IM"),g("WIM"),g("FM"),g("WFM"),g("NM"),g("CM"),g("WCM"),g("WNM"),g("LM"),g("BOT")]),Yh=R({id:N(),name:N(),title:nr.nullable(),rating:Q().nullable(),provisional:W().optional()}),Xh=R({aiLevel:Q()}),Vr=Y([Yh,Xh]),ef=Y([g("created"),g("started"),g("aborted"),g("mate"),g("resign"),g("stalemate"),g("timeout"),g("draw"),g("outoftime"),g("cheat"),g("noStart"),g("unknownFinish"),g("variantEnd")]),zs=R({type:g("gameState"),moves:N(),wtime:Q(),btime:Q(),winc:Q(),binc:Q(),status:ef,winner:Ue.optional(),wdraw:W().optional(),bdraw:W().optional(),wtakeback:W().optional(),btakeback:W().optional()}),tf=R({type:g("gameFull"),id:N(),variant:tr,clock:Qh,speed:er,perf:Jh,rated:W(),createdAt:Q(),white:Vr,black:Vr,initialFen:N(),state:zs,tournamentId:N().optional()}),nf=R({type:g("chatLine"),room:Y([g("player"),g("spectator")]),username:N(),text:N()}),rf=R({type:g("opponentGone"),gone:W(),claimWinInSeconds:Q()}),of=Y([zs,tf,nf,rf]);R({gameId:N(),move:N(),offeringDraw:W().optional()});const fe=R({games:Q(),rating:Q(),rd:Q(),prog:Q(),prov:W().optional()}),sf=R({chess960:fe.optional(),atomic:fe.optional(),racingKings:fe.optional(),ultraBullet:fe.optional(),blitz:fe.optional(),kingOfTheHill:fe.optional(),threeCheck:fe.optional(),antichess:fe.optional(),crazyhouse:fe.optional(),bullet:fe.optional(),correspondence:fe.optional(),horde:fe.optional(),puzzle:fe.optional(),classical:fe.optional(),rapid:fe.optional(),storm:fe.optional(),racer:fe.optional(),streak:fe.optional()}),af=R({flag:N().optional(),location:N().optional(),bio:N().optional(),realName:N().optional(),fideRating:Q().optional(),uscfRating:Q().optional(),ecfRating:Q().optional(),cfcRating:Q().optional(),rcfRating:Q().optional(),dsbRating:Q().optional(),links:N().optional()}),cf=R({total:Q(),tv:Q()}),Os=ih({id:N(),username:N(),url:N().optional(),perfs:sf.optional(),title:nr.optional(),flair:N().optional(),createdAt:Q().optional(),disabled:W().optional(),tosViolation:W().optional(),profile:af.optional(),seenAt:Q().optional(),playTime:cf.optional(),patron:W().optional(),verified:W().optional()}),lf=R({id:N(),name:N(),flair:N().optional(),title:nr.optional(),online:W().optional(),playing:W().optional(),streaming:W().optional(),patron:W().optional()});R({ids:N(),withSignal:W().optional(),withGameIds:W().optional(),withGameMetas:W().optional()});const we=e=>[x("lichess/host"),e].join("/api"),uf=(e,t)=>{const n=Et("lichess/user");if(n){const r=n.streamer(qh,we("/stream/event"));return r.onMessage(e),r.onClose(t),!0}return!1},hf=(e,t)=>{const n=Et("lichess/user");return n?(n.streamer(of,we(`/board/game/stream/${e}`)).onMessage(t),!0):!1},ff=(e,t)=>{const n=Et("lichess/user");if(n){const r=n.streamer(Os,we("/rel/following"));return r.onMessage(e),t&&r.onClose(t),!0}return!1},pf=(e=!1)=>{const t=Et("lichess/user");if(t)return ts(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),Ra},He=(e=!1)=>{const t=Et("lichess/user");if(t)return rs(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),Na},df=e=>He()(Ut,we(`/challenge/${e}/accept`),{}),gf=(e,t)=>He()(Ut,we(`/challenge/${e}/decline`),{reason:t}),mf=(e,t)=>He()(Ut,we(`/board/game/${e}/move/${t}`),{}),Rs=e=>He()(Ut,we(`/board/game/${e}/resign`),{}),an=(e,t)=>He()(Ut,we(`/board/game/${e}/draw/${t}`),{}),Ns=e=>He()(Os.array(),we("/users"),e).then(n=>{if(n.length>1)return n[0];throw new Error("Failed to get a user with id: "+e)}),_f=(e,t)=>He()(ht,we(`/challenge/${e}`),t),vf=e=>He()(ht,we("/challenge/ai"),e),bf=e=>pf()(lf.array(),za(we("/users/status"),{ids:e.join(",")})),kf=()=>fetch([x("lichess/host"),"__ping"].join("/"),{mode:"no-cors",cache:"default",redirect:"follow",credentials:"same-origin"}),wf=(e,t,n)=>{const r=Et("lichess/user");if(r){const o=r.streamer(Wh,we("/board/seek"),{...ns(),body:Hn(e)});return o.onMessage(t),o.onClose(n),!0}return!1},xs=e=>{const t=x("lichess/game-info"),n=x("lichess/game-state");if(Ls(),t&&n&&n.status==="started"){const r=window.setInterval(e,100);F("clock",{interval:r,gameId:t.gameId})}},Ls=()=>{const e=x("clock");e&&(clearInterval(e.interval),F("clock",null))},Ef=e=>{const t=x("clock"),n=x("lichess/game-state");!n&&t?Ls():n&&n.status==="started"&&!t&&xs(e)},yf=e=>{const t=p("time white active","--:--"),n=p("time black","--:--");e.append(p("clock",t,n)),zn({white:t,black:n}),Xr({white:t,black:n}),ae("lichess/game-state")(()=>{Ef(()=>zn({white:t,black:n})),Xr({white:t,black:n})}),xs(()=>{zn({white:t,black:n})})},Qr="--:--",Cf=()=>{const e=x("lichess/game-info"),t=x("lichess/game-state"),n=wt();if(t&&e&&n){if(Zt(t.moves).length<2)return{white:en(t.wtime),black:en(t.btime)};const r=Date.now()-t.timestamp,o=n==="white"?t.wtime-r:t.wtime,s=n==="black"?t.btime-r:t.btime;return{white:en(o),black:en(s)}}else return{white:Qr,black:Qr}},zn=({white:e,black:t})=>{const n=le(e),r=le(t),o=Cf();n(o.white),r(o.black)},{floor:On}=Math,en=e=>{const t=e/1e3,n=On(t%60),r=On(t/60%60),o=On(t/60/60),s=n<10?`0${n.toFixed(0)}`:`${n.toFixed(0)}`,a=r<10?`0${r.toFixed(0)}`:`${r.toFixed(0)}`,l=o<10?`0${o.toFixed(0)}`:`${o.toFixed(0)}`;return t>=3600?`${l}:${a}:${s}`:`${a}:${s}`},Sf=pn("active"),Af=rt("active"),Jr=Qi("active"),Yr=(e,t)=>t&&!Jr(e)?Af(e):!t&&Jr(e)?Sf(e):void 0,Xr=({white:e,black:t})=>{const n=wt();Yr(e,n=="white"),Yr(t,n=="black")},Rn=(e,t=null,n=null,r,o,s=null)=>({_tag:"Normal",role:e,capture:r,to:o,rank:n,file:t,promotion:s}),eo=e=>({_tag:"Castle",side:e}),$f=(e,t,n)=>e.filter(r=>{switch(r._tag){case"Castle":return!1;case"EnPassant":return t=="Pawn"&&r.to===n;default:return n===r.to&&t===r.role}}),Tf=(e,t)=>{switch(e._tag){case"Normal":{if(e.role==="Pawn")return Rn("Pawn",e.capture!==null?Ge(e.from):null,null,e.capture!==null,e.to,e.promotion);{let n=!1,r=!1,o=!1;for(const s of t)s._tag==="Normal"&&e.from!=s.from&&e.role==s.role&&e.to==s.to&&e.promotion==s.promotion&&(n=!0,rn(e.from)==rn(s.from)&&(o=!0),Ge(e.from)==Ge(s.from)&&(r=!0));return Rn(e.role,n&&(!r||o)?Ge(e.from):null,r?rn(e.from):null,e.capture!==null,e.to,e.promotion)}}case"EnPassant":return Rn("Pawn",Ge(e.from),null,!0,e.to,null);case"Castle":return Ge(e.rook)<Ge(e.king)?eo("QueenSide"):eo("KingSide")}},to=e=>{switch(e){case"Pawn":return"P";case"Rook":return"R";case"Knight":return"N";case"Bishop":return"B";case"Queen":return"Q";case"King":return"K"}},no=(e,t)=>{switch(e){case"Pawn":return t==="white"?Ko:Lo;case"Rook":return t==="white"?Go:Fo;case"Knight":return t==="white"?qo:Uo;case"Bishop":return t==="white"?Bo:Do;case"Queen":return t==="white"?Wo:Mo;case"King":return t==="white"?Ho:jo}},If=(e,t)=>{let n=[];return t._tag==="Normal"&&t.role!=="Pawn"&&(n=$f(e,t.role,t.to)),Tf(t,n)},Pf={symbol:!1,color:"white"},Fs={symbol:!0,color:"white"},Zf=(e,{symbol:t,color:n})=>{const r=[];switch(e._tag){case"Normal":{e.role!=="Pawn"&&r.push(t?no(e.role,n):to(e.role)),e.file!==null&&r.push(e.file.toLowerCase()),e.rank!==null&&r.push(e.rank),e.capture&&r.push("x"),r.push(e.to.toLowerCase()),e.promotion!==null&&r.push("=",t?no(e.promotion,n):to(e.promotion));break}case"Castle":{e.side==="KingSide"?r.push("O","-","O"):r.push("O","-","O","-","O");break}case"null":r.push("--")}return r.join("")},rr=(e,t,n=Pf)=>Zf(If(t,e),n),ro=(e,t)=>{const n=x("lichess/game-info"),r=x("lichess/game-state"),o=wt(),s=at();if(n&&r&&o&&s){const a=le(t);if(le(e)(kt("name",n.opponent.username)),o===s){const i=Jo(r.moves),h=i.pop();if(h){const c=rr(h,Wn(r.moves,i.length),Fs);a(c)}else a(p("idle",`Your turn to play ${o}`))}else a(p("compute"))}},zf=e=>{const t=p("info"),n=p("state");ro(t,n);const r=p("engine",t,n);e.append(r),ae("lichess/game-state")(()=>ro(t,n))},Of="/telechecs/",Rf=(...e)=>{var t="/",n=new RegExp(t+"{1,}","g");return e.join(t).replace(n,t)},Us=(...e)=>Rf(Of,...e),Nf=Us("chess.ogg"),Ds=Ne(na("-",Nf),e=>e("preload","auto"));document.body.append(Ds);const xf=()=>{Ds.play()},Lf=e=>(F("input",un()),F("lichess/game-state",hn(e.state)),F("started",!0),!0),Ff=e=>(F("input",un()),F("lichess/game-state",hn(e)),at()===wt()&&xf(),!0),Uf=e=>(F("lichess/chat",hn(e)),!0),Df=e=>{switch(e.type){case"gameFull":return Lf(e);case"gameState":return Ff(e);case"chatLine":return Uf(e);case"opponentGone":return!0}},Mf=e=>hf(e,Df),jf=e=>{const t=x("lichess/game-info");t&&mf(t.gameId,Di(e))},oo=(e,t)=>{switch(e){case"Pawn":return t==="black"?Lo:Ko;case"Rook":return t==="black"?Fo:Go;case"Knight":return t==="black"?Uo:qo;case"Bishop":return t==="black"?Do:Bo;case"Queen":return t==="black"?Mo:Wo;case"King":return t==="black"?jo:Ho}},Kf=(e,t)=>t.some(n=>{switch(n._tag){case"Normal":return n.role===e;case"Castle":return e==="King";case"EnPassant":return e==="Pawn"}}),so=e=>e?"selected":"",Gf=(e,t)=>Ea.map(n=>Kf(n,t)?de(p(`piece ${n}  ${so(e===n)}`,oo(n,"black")),r=>r("click",()=>e===n?F("input",Xo()):F("input",Mi(n)))):p(`piece ${n}  ${so(e===n)}`,oo(n,"white"))),qf=e=>{F("input",ji(e)),jf(e)},Bf=e=>t=>e.filter(n=>{switch(n._tag){case"Castle":{switch(t){case"G1":return n.king==="E1"&&n.rook=="H1";case"C1":return n.king==="E1"&&n.rook=="A1";case"G8":return n.king==="E8"&&n.rook=="H8";case"C8":return n.king==="E8"&&n.rook=="A8"}return!1}case"Normal":case"EnPassant":return n.to===t}}),Wf=(e,t)=>{const n=le(e);return r=>{n(...r.map(o=>de(p("move",rr(o,t,{symbol:!0,color:"black"})),s=>s("click",()=>qf(o))))),Vo(e)}},Hf=(e,t)=>{const n=rt("selected-file"),r=rt("selected-rank"),o=rt("dim"),s=rt("selected"),a=pn("selected-file","selected-rank","selected","dim"),l=Ge(e),i=rn(e);t.map(h=>{h.querySelectorAll(".square").forEach(c=>{a(c);const w=c.getAttribute("data-file"),f=c.getAttribute("data-rank"),C=l===w,y=i===f;!C&&!y?o(c):C&&y?s(c):C?n(c):y&&r(c)}),h.querySelectorAll(".ord").forEach(c=>{const w=c.getAttribute("data-file"),f=c.getAttribute("data-rank");l===w||i===f?s(c):a(c)})})},Vf=(e,t)=>{const n=Bf(t.filter(c=>Po(c)===zo(e))),r=at()==="black"?br:br.slice(0).reverse(),o=at()==="white"?vr:vr.slice(0).reverse(),s=p("rank",...[p("ord")].concat(o.map(c=>Ne(p("ord",c.toLowerCase()),w=>{w("data-file",c)}))).concat(p("ord padder"))),a=p("select hidden"),l=Wf(a,t),h=r.map(c=>p(`rank ${c} `,Ne(p("ord",c),w=>w("data-rank",c)),...o.map(w=>{const f=Li(w,c),C=n(f);return C.length==0?p(`square ${f}`):Ne(de(p(`square  ${f} target`,p("label",f.toLowerCase())),y=>y("click",()=>{l(C),Hf(f,h)})),y=>{y("data-file",w),y("data-rank",c)})}),p("ord padder"))).concat(s);return[a].concat(h)},Qf=e=>{const t=p("pieces"),n=p("moves"),r=p("input",n,t);e.append(r);const o=()=>{const s=x("lichess/game-state");if(s&&wt()===at()){const a=le(t),l=le(n),i=x("input"),h=zo(i),c=Wn(s.moves);a(...Gf(h,c)),i._tag==="role"&&c.length>0?(Vo(n),l(...Vf(i,c))):(ya(n),Pe(n))}else Pe(n),Pe(t)};ae("lichess/game-state","lichess/game-info","input")(o),o()},ot=(e,t)=>({name:e,className:t??e}),Jf=e=>(typeof e=="string"?e:e.className).toLowerCase().split(" ").join("-"),Yf=e=>typeof e=="string"?e:e.name,Ce=(e,t)=>de(p(`button button-${Jf(e)}`,Yf(e)),n=>n("click",t)),Nt=(e,t)=>Ce(t,()=>F("screen",e)),kn=()=>Nt("home","Home"),Xf=()=>Nt("seek","Create a game");let Kn=null;const ep=e=>Kn=e,io=e=>{Kn!==null&&(e?Kn.requestFullscreen().then(()=>F("fullscreen",!0)).catch(t=>console.warn("failed to enter fullscreen",t)):document.exitFullscreen().then(()=>F("fullscreen",!1)).catch(t=>console.warn("failed to exit fullscreen",t)))},tp=e=>{F("lichess/current-challenge",e),F("lichess/challenges",[]),F("input",un()),df(e.id)},np=e=>{ct("lichess/challenges",t=>t.filter(n=>n.id!==e.id)),gf(e.id,"generic")},rp=e=>{const t=p("lock locked"),n=rt("locked"),r=pn("locked"),o=()=>x("lockScreen")?n(t):r(t);ae("lockScreen")(o),o(),e.append(t)},ao="⛶",Nn="½",op="⚐",co="1.",lo=()=>x("fullscreen")?Ce(ot(ao,"fullscreen-off"),()=>io(!1)):Ce(ot(ao,"fullscreen-on"),()=>io(!0)),sp=e=>{const t=at(),n=Yo();if(e&&t&&n){if(t==="white"&&e.wdraw||t==="black"&&e.bdraw)return"me";if(n==="white"&&e.wdraw||n==="black"&&e.bdraw)return"other"}return"none"},ip=(e,t)=>{switch(sp(e)){case"me":return Ce(ot(Nn,"draw-waiting"),Sa);case"other":return p("draw-answer",p("icon",Nn),Ce(ot("Accept","draw-accept"),()=>an(t.fullId,"yes")),Ce(ot("Decline","draw-decline"),()=>{an(t.fullId,"no"),ct("lichess/game-state",n=>n&&{...n,bdraw:!1,wdraw:!1})}));case"none":return Ce(ot(Nn,"draw-offer"),()=>an(t.fullId,"yes"))}},ap=e=>Ce(ot(op,"resign"),()=>Rs(e.fullId)),cp=(...e)=>{const t=p("anti-slip on",...e);let n=null;return t.addEventListener("click",r=>{n||(r.preventDefault(),r.stopPropagation(),t.classList.remove("on"),n=window.setTimeout(()=>{n=null,t.classList.add("on")},6e3))}),t},lp=e=>{const t=p("game-actions"),n=()=>{const r=x("lichess/game-state"),o=x("lichess/game-info"),s=le(t);r&&o?s(p("view",lo(),Nt("movelist",co)),cp(ip(r,o),ap(o))):s(p("view",lo(),Nt("movelist",co)))};n(),e.append(t),ae("lichess/game-info","lichess/game-state","fullscreen")(n)},up=e=>{zf(e),lp(e),Qf(e),yf(e),rp(e)};var ke={},uo;function hp(){return uo||(uo=1,function(e){var t=ke&&ke.__extends||function(){var b=function(d,E){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,T){A.__proto__=T}||function(A,T){for(var $ in T)T.hasOwnProperty($)&&(A[$]=T[$])},b(d,E)};return function(d,E){b(d,E);function A(){this.constructor=d}d.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}}(),n=ke&&ke.__assign||function(){return n=Object.assign||function(b){for(var d,E=1,A=arguments.length;E<A;E++){d=arguments[E];for(var T in d)Object.prototype.hasOwnProperty.call(d,T)&&(b[T]=d[T])}return b},n.apply(this,arguments)},r=ke&&ke.__awaiter||function(b,d,E,A){function T($){return $ instanceof E?$:new E(function(B){B($)})}return new(E||(E=Promise))(function($,B){function q(V){try{L(A.next(V))}catch(ue){B(ue)}}function X(V){try{L(A.throw(V))}catch(ue){B(ue)}}function L(V){V.done?$(V.value):T(V.value).then(q,X)}L((A=A.apply(b,d||[])).next())})},o=ke&&ke.__generator||function(b,d){var E={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},A,T,$,B;return B={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function q(L){return function(V){return X([L,V])}}function X(L){if(A)throw new TypeError("Generator is already executing.");for(;E;)try{if(A=1,T&&($=L[0]&2?T.return:L[0]?T.throw||(($=T.return)&&$.call(T),0):T.next)&&!($=$.call(T,L[1])).done)return $;switch(T=0,$&&(L=[L[0]&2,$.value]),L[0]){case 0:case 1:$=L;break;case 4:return E.label++,{value:L[1],done:!1};case 5:E.label++,T=L[1],L=[0];continue;case 7:L=E.ops.pop(),E.trys.pop();continue;default:if($=E.trys,!($=$.length>0&&$[$.length-1])&&(L[0]===6||L[0]===2)){E=0;continue}if(L[0]===3&&(!$||L[1]>$[0]&&L[1]<$[3])){E.label=L[1];break}if(L[0]===6&&E.label<$[1]){E.label=$[1],$=L;break}if($&&E.label<$[2]){E.label=$[2],E.ops.push(L);break}$[2]&&E.ops.pop(),E.trys.pop();continue}L=d.call(b,E)}catch(V){L=[6,V],T=0}finally{A=$=0}if(L[0]&5)throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}},s=ke&&ke.__spreadArrays||function(){for(var b=0,d=0,E=arguments.length;d<E;d++)b+=arguments[d].length;for(var A=Array(b),T=0,d=0;d<E;d++)for(var $=arguments[d],B=0,q=$.length;B<q;B++,T++)A[T]=$[B];return A};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function b(){}return b.prototype.toString=function(){return"ErrorOAuth2"},b}();e.ErrorOAuth2=a;var l=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnknown"},d}(a);e.ErrorUnknown=l;var i=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorNoAuthCode"},d}(a);e.ErrorNoAuthCode=i;var h=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidReturnedStateParam"},d}(a);e.ErrorInvalidReturnedStateParam=h;var c=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidJson"},d}(a);e.ErrorInvalidJson=c;var w=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidScope"},d}(a);e.ErrorInvalidScope=w;var f=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidRequest"},d}(a);e.ErrorInvalidRequest=f;var C=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidToken"},d}(a);e.ErrorInvalidToken=C;var y=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAuthenticationGrant"},d}(a);e.ErrorAuthenticationGrant=y;var M=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnauthorizedClient"},d}(y);e.ErrorUnauthorizedClient=M;var G=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessDenied"},d}(y);e.ErrorAccessDenied=G;var j=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedResponseType"},d}(y);e.ErrorUnsupportedResponseType=j;var Z=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorServerError"},d}(y);e.ErrorServerError=Z;var D=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorTemporarilyUnavailable"},d}(y);e.ErrorTemporarilyUnavailable=D;var H=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessTokenResponse"},d}(a);e.ErrorAccessTokenResponse=H;var Ae=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidClient"},d}(H);e.ErrorInvalidClient=Ae;var xe=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidGrant"},d}(H);e.ErrorInvalidGrant=xe;var Ve=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedGrantType"},d}(H);e.ErrorUnsupportedGrantType=Ve;var dt=function(){function b(){this.realm="",this.error=""}return b}();e.ErrorWWWAuthenticate=dt,e.RawErrorToErrorClassMap={invalid_request:f,invalid_grant:xe,unauthorized_client:M,access_denied:G,unsupported_response_type:j,invalid_scope:w,server_error:Z,temporarily_unavailable:D,invalid_client:Ae,unsupported_grant_type:Ve,invalid_json:c,invalid_token:C};function Qe(b){return new(e.RawErrorToErrorClassMap[b]||l)}e.toErrorClass=Qe;function Dt(b){var d=b.slice(7).replace(/"/g,"").split(", ").map(function(E){var A,T=E.split("="),$=T[0],B=T[1];return A={},A[$]=B,A}).reduce(function(E,A){return n(n({},E),A)},{});return{realm:d.realm,error:d.error}}e.fromWWWAuthenticateHeaderStringToObject=Dt;var wn="Authorization",yt="WWW-Authenticate";e.LOCALSTORAGE_ID="oauth2authcodepkce",e.LOCALSTORAGE_STATE=e.LOCALSTORAGE_ID+"-state",e.RECOMMENDED_CODE_VERIFIER_LENGTH=96,e.RECOMMENDED_STATE_LENGTH=32;var Je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",Mt=function(){function b(d){return this.state={},this.config=d,this.recoverState(),this}return b.prototype.decorateFetchHTTPClient=function(d){var E=this;return function(A,T){for(var $=[],B=2;B<arguments.length;B++)$[B-2]=arguments[B];return E.state.isHTTPDecoratorActive?E.getAccessToken().then(function(q){var X=q.token,L=Object.assign({},T);return L.headers||(L.headers={}),L.headers[wn]="Bearer "+X.value,d.apply(void 0,s([A,L],$))}).then(function(q){if(q.ok||!q.headers.has(yt.toLowerCase()))return q;var X=Qe(Dt(q.headers.get(yt.toLowerCase())).error);return X instanceof C&&E.config.onAccessTokenExpiry(function(){return E.exchangeRefreshTokenForAccessToken()}),Promise.reject(X)}):d.apply(void 0,s([A,T],$))}},b.prototype.isReturningFromAuthServer=function(){var d=b.extractParamFromUrl(location.href,"error");if(d)return Promise.reject(Qe(d));var E=b.extractParamFromUrl(location.href,"code");if(!E)return Promise.resolve(!1);var A=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),T=b.extractParamFromUrl(location.href,"state");return T!==A.stateQueryParam?(console.warn("state query string parameter doesn't match the one sent! Possible malicious activity somewhere."),Promise.reject(new h)):(A.authorizationCode=E,A.hasAuthCodeBeenExchangedForAccessToken=!1,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(A)),this.setState(A),Promise.resolve(!0))},b.prototype.fetchAuthorizationCode=function(d){return r(this,void 0,void 0,function(){var E,A,T,$,B,q,X,L,V,ue,$e;return o(this,function(Ze){switch(Ze.label){case 0:return this.assertStateAndConfigArePresent(),E=this.config,A=E.clientId,T=E.extraAuthorizationParams,$=E.redirectUrl,B=E.scopes,[4,b.generatePKCECodes()];case 1:return q=Ze.sent(),X=q.codeChallenge,L=q.codeVerifier,V=b.generateRandomState(e.RECOMMENDED_STATE_LENGTH),this.state=n(n({},this.state),{codeChallenge:X,codeVerifier:L,stateQueryParam:V,isHTTPDecoratorActive:!0}),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state)),ue=this.config.authorizationUrl+"?response_type=code&"+("client_id="+encodeURIComponent(A)+"&")+("redirect_uri="+encodeURIComponent($)+"&")+("scope="+encodeURIComponent(B.join(" "))+"&")+("state="+V+"&")+("code_challenge="+encodeURIComponent(X)+"&")+"code_challenge_method=S256",(T||d)&&($e=n(n({},T),d),ue=ue+"&"+b.objectToQueryString($e)),location.replace(ue),[2]}})})},b.prototype.getAccessToken=function(){var d=this;this.assertStateAndConfigArePresent();var E=this.config.onAccessTokenExpiry,A=this.state,T=A.accessToken,$=A.authorizationCode,B=A.explicitlyExposedTokens,q=A.hasAuthCodeBeenExchangedForAccessToken,X=A.refreshToken,L=A.scopes;return $?this.authCodeForAccessTokenRequest?this.authCodeForAccessTokenRequest:!this.isAuthorized()||!q?(this.authCodeForAccessTokenRequest=this.exchangeAuthCodeForAccessToken(),this.authCodeForAccessTokenRequest):X&&this.isAccessTokenExpired()?E(function(){return d.exchangeRefreshTokenForAccessToken()}):Promise.resolve({token:T,explicitlyExposedTokens:B,scopes:L,refreshToken:X}):Promise.reject(new i)},b.prototype.exchangeRefreshTokenForAccessToken=function(){var d=this,E;this.assertStateAndConfigArePresent();var A=this.config,T=A.extraRefreshParams,$=A.clientId,B=A.tokenUrl,q=this.state.refreshToken;q||console.warn("No refresh token is present.");var X=B,L="grant_type=refresh_token&"+("refresh_token="+((E=q)===null||E===void 0?void 0:E.value)+"&")+("client_id="+$);return T&&(L=X+"&"+b.objectToQueryString(T)),fetch(X,{method:"POST",body:L,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(V){return V.status>=400?V.json().then(function(ue){return Promise.reject(ue)}):V.json()}).then(function(V){var ue=V.access_token,$e=V.expires_in,Ze=V.refresh_token,Ye=V.scope,De=d.config.explicitlyExposedTokens,ge=[],ze={},Xe={value:ue,expiry:new Date(Date.now()+parseInt($e)*1e3).toString()};if(d.state.accessToken=Xe,Ze){var gt={value:Ze};d.state.refreshToken=gt}De&&(ze=Object.fromEntries(De.map(function(Te){return[Te,V[Te]]}).filter(function(Te){Te[0];var Me=Te[1];return Me!==void 0})),d.state.explicitlyExposedTokens=ze),Ye&&(ge=Ye.split(" "),d.state.scopes=ge),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d.state));var Oe={token:Xe,scopes:ge};return De&&(Oe.explicitlyExposedTokens=ze),Oe}).catch(function(V){var ue=d.config.onInvalidGrant,$e=V.error||"There was a network error.";switch($e){case"invalid_grant":ue(function(){return d.fetchAuthorizationCode()});break}return Promise.reject(Qe($e))})},b.prototype.getGrantedScopes=function(){return this.state.scopes},b.prototype.isHTTPDecoratorActive=function(d){this.state.isHTTPDecoratorActive=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state))},b.prototype.isAuthorized=function(){return!!this.state.accessToken},b.prototype.isAccessTokenExpired=function(){var d=this.state.accessToken;return!!(d&&new Date>=new Date(d.expiry))},b.prototype.reset=function(){this.setState({}),this.authCodeForAccessTokenRequest=void 0},b.prototype.assertStateAndConfigArePresent=function(){if(!this.state||!this.config)throw console.error("state:",this.state,"config:",this.config),new Error("state or config is not set.")},b.prototype.exchangeAuthCodeForAccessToken=function(d){var E=this;this.assertStateAndConfigArePresent();var A=this.state,T=A.authorizationCode,$=T===void 0?d:T,B=A.codeVerifier,q=B===void 0?"":B,X=this.config,L=X.clientId,V=X.onInvalidGrant,ue=X.redirectUrl;q?$||console.warn("No authorization grant code is being passed."):console.warn("No code verifier is being sent.");var $e=this.config.tokenUrl,Ze="grant_type=authorization_code&"+("code="+encodeURIComponent($||"")+"&")+("redirect_uri="+encodeURIComponent(ue)+"&")+("client_id="+encodeURIComponent(L)+"&")+("code_verifier="+q);return fetch($e,{method:"POST",body:Ze,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(Ye){var De=Ye.json().catch(function(ge){return{error:"invalid_json"}});return Ye.ok?De.then(function(ge){var ze=ge.access_token,Xe=ge.expires_in,gt=ge.refresh_token,Oe=ge.scope,Te=E.config.explicitlyExposedTokens,Me=[],Ct={};E.state.hasAuthCodeBeenExchangedForAccessToken=!0,E.authCodeForAccessTokenRequest=void 0;var jt={value:ze,expiry:new Date(Date.now()+parseInt(Xe)*1e3).toString()};if(E.state.accessToken=jt,gt){var En={value:gt};E.state.refreshToken=En}Te&&(Ct=Object.fromEntries(Te.map(function(et){return[et,ge[et]]}).filter(function(et){et[0];var Gt=et[1];return Gt!==void 0})),E.state.explicitlyExposedTokens=Ct),Oe&&(Me=Oe.split(" "),E.state.scopes=Me),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(E.state));var Kt={token:jt,scopes:Me};return Te&&(Kt.explicitlyExposedTokens=Ct),Kt}):De.then(function(ge){var ze=ge.error;switch(ze){case"invalid_grant":V(function(){return E.fetchAuthorizationCode()});break}return Promise.reject(Qe(ze))})})},b.prototype.recoverState=function(){return this.state=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),this},b.prototype.setState=function(d){return this.state=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d)),this},b.base64urlEncode=function(d){var E=btoa(d);return E=E.replace(/\+/g,"-"),E=E.replace(/\//g,"_"),E=E.replace(/=/g,""),E},b.extractParamFromUrl=function(d,E){var A=d.split("?");if(A.length<2)return"";A=A[1].split("#");var T=A[0].split("&").reduce(function(B,q){return B.concat(q.split("="))},[]);if(T.length<2)return"";var $=T.indexOf(E);return decodeURIComponent($>=0?T[$+1]:"")},b.objectToQueryString=function(d){return Object.entries(d).map(function(E){var A=E[0],T=E[1];return A+"="+encodeURIComponent(T)}).join("&")},b.generatePKCECodes=function(){var d=new Uint32Array(e.RECOMMENDED_CODE_VERIFIER_LENGTH);crypto.getRandomValues(d);var E=b.base64urlEncode(Array.from(d).map(function(A){return Je[A%Je.length]}).join(""));return crypto.subtle.digest("SHA-256",new TextEncoder().encode(E)).then(function(A){for(var T=new Uint8Array(A),$="",B=T.byteLength,q=0;q<B;q++)$+=String.fromCharCode(T[q]);return $}).then(b.base64urlEncode).then(function(A){return{codeChallenge:A,codeVerifier:E}})},b.generateRandomState=function(d){var E=new Uint32Array(d);return crypto.getRandomValues(E),Array.from(E).map(function(A){return Je[A%Je.length]}).join("")},b}();e.OAuth2AuthCodePKCE=Mt}(ke)),ke}var fp=hp();const pp=new RegExp(`
`),dp=(e,t,n,r)=>e(n,r).then(o=>o.body).then(o=>{if(o==null)throw new Error("Response body is NULL");const s=o.getReader();return new ReadableStream({start(a){const l=new TextDecoder,i=()=>{s.read().then(({done:h,value:c})=>{if(h){console.log("done",h),a.close();return}l.decode(c).split(pp).map(f=>{if(f.trim().length>0)try{const y=JSON.parse(f),M=t.parse(y);console.log("stream",M),a.enqueue(M)}catch{console.error("Failed to make an object out of chunk:",f)}}),i()})};i()}}).getReader()}),gp=e=>(t,n,r)=>{const o=[],s=[];let a=[];const l=f=>{const C=()=>{f.read().then(({done:y,value:M})=>{c(Le(M)),y?w():setTimeout(C,0)}).catch(w)};C()},i=f=>{a.length>0&&(a.forEach(f),a=[]),o.push(f)},h=f=>{s.push(f)},c=Se(f=>{o.length>0?o.find(C=>!C(f)):a.push(f)}),w=()=>{s.forEach(f=>f())};return dp(e,t,n,r).then(l).catch(()=>setTimeout(w,200)),{onMessage:i,onClose:h}},mp=["board:play","challenge:read","follow:read"],_p=`ucui-${location.host}`,vp=`${location.protocol}//${location.host}${Us()}`,bp=()=>{const e=x("lichess/host");let t=null;const n=new fp.OAuth2AuthCodePKCE({authorizationUrl:`${e}/oauth`,tokenUrl:`${e}/api/token`,clientId:_p,scopes:mp,redirectUrl:vp,onAccessTokenExpiry:i=>i(),onInvalidGrant:console.warn}),r=async()=>{try{await n.getAccessToken()&&await a()}catch(i){console.error(i)}if(!t)try{await n.isReturningFromAuthServer()&&await a()}catch(i){console.error(i)}},o=async()=>{await n.fetchAuthorizationCode()},s=async()=>{t&&await t.httpClient(`${e}/api/token`,{method:"DELETE"}),localStorage.clear(),t=null},a=async()=>{const i=n.decorateFetchHTTPClient(window.fetch),c={...await(await i(`${e}/api/account`)).json(),httpClient:i,streamer:gp(i)};if(c.error)throw c.error;t=c};return{init:r,login:o,logout:s,user:()=>Se(i=>({id:i.id,username:i.username,streamer:i.streamer,httpClient:i.httpClient}))(Le(t))}},it=bp();it.init().then(()=>{Se(t=>F("lichess/user",t))(it.user())});let tn=!1;const Ms=()=>{tn||(tn=!0,x("lichess/user")?(F("online",!0),uf(t=>(ct("lichess/stream-events",n=>n.concat(t)),!0),()=>{tn=!1,F("online",!1),window.setTimeout(Ms,2e4)})):tn=!1)},kp=()=>de(p("button button-login","connect"),e=>e("click",async()=>{const t=$o(()=>{it.login().then(()=>{n(it.user())})}),n=Se(r=>{F("lichess/user",r)});cn(it.user(),n,t)})),wp=()=>de(p("button button-logout","×"),e=>e("click",()=>it.logout().then(()=>F("lichess/user",null)))),Ep=e=>t=>{Ms(),Pe(e),e.append(p("user",p("username",dn("",`${x("lichess/host")}/@/${t.id}`,t.username)),wp()))},yp=e=>()=>{Pe(e),e.append(kp())},Cp=e=>{const t=Se(Ep(e)),n=$o(yp(e)),r=ae("lichess/user"),o=()=>{cn(it.user(),t,n)};r(o),o()},ho=e=>{ff(t=>(ct("lichess/following",n=>n.filter(r=>r.id!==t.id).concat(t)),!1),async()=>{const t=await bf(x("lichess/following").map(n=>n.id));for(const n of t){const r=e.querySelector(`[data-id="${n.id}"]`);r&&(n.online?r.classList.add("online"):r.classList.remove("online"))}})},Sp=Se(({classical:e,rapid:t})=>p("perfs",p("classical",`Classic: ${e?e.rating:"?"}`),p("rapid",`Rapid: ${t?t.rating:"?"}`))),Ap=e=>de(p("result",p("username",e.username),Sp(Le(e.perfs))),t=>t("click",()=>{F("lichess/opponent",e),F("screen","challenge")})),$p=()=>{const e=Ne(ea("","search"),r=>r("placeholder","username")),t=p("results"),n=de(p("button submit","search"),r=>r("click",()=>{const o=e.value;Ns(o).then(s=>le(t)(Ap(s)))}));return p("lookup",p("section",p("title","Find player")),p("search-block",e,n),t)},fo=e=>Ne(p("user",de(p("username",e.username),t=>t("click",()=>{F("lichess/opponent",e),F("screen","challenge")})),p("activity")),t=>t("data-id",e.id)),Tp=e=>de(p(`level level-${e}`,`${e}`),t=>t("click",()=>{F("lichess/opponent",{_tag:"lichess-ai",level:e}),F("screen","challenge")})),Ip=[1,2,3,4,5,6,7,8],Pp=()=>p("user lichess-ai",p("section","Play with Lichess AI"),p("levels",p("label","Level"),...Ip.map(Tp))),js=e=>{const t=p("users",...x("lichess/following").map(fo)),n=Ce("refresh",()=>{ho(t)}),r=p("section",p("title","Players you follow"),n);e.append(p("players",r,t,Pp(),$p())),ae("lichess/following")(()=>{le(t)(...x("lichess/following").map(fo))}),ho(t)},Zp=e=>{switch(e.type){case"clock":return e.show;case"correspondence":return`${e.daysPerTurn} day`;case"unlimited":return"unlimited"}},zp=e=>p("challenge",p("spec",p("challenger",e.challenger.name),p("time",Zp(e.timeControl))),p("actions",de(p("button button-accept","Accept"),t=>t("click",()=>{tp(e),F("screen","game")})),de(p("button button-decline","Decline"),t=>t("click",()=>{np(e)})))),po=()=>{const e=x("lichess/challenges");return e.length>0?e.map(zp):[p("waiting","Waiting to be challenged…")]},go=()=>p("footer",dn("link","https://github.com/pierremarc/telechecs","Source code & feedback")),Op=()=>p("intro",Wt(kt("ucui","Téléchecs "),"is a ",dn("",x("lichess/host")," Lichess")," client for players who prefer to play over the board."),ta("board-image","https://raw.githubusercontent.com/pierremarc/telechecs/main/picture.jpg"),Wt(`
    Connect this page with your Lichess account to create games or challenge players 
    from here.  
    `),Wt(`
    Once a game starts, you'll be presented with a black 
    screen where you'll see your opponent moves when they play, 
    and an input widget to enter your moves when it's your turn.
    And that will be all of it. 
    `),Wt("Enjoy!")),Rp=()=>{const e=p("challenges",...po()),t=le(e);return ae("lichess/challenges")(()=>{t(...po())}),p("challenge-block",p("section",p("title","Challenges")),e)},Np=()=>p("section",Xf()),mo=e=>{const t=le(e),n=()=>{const r=p("login");Cp(r);const o=p("header",p("title","Téléchecs"),r);if(x("lichess/user")){const s=p("players");js(s),t(p("home",o,s,Rp(),Np(),go()))}else t(p("home",o,Op(),go()))};n(),ae("lichess/user")(n)},xp="wakeLock"in navigator,Lp=()=>{if(xp){const e=ae(...Ia().filter(i=>i!=="lockScreen"));let t=null;const n=i=>Ta("lockScreen",h=>h!==i?qn(i):Gn),r=()=>x("screen")==="game"?t===null?!0:!t.released:!1,o=()=>!!(x("screen")!=="game"&&t&&!t.released),s=()=>{navigator.wakeLock.request("screen").then(i=>{t=i,console.log("WakeLock acquired"),n(!0),t.addEventListener("release",()=>{n(!1),console.log("Navigator released lock sentinel")})}).catch(i=>{console.error("failed to lock screen",i),F("lichess/chat",hn({type:"chatLine",room:"spectator",username:"Téléchecs",text:`Failed to lock screen: ${i}`}))})},a=()=>{n(!1),t&&!t.released&&t.release().then(()=>{t=null}).catch(i=>console.error("failed to release wakelock",i))},l=()=>{r()?s():o()&&a()};e(l),l()}},Fp=e=>{switch(e.name){case"created":return"??";case"started":return"??";case"aborted":return"Aborted";case"mate":return"Mate";case"resign":return"Resigned";case"stalemate":return"Stalemate";case"timeout":return"Timeout";case"draw":return"Draw";case"outoftime":return"Flagged";case"cheat":return"Someone cheated";case"noStart":return"It didn't start";case"unknownFinish":return"Don't know...";case"variantEnd":return"End by variant rules"}},Up=e=>p("status",Fp(e.status)),xn=({winner:e})=>e===void 0?"½ - ½":e==="white"?" 1 - 0":"0 - 1",Ks=e=>e.color===e.winner?p("result won",xn(e)):Zo(e.color)===e.winner?p("result lost",xn(e)):p("result draw",xn(e)),Dp=Se(e=>p("section",Ce("Rematch",()=>{Ns(e).then(t=>{F("lichess/opponent",t),F("screen","challenge")})}))),Mp=e=>p("section",Nt("movelist","Review the game"),Ne(dn("link",`${x("lichess/host")}/${e.gameId}`,"Review the game on Lichess"),t=>t("target","_blank"))),jp=e=>Se(t=>{le(e)(Ks(t),Up(t),Dp(Le(t.opponent.id)),Mp(t))}),Kp=e=>{const t=p("info"),n=jp(t),r=p("header",p("title","End of game"),kn());n(Le(x("lichess/game-info"))),ae("lichess/game-info")(()=>n(Le(x("lichess/game-info")))),e.append(p("end",r,t))},Gp={_tag:"pending"},qp=()=>wt()===Yo()?$r().concat(Gp):$r(),Bp=(e,t,n)=>kt("move",rr(t,Wn(e.moves,n),Fs),"  "),Wp=()=>qs(()=>p("hidden"),p("pending")),Ln=(e,t,n)=>{switch(t._tag){case"pending":return Wp();default:return Bp(e,t,n)}},_o=e=>kt("normal",`${e+1}. `),vo=Se(e=>Ki(2,qp()).map(([t,n],r)=>{const o=r*2;return t&&n?p("ply",_o(r),kt("moves",Ln(e,t,o),Ln(e,n,o+1))):t?p("ply",_o(r),kt("moves",Ln(e,t,o))):p("empty")})),Hp=e=>de(p("button","Resign"),t=>t("click",()=>Rs(e.gameId))),Vp=e=>de(p("button","Draw"),t=>t("click",()=>an(e.gameId,"yes"))),Gs=(e,t)=>{const n=x("lichess/game-info");return n&&n.status.name==="started"?e(n):t},qs=(e,t)=>{const n=x("lichess/game-info");return n&&n.status.name!=="created"&&n.status.name!=="started"?e(n):t},bo=()=>Gs(e=>[Vp(e),Hp(e)],[]),ko=()=>qs(Ks,p("no-outcome")),wo=()=>[Yi("title","Moves"),Gs(()=>de(p("to-game  to-button","↩"),e=>e("click",()=>F("screen","game"))),kn())],Qp=e=>{const t=p("moves",...cn(Le(x("lichess/game-state")),vo,_r([p("no-moves")]))),n=p("header",...wo()),r=p("actions",...bo()),o=p("outcome",ko());e.append(p("movelist",n,p("listing",t),o,r));const s=le(t),a=le(o),l=le(r),i=le(n),h=ae("lichess/game-state"),c=ae("started","lichess/game-info");h(()=>{s(...cn(Le(x("lichess/game-state")),vo,_r([p("no-moves")])))}),c(()=>{i(...wo()),l(...bo()),a(ko())})},Jp=e=>{const t=p("events"),n=Ji("","Events"),r=()=>{Pe(t),x("lichess/stream-events").forEach(o=>t.append(p("event"),Xi("json",JSON.stringify(o,void 0,4))))};r(),e.append(n,t),ae("lichess/stream-events")(r)},or=e=>"_tag"in e&&e._tag==="lichess-ai",Yp=(e,t,n)=>({color:t,"clock.increment":0,"clock.limit":e*60,keepAliveStream:!1,rated:n,variant:"standard"}),Xp=(e,t,n)=>({color:t,"clock.increment":0,"clock.limit":e*60,variant:"standard",level:n}),_t=(e,t,n,r)=>de(p(`button button-create ${n} ${r}`,n),o=>o("click",()=>{or(e)?vf(Xp(t,n,e.level)).then(s=>F("lichess/my-challenge",s)):_f(e.username,Yp(t,n,r)).then(s=>F("lichess/my-challenge",s))})),Eo=e=>or(e)?`LichessAI ${e.level}`:e.username,ed=(e,[t,n])=>p("challenge-create",p("time-control",p("time",t),p("label","minutes")),p("actions",p("unrated",_t(e,t,"black",!1),_t(e,t,"random",!1),_t(e,t,"white",!1)),or(e)?p("rated "):p("rated",_t(e,t,"black",!0),_t(e,t,"random",!0),_t(e,t,"white",!0)))),td=e=>{const t=x("lichess/opponent");if(t){const n=p("choices",...Oo.map(r=>ed(t,r)));e.append(p("challenge-page",p("header",p("title",`Challenge ${Eo(t)}`),kn()),n)),ae("lichess/my-challenge")(()=>{le(n)(p("waiting",`Waiting for ${Eo(t)} answer.`))})}};let nn=null;const nd=(e,t)=>{Pe(e),e.classList.remove("hidden"),e.append(p("message",p("from",t.username),p("text",t.text)),Ce("close",()=>{e.classList.add("hidden"),F("lichess/chat",null)})),nn!==null&&clearTimeout(nn),nn=window.setTimeout(()=>{F("lichess/chat",null),e.classList.add("hidden"),nn=null},6e3)},rd=e=>{const t=p("chat-box hidden");e.append(t),ae("lichess/chat")(()=>{const n=x("lichess/chat");n?nd(t,n):Pe(t)})},od=3e3,sd=3e3;let yo=null;const id=e=>{const t=Date.now();kf().then(()=>{const n=Date.now()-t,r=Math.max(0,Math.min(100,100-Math.round(n*100/sd)));e(r)}).catch(()=>e(0))},ad=e=>{yo===null&&(yo=window.setInterval(()=>{x("online")||id(e)},od),window.addEventListener("offline",()=>e(0)))},cd=e=>e>0&&!x("online")?F("online",!0):e===0&&x("online")?F("online",!1):void 0,ld=e=>{ad(cd);const t=p("online-status ok",p("icon"),p("label","Currently offline..."));ae("online")(()=>{const n=x("online");n&&t.classList.contains("nok")?(t.classList.remove("nok"),t.classList.add("ok")):!n&&t.classList.contains("ok")&&(t.classList.remove("ok"),t.classList.add("nok"))}),e.append(t)},ud=(e,t,n)=>({color:t,increment:0,limit:e*60,rated:n,variant:"standard"}),hd=({id:e})=>!!F("lichess/seek",e),fd=()=>F("lichess/seek",null),vt=(e,t,n)=>de(p(`button button-create ${t} ${n}`,t),r=>r("click",()=>{const o=ud(e,t,n);F("lichess/seek",{request:o,_tag:"seek-req",since:Date.now()}),wf(o,hd,fd)})),pd=([e,t])=>p("challenge-create",p("time-control",p("time",e),p("label","minutes")),p("actions",p("unrated",vt(e,"black",!1),vt(e,"random",!1),vt(e,"white",!1)),p("rated",vt(e,"black",!0),vt(e,"random",!0),vt(e,"white",!0)))),dd=e=>{const t=p("choices",...Oo.map(n=>pd(n)));e.append(p("challenge-page",p("header",p("title","Create game"),kn()),t)),ae("lichess/seek")(()=>{le(t)(p("waiting","Waiting for someone, anyone."),Ce("Stop waiting",()=>{window.location.assign("/")}))})},Co=()=>{ae("lichess/stream-events")(()=>{const t=x("lichess/stream-events");if(t.length>0){const n=t[t.length-1];n.type==="gameStart"?(F("lichess/game-info",n.game),F("lichess/challenges",[]),F("screen","game"),Mf(n.game.gameId)):n.type==="gameFinish"?(F("lichess/current-challenge",null),F("lichess/game-info",n.game),F("screen","end-game")):n.type==="challenge"?n.challenge.status==="created"&&ct("lichess/challenges",r=>r.concat(n.challenge)):n.type==="challengeCanceled"&&ct("lichess/challenges",r=>r.filter(o=>o.id===n.challenge.id))}})},gd=e=>{ep(e),Lp(),mo(e),rd(document.body),ld(document.body),Co();let t=["screen","lockScreen","lichess/chat","online"];ae("screen")(()=>{switch(Pa(n=>t.includes(n)),Co(),Pe(e),x("screen")){case"home":return mo(e);case"events":return Jp(e);case"game":return up(e);case"movelist":return Qp(e);case"challenge":return td(e);case"seek":return dd(e);case"follow":return js(e);case"end-game":return Kp(e)}})};Se(gd)(Le(document.querySelector("#app")));
