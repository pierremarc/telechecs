var Ji=Object.defineProperty;var Yi=(e,t,n)=>t in e?Ji(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ne=(e,t,n)=>Yi(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const qo="none",Go="some",Jn={tag:qo},Yn=e=>({tag:Go,value:e}),Xi=e=>typeof e=="object"&&e!==null&&"tag"in e&&(e.tag===qo||e.tag===Go),Xn=e=>e.tag==="none",Pe=e=>t=>Xn(t)?Jn:Yn(e(t.value)),Ir=e=>t=>Xn(t)?e:t.value,Bo=e=>t=>Xn(t)?e():t.value,Ue=e=>e==null?Jn:Yn(e),cn=(e,t,n)=>n(t(e));function w(e,t,n){function r(l,a){var p;Object.defineProperty(l,"_zod",{value:l._zod??{},enumerable:!1}),(p=l._zod).traits??(p.traits=new Set),l._zod.traits.add(e),t(l,a);for(const c in i.prototype)c in l||Object.defineProperty(l,c,{value:i.prototype[c].bind(l)});l._zod.constr=i,l._zod.def=a}const o=(n==null?void 0:n.Parent)??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function i(l){var a;const p=n!=null&&n.Parent?new s:this;r(p,l),(a=p._zod).deferred??(a.deferred=[]);for(const c of p._zod.deferred)c();return p}return Object.defineProperty(i,"init",{value:r}),Object.defineProperty(i,Symbol.hasInstance,{value:l=>{var a,p;return n!=null&&n.Parent&&l instanceof n.Parent?!0:(p=(a=l==null?void 0:l._zod)==null?void 0:a.traits)==null?void 0:p.has(e)}}),Object.defineProperty(i,"name",{value:e}),i}class Tt extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Wo={};function lt(e){return Wo}function ea(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function ta(e,t){return typeof t=="bigint"?t.toString():t}function Ho(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function er(e){return e==null}function tr(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function na(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=Number.parseInt(e.toFixed(o).replace(".","")),i=Number.parseInt(t.toFixed(o).replace(".",""));return s%i/10**o}function se(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function fn(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Vo(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function Ct(e){return JSON.stringify(e)}function qn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const ra=Ho(()=>{if(typeof navigator<"u"&&(navigator!=null&&navigator.userAgent.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Pr(e){if(qn(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(qn(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}const oa=new Set(["string","number","symbol"]);function Rt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pt(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function O(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function sa(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const ia={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function aa(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return pt(e,{...e._zod.def,shape:n,checks:[]})}function ca(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return pt(e,{...e._zod.def,shape:n,checks:[]})}function la(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return fn(this,"shape",r),r},checks:[]};return pt(e,n)}function ua(e,t){return pt(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return fn(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function ha(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)o[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return pt(t,{...t._zod.def,shape:o,checks:[]})}function fa(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)o[s]=new e({type:"nonoptional",innerType:r[s]});return pt(t,{...t._zod.def,shape:o,checks:[]})}function $t(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function nr(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Ht(e){return typeof e=="string"?e:e==null?void 0:e.message}function ut(e,t,n){var o,s,i,l,a,p;const r={...e,path:e.path??[]};if(!e.message){const c=Ht((i=(s=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:s.error)==null?void 0:i.call(s,e))??Ht((l=t==null?void 0:t.error)==null?void 0:l.call(t,e))??Ht((a=n.customError)==null?void 0:a.call(n,e))??Ht((p=n.localeError)==null?void 0:p.call(n,e))??"Invalid input";r.message=c}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function rr(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function It(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const Qo=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,ta,2)},enumerable:!0})},Jo=w("$ZodError",Qo),Yo=w("$ZodError",Qo,{Parent:Error});function pa(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function da(e,t){const n=t||function(s){return s.message},r={_errors:[]},o=s=>{for(const i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(l=>o({issues:l}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)r._errors.push(n(i));else{let l=r,a=0;for(;a<i.path.length;){const p=i.path[a];a===i.path.length-1?(l[p]=l[p]||{_errors:[]},l[p]._errors.push(n(i))):l[p]=l[p]||{_errors:[]},l=l[p],a++}}};return o(e),r}const ga=e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise)throw new Tt;if(i.issues.length){const l=new((o==null?void 0:o.Err)??e)(i.issues.map(a=>ut(a,s,lt())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return i.value},ma=e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const l=new((o==null?void 0:o.Err)??e)(i.issues.map(a=>ut(a,s,lt())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return i.value},Xo=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new Tt;return s.issues.length?{success:!1,error:new(e??Jo)(s.issues.map(i=>ut(i,o,lt())))}:{success:!0,data:s.value}},_a=Xo(Yo),es=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(i=>ut(i,o,lt())))}:{success:!0,data:s.value}},va=es(Yo),ba=/^[cC][^\s-]{8,}$/,wa=/^[0-9a-z]+$/,ka=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ya=/^[0-9a-vA-V]{20}$/,Ea=/^[A-Za-z0-9]{27}$/,Ca=/^[a-zA-Z0-9_-]{21}$/,Sa=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Aa=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Zr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,$a=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Ta="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Ia(){return new RegExp(Ta,"u")}const Pa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Za=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,za=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Oa=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ra=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ts=/^[A-Za-z0-9_-]*$/,Na=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,xa=/^\+(?:[0-9]){6,14}[0-9]$/,ns="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",La=new RegExp(`^${ns}$`);function rs(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function Fa(e){return new RegExp(`^${rs(e)}$`)}function Da(e){let t=`${ns}T${rs(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}const Ma=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Ua=/^\d+$/,ja=/^-?\d+(?:\.\d+)?/i,Ka=/true|false/i,qa=/^[^A-Z]*$/,Ga=/^[^a-z]*$/,Ee=w("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),os={number:"number",bigint:"bigint",object:"date"},ss=w("$ZodCheckLessThan",(e,t)=>{Ee.init(e,t);const n=os[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),is=w("$ZodCheckGreaterThan",(e,t)=>{Ee.init(e,t);const n=os[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ba=w("$ZodCheckMultipleOf",(e,t)=>{Ee.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):na(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Wa=w("$ZodCheckNumberFormat",(e,t)=>{var i;Ee.init(e,t),t.format=t.format||"float64";const n=(i=t.format)==null?void 0:i.includes("int"),r=n?"int":"number",[o,s]=ia[t.format];e._zod.onattach.push(l=>{const a=l._zod.bag;a.format=t.format,a.minimum=o,a.maximum=s,n&&(a.pattern=Ua)}),e._zod.check=l=>{const a=l.value;if(n){if(!Number.isInteger(a)){l.issues.push({expected:r,format:t.format,code:"invalid_type",input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?l.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):l.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}a<o&&l.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),a>s&&l.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:e})}}),Ha=w("$ZodCheckMaxLength",(e,t)=>{Ee.init(e,t),e._zod.when=n=>{const r=n.value;return!er(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const s=rr(r);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Va=w("$ZodCheckMinLength",(e,t)=>{Ee.init(e,t),e._zod.when=n=>{const r=n.value;return!er(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const s=rr(r);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Qa=w("$ZodCheckLengthEquals",(e,t)=>{Ee.init(e,t),e._zod.when=n=>{const r=n.value;return!er(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,o=r.length;if(o===t.length)return;const s=rr(r),i=o>t.length;n.issues.push({origin:s,...i?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),pn=w("$ZodCheckStringFormat",(e,t)=>{var n;Ee.init(e,t),e._zod.onattach.push(r=>{const o=r._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),Ja=w("$ZodCheckRegex",(e,t)=>{pn.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Ya=w("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=qa),pn.init(e,t)}),Xa=w("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Ga),pn.init(e,t)}),ec=w("$ZodCheckIncludes",(e,t)=>{Ee.init(e,t);const n=Rt(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),tc=w("$ZodCheckStartsWith",(e,t)=>{Ee.init(e,t);const n=new RegExp(`^${Rt(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),nc=w("$ZodCheckEndsWith",(e,t)=>{Ee.init(e,t);const n=new RegExp(`.*${Rt(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),rc=w("$ZodCheckOverwrite",(e,t)=>{Ee.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class oc{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(i=>i),o=Math.min(...r.map(i=>i.length-i.trimStart().length)),s=r.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(const i of s)this.content.push(i)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}}const sc={major:4,minor:0,patch:0},ie=w("$ZodType",(e,t)=>{var o;var n;e??(e={}),se(e._zod,"id",()=>t.type+"_"+Vo(10)),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=sc;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const s of r)for(const i of s._zod.onattach)i(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const s=(i,l,a)=>{let p=$t(i),c;for(const k of l){if(k._zod.when){if(!k._zod.when(i))continue}else if(p)continue;const m=i.issues.length,C=k._zod.check(i);if(C instanceof Promise&&(a==null?void 0:a.async)===!1)throw new Tt;if(c||C instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await C,i.issues.length!==m&&(p||(p=$t(i,m)))});else{if(i.issues.length===m)continue;p||(p=$t(i,m))}}return c?c.then(()=>i):i};e._zod.run=(i,l)=>{const a=e._zod.parse(i,l);if(a instanceof Promise){if(l.async===!1)throw new Tt;return a.then(p=>s(p,r,l))}return s(a,r,l)}}e["~standard"]={validate:s=>{var i;try{const l=_a(e,s);return l.success?{value:l.data}:{issues:(i=l.error)==null?void 0:i.issues}}catch{return va(e,s).then(a=>{var p;return a.success?{value:a.data}:{issues:(p=a.error)==null?void 0:p.issues}})}},vendor:"zod",version:1}}),or=w("$ZodString",(e,t)=>{var n;ie.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??Ma(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),oe=w("$ZodStringFormat",(e,t)=>{pn.init(e,t),or.init(e,t)}),ic=w("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Aa),oe.init(e,t)}),ac=w("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Zr(r))}else t.pattern??(t.pattern=Zr());oe.init(e,t)}),cc=w("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=$a),oe.init(e,t)}),lc=w("$ZodURL",(e,t)=>{oe.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Na.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),uc=w("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Ia()),oe.init(e,t)}),hc=w("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Ca),oe.init(e,t)}),fc=w("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=ba),oe.init(e,t)}),pc=w("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=wa),oe.init(e,t)}),dc=w("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ka),oe.init(e,t)}),gc=w("$ZodXID",(e,t)=>{t.pattern??(t.pattern=ya),oe.init(e,t)}),mc=w("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Ea),oe.init(e,t)}),_c=w("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Da(t)),oe.init(e,t)}),vc=w("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=La),oe.init(e,t)}),bc=w("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Fa(t)),oe.init(e,t)}),wc=w("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Sa),oe.init(e,t)}),kc=w("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Pa),oe.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),yc=w("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Za),oe.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),Ec=w("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=za),oe.init(e,t)}),Cc=w("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Oa),oe.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function as(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Sc=w("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Ra),oe.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{as(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function Ac(e){if(!ts.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return as(n)}const $c=w("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=ts),oe.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{Ac(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),Tc=w("$ZodE164",(e,t)=>{t.pattern??(t.pattern=xa),oe.init(e,t)});function Ic(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const Pc=w("$ZodJWT",(e,t)=>{oe.init(e,t),e._zod.check=n=>{Ic(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),cs=w("$ZodNumber",(e,t)=>{ie.init(e,t),e._zod.pattern=e._zod.bag.pattern??ja,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),Zc=w("$ZodNumber",(e,t)=>{Wa.init(e,t),cs.init(e,t)}),zc=w("$ZodBoolean",(e,t)=>{ie.init(e,t),e._zod.pattern=Ka,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),Oc=w("$ZodUnknown",(e,t)=>{ie.init(e,t),e._zod.parse=n=>n}),Rc=w("$ZodNever",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function zr(e,t,n){e.issues.length&&t.issues.push(...nr(n,e.issues)),t.value[n]=e.value}const Nc=w("$ZodArray",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let i=0;i<o.length;i++){const l=o[i],a=t.element._zod.run({value:l,issues:[]},r);a instanceof Promise?s.push(a.then(p=>zr(p,n,i))):zr(a,n,i)}return s.length?Promise.all(s).then(()=>n):n}});function Vt(e,t,n){e.issues.length&&t.issues.push(...nr(n,e.issues)),t.value[n]=e.value}function Or(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...nr(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const xc=w("$ZodObject",(e,t)=>{ie.init(e,t);const n=Ho(()=>{const k=Object.keys(t.shape);for(const C of k)if(!(t.shape[C]instanceof ie))throw new Error(`Invalid element at key "${C}": expected a Zod schema`);const m=sa(t.shape);return{shape:t.shape,keys:k,keySet:new Set(k),numKeys:k.length,optionalKeys:new Set(m)}});se(e._zod,"propValues",()=>{const k=t.shape,m={};for(const C in k){const E=k[C]._zod;if(E.values){m[C]??(m[C]=new Set);for(const j of E.values)m[C].add(j)}}return m});const r=k=>{const m=new oc(["shape","payload","ctx"]),{keys:C,optionalKeys:E}=n.value,j=N=>{const U=Ct(N);return`shape[${U}]._zod.run({ value: input[${U}], issues: [] }, ctx)`};m.write("const input = payload.value;");const K=Object.create(null);for(const N of C)K[N]=Vo(15);m.write("const newResult = {}");for(const N of C)if(E.has(N)){const U=K[N];m.write(`const ${U} = ${j(N)};`);const Q=Ct(N);m.write(`
        if (${U}.issues.length) {
          if (input[${Q}] === undefined) {
            if (${Q} in input) {
              newResult[${Q}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${U}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${Q}, ...iss.path] : [${Q}],
              }))
            );
          }
        } else if (${U}.value === undefined) {
          if (${Q} in input) newResult[${Q}] = undefined;
        } else {
          newResult[${Q}] = ${U}.value;
        }
        `)}else{const U=K[N];m.write(`const ${U} = ${j(N)};`),m.write(`
          if (${U}.issues.length) payload.issues = payload.issues.concat(${U}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Ct(N)}, ...iss.path] : [${Ct(N)}]
          })));`),m.write(`newResult[${Ct(N)}] = ${U}.value`)}m.write("payload.value = newResult;"),m.write("return payload;");const G=m.compile();return(N,U)=>G(k,N,U)};let o;const s=qn,i=!Wo.jitless,a=i&&ra.value,{catchall:p}=t;let c;e._zod.parse=(k,m)=>{c??(c=n.value);const C=k.value;if(!s(C))return k.issues.push({expected:"object",code:"invalid_type",input:C,inst:e}),k;const E=[];if(i&&a&&(m==null?void 0:m.async)===!1&&m.jitless!==!0)o||(o=r(t.shape)),k=o(k,m);else{k.value={};const U=c.shape;for(const Q of c.keys){const Ze=U[Q],Me=Ze._zod.run({value:C[Q],issues:[]},m),Xe=Ze._zod.optin==="optional"&&Ze._zod.optout==="optional";Me instanceof Promise?E.push(Me.then(mt=>Xe?Or(mt,k,Q,C):Vt(mt,k,Q))):Xe?Or(Me,k,Q,C):Vt(Me,k,Q)}}if(!p)return E.length?Promise.all(E).then(()=>k):k;const j=[],K=c.keySet,G=p._zod,N=G.def.type;for(const U of Object.keys(C)){if(K.has(U))continue;if(N==="never"){j.push(U);continue}const Q=G.run({value:C[U],issues:[]},m);Q instanceof Promise?E.push(Q.then(Ze=>Vt(Ze,k,U))):Vt(Q,k,U)}return j.length&&k.issues.push({code:"unrecognized_keys",keys:j,input:C,inst:e}),E.length?Promise.all(E).then(()=>k):k}});function Rr(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(s=>ut(s,r,lt())))}),t}const Lc=w("$ZodUnion",(e,t)=>{ie.init(e,t),se(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),se(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>tr(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const s=[];for(const i of t.options){const l=i._zod.run({value:n.value,issues:[]},r);if(l instanceof Promise)s.push(l),o=!0;else{if(l.issues.length===0)return l;s.push(l)}}return o?Promise.all(s).then(i=>Rr(i,n,e,r)):Rr(s,n,e,r)}}),Fc=w("$ZodIntersection",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>{const{value:o}=n,s=t.left._zod.run({value:o,issues:[]},r),i=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([a,p])=>Nr(n,a,p)):Nr(n,s,i)}});function Gn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Pr(e)&&Pr(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const i=Gn(e[s],t[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],i=Gn(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[r,...i.mergeErrorPath]};n.push(i.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Nr(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),$t(e))return e;const r=Gn(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const Dc=w("$ZodEnum",(e,t)=>{ie.init(e,t);const n=ea(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(r=>oa.has(typeof r)).map(r=>typeof r=="string"?Rt(r):r.toString()).join("|")})$`),e._zod.parse=(r,o)=>{const s=r.value;return e._zod.values.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),Mc=w("$ZodLiteral",(e,t)=>{ie.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?Rt(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),Uc=w("$ZodTransform",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(n.value=i,n));if(o instanceof Promise)throw new Tt;return n.value=o,n}}),jc=w("$ZodOptional",(e,t)=>{ie.init(e,t),e._zod.optin="optional",e._zod.optout="optional",se(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),se(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${tr(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),Kc=w("$ZodNullable",(e,t)=>{ie.init(e,t),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),se(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${tr(n.source)}|null)$`):void 0}),se(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),qc=w("$ZodDefault",(e,t)=>{ie.init(e,t),e._zod.optin="optional",se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>xr(s,t)):xr(o,t)}});function xr(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Gc=w("$ZodPrefault",(e,t)=>{ie.init(e,t),e._zod.optin="optional",se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Bc=w("$ZodNonOptional",(e,t)=>{ie.init(e,t),se(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Lr(s,e)):Lr(o,e)}});function Lr(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Wc=w("$ZodCatch",(e,t)=>{ie.init(e,t),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(i=>ut(i,r,lt()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>ut(s,r,lt()))},input:n.value}),n.issues=[]),n)}}),Hc=w("$ZodPipe",(e,t)=>{ie.init(e,t),se(e._zod,"values",()=>t.in._zod.values),se(e._zod,"optin",()=>t.in._zod.optin),se(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>Fr(s,t,r)):Fr(o,t,r)}});function Fr(e,t,n){return $t(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const Vc=w("$ZodReadonly",(e,t)=>{ie.init(e,t),se(e._zod,"propValues",()=>t.innerType._zod.propValues),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(Dr):Dr(o)}});function Dr(e){return e.value=Object.freeze(e.value),e}const Qc=w("$ZodCustom",(e,t)=>{Ee.init(e,t),ie.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>Mr(s,n,r,e));Mr(o,n,r,e)}});function Mr(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(It(o))}}class Jc{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function Yc(){return new Jc}const Qt=Yc();function Xc(e,t){return new e({type:"string",...O(t)})}function el(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...O(t)})}function Ur(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...O(t)})}function tl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...O(t)})}function nl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...O(t)})}function rl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...O(t)})}function ol(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...O(t)})}function ls(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...O(t)})}function sl(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...O(t)})}function il(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...O(t)})}function al(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...O(t)})}function cl(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...O(t)})}function ll(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...O(t)})}function ul(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...O(t)})}function hl(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...O(t)})}function fl(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...O(t)})}function pl(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...O(t)})}function dl(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...O(t)})}function gl(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...O(t)})}function ml(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...O(t)})}function _l(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...O(t)})}function vl(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...O(t)})}function bl(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...O(t)})}function wl(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...O(t)})}function kl(e,t){return new e({type:"string",format:"date",check:"string_format",...O(t)})}function yl(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...O(t)})}function El(e,t){return new e({type:"string",format:"duration",check:"string_format",...O(t)})}function Cl(e,t){return new e({type:"number",checks:[],...O(t)})}function Sl(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...O(t)})}function Al(e,t){return new e({type:"boolean",...O(t)})}function $l(e){return new e({type:"unknown"})}function Tl(e,t){return new e({type:"never",...O(t)})}function jr(e,t){return new ss({check:"less_than",...O(t),value:e,inclusive:!1})}function An(e,t){return new ss({check:"less_than",...O(t),value:e,inclusive:!0})}function Kr(e,t){return new is({check:"greater_than",...O(t),value:e,inclusive:!1})}function $n(e,t){return new is({check:"greater_than",...O(t),value:e,inclusive:!0})}function qr(e,t){return new Ba({check:"multiple_of",...O(t),value:e})}function us(e,t){return new Ha({check:"max_length",...O(t),maximum:e})}function ln(e,t){return new Va({check:"min_length",...O(t),minimum:e})}function hs(e,t){return new Qa({check:"length_equals",...O(t),length:e})}function Il(e,t){return new Ja({check:"string_format",format:"regex",...O(t),pattern:e})}function Pl(e){return new Ya({check:"string_format",format:"lowercase",...O(e)})}function Zl(e){return new Xa({check:"string_format",format:"uppercase",...O(e)})}function zl(e,t){return new ec({check:"string_format",format:"includes",...O(t),includes:e})}function Ol(e,t){return new tc({check:"string_format",format:"starts_with",...O(t),prefix:e})}function Rl(e,t){return new nc({check:"string_format",format:"ends_with",...O(t),suffix:e})}function Nt(e){return new rc({check:"overwrite",tx:e})}function Nl(e){return Nt(t=>t.normalize(e))}function xl(){return Nt(e=>e.trim())}function Ll(){return Nt(e=>e.toLowerCase())}function Fl(){return Nt(e=>e.toUpperCase())}function Dl(e,t,n){return new e({type:"array",element:t,...O(n)})}function Ml(e,t,n){return new e({type:"custom",check:"custom",fn:t,...O(n)})}const Ul=w("ZodISODateTime",(e,t)=>{_c.init(e,t),ae.init(e,t)});function jl(e){return wl(Ul,e)}const Kl=w("ZodISODate",(e,t)=>{vc.init(e,t),ae.init(e,t)});function ql(e){return kl(Kl,e)}const Gl=w("ZodISOTime",(e,t)=>{bc.init(e,t),ae.init(e,t)});function Bl(e){return yl(Gl,e)}const Wl=w("ZodISODuration",(e,t)=>{wc.init(e,t),ae.init(e,t)});function Hl(e){return El(Wl,e)}const Vl=(e,t)=>{Jo.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>da(e,n)},flatten:{value:n=>pa(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},dn=w("ZodError",Vl,{Parent:Error}),Ql=ga(dn),Jl=ma(dn),Yl=Xo(dn),Xl=es(dn),ce=w("ZodType",(e,t)=>(ie.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>pt(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>Ql(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>Yl(e,n,r),e.parseAsync=async(n,r)=>Jl(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>Xl(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(qu(n,r)),e.superRefine=n=>e.check(Gu(n)),e.overwrite=n=>e.check(Nt(n)),e.optional=()=>Wr(e),e.nullable=()=>Hr(e),e.nullish=()=>Wr(Hr(e)),e.nonoptional=n=>xu(e,n),e.array=()=>Eu(e),e.or=n=>Y([e,n]),e.and=n=>Au(e,n),e.transform=n=>Vr(e,Pu(n)),e.default=n=>Ou(e,n),e.prefault=n=>Nu(e,n),e.catch=n=>Fu(e,n),e.pipe=n=>Vr(e,n),e.readonly=()=>Uu(e),e.describe=n=>{const r=e.clone();return Qt.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=Qt.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Qt.get(e);const r=e.clone();return Qt.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),fs=w("_ZodString",(e,t)=>{or.init(e,t),ce.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(Il(...r)),e.includes=(...r)=>e.check(zl(...r)),e.startsWith=(...r)=>e.check(Ol(...r)),e.endsWith=(...r)=>e.check(Rl(...r)),e.min=(...r)=>e.check(ln(...r)),e.max=(...r)=>e.check(us(...r)),e.length=(...r)=>e.check(hs(...r)),e.nonempty=(...r)=>e.check(ln(1,...r)),e.lowercase=r=>e.check(Pl(r)),e.uppercase=r=>e.check(Zl(r)),e.trim=()=>e.check(xl()),e.normalize=(...r)=>e.check(Nl(...r)),e.toLowerCase=()=>e.check(Ll()),e.toUpperCase=()=>e.check(Fl())}),eu=w("ZodString",(e,t)=>{or.init(e,t),fs.init(e,t),e.email=n=>e.check(el(tu,n)),e.url=n=>e.check(ls(ps,n)),e.jwt=n=>e.check(bl(_u,n)),e.emoji=n=>e.check(sl(ru,n)),e.guid=n=>e.check(Ur(Gr,n)),e.uuid=n=>e.check(tl(Jt,n)),e.uuidv4=n=>e.check(nl(Jt,n)),e.uuidv6=n=>e.check(rl(Jt,n)),e.uuidv7=n=>e.check(ol(Jt,n)),e.nanoid=n=>e.check(il(ou,n)),e.guid=n=>e.check(Ur(Gr,n)),e.cuid=n=>e.check(al(su,n)),e.cuid2=n=>e.check(cl(iu,n)),e.ulid=n=>e.check(ll(au,n)),e.base64=n=>e.check(ml(du,n)),e.base64url=n=>e.check(_l(gu,n)),e.xid=n=>e.check(ul(cu,n)),e.ksuid=n=>e.check(hl(lu,n)),e.ipv4=n=>e.check(fl(uu,n)),e.ipv6=n=>e.check(pl(hu,n)),e.cidrv4=n=>e.check(dl(fu,n)),e.cidrv6=n=>e.check(gl(pu,n)),e.e164=n=>e.check(vl(mu,n)),e.datetime=n=>e.check(jl(n)),e.date=n=>e.check(ql(n)),e.time=n=>e.check(Bl(n)),e.duration=n=>e.check(Hl(n))});function A(e){return Xc(eu,e)}const ae=w("ZodStringFormat",(e,t)=>{oe.init(e,t),fs.init(e,t)}),tu=w("ZodEmail",(e,t)=>{cc.init(e,t),ae.init(e,t)}),Gr=w("ZodGUID",(e,t)=>{ic.init(e,t),ae.init(e,t)}),Jt=w("ZodUUID",(e,t)=>{ac.init(e,t),ae.init(e,t)}),ps=w("ZodURL",(e,t)=>{lc.init(e,t),ae.init(e,t)});function nu(e){return ls(ps,e)}const ru=w("ZodEmoji",(e,t)=>{uc.init(e,t),ae.init(e,t)}),ou=w("ZodNanoID",(e,t)=>{hc.init(e,t),ae.init(e,t)}),su=w("ZodCUID",(e,t)=>{fc.init(e,t),ae.init(e,t)}),iu=w("ZodCUID2",(e,t)=>{pc.init(e,t),ae.init(e,t)}),au=w("ZodULID",(e,t)=>{dc.init(e,t),ae.init(e,t)}),cu=w("ZodXID",(e,t)=>{gc.init(e,t),ae.init(e,t)}),lu=w("ZodKSUID",(e,t)=>{mc.init(e,t),ae.init(e,t)}),uu=w("ZodIPv4",(e,t)=>{kc.init(e,t),ae.init(e,t)}),hu=w("ZodIPv6",(e,t)=>{yc.init(e,t),ae.init(e,t)}),fu=w("ZodCIDRv4",(e,t)=>{Ec.init(e,t),ae.init(e,t)}),pu=w("ZodCIDRv6",(e,t)=>{Cc.init(e,t),ae.init(e,t)}),du=w("ZodBase64",(e,t)=>{Sc.init(e,t),ae.init(e,t)}),gu=w("ZodBase64URL",(e,t)=>{$c.init(e,t),ae.init(e,t)}),mu=w("ZodE164",(e,t)=>{Tc.init(e,t),ae.init(e,t)}),_u=w("ZodJWT",(e,t)=>{Pc.init(e,t),ae.init(e,t)}),ds=w("ZodNumber",(e,t)=>{cs.init(e,t),ce.init(e,t),e.gt=(r,o)=>e.check(Kr(r,o)),e.gte=(r,o)=>e.check($n(r,o)),e.min=(r,o)=>e.check($n(r,o)),e.lt=(r,o)=>e.check(jr(r,o)),e.lte=(r,o)=>e.check(An(r,o)),e.max=(r,o)=>e.check(An(r,o)),e.int=r=>e.check(M(r)),e.safe=r=>e.check(M(r)),e.positive=r=>e.check(Kr(0,r)),e.nonnegative=r=>e.check($n(0,r)),e.negative=r=>e.check(jr(0,r)),e.nonpositive=r=>e.check(An(0,r)),e.multipleOf=(r,o)=>e.check(qr(r,o)),e.step=(r,o)=>e.check(qr(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Ie(e){return Cl(ds,e)}const vu=w("ZodNumberFormat",(e,t)=>{Zc.init(e,t),ds.init(e,t)});function M(e){return Sl(vu,e)}const bu=w("ZodBoolean",(e,t)=>{zc.init(e,t),ce.init(e,t)});function q(e){return Al(bu,e)}const wu=w("ZodUnknown",(e,t)=>{Oc.init(e,t),ce.init(e,t)});function Br(){return $l(wu)}const ku=w("ZodNever",(e,t)=>{Rc.init(e,t),ce.init(e,t)});function gs(e){return Tl(ku,e)}const yu=w("ZodArray",(e,t)=>{Nc.init(e,t),ce.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(ln(n,r)),e.nonempty=n=>e.check(ln(1,n)),e.max=(n,r)=>e.check(us(n,r)),e.length=(n,r)=>e.check(hs(n,r)),e.unwrap=()=>e.element});function Eu(e,t){return Dl(yu,e,t)}const ms=w("ZodObject",(e,t)=>{xc.init(e,t),ce.init(e,t),se(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>$u(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Br()}),e.loose=()=>e.clone({...e._zod.def,catchall:Br()}),e.strict=()=>e.clone({...e._zod.def,catchall:gs()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>la(e,n),e.merge=n=>ua(e,n),e.pick=n=>aa(e,n),e.omit=n=>ca(e,n),e.partial=(...n)=>ha(_s,e,n[0]),e.required=(...n)=>fa(vs,e,n[0])});function Bn(e,t){const n={type:"object",get shape(){return fn(this,"shape",{...e}),this.shape},...O(t)};return new ms(n)}function Z(e,t){return new ms({type:"object",get shape(){return fn(this,"shape",{...e}),this.shape},catchall:gs(),...O(t)})}const Cu=w("ZodUnion",(e,t)=>{Lc.init(e,t),ce.init(e,t),e.options=t.options});function Y(e,t){return new Cu({type:"union",options:e,...O(t)})}const Su=w("ZodIntersection",(e,t)=>{Fc.init(e,t),ce.init(e,t)});function Au(e,t){return new Su({type:"intersection",left:e,right:t})}const Wn=w("ZodEnum",(e,t)=>{Dc.init(e,t),ce.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const i of r)if(n.has(i))s[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Wn({...t,checks:[],...O(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const i of r)if(n.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new Wn({...t,checks:[],...O(o),entries:s})}});function $u(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new Wn({type:"enum",entries:n,...O(t)})}const Tu=w("ZodLiteral",(e,t)=>{Mc.init(e,t),ce.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function f(e,t){return new Tu({type:"literal",values:Array.isArray(e)?e:[e],...O(t)})}const Iu=w("ZodTransform",(e,t)=>{Uc.init(e,t),ce.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=s=>{if(typeof s=="string")n.issues.push(It(s,n.value,t));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=e),i.continue??(i.continue=!0),n.issues.push(It(i))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function Pu(e){return new Iu({type:"transform",transform:e})}const _s=w("ZodOptional",(e,t)=>{jc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Wr(e){return new _s({type:"optional",innerType:e})}const Zu=w("ZodNullable",(e,t)=>{Kc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Hr(e){return new Zu({type:"nullable",innerType:e})}const zu=w("ZodDefault",(e,t)=>{qc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Ou(e,t){return new zu({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Ru=w("ZodPrefault",(e,t)=>{Gc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Nu(e,t){return new Ru({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const vs=w("ZodNonOptional",(e,t)=>{Bc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function xu(e,t){return new vs({type:"nonoptional",innerType:e,...O(t)})}const Lu=w("ZodCatch",(e,t)=>{Wc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Fu(e,t){return new Lu({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Du=w("ZodPipe",(e,t)=>{Hc.init(e,t),ce.init(e,t),e.in=t.in,e.out=t.out});function Vr(e,t){return new Du({type:"pipe",in:e,out:t})}const Mu=w("ZodReadonly",(e,t)=>{Vc.init(e,t),ce.init(e,t)});function Uu(e){return new Mu({type:"readonly",innerType:e})}const ju=w("ZodCustom",(e,t)=>{Qc.init(e,t),ce.init(e,t)});function Ku(e,t){const n=new Ee({check:"custom",...O(t)});return n._zod.check=e,n}function qu(e,t={}){return Ml(ju,e,t)}function Gu(e,t){const n=Ku(r=>(r.addIssue=o=>{if(typeof o=="string")r.issues.push(It(o,r.value,n._zod.def));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=n),s.continue??(s.continue=!n._zod.def.abort),r.issues.push(It(s))}},e(r.value,r)),t);return n}const Qr=Y([f("en"),f("fr")]),Bu=e=>{switch(e){case"Pawn":return"p";case"Knight":return"n";case"Bishop":return"b";case"Rook":return"r";case"Queen":return"q";case"King":return"k"}},Tn=e=>{switch(e){case"p":return"Pawn";case"n":return"Knight";case"b":return"Bishop";case"r":return"Rook";case"q":return"Queen";case"k":return"King"}},Wu=["A","B","C","D","E","F","G","H"],Hu=["1","2","3","4","5","6","7","8"],Ve=e=>e[0],In=e=>e[1],Vu=(e,t)=>e+t,Qu=(e,t,n,r,o,s,i)=>({_tag:"Normal",role:e,from:t,to:n,capture:r,promotion:o,check:s,checkmate:i}),Ju=(e,t,n,r)=>({_tag:"EnPassant",from:e,to:t,check:n,checkmate:r}),Yt=(e,t,n,r)=>({_tag:"Castle",king:e,rook:t,check:n,checkmate:r}),sr=e=>{switch(e._tag){case"Castle":return"King";case"EnPassant":return"Pawn";case"Normal":return e.role}},bs=e=>{switch(e._tag){case"Castle":switch(e.king){case"E1":return e.rook==="H1"?"G1":"C1";case"E8":return e.rook==="H8"?"G8":"C8"}case"EnPassant":case"Normal":return e.to}},Yu=e=>{switch(e._tag){case"Castle":return e.king;case"EnPassant":case"Normal":return e.from}},Xu=e=>[Yu(e),bs(e),e._tag==="Normal"&&e.promotion!==null?Bu(e.promotion):""].join("").toLowerCase(),ws=e=>e==="black"?"white":"black",gn=()=>({_tag:"none"}),eh=e=>({_tag:"role",role:e}),th=(e,t)=>({_tag:"candidates",role:e,candidates:t}),nh=e=>({_tag:"move",move:e}),un=e=>{switch(e._tag){case"role":case"candidates":return e.role;case"move":return sr(e.move)}},xt=e=>({...e,timestamp:Date.now()}),rh=e=>({_tag:"sending",since:Date.now(),request:e}),oh=(e,t)=>({_tag:"sent",since:Date.now(),request:e,cancel:t}),sh=(e,t)=>{const n=[[]];for(let r=0;r<t.length;r++){let o=Math.floor(r/e);o===n.length&&n.push([]),n[o].push(t[r])}return n},ih=["localhost","127.0.0.1","10\\..+","172\\.16\\..+","192\\.168\\..+"].map(e=>new RegExp(e)),ah=e=>ih.some(t=>t.test(e)),ks=[[15,10],[30,20],[40,30],[60,60],[90,60],[120,60]],ys=(e,t,n=" ")=>(t=t>>0,n=String(typeof n<"u"?n:" "),e.length>t?String(e):(t=t-e.length,t>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(e))),dt=(e,t)=>(t((r,o)=>{e.setAttribute(r,o.toString())}),e),me=(e,t)=>(t((r,o)=>{e.addEventListener(r,o)}),e);function Te(e){for(;e.firstChild;)ch(e.firstChild);return e}function ch(e,t=!1){t||Te(e);const n=e.parentNode;n&&n.removeChild(e)}const lh=e=>document.createElement(e),Jr=e=>t=>t.appendChild(document.createTextNode(e)),mn=(e,t)=>{const n=lh(e);return n.setAttribute("class",t),n},uh=e=>t=>{typeof t=="number"?Jr(t.toLocaleString())(e):Jr(t)(e)},hh=e=>t=>{e.appendChild(t)},Yr=(e,t)=>{typeof t=="number"||typeof t=="string"?uh(e)(t):hh(e)(t)},ir=e=>t=>{Xi(t)?Pe(n=>Yr(e,n))(t):Yr(e,t)},te=e=>(...t)=>{const n=ir(e);Te(e),t.forEach(n)},fh=e=>t=>t.classList.contains(e),ar=(...e)=>t=>(t.classList.add(...e),t),cr=(...e)=>t=>(t.classList.remove(...e),t),je=(e,t,n)=>{const r=mn(e,t);return n.forEach(ir(r)),r},u=(e,...t)=>je("div",e,t),Be=(...e)=>je("p","",e),Ye=(e,...t)=>je("span",e,t),lr=(e,...t)=>je("h1",e,t),ph=(e,...t)=>je("h2",e,t),dh=(e,...t)=>je("pre",e,t),gh=(e,t)=>dt(mn("input",e),n=>n("type",t)),Pt=(e,t,...n)=>dt(je("a",e,n),r=>r("href",t)),mh=(e,t)=>{const n=mn("img",e);return n.setAttribute("src",t),n},_h=(e,t)=>dt(mn("audio",e),n=>{n("src",t)}),vh=(e,t,...n)=>{const r=je("details",e,[je("summary","",[t])]),o=ir(r);return n.forEach(o),r};var Pn,Xr;function bh(){if(Xr)return Pn;Xr=1;function e(a){return a!==null?{comment:a,variations:[]}:{variations:[]}}function t(a,p,c,k,m){const C={move:a,variations:m};return p&&(C.suffix=p),c&&(C.nag=c),k!==null&&(C.comment=k),C}function n(...a){const[p,...c]=a;let k=p;for(const m of c)m!==null&&(k.variations=[m,...m.variations],m.variations=[],k=m);return p}function r(a,p){if(p.marker&&p.marker.comment){let c=p.root;for(;;){const k=c.variations[0];if(!k){c.comment=p.marker.comment;break}c=k}}return{headers:a,root:p.root,result:(p.marker&&p.marker.result)??void 0}}function o(a,p){function c(){this.constructor=a}c.prototype=p.prototype,a.prototype=new c}function s(a,p,c,k){var m=Error.call(this,a);return Object.setPrototypeOf&&Object.setPrototypeOf(m,s.prototype),m.expected=p,m.found=c,m.location=k,m.name="SyntaxError",m}o(s,Error);function i(a,p,c){return c=c||" ",a.length>p?a:(p-=a.length,c+=c.repeat(p),a+c.slice(0,p))}s.prototype.format=function(a){var p="Error: "+this.message;if(this.location){var c=null,k;for(k=0;k<a.length;k++)if(a[k].source===this.location.source){c=a[k].text.split(/\r\n|\n|\r/g);break}var m=this.location.start,C=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(m):m,E=this.location.source+":"+C.line+":"+C.column;if(c){var j=this.location.end,K=i("",C.line.toString().length," "),G=c[m.line-1],N=m.line===j.line?j.column:G.length+1,U=N-m.column||1;p+=`
 --> `+E+`
`+K+` |
`+C.line+" | "+G+`
`+K+" | "+i("",m.column-1," ")+i("",U,"^")}else p+=`
 at `+E}return p},s.buildMessage=function(a,p){var c={literal:function(G){return'"'+m(G.text)+'"'},class:function(G){var N=G.parts.map(function(U){return Array.isArray(U)?C(U[0])+"-"+C(U[1]):C(U)});return"["+(G.inverted?"^":"")+N.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(G){return G.description}};function k(G){return G.charCodeAt(0).toString(16).toUpperCase()}function m(G){return G.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(N){return"\\x0"+k(N)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(N){return"\\x"+k(N)})}function C(G){return G.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(N){return"\\x0"+k(N)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(N){return"\\x"+k(N)})}function E(G){return c[G.type](G)}function j(G){var N=G.map(E),U,Q;if(N.sort(),N.length>0){for(U=1,Q=1;U<N.length;U++)N[U-1]!==N[U]&&(N[Q]=N[U],Q++);N.length=Q}switch(N.length){case 1:return N[0];case 2:return N[0]+" or "+N[1];default:return N.slice(0,-1).join(", ")+", or "+N[N.length-1]}}function K(G){return G?'"'+m(G)+'"':"end of input"}return"Expected "+j(a)+" but "+K(p)+" found."};function l(a,p){p=p!==void 0?p:{};var c={},k=p.grammarSource,m={pgn:Er},C=Er,E="[",j='"',K="]",G=".",N="O-O-O",U="O-O",Q="0-0-0",Ze="0-0",Me="$",Xe="{",mt="}",et=";",Ut="(",En=")",kt="1-0",tt="0-1",jt="1/2-1/2",b="*",d=/^[a-zA-Z]/,y=/^[^"]/,$=/^[0-9]/,z=/^[.]/,P=/^[a-zA-Z1-8\-=]/,V=/^[+#]/,H=/^[!?]/,ee=/^[^}]/,F=/^[^\r\n]/,J=/^[ \t\r\n]/,fe=Ae("tag pair"),ze=pe("[",!1),Ne=pe('"',!1),nt=pe("]",!1),qe=Ae("tag name"),ve=Fe([["a","z"],["A","Z"]],!1,!1),xe=Ae("tag value"),rt=Fe(['"'],!0,!1),_t=Ae("move number"),Le=Fe([["0","9"]],!1,!1),Oe=pe(".",!1),Ge=Fe(["."],!1,!1),yt=Ae("standard algebraic notation"),Kt=pe("O-O-O",!1),Cn=pe("O-O",!1),qt=pe("0-0-0",!1),ot=pe("0-0",!1),Gt=Fe([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),ui=Fe(["+","#"],!1,!1),hi=Ae("suffix annotation"),_r=Fe(["!","?"],!1,!1),fi=Ae("NAG"),pi=pe("$",!1),di=Ae("brace comment"),gi=pe("{",!1),vr=Fe(["}"],!0,!1),mi=pe("}",!1),_i=Ae("rest of line comment"),vi=pe(";",!1),br=Fe(["\r",`
`],!0,!1),bi=Ae("variation"),wi=pe("(",!1),ki=pe(")",!1),yi=Ae("game termination marker"),Ei=pe("1-0",!1),Ci=pe("0-1",!1),Si=pe("1/2-1/2",!1),Ai=pe("*",!1),$i=Ae("whitespace"),wr=Fe([" ","	","\r",`
`],!1,!1),Ti=function(h,_){return r(h,_)},Ii=function(h){return Object.fromEntries(h)},Pi=function(h,_){return[h,_]},Zi=function(h,_){return{root:h,marker:_}},zi=function(h,_){return n(e(h),..._.flat())},Oi=function(h,_,v,x,L){return t(h,_,v,x,L)},Ri=function(h){return h},Ni=function(h){return h.replace(/[\r\n]+/g," ")},xi=function(h){return h.trim()},Li=function(h){return h},Fi=function(h,_){return{result:h,comment:_}},g=p.peg$currPos|0,vt=[{line:1,column:1}],Re=g,Bt=p.peg$maxFailExpected||[],S=p.peg$silentFails|0,Et;if(p.startRule){if(!(p.startRule in m))throw new Error(`Can't start parsing from rule "`+p.startRule+'".');C=m[p.startRule]}function pe(h,_){return{type:"literal",text:h,ignoreCase:_}}function Fe(h,_,v){return{type:"class",parts:h,inverted:_,ignoreCase:v}}function Di(){return{type:"end"}}function Ae(h){return{type:"other",description:h}}function kr(h){var _=vt[h],v;if(_)return _;if(h>=vt.length)v=vt.length-1;else for(v=h;!vt[--v];);for(_=vt[v],_={line:_.line,column:_.column};v<h;)a.charCodeAt(v)===10?(_.line++,_.column=1):_.column++,v++;return vt[h]=_,_}function yr(h,_,v){var x=kr(h),L=kr(_),X={source:k,start:{offset:h,line:x.line,column:x.column},end:{offset:_,line:L.line,column:L.column}};return X}function R(h){g<Re||(g>Re&&(Re=g,Bt=[]),Bt.push(h))}function Mi(h,_,v){return new s(s.buildMessage(h,_),h,_,v)}function Er(){var h,_,v;return h=g,_=Ui(),v=qi(),h=Ti(_,v),h}function Ui(){var h,_,v;for(h=g,_=[],v=Cr();v!==c;)_.push(v),v=Cr();return v=ke(),h=Ii(_),h}function Cr(){var h,_,v,x,L,X,st;return S++,h=g,ke(),a.charCodeAt(g)===91?(_=E,g++):(_=c,S===0&&R(ze)),_!==c?(ke(),v=ji(),v!==c?(ke(),a.charCodeAt(g)===34?(x=j,g++):(x=c,S===0&&R(Ne)),x!==c?(L=Ki(),a.charCodeAt(g)===34?(X=j,g++):(X=c,S===0&&R(Ne)),X!==c?(ke(),a.charCodeAt(g)===93?(st=K,g++):(st=c,S===0&&R(nt)),st!==c?h=Pi(v,L):(g=h,h=c)):(g=h,h=c)):(g=h,h=c)):(g=h,h=c)):(g=h,h=c),S--,h===c&&S===0&&R(fe),h}function ji(){var h,_,v;if(S++,h=g,_=[],v=a.charAt(g),d.test(v)?g++:(v=c,S===0&&R(ve)),v!==c)for(;v!==c;)_.push(v),v=a.charAt(g),d.test(v)?g++:(v=c,S===0&&R(ve));else _=c;return _!==c?h=a.substring(h,g):h=_,S--,h===c&&(_=c,S===0&&R(qe)),h}function Ki(){var h,_,v;for(S++,h=g,_=[],v=a.charAt(g),y.test(v)?g++:(v=c,S===0&&R(rt));v!==c;)_.push(v),v=a.charAt(g),y.test(v)?g++:(v=c,S===0&&R(rt));return h=a.substring(h,g),S--,_=c,S===0&&R(xe),h}function qi(){var h,_,v;return h=g,_=Sr(),ke(),v=Qi(),v===c&&(v=null),ke(),h=Zi(_,v),h}function Sr(){var h,_,v,x;for(h=g,_=Sn(),_===c&&(_=null),v=[],x=Ar();x!==c;)v.push(x),x=Ar();return h=zi(_,v),h}function Ar(){var h,_,v,x,L,X,st,Wt;if(h=g,ke(),Gi(),ke(),_=Bi(),_!==c){for(v=Wi(),v===c&&(v=null),x=[],L=$r();L!==c;)x.push(L),L=$r();for(L=ke(),X=Sn(),X===c&&(X=null),st=[],Wt=Tr();Wt!==c;)st.push(Wt),Wt=Tr();h=Oi(_,v,x,X,st)}else g=h,h=c;return h}function Gi(){var h,_,v,x,L,X;for(S++,h=g,_=[],v=a.charAt(g),$.test(v)?g++:(v=c,S===0&&R(Le));v!==c;)_.push(v),v=a.charAt(g),$.test(v)?g++:(v=c,S===0&&R(Le));if(a.charCodeAt(g)===46?(v=G,g++):(v=c,S===0&&R(Oe)),v!==c){for(x=ke(),L=[],X=a.charAt(g),z.test(X)?g++:(X=c,S===0&&R(Ge));X!==c;)L.push(X),X=a.charAt(g),z.test(X)?g++:(X=c,S===0&&R(Ge));_=[_,v,x,L],h=_}else g=h,h=c;return S--,h===c&&(_=c,S===0&&R(_t)),h}function Bi(){var h,_,v,x,L,X;if(S++,h=g,_=g,a.substr(g,5)===N?(v=N,g+=5):(v=c,S===0&&R(Kt)),v===c&&(a.substr(g,3)===U?(v=U,g+=3):(v=c,S===0&&R(Cn)),v===c&&(a.substr(g,5)===Q?(v=Q,g+=5):(v=c,S===0&&R(qt)),v===c&&(a.substr(g,3)===Ze?(v=Ze,g+=3):(v=c,S===0&&R(ot)),v===c))))if(v=g,x=a.charAt(g),d.test(x)?g++:(x=c,S===0&&R(ve)),x!==c){if(L=[],X=a.charAt(g),P.test(X)?g++:(X=c,S===0&&R(Gt)),X!==c)for(;X!==c;)L.push(X),X=a.charAt(g),P.test(X)?g++:(X=c,S===0&&R(Gt));else L=c;L!==c?(x=[x,L],v=x):(g=v,v=c)}else g=v,v=c;return v!==c?(x=a.charAt(g),V.test(x)?g++:(x=c,S===0&&R(ui)),x===c&&(x=null),v=[v,x],_=v):(g=_,_=c),_!==c?h=a.substring(h,g):h=_,S--,h===c&&(_=c,S===0&&R(yt)),h}function Wi(){var h,_,v;for(S++,h=g,_=[],v=a.charAt(g),H.test(v)?g++:(v=c,S===0&&R(_r));v!==c;)_.push(v),_.length>=2?v=c:(v=a.charAt(g),H.test(v)?g++:(v=c,S===0&&R(_r)));return _.length<1?(g=h,h=c):h=_,S--,h===c&&(_=c,S===0&&R(hi)),h}function $r(){var h,_,v,x,L;if(S++,h=g,ke(),a.charCodeAt(g)===36?(_=Me,g++):(_=c,S===0&&R(pi)),_!==c){if(v=g,x=[],L=a.charAt(g),$.test(L)?g++:(L=c,S===0&&R(Le)),L!==c)for(;L!==c;)x.push(L),L=a.charAt(g),$.test(L)?g++:(L=c,S===0&&R(Le));else x=c;x!==c?v=a.substring(v,g):v=x,v!==c?h=Ri(v):(g=h,h=c)}else g=h,h=c;return S--,h===c&&S===0&&R(fi),h}function Sn(){var h;return h=Hi(),h===c&&(h=Vi()),h}function Hi(){var h,_,v,x,L;if(S++,h=g,a.charCodeAt(g)===123?(_=Xe,g++):(_=c,S===0&&R(gi)),_!==c){for(v=g,x=[],L=a.charAt(g),ee.test(L)?g++:(L=c,S===0&&R(vr));L!==c;)x.push(L),L=a.charAt(g),ee.test(L)?g++:(L=c,S===0&&R(vr));v=a.substring(v,g),a.charCodeAt(g)===125?(x=mt,g++):(x=c,S===0&&R(mi)),x!==c?h=Ni(v):(g=h,h=c)}else g=h,h=c;return S--,h===c&&(_=c,S===0&&R(di)),h}function Vi(){var h,_,v,x,L;if(S++,h=g,a.charCodeAt(g)===59?(_=et,g++):(_=c,S===0&&R(vi)),_!==c){for(v=g,x=[],L=a.charAt(g),F.test(L)?g++:(L=c,S===0&&R(br));L!==c;)x.push(L),L=a.charAt(g),F.test(L)?g++:(L=c,S===0&&R(br));v=a.substring(v,g),h=xi(v)}else g=h,h=c;return S--,h===c&&(_=c,S===0&&R(_i)),h}function Tr(){var h,_,v,x;return S++,h=g,ke(),a.charCodeAt(g)===40?(_=Ut,g++):(_=c,S===0&&R(wi)),_!==c?(v=Sr(),v!==c?(ke(),a.charCodeAt(g)===41?(x=En,g++):(x=c,S===0&&R(ki)),x!==c?h=Li(v):(g=h,h=c)):(g=h,h=c)):(g=h,h=c),S--,h===c&&S===0&&R(bi),h}function Qi(){var h,_,v;return S++,h=g,a.substr(g,3)===kt?(_=kt,g+=3):(_=c,S===0&&R(Ei)),_===c&&(a.substr(g,3)===tt?(_=tt,g+=3):(_=c,S===0&&R(Ci)),_===c&&(a.substr(g,7)===jt?(_=jt,g+=7):(_=c,S===0&&R(Si)),_===c&&(a.charCodeAt(g)===42?(_=b,g++):(_=c,S===0&&R(Ai))))),_!==c?(ke(),v=Sn(),v===c&&(v=null),h=Fi(_,v)):(g=h,h=c),S--,h===c&&(_=c,S===0&&R(yi)),h}function ke(){var h,_;for(S++,h=[],_=a.charAt(g),J.test(_)?g++:(_=c,S===0&&R(wr));_!==c;)h.push(_),_=a.charAt(g),J.test(_)?g++:(_=c,S===0&&R(wr));return S--,_=c,S===0&&R($i),h}if(Et=C(),p.peg$library)return{peg$result:Et,peg$currPos:g,peg$FAILED:c,peg$maxFailExpected:Bt,peg$maxFailPos:Re};if(Et!==c&&g===a.length)return Et;throw Et!==c&&g<a.length&&R(Di()),Mi(Bt,Re<a.length?a.charAt(Re):null,Re<a.length?yr(Re,Re+1):yr(Re,Re))}return Pn={StartRules:["pgn"],SyntaxError:s,parse:l},Pn}var wh=bh();/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const on=0xffffffffffffffffn;function Zn(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function eo(e,t){return e*t&on}function kh(e){return function(){let t=BigInt(e&on),n=BigInt(e>>64n&on);const r=eo(Zn(eo(t,5n),7n),9n);return n^=t,t=(Zn(t,24n)^n^n<<16n)&on,n=Zn(n,37n),e=n<<64n|t,r}}const _n=kh(0xa187eb39cdcaed8f31c4b365b102e01en),yh=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>_n()))),Eh=Array.from({length:8},()=>_n()),Ch=Array.from({length:16},()=>_n()),zn=_n(),we="w",$e="b",le="p",Hn="n",sn="b",At="r",Qe="q",he="k",On="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Xt{constructor(t,n){ne(this,"color");ne(this,"from");ne(this,"to");ne(this,"piece");ne(this,"captured");ne(this,"promotion");ne(this,"flags");ne(this,"san");ne(this,"lan");ne(this,"before");ne(this,"after");const{color:r,piece:o,from:s,to:i,flags:l,captured:a,promotion:p}=n,c=ge(s),k=ge(i);this.color=r,this.piece=o,this.from=c,this.to=k,this.san=t._moveToSan(n,t._moves({legal:!0})),this.lan=c+k,this.before=t.fen(),t._makeMove(n),this.after=t.fen(),t._undoMove(),this.flags="";for(const m in B)B[m]&l&&(this.flags+=it[m]);a&&(this.captured=a),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(it.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(it.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(it.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(it.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(it.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(it.BIG_PAWN)>-1}}const be=-1,it={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},B={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Vn={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Sh={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Ah={...Vn,...Sh},D={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Rn={b:[16,32,17,15],w:[-16,-32,-17,-15]},to={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},$h=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Th=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Ih={p:1,n:2,b:4,r:8,q:16,k:32},Ph="pnbrqkPNBRQK",no=[Hn,sn,At,Qe],Zh=7,zh=6,Oh=1,Rh=0,en={[he]:B.KSIDE_CASTLE,[Qe]:B.QSIDE_CASTLE},We={w:[{square:D.a1,flag:B.QSIDE_CASTLE},{square:D.h1,flag:B.KSIDE_CASTLE}],b:[{square:D.a8,flag:B.QSIDE_CASTLE},{square:D.h8,flag:B.KSIDE_CASTLE}]},Nh={b:Oh,w:zh};function at(e){return e>>4}function Zt(e){return e&15}function Es(e){return"0123456789".indexOf(e)!==-1}function ge(e){const t=Zt(e),n=at(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function St(e){return e===we?$e:we}function xh(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=t[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let i=0;i<o.length;i++){let l=0,a=!1;for(let p=0;p<o[i].length;p++)if(Es(o[i][p])){if(a)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(o[i][p],10),a=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[i][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,a=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:i,regex:l}of s){if(!l.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${i} king`};if((t[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${i} kings`}}return Array.from(o[0]+o[7]).some(i=>i.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Lh(e,t){const n=e.from,r=e.to,o=e.piece;let s=0,i=0,l=0;for(let a=0,p=t.length;a<p;a++){const c=t[a].from,k=t[a].to,m=t[a].piece;o===m&&n!==c&&r===k&&(s++,at(n)===at(c)&&i++,Zt(n)===Zt(c)&&l++)}return s>0?i>0&&l>0?ge(n):l>0?ge(n).charAt(1):ge(n).charAt(0):""}function He(e,t,n,r,o,s=void 0,i=B.NORMAL){const l=at(r);if(o===le&&(l===Zh||l===Rh))for(let a=0;a<no.length;a++){const p=no[a];e.push({color:t,from:n,to:r,piece:o,captured:s,promotion:p,flags:i|B.PROMOTION})}else e.push({color:t,from:n,to:r,piece:o,captured:s,flags:i})}function ro(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:le:(t=t.toLowerCase(),t==="o"?he:t)}function Nn(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Cs{constructor(t=On,{skipValidation:n=!1}={}){ne(this,"_board",new Array(128));ne(this,"_turn",we);ne(this,"_header",{});ne(this,"_kings",{w:be,b:be});ne(this,"_epSquare",-1);ne(this,"_halfMoves",0);ne(this,"_moveNumber",0);ne(this,"_history",[]);ne(this,"_comments",{});ne(this,"_castling",{w:0,b:0});ne(this,"_hash",0n);ne(this,"_positionCount",new Map);this.load(t,{skipValidation:n})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:be,b:be},this._turn=we,this._castling={w:0,b:0},this._epSquare=be,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Ah},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:n=!1,preserveHeaders:r=!1}={}){let o=t.split(/\s+/);if(o.length>=2&&o.length<6){const l=["-","-","0","1"];t=o.concat(l.slice(-(6-o.length))).join(" ")}if(o=t.split(/\s+/),!n){const{ok:l,error:a}=xh(t);if(!l)throw new Error(a)}const s=o[0];let i=0;this.clear({preserveHeaders:r});for(let l=0;l<s.length;l++){const a=s.charAt(l);if(a==="/")i+=8;else if(Es(a))i+=parseInt(a,10);else{const p=a<"a"?we:$e;this._put({type:a.toLowerCase(),color:p},ge(i)),i++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=B.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=B.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=B.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=B.QSIDE_CASTLE),this._epSquare=o[3]==="-"?be:D[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var i,l;let n=0,r="";for(let a=D.a8;a<=D.h1;a++){if(this._board[a]){n>0&&(r+=n,n=0);const{color:p,type:c}=this._board[a];r+=p===we?c.toUpperCase():c.toLowerCase()}else n++;a+1&136&&(n>0&&(r+=n),a!==D.h1&&(r+="/"),n=0,a+=8)}let o="";this._castling[we]&B.KSIDE_CASTLE&&(o+="K"),this._castling[we]&B.QSIDE_CASTLE&&(o+="Q"),this._castling[$e]&B.KSIDE_CASTLE&&(o+="k"),this._castling[$e]&B.QSIDE_CASTLE&&(o+="q"),o=o||"-";let s="-";if(this._epSquare!==be)if(t)s=ge(this._epSquare);else{const a=this._epSquare+(this._turn===we?16:-16),p=[a+1,a-1];for(const c of p){if(c&136)continue;const k=this._turn;if(((i=this._board[c])==null?void 0:i.color)===k&&((l=this._board[c])==null?void 0:l.type)===le){this._makeMove({color:k,from:c,to:this._epSquare,piece:le,captured:le,flags:B.EP_CAPTURE});const m=!this._isKingAttacked(k);if(this._undoMove(),m){s=ge(this._epSquare);break}}}}return[r,this._turn,o,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:n,type:r}=this._board[t],o={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[r];return yh[o][s][t]}_epKey(){return this._epSquare===be?0n:Eh[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return Ch[t]}_computeHash(){let t=0n;for(let n=D.a8;n<=D.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(t^=this._pieceKey(n))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=zn),t}_updateSetup(t){this._history.length>0||(t!==On?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(On)}get(t){return this._board[D[t]]}findPiece(t){var r;const n=[];for(let o=D.a8;o<=D.h1;o++){if(o&136){o+=7;continue}!this._board[o]||((r=this._board[o])==null?void 0:r.color)!==t.color||this._board[o].color===t.color&&this._board[o].type===t.type&&n.push(ge(o))}return n}put({type:t,color:n},r){return this._put({type:t,color:n},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,n){this._hash^=this._pieceKey(t),this._board[t]=n,this._hash^=this._pieceKey(t)}_put({type:t,color:n},r){if(Ph.indexOf(t.toLowerCase())===-1||!(r in D))return!1;const o=D[r];if(t==he&&!(this._kings[n]==be||this._kings[n]==o))return!1;const s=this._board[o];return s&&s.type===he&&(this._kings[s.color]=be),this._set(o,{type:t,color:n}),t===he&&(this._kings[n]=o),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const n=this.get(t);return this._clear(D[t]),n&&n.type===he&&(this._kings[n.color]=be),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var r,o,s,i,l,a,p,c,k,m,C,E;this._hash^=this._castlingKey();const t=((r=this._board[D.e1])==null?void 0:r.type)===he&&((o=this._board[D.e1])==null?void 0:o.color)===we,n=((s=this._board[D.e8])==null?void 0:s.type)===he&&((i=this._board[D.e8])==null?void 0:i.color)===$e;(!t||((l=this._board[D.a1])==null?void 0:l.type)!==At||((a=this._board[D.a1])==null?void 0:a.color)!==we)&&(this._castling.w&=-65),(!t||((p=this._board[D.h1])==null?void 0:p.type)!==At||((c=this._board[D.h1])==null?void 0:c.color)!==we)&&(this._castling.w&=-33),(!n||((k=this._board[D.a8])==null?void 0:k.type)!==At||((m=this._board[D.a8])==null?void 0:m.color)!==$e)&&(this._castling.b&=-65),(!n||((C=this._board[D.h8])==null?void 0:C.type)!==At||((E=this._board[D.h8])==null?void 0:E.color)!==$e)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,i;if(this._epSquare===be)return;const t=this._epSquare+(this._turn===we?-16:16),n=this._epSquare+(this._turn===we?16:-16),r=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==St(this._turn)||((i=this._board[n])==null?void 0:i.type)!==le){this._hash^=this._epKey(),this._epSquare=be;return}const o=l=>{var a,p;return!(l&136)&&((a=this._board[l])==null?void 0:a.color)===this._turn&&((p=this._board[l])==null?void 0:p.type)===le};r.some(o)||(this._hash^=this._epKey(),this._epSquare=be)}_attacked(t,n,r){const o=[];for(let s=D.a8;s<=D.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==t)continue;const i=this._board[s],l=s-n;if(l===0)continue;const a=l+119;if($h[a]&Ih[i.type]){if(i.type===le){if(l>0&&i.color===we||l<=0&&i.color===$e)if(r)o.push(ge(s));else return!0;continue}if(i.type==="n"||i.type==="k")if(r){o.push(ge(s));continue}else return!0;const p=Th[a];let c=s+p,k=!1;for(;c!==n;){if(this._board[c]!=null){k=!0;break}c+=p}if(!k)if(r){o.push(ge(s));continue}else return!0}}return r?o:!1}attackers(t,n){return n?this._attacked(n,D[t],!0):this._attacked(this._turn,D[t],!0)}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(St(t),n)}hash(){return this._hash.toString(16)}isAttacked(t,n){return this._attacked(n,D[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let r=0,o=0;for(let s=D.a8;s<=D.h1;s++){if(o=(o+1)%2,s&136){s+=7;continue}const i=this._board[s];i&&(t[i.type]=i.type in t?t[i.type]+1:1,i.type===sn&&n.push(o),r++)}if(r===2)return!0;if(r===3&&(t[sn]===1||t[Hn]===1))return!0;if(r===t[sn]+2){let s=0;const i=n.length;for(let l=0;l<i;l++)s+=n[l];if(s===0||s===i)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:r=void 0}={}){const o=this._moves({square:n,piece:r});return t?o.map(s=>new Xt(this,s)):o.map(s=>this._moveToSan(s,o))}_moves({legal:t=!0,piece:n=void 0,square:r=void 0}={}){var C;const o=r?r.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),i=[],l=this._turn,a=St(l);let p=D.a8,c=D.h1,k=!1;if(o)if(o in D)p=c=D[o],k=!0;else return[];for(let E=p;E<=c;E++){if(E&136){E+=7;continue}if(!this._board[E]||this._board[E].color===a)continue;const{type:j}=this._board[E];let K;if(j===le){if(s&&s!==j)continue;K=E+Rn[l][0],this._board[K]||(He(i,l,E,K,le),K=E+Rn[l][1],Nh[l]===at(E)&&!this._board[K]&&He(i,l,E,K,le,void 0,B.BIG_PAWN));for(let G=2;G<4;G++)K=E+Rn[l][G],!(K&136)&&(((C=this._board[K])==null?void 0:C.color)===a?He(i,l,E,K,le,this._board[K].type,B.CAPTURE):K===this._epSquare&&He(i,l,E,K,le,le,B.EP_CAPTURE))}else{if(s&&s!==j)continue;for(let G=0,N=to[j].length;G<N;G++){const U=to[j][G];for(K=E;K+=U,!(K&136);){if(!this._board[K])He(i,l,E,K,j);else{if(this._board[K].color===l)break;He(i,l,E,K,j,this._board[K].type,B.CAPTURE);break}if(j===Hn||j===he)break}}}}if((s===void 0||s===he)&&(!k||c===this._kings[l])){if(this._castling[l]&B.KSIDE_CASTLE){const E=this._kings[l],j=E+2;!this._board[E+1]&&!this._board[j]&&!this._attacked(a,this._kings[l])&&!this._attacked(a,E+1)&&!this._attacked(a,j)&&He(i,l,this._kings[l],j,he,void 0,B.KSIDE_CASTLE)}if(this._castling[l]&B.QSIDE_CASTLE){const E=this._kings[l],j=E-2;!this._board[E-1]&&!this._board[E-2]&&!this._board[E-3]&&!this._attacked(a,this._kings[l])&&!this._attacked(a,E-1)&&!this._attacked(a,j)&&He(i,l,this._kings[l],j,he,void 0,B.QSIDE_CASTLE)}}if(!t||this._kings[l]===-1)return i;const m=[];for(let E=0,j=i.length;E<j;E++)this._makeMove(i[E]),this._isKingAttacked(l)||m.push(i[E]),this._undoMove();return m}move(t,{strict:n=!1}={}){let r=null;if(typeof t=="string")r=this._moveFromSan(t,n);else if(typeof t=="object"){const s=this._moves();for(let i=0,l=s.length;i<l;i++)if(t.from===ge(s[i].from)&&t.to===ge(s[i].to)&&(!("promotion"in s[i])||t.promotion===s[i].promotion)){r=s[i];break}}if(!r)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const o=new Xt(this,r);return this._makeMove(r),this._incPositionCount(),o}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,n){this._hash^=this._pieceKey(t),this._board[n]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(n)}_makeMove(t){var o,s,i,l;const n=this._turn,r=St(n);if(this._push(t),this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&B.EP_CAPTURE&&(this._turn===$e?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:n})),this._board[t.to].type===he){if(this._kings[n]=t.to,t.flags&B.KSIDE_CASTLE){const a=t.to-1,p=t.to+1;this._movePiece(p,a)}else if(t.flags&B.QSIDE_CASTLE){const a=t.to+1,p=t.to-2;this._movePiece(p,a)}this._castling[n]=0}if(this._castling[n]){for(let a=0,p=We[n].length;a<p;a++)if(t.from===We[n][a].square&&this._castling[n]&We[n][a].flag){this._castling[n]^=We[n][a].flag;break}}if(this._castling[r]){for(let a=0,p=We[r].length;a<p;a++)if(t.to===We[r][a].square&&this._castling[r]&We[r][a].flag){this._castling[r]^=We[r][a].flag;break}}if(this._hash^=this._castlingKey(),t.flags&B.BIG_PAWN){let a;n===$e?a=t.to-16:a=t.to+16,!(t.to-1&136)&&((o=this._board[t.to-1])==null?void 0:o.type)===le&&((s=this._board[t.to-1])==null?void 0:s.color)===r||!(t.to+1&136)&&((i=this._board[t.to+1])==null?void 0:i.type)===le&&((l=this._board[t.to+1])==null?void 0:l.color)===r?(this._epSquare=a,this._hash^=this._epKey()):this._epSquare=be}else this._epSquare=be;t.piece===le?this._halfMoves=0:t.flags&(B.CAPTURE|B.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===$e&&this._moveNumber++,this._turn=r,this._hash^=zn}undo(){const t=this._hash,n=this._undoMove();if(n){const r=new Xt(this,n);return this._decPositionCount(t),r}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=zn;const r=this._turn,o=St(r);if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:r})),n.captured)if(n.flags&B.EP_CAPTURE){let s;r===$e?s=n.to-16:s=n.to+16,this._set(s,{type:le,color:o})}else this._set(n.to,{type:n.captured,color:o});if(n.flags&(B.KSIDE_CASTLE|B.QSIDE_CASTLE)){let s,i;n.flags&B.KSIDE_CASTLE?(s=n.to+1,i=n.to-1):(s=n.to-2,i=n.to+1),this._movePiece(i,s)}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const r=[];let o=!1;for(const m in this._header)this._header[m]&&r.push(`[${m} "${this._header[m]}"]`+t),o=!0;o&&this._history.length&&r.push(t);const s=m=>{const C=this._comments[this.fen()];if(typeof C<"u"){const E=m.length>0?" ":"";m=`${m}${E}{${C}}`}return m},i=[];for(;this._history.length>0;)i.push(this._undoMove());const l=[];let a="";for(i.length===0&&l.push(s(""));i.length>0;){a=s(a);const m=i.pop();if(!m)break;if(!this._history.length&&m.color==="b"){const C=`${this._moveNumber}. ...`;a=a?`${a} ${C}`:C}else m.color==="w"&&(a.length&&l.push(a),a=this._moveNumber+".");a=a+" "+this._moveToSan(m,this._moves({legal:!0})),this._makeMove(m)}if(a.length&&l.push(s(a)),l.push(this._header.Result||"*"),n===0)return r.join("")+l.join(" ");const p=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},c=function(m,C){for(const E of C.split(" "))if(E){if(m+E.length>n){for(;p();)m--;r.push(t),m=0}r.push(E),m+=E.length,r.push(" "),m++}return p()&&m--,m};let k=0;for(let m=0;m<l.length;m++){if(k+l[m].length>n&&l[m].includes("{")){k=c(k,l[m]);continue}k+l[m].length>n&&m!==0?(r[r.length-1]===" "&&r.pop(),r.push(t),k=0):m!==0&&(r.push(" "),k++),r.push(l[m]),k+=l[m].length}return r.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}setHeader(t,n){return this._header[t]=n??Vn[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Vn[t]||null,!0):!1}getHeaders(){const t={};for(const[n,r]of Object.entries(this._header))r!==null&&(t[n]=r);return t}loadPgn(t,{strict:n=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(t=t.replace(new RegExp(r,"g"),`
`));const o=wh.parse(t);this.reset();const s=o.headers;let i="";for(const p in s)p.toLowerCase()==="fen"&&(i=s[p]),this.header(p,s[p]);if(!n)i&&this.load(i,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let l=o.root;for(;l;){if(l.move){const p=this._moveFromSan(l.move,n);if(p==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(p),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const a=o.result;a&&Object.keys(this._header).length&&this._header.Result!==a&&this.setHeader("Result",a)}_moveToSan(t,n){let r="";if(t.flags&B.KSIDE_CASTLE)r="O-O";else if(t.flags&B.QSIDE_CASTLE)r="O-O-O";else{if(t.piece!==le){const o=Lh(t,n);r+=t.piece.toUpperCase()+o}t.flags&(B.CAPTURE|B.EP_CAPTURE)&&(t.piece===le&&(r+=ge(t.from)[0]),r+="x"),r+=ge(t.to),t.promotion&&(r+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(t,n=!1){let r=Nn(t);n||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O"));let o=ro(r),s=this._moves({legal:!0,piece:o});for(let m=0,C=s.length;m<C;m++)if(r===Nn(this._moveToSan(s[m],s)))return s[m];if(n)return null;let i,l,a,p,c,k=!1;if(l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(i=l[1],a=l[2],p=l[3],c=l[4],a.length==1&&(k=!0)):(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(i=l[1],a=l[2],p=l[3],c=l[4],a.length==1&&(k=!0))),o=ro(r),s=this._moves({legal:!0,piece:i||o}),!p)return null;for(let m=0,C=s.length;m<C;m++)if(a){if((!i||i.toLowerCase()==s[m].piece)&&D[a]==s[m].from&&D[p]==s[m].to&&(!c||c.toLowerCase()==s[m].promotion))return s[m];if(k){const E=ge(s[m].from);if((!i||i.toLowerCase()==s[m].piece)&&D[p]==s[m].to&&(a==E[0]||a==E[1])&&(!c||c.toLowerCase()==s[m].promotion))return s[m]}}else if(r===Nn(this._moveToSan(s[m],s)).replace("x",""))return s[m];return null}ascii(){let t=`   +------------------------+
`;for(let n=D.a8;n<=D.h1;n++){if(Zt(n)===0&&(t+=" "+"87654321"[at(n)]+" |"),this._board[n]){const r=this._board[n].type,s=this._board[n].color===we?r.toUpperCase():r.toLowerCase();t+=" "+s+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let r=0;const o=this._turn;for(let s=0,i=n.length;s<i;s++)this._makeMove(n[s]),this._isKingAttacked(o)||(t-1>0?r+=this.perft(t-1):r++),this._undoMove();return r}turn(){return this._turn}board(){const t=[];let n=[];for(let r=D.a8;r<=D.h1;r++)this._board[r]==null?n.push(null):n.push({square:ge(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t}squareColor(t){if(t in D){const n=D[t];return(at(n)+Zt(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],r=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;t?r.push(new Xt(this,o)):r.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return r}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const n=this._positionCount.get(t)??0;n===1?this._positionCount.delete(t):this._positionCount.set(t,n-1)}_pruneComments(){const t=[],n={},r=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)t.push(this._undoMove());for(r(this.fen());;){const o=t.pop();if(!o)break;this._makeMove(o),r(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const o of[he,Qe])n[o]!==void 0&&(n[o]?this._castling[t]|=en[o]:this._castling[t]&=~en[o]);this._updateCastlingRights();const r=this.getCastlingRights(t);return(n[he]===void 0||n[he]===r[he])&&(n[Qe]===void 0||n[Qe]===r[Qe])}getCastlingRights(t){return{[he]:(this._castling[t]&en[he])!==0,[Qe]:(this._castling[t]&en[Qe])!==0}}moveNumber(){return this._moveNumber}}const Fh=["Pawn","Bishop","Knight","Rook","Queen","King"],Ss="♟",As="♜",$s="♞",Ts="♝",Is="♛",ur="♚",Ps="♙",Zs="♖",zs="♘",Os="♗",Rs="♕",hr="♔",Dh=ar("hidden"),Mh=cr("hidden"),Ns=e=>{const t=e.slice(0,2),n=e.slice(2,4),r=e[4];return{from:t,to:n,promotion:r}},zt=e=>e.split(" ").filter(t=>t.trim().length>0),vn=(e,t)=>{const n=new Cs;return(t===void 0?zt(e):zt(e).slice(0,t)).forEach(o=>n.move(Ns(o))),n.moves({verbose:!0}).map(o=>{n.move(o);const s=xs(o,n.isCheck(),n.isCheckmate());return n.undo(),s})},xs=(e,t,n)=>e.isKingsideCastle()?e.color=="w"?Yt("E1","H1",t,n):Yt("E8","H8",t,n):e.isQueensideCastle()?e.color=="w"?Yt("E1","A1",t,n):Yt("E8","A8",t,n):e.isEnPassant()?Ju(e.from.toUpperCase(),e.to.toUpperCase(),t,n):Qu(Tn(e.piece),e.from.toUpperCase(),e.to.toUpperCase(),e.isCapture()?Tn(e.captured):null,e.isPromotion()?Tn(e.promotion):null,t,n),Ls=e=>{const t=new Cs,n=[];for(const r of zt(e)){const o=t.move(Ns(r));n.push(xs(o,t.isCheck(),t.isCheckmate()))}return n},Uh=()=>{},bt=()=>{const e=I("lichess/game-state");return e?zt(e.moves).length%2===0?"white":"black":null},Fs=()=>{const e=Lt();return e?ws(e):null},Lt=()=>{const e=I("lichess/game-info");return e?e.color:null},oo=()=>{const e=I("lichess/game-state");return e?Ls(e.moves):[]},Ds=()=>I("lang")??"en",Ms=()=>gn(),jh=()=>"home";let Je={lang:null,screen:jh(),clock:null,input:Ms(),"input-san/file":null,"input-san/rank":null,started:!1,lockScreen:!1,online:!0,fullscreen:!1,ratedChallenge:!1,challengeColor:"random","lichess/host":"https://lichess.org","lichess/user":null,"lichess/stream-events":[],"lichess/challenges":[],"lichess/current-challenge":null,"lichess/my-challenge":null,"lichess/game-info":null,"lichess/game-state":null,"lichess/opponent":null,"lichess/following":[],"lichess/chat":null,"lichess/seek":null,"lichess/arena-created":[],"lichess/arena-started":[],"lichess/arena-join":null};const Us=["lang"],Kh=()=>Us.map(e=>{const t=localStorage.getItem(e);t!==null&&(Je[e]=JSON.parse(t))});Kh();let Ot=[];const ht=(e,t)=>{let n=I(e);Je[e]=t(n),Us.includes(e)&&localStorage.setItem(e,JSON.stringify(Je[e]));const r=Ot.filter(([o,s])=>o==e);for(const o of r){const s=o[1];s(e)}return e!=="clock"&&(console.groupCollapsed(e),console.debug("from",n),console.debug("to",Je[e]),console.debug("subscribers",r),console.groupEnd()),I(e)},qh=(e,t)=>Pe(n=>T(e,n))(t(I(e))),T=(e,t)=>ht(e,()=>t),I=e=>JSON.parse(JSON.stringify(Je[e])),gt=e=>Je[e],Gh=()=>Object.keys(Je),re=(...e)=>t=>Ot=Ot.concat(e.map(n=>[n,t])),Bh=e=>Ot=Ot.filter(([t,n])=>e(t));ah(document.location.hostname)&&Object.assign(window,{UcuiState:Je});const Wh=(e,t)=>Array.isArray(t)?t.map(n=>`${e}=${encodeURIComponent(n)}`).join("&"):`${e}=${encodeURIComponent(t)}`,fr=e=>Object.keys(e).map(t=>Wh(t,e[t])).join("&"),Hh=(e,t)=>`${e}?${fr(t)}`,Vh=(e="application/json")=>{const t=new Headers;return e!=="none"&&t.append("Content-Type",e),{mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},js=e=>(t,n,r)=>{const o={method:"GET",...Vh(),...r};return e(n,o).then(s=>{if(s.ok)return s.json();throw s}).then(s=>{try{return t.parse(s)}catch(i){throw console.error("Failed to parse obj from",n),console.error("=>",s),i}})},Qh=js(fetch),Ks=(e="application/x-www-form-urlencoded")=>{const t={};return e!=="none"&&(t["Content-Type"]=e),{method:"POST",mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},qs=e=>(t,n,r,o)=>{const s={method:"POST",...Ks(),...o};return typeof r=="string"?(s.headers["Content-Type"]="text/plain",s.body=r):s.body=fr(r),e(n,s).then(i=>{if(i.ok)return i.json();throw i}).then(i=>{try{return t.parse(i)}catch(l){throw console.error("Failed to parse obj from",n),console.error("=>",i),l}})},Jh=qs(fetch),De=Y([f("white"),f("black")]),Gs=Y([f("lobby"),f("friend"),f("ai"),f("api"),f("tournament"),f("position"),f("import"),f("importlive"),f("simul"),f("relay"),f("pool"),f("swiss"),f("arena")]),Yh=Y([Z({id:f(10),name:f("created")}),Z({id:f(20),name:f("started")}),Z({id:f(25),name:f("aborted")}),Z({id:f(30),name:f("mate")}),Z({id:f(31),name:f("resign")}),Z({id:f(32),name:f("stalemate")}),Z({id:f(33),name:f("timeout")}),Z({id:f(34),name:f("draw")}),Z({id:f(35),name:f("outoftime")}),Z({id:f(36),name:f("cheat")}),Z({id:f(37),name:f("noStart")}),Z({id:f(38),name:f("unknownFinish")}),Z({id:f(60),name:f("variantEnd")})]),bn=Y([f("ultraBullet"),f("bullet"),f("blitz"),f("rapid"),f("classical"),f("correspondence")]),Xh=Z({id:A(),username:A(),rating:Ie(),ratingDiff:Ie().optional()}),ef=Z({id:A().nullable(),username:A(),rating:Ie().optional(),ai:Ie()}),wn=Z({bot:q(),board:q()}),Ft=Y([f("standard"),f("chess960"),f("crazyhouse"),f("antichess"),f("atomic"),f("horde"),f("kingOfTheHill"),f("racingKings"),f("threeCheck"),f("fromPosition")]),Dt=Z({key:Ft,name:A(),short:A().optional()}),Bs=Z({id:A(),fullId:A(),gameId:A(),fen:A(),color:De,lastMove:A(),source:Gs,status:Yh,variant:Dt,speed:bn,perf:A(),rated:q(),hasMoved:q(),opponent:Y([Xh,ef]),isMyTurn:q(),secondsLeft:Ie().optional(),compat:wn,winner:De.optional(),ratingDiff:Ie().optional(),tournamentId:A().optional()}),tf=Z({type:f("gameStart"),game:Bs}),nf=Z({type:f("gameFinish"),game:Bs}),rf=Y([f("created"),f("offline"),f("canceled"),f("declined"),f("accepted")]),so=Z({id:A(),name:A(),rating:Ie(),title:A().nullable(),flair:A().optional(),patron:q().optional(),provisional:q().optional(),online:q().optional(),lag:Ie().optional()}),of=Z({type:f("clock"),limit:Ie(),increment:Ie(),show:A()}),sf=Z({type:f("correspondence"),daysPerTurn:Ie()}),af=Z({type:f("unlimited")}),cf=Y([of,sf,af]),ft=Z({id:A(),url:nu(),status:rf,challenger:so,destUser:so.nullable(),variant:Dt,rated:q(),speed:bn,timeControl:cf,color:Y([De,f("random")]),finalColor:De,perf:Z({icon:A(),name:A()}),direction:Y([f("in"),f("out")]).optional(),initialFen:A().optional()}),pr=Y([f("ultraBullet"),f("bullet"),f("blitz"),f("rapid"),f("classical"),f("correspondence"),f("chess960"),f("crazyhouse"),f("antichess"),f("atomic"),f("horde"),f("kingOfTheHill"),f("racingKings"),f("threeCheck")]),Ws=Y([f("created"),f("started"),f("aborted"),f("mate"),f("resign"),f("stalemate"),f("timeout"),f("draw"),f("outoftime"),f("cheat"),f("noStart"),f("unknownFinish"),f("variantEnd")]);Z({id:A(),fullId:A(),status:Z({id:M(),name:Ws}),variant:Dt,rated:q(),speed:bn,perf:pr,direction:Y([f("in"),f("out")]).optional(),fen:A().optional(),turns:M().optional(),source:Gs.optional(),createdAt:Ie().optional(),player:De.optional()});const lf=Z({type:f("challenge"),challenge:ft,compat:wn.optional()}),uf=Z({type:f("challengeCanceled"),challenge:ft,compat:wn.optional()}),hf=Y([f("generic"),f("later"),f("tooFast"),f("tooSlow"),f("timeControl"),f("rated"),f("casual"),f("standard"),f("variant"),f("noBot"),f("onlyBot")]),ff=ft.extend({declineReason:A(),declineReasonKey:hf}),pf=Z({type:f("challengeDeclined"),challenge:ff,compat:wn.optional()}),df=Y([tf,nf,lf,uf,pf]);Z({in:ft.array(),out:ft.array()});const Hs=Y([f("noAbort"),f("noRematch"),f("noGiveTime"),f("noClaimWin"),f("noEarlyDraw")]),gf=Z({rated:q(),"clock.limit":M(),"clock.increment":M(),color:Y([De,f("random")]),variant:Ft,fen:A().optional(),keepAliveStream:q(),rules:Hs.optional()});Z({time:M(),increment:M(),rated:q().optional(),color:Y([De,f("random")]),variant:Ft,ratingRange:A().optional()});const mf=Z({id:A()}),_f=Y([f(1),f(2),f(3),f(4),f(5),f(7),f(10),f(14)]),vf=Z({rated:q(),days:_f,color:Y([De,f("random")]),variant:Ft,fen:A().optional(),keepAliveStream:q(),rules:Hs.optional()});Y([gf,vf]);Z({"clock.limit":M(),"clock.increment":M(),color:Y([De,f("random")]),variant:Ft,fen:A().optional(),level:Y([f(1),f(2),f(3),f(4),f(5),f(6),f(7),f(8)])});const wt=Z({ok:q()}),bf=Z({initial:M(),increment:M()}),wf=Z({name:A()}),kn=Y([f("GM"),f("WGM"),f("IM"),f("WIM"),f("FM"),f("WFM"),f("NM"),f("CM"),f("WCM"),f("WNM"),f("LM"),f("BOT")]),kf=Z({id:A(),name:A(),title:kn.nullable(),rating:M().nullable(),provisional:q().optional()}),yf=Z({aiLevel:M()}),io=Y([kf,yf]),Vs=Z({type:f("gameState"),moves:A(),wtime:M(),btime:M(),winc:M(),binc:M(),status:Ws,winner:De.optional(),wdraw:q().optional(),bdraw:q().optional(),wtakeback:q().optional(),btakeback:q().optional()}),Ef=Z({type:f("gameFull"),id:A(),variant:Dt,clock:bf,speed:bn,perf:wf,rated:q(),createdAt:M(),white:io,black:io,initialFen:A(),state:Vs,tournamentId:A().optional()}),Cf=Z({type:f("chatLine"),room:Y([f("player"),f("spectator")]),username:A(),text:A()}),Sf=Z({type:f("opponentGone"),gone:q(),claimWinInSeconds:M()}),Af=Y([Vs,Ef,Cf,Sf]);Z({gameId:A(),move:A(),offeringDraw:q().optional()});const de=Z({games:M(),rating:M(),rd:M(),prog:M(),prov:q().optional()}),$f=Z({chess960:de.optional(),atomic:de.optional(),racingKings:de.optional(),ultraBullet:de.optional(),blitz:de.optional(),kingOfTheHill:de.optional(),threeCheck:de.optional(),antichess:de.optional(),crazyhouse:de.optional(),bullet:de.optional(),correspondence:de.optional(),horde:de.optional(),puzzle:de.optional(),classical:de.optional(),rapid:de.optional(),storm:de.optional(),racer:de.optional(),streak:de.optional()}),Tf=Z({flag:A().optional(),location:A().optional(),bio:A().optional(),realName:A().optional(),fideRating:M().optional(),uscfRating:M().optional(),ecfRating:M().optional(),cfcRating:M().optional(),rcfRating:M().optional(),dsbRating:M().optional(),links:A().optional()}),If=Z({total:M(),tv:M()}),Qs=Bn({id:A(),username:A(),url:A().optional(),perfs:$f.optional(),title:kn.optional(),flair:A().optional(),createdAt:M().optional(),disabled:q().optional(),tosViolation:q().optional(),profile:Tf.optional(),seenAt:M().optional(),playTime:If.optional(),patron:q().optional(),verified:q().optional()}),Pf=Z({id:A(),name:A(),flair:A().optional(),title:kn.optional(),online:q().optional(),playing:q().optional(),streaming:q().optional(),patron:q().optional()});Z({ids:A(),withSignal:q().optional(),withGameIds:q().optional(),withGameMetas:q().optional()});const Zf=Y([f(10),f(20),f(30)]),zf=Z({key:pr,name:A(),position:M(),icon:A().optional()}),ao=Z({perf:pr.optional(),rating:M()}),Of=Z({eco:A().optional(),name:A(),fen:A(),url:A().optional()}),Rf=Z({name:A(),fen:A()}),Nf=Y([Of,Rf]),xf=Z({id:A(),name:A(),flair:A().optional(),title:kn.optional(),patron:q().optional()}),Lf=Z({limit:M(),increment:M()}),xn=Z({id:A(),createdBy:A(),system:f("arena"),minutes:M(),clock:Lf,rated:q(),fullName:A(),nbPlayers:M(),variant:Dt,startsAt:M(),finishesAt:M(),status:Zf,perf:zf,secondsToStart:M().optional(),hasMaxRating:q().optional(),maxRating:ao.optional(),minRating:ao.optional(),minRatedGames:Z({nb:M()}).optional(),botsAllowed:q().optional(),minAccountAgeInDays:M().optional(),onlyTitled:q().optional(),teamMember:A().optional(),private:q().optional(),position:Nf.optional(),schedule:Bn({freq:A().optional(),speed:A().optional()}).optional(),teamBattle:Bn({teams:A().array().optional(),nbLeaders:M().optional()}).optional(),winner:xf.optional()}),Ff=Z({created:xn.array(),started:xn.array(),finished:xn.array()}),ye=e=>[I("lichess/host"),e].join("/api"),Df=(e,t)=>{const n=gt("lichess/user");if(n){const r=n.streamer(df,ye("/stream/event"));return r.onMessage(e),r.onClose(t),!0}return!1},Mf=(e,t)=>{const n=gt("lichess/user");return n?(n.streamer(Af,ye(`/board/game/stream/${e}`)).onMessage(t),!0):!1},Uf=(e,t)=>{const n=gt("lichess/user");if(n){const r=n.streamer(Qs,ye("/rel/following"));return r.onMessage(e),t&&r.onClose(t),!0}return!1},Js=(e=!1)=>{const t=gt("lichess/user");if(t)return js(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),Qh},Ke=(e=!1)=>{const t=gt("lichess/user");if(t)return qs(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),Jh},jf=e=>Ke()(wt,ye(`/challenge/${e}/accept`),{}),Kf=(e,t)=>Ke()(wt,ye(`/challenge/${e}/decline`),{reason:t}),qf=(e,t)=>Ke()(wt,ye(`/board/game/${e}/move/${t}`),{}),Ys=e=>Ke()(wt,ye(`/board/game/${e}/resign`),{}),an=(e,t)=>Ke()(wt,ye(`/board/game/${e}/draw/${t}`),{}),Xs=e=>Ke()(Qs.array(),ye("/users"),e).then(n=>{for(const r of n)if(r.id===e)return r;throw new Error("Failed to get a user with id: "+e)}),Gf=(e,t)=>Ke()(ft,ye(`/challenge/${e}`),t),Bf=e=>Ke()(ft,ye("/challenge/ai"),e),Wf=e=>Js()(Pf.array(),Hh(ye("/users/status"),{ids:e.join(",")})),Hf=()=>fetch([I("lichess/host"),"__ping"].join("/"),{mode:"no-cors",cache:"default",redirect:"follow",credentials:"same-origin"}),Vf=(e,t)=>{const n=gt("lichess/user");return n?new Promise((r,o)=>{n.streamer(mf,ye("/board/seek"),i=>{r(i)},{...Ks(),body:fr(e)}).onClose(t)}):Promise.reject("no-config")},Qf=()=>Js()(Ff,ye("/tournament")),Jf=e=>Ke()(wt,ye(`/tournament/${e}/join`),{pairMeAsap:!0}),Yf={"home/link-git":{en:"Source code & feedback",fr:"Code source & retours"},"home/connect":{en:"Connect",fr:"Connecter"},"home/challenges":{en:"Challenges",fr:"Défis"},"home/challenge-accept":{en:"Accept",fr:"Accepter"},"home/challenge-decline":{en:"Decline",fr:"Décliner"},"home/challenge-wait":{en:"Waiting to be challenged…",fr:"En attente d'un défi…"}},Xf={"button/home":{en:"Home",fr:"Accueil"},"button/players":{en:"Players",fr:"Partenaires"},"button/create":{en:"Create a game",fr:"Initier une partie"}},ep={"players/classic":{en:"Classic",fr:"Classique"},"players/rapid":{en:"Rapid",fr:"Rapide"},"players/username":{en:"Username",fr:"Bon d'utilisateurice"},"players/search":{en:"Search",fr:"Recherchez"},"players/find":{en:"Find player",fr:"Trouver un·e partenaire"},"players/ai":{en:"Play with Lichess AI",fr:"Jouer avec l'automate"},"players/ai-level":{en:"Level",fr:"Niveau"},"players/following":{en:"Players you follow",fr:"Les joueur·euses que vous suivez "}},tp={"end/aborted":{en:"Game has been aborted",fr:"La partie a été annulée"},"end/mate":{en:"Mate",fr:"Échec et mat"},"end/resign":{en:"Resigned",fr:"Abandon"},"end/stalemate":{en:"Stalemate",fr:"Pat"},"end/timeout":{en:"Flagged",fr:"Perdue au temps"},"end/outoftime":{en:"Flagged",fr:"Perdue au temps"},"end/draw":{en:"Draw",fr:"Partie nulle"},"end/cheat":{en:"Cheat!",fr:"Triche"},"end/noStart":{en:"Game didn't dtart",fr:"La partie n'a pas commencé"}},np={"challenge/rated":{en:"Rated",fr:"Classé"},"challenge/casual":{en:"Casual",fr:"Amical"}},rp={"home/tagline":{en:()=>Be(Ye("ucui","Téléchecs "),"is a ",Pt("",I("lichess/host")," Lichess")," client for players who prefer to play over the board."),fr:()=>Be(Ye("ucui","Téléchecs "),"est une interface à ",Pt("",I("lichess/host")," Lichess")," pour les joueuses et joueurs qui préfèrent jouer sur un échiquier.")},"home/description":{en:()=>u("",Be(`
            Connect this page with your Lichess account to create games or challenge players 
            from here.  
            `),Be(`
            Once a game starts, you'll be presented with a black 
            screen where you'll see your opponent moves when they play, 
            and an input widget to enter your moves when it's your turn.
            And that will be all of it. 
            `),Be("Enjoy!")),fr:()=>u("",Be(`
            Connectez cette page à votre compte Lichess pour commencer à jouer.  
            `),Be(`
            Lorsqu'une partie commence, les coups de l'adversaire 
            vous seront présentés de manière textuelle. 
            Et à votre tour de jouer, une interface de saisie 
            vous permettra de transmettre votre coup. 
            `),Be("Bonne partie!"))}},op={"clock/flagged":{en:"Flag",fr:"Tombé"}},sp={"arena/arena":{en:"Arenas",fr:"Arènes"},"arena/created":{en:"Created",fr:"À venir"},"arena/started":{en:"Started",fr:"En cours"},"arena/join":{en:"Join",fr:"Rejoindre"},"arena/waiting":{en:"Waiting to be paired",fr:"En attente d'appariement"},"arena/leave":{en:"Leave arena",fr:"Se retirer"}},ip={...Yf,...Xf,...ep,...tp,...np,...op,...sp},ap={...rp},W=e=>ip[e][Ds()],co=e=>ap[e][Ds()](),cp=()=>{const e=document.location,n=new URL(e.href).searchParams.get("lang");if(n){try{const r=Qr.parse(n);T("lang",r)}catch{console.error("Failed to recognize lang",n)}return}if(I("lang")===null){try{const r=Qr.parse(navigator.language.split("-")[0]);T("lang",r)}catch{console.error("Failed to set lang from navigator",navigator.language)}return}},ei=e=>{const t=I("lichess/game-info"),n=I("lichess/game-state");if(ti(),t&&n&&n.status==="started"){const r=window.setInterval(e,500);T("clock",{interval:r,gameId:t.gameId})}},ti=()=>{const e=I("clock");e&&(clearInterval(e.interval),T("clock",null))},lp=e=>{const t=I("clock"),n=I("lichess/game-state");!n&&t?ti():n&&n.status==="started"&&!t&&ei(e)},up=e=>{const t=u("time white active","--:--"),n=u("time black","--:--");e.append(u("clock",t,n)),Ln({white:t,black:n}),fo({white:t,black:n}),re("lichess/game-state")(()=>{lp(()=>Ln({white:t,black:n})),fo({white:t,black:n})}),ei(()=>{Ln({white:t,black:n})})},lo="--:--",hp=()=>u("flag",W("clock/flagged")),fp=()=>{const e=I("lichess/game-info"),t=I("lichess/game-state"),n=bt();if(t&&e&&n){if(zt(t.moves).length<2)return{white:tn(t.wtime),black:tn(t.btime)};const r=Date.now()-t.timestamp,o=n==="white"?t.wtime-r:t.wtime,s=n==="black"?t.btime-r:t.btime;return{white:tn(o),black:tn(s)}}else return{white:lo,black:lo}},Ln=({white:e,black:t})=>{const n=te(e),r=te(t),o=fp();n(o.white),r(o.black)},{floor:Fn}=Math,tn=e=>{if(e<=0)return hp();const t=e/1e3,n=Fn(t%60),r=Fn(t/60%60),o=Fn(t/60/60),s=n<10?`0${n.toFixed(0)}`:`${n.toFixed(0)}`,i=r<10?`0${r.toFixed(0)}`:`${r.toFixed(0)}`,l=o<10?`0${o.toFixed(0)}`:`${o.toFixed(0)}`;return t>=3600?`${l}:${i}:${s}`:`${i}:${s}`},pp=cr("active"),dp=ar("active"),uo=fh("active"),ho=(e,t)=>t&&!uo(e)?dp(e):!t&&uo(e)?pp(e):void 0,fo=({white:e,black:t})=>{const n=bt();ho(e,n=="white"),ho(t,n=="black")},Dn=(e,t=null,n=null,r,o,s=null)=>({_tag:"Normal",role:e,capture:r,to:o,rank:n,file:t,promotion:s}),po=e=>({_tag:"Castle",side:e}),gp=(e,t,n)=>e.filter(r=>{switch(r._tag){case"Castle":return!1;case"EnPassant":return t=="Pawn"&&r.to===n;default:return n===r.to&&t===r.role}}),mp=(e,t)=>{switch(e._tag){case"Normal":{if(e.role==="Pawn")return Dn("Pawn",e.capture!==null?Ve(e.from):null,null,e.capture!==null,e.to,e.promotion);{let n=!1,r=!1,o=!1;for(const s of t)s._tag==="Normal"&&e.from!=s.from&&e.role==s.role&&e.to==s.to&&e.promotion==s.promotion&&(n=!0,In(e.from)==In(s.from)&&(o=!0),Ve(e.from)==Ve(s.from)&&(r=!0));return Dn(e.role,n&&(!r||o)?Ve(e.from):null,r?In(e.from):null,e.capture!==null,e.to,e.promotion)}}case"EnPassant":return Dn("Pawn",Ve(e.from),null,!0,e.to,null);case"Castle":return Ve(e.rook)<Ve(e.king)?po("QueenSide"):po("KingSide")}},go=e=>{switch(e){case"Pawn":return"P";case"Rook":return"R";case"Knight":return"N";case"Bishop":return"B";case"Queen":return"Q";case"King":return"K"}},mo=(e,t)=>{switch(e){case"Pawn":return t==="white"?Ps:Ss;case"Rook":return t==="white"?Zs:As;case"Knight":return t==="white"?zs:$s;case"Bishop":return t==="white"?Os:Ts;case"Queen":return t==="white"?Rs:Is;case"King":return t==="white"?hr:ur}},_p=(e,t)=>{let n=[];return t._tag==="Normal"&&t.role!=="Pawn"&&(n=gp(e,t.role,t.to)),mp(t,n)},vp={symbol:!1,color:"white"},ni={symbol:!0,color:"white"},bp=(e,t,{symbol:n,color:r})=>{const o=[];switch(t._tag){case"Normal":{t.role!=="Pawn"&&o.push(n?mo(t.role,r):go(t.role)),t.file!==null&&o.push(t.file.toLowerCase()),t.rank!==null&&o.push(t.rank),t.capture&&o.push("x"),o.push(t.to.toLowerCase()),t.promotion!==null&&o.push("=",n?mo(t.promotion,r):go(t.promotion));break}case"Castle":{t.side==="KingSide"?o.push("O","-","O"):o.push("O","-","O","-","O");break}case"null":o.push("--")}return e.checkmate?o.push("#"):e.check&&o.push("+"),o.join("")},dr=(e,t,n=vp)=>bp(e,_p(t,e),n),_o=(e,t)=>{const n=I("lichess/game-info"),r=I("lichess/game-state"),o=bt(),s=Lt();if(n&&r&&o&&s){const i=te(t);if(te(e)(Ye("name",n.opponent.username)),o===s){const a=Ls(r.moves),p=a.pop();if(p){const c=dr(p,vn(r.moves,a.length),ni);i(c)}else i(u("idle",`Your turn to play ${o}`))}else i(u("opponent-think","…"))}},wp=e=>{const t=u("info"),n=u("state");_o(t,n);const r=u("engine",t,n);e.append(r),re("lichess/game-state")(()=>_o(t,n))},kp="/telechecs/",yp=(...e)=>{var t="/",n=new RegExp(t+"{1,}","g");return e.join(t).replace(n,t)},ri=(...e)=>yp(kp,...e),Ep=ri("chess.ogg"),oi=dt(_h("-",Ep),e=>e("preload","auto"));document.body.append(oi);const Cp=()=>{oi.play()},Sp=e=>(T("input",gn()),T("lichess/game-state",xt(e.state)),T("started",!0),!0),Ap=e=>(T("input",gn()),T("lichess/game-state",xt(e)),Lt()===bt()&&Cp(),!0),$p=e=>(T("lichess/chat",xt(e)),!0),Tp=e=>{switch(e.type){case"gameFull":return Sp(e);case"gameState":return Ap(e);case"chatLine":return $p(e);case"opponentGone":return!0}},Ip=e=>Mf(e,Tp),Pp=e=>{const t=I("lichess/game-info");t&&qf(t.gameId,Xu(e))},Zp=e=>T("input-san/file",e),zp=e=>T("input-san/rank",e),gr=()=>{T("input-san/file",null),T("input-san/rank",null)},vo=(e,t)=>{switch(e){case"Pawn":return t==="black"?Ss:Ps;case"Rook":return t==="black"?As:Zs;case"Knight":return t==="black"?$s:zs;case"Bishop":return t==="black"?Ts:Os;case"Queen":return t==="black"?Is:Rs;case"King":return t==="black"?ur:hr}},Op=(e,t)=>t.some(n=>{switch(n._tag){case"Normal":return n.role===e;case"Castle":return e==="King";case"EnPassant":return e==="Pawn"}}),bo=e=>e?"selected":"",wo=(e,t)=>Fh.map(n=>Op(n,t)?me(u(`piece ${n}  ${bo(e===n)}`,vo(n,"black")),r=>r("click",()=>{gr(),e===n?T("input",Ms()):T("input",eh(n))})):u(`piece ${n}  ${bo(e===n)}`,vo(n,"white"))),Rp=e=>{gr(),T("input",nh(e)),Pp(e)},Np=e=>t=>e.filter(n=>{switch(n._tag){case"Castle":{switch(t){case"G1":return n.king==="E1"&&n.rook=="H1";case"C1":return n.king==="E1"&&n.rook=="A1";case"G8":return n.king==="E8"&&n.rook=="H8";case"C8":return n.king==="E8"&&n.rook=="A8"}return!1}case"Normal":case"EnPassant":return n.to===t}}),xp=e=>t=>me(u("move",dr(t,vn(e.moves),{symbol:!0,color:"black"})),n=>n("click",()=>{T("input-san/file",null),Rp(t)})),Lp=e=>{const t=I("lichess/game-state");return t?e.map(xp(t)):[]},Fp=(e,t,n)=>{const r=new Set(n.map(bs).map(Ve));return Wu.map(o=>o===t?u(`button-select file file-${o} selected`,o.toLowerCase()):r.has(o)?me(u(`button-select file file-${o} candidate`,o.toLowerCase()),s=>s("click",()=>{gr(),T("input",{_tag:"role",role:un(e)}),Zp(o)})):u(`button-select file file-${o} nothing`,o.toLowerCase()))},Dp=(e,t,n)=>{const r=Np(n.filter(o=>sr(o)===un(e)));return Hu.map(o=>{if(t===null)return u(`button-select rank rank-${o} nothing`,o.toLowerCase());const s=Vu(t,o),i=r(s);return i.length===0?u(`button-select rank rank-${o} nothing`,o.toLowerCase()):o===I("input-san/rank")?u(`button-select rank rank-${o} selected`,o.toLowerCase()):me(u(`button-select rank rank-${o} candidate`,o.toLowerCase()),l=>l("click",()=>{zp(o);const a=un(e);a&&T("input",th(a,i))}))})},Mp=(e,t)=>{const n=e._tag==="candidates"?e.candidates:[],r=n.length===0?u("select hidden"):u("select",...Lp(n)),o=I("input-san/file"),s=u("square-select files",...Fp(e,o,t)),i=u("square-select ranks",...Dp(e,o,t));return[r,i,s]},Up=e=>{const t=u("pieces"),n=u("moves"),r=u("input input-san",n,t);e.append(r);const o=()=>{const s=I("lichess/game-state");if(s&&bt()===Lt()){const i=te(t),l=te(n),a=I("input"),p=vn(s.moves);if(a._tag!=="none"&&p.length>0){const c=un(a);i(...wo(c,p)),l(...Mp(a,p.filter(k=>sr(k)===c))),Mh(n)}else i(...wo(null,p)),Te(n),Dh(n)}else Te(n),Te(t)};re("lichess/game-state","lichess/game-info","input","input-san/file","input-san/rank")(o),o()},_e=(e,t)=>({name:e,className:t??e}),jp=e=>(typeof e=="string"?e:e.className).toLowerCase().split(" ").join("-"),Kp=e=>typeof e=="string"||e instanceof HTMLElement?e:e.name,ue=(e,t)=>me(u(`button button-${jp(e)}`,Kp(e)),n=>n("click",t)),yn=(e,t)=>ue(t,()=>T("screen",e)),Mt=()=>yn("home",W("button/home")),qp=()=>yn("seek",W("button/create"));let Qn=null;const Gp=e=>Qn=e,hn=e=>{Qn!==null&&(e?Qn.requestFullscreen().then(()=>T("fullscreen",!0)).catch(t=>console.warn("failed to enter fullscreen",t)):document.exitFullscreen().then(()=>T("fullscreen",!1)).catch(t=>console.warn("failed to exit fullscreen",t)))},Bp=e=>{T("lichess/current-challenge",e),T("lichess/challenges",[]),T("input",gn()),jf(e.id)},Wp=e=>{ht("lichess/challenges",t=>t.filter(n=>n.id!==e.id)),Kf(e.id,"generic")},Hp=e=>{const t=u("lock locked"),n=ar("locked"),r=cr("locked"),o=()=>I("lockScreen")?n(t):r(t);re("lockScreen")(o),o(),e.append(t)},ko="⛶",Mn="½",Vp="⚐",Qp="1.",Jp=()=>I("fullscreen")?ue(_e(ko,"fullscreen-off"),()=>hn(!1)):ue(_e(ko,"fullscreen-on"),()=>hn(!0)),Yp=e=>{const t=Lt(),n=Fs();if(e&&t&&n){if(t==="white"&&e.wdraw||t==="black"&&e.bdraw)return"me";if(n==="white"&&e.wdraw||n==="black"&&e.bdraw)return"other"}return"none"},Xp=(e,t)=>{switch(Yp(e)){case"me":return ue(_e(Mn,"draw-waiting"),Uh);case"other":return u("draw-answer",u("icon",Mn),ue(_e("Accept","draw-accept"),()=>an(t.fullId,"yes")),ue(_e("Decline","draw-decline"),()=>{an(t.fullId,"no"),ht("lichess/game-state",n=>n&&{...n,bdraw:!1,wdraw:!1})}));case"none":return ue(_e(Mn,"draw-offer"),()=>an(t.fullId,"yes"))}},ed=e=>ue(_e(Vp,"resign"),()=>Ys(e.fullId)),td=(...e)=>{const t=u("anti-slip on",...e);let n=null;return t.addEventListener("click",()=>{n||(t.classList.remove("on"),n=window.setTimeout(()=>{n=null,t.classList.add("on")},6e3))}),t},nd=e=>{const t=u("game-actions actions-view"),n=u("game-actions actions-game"),r=()=>{const o=I("lichess/game-state"),s=I("lichess/game-info");te(t)(Jp(),yn("movelist",Qp)),o&&s?te(n)(td(Xp(o,s),ed(s))):Te(n)};r(),e.append(t,n),re("lichess/game-info","lichess/game-state","fullscreen")(r)},rd=e=>{wp(e),nd(e),Up(e),up(e),Hp(e)};var Ce={},yo;function od(){return yo||(yo=1,function(e){var t=Ce&&Ce.__extends||function(){var b=function(d,y){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,z){$.__proto__=z}||function($,z){for(var P in z)z.hasOwnProperty(P)&&($[P]=z[P])},b(d,y)};return function(d,y){b(d,y);function $(){this.constructor=d}d.prototype=y===null?Object.create(y):($.prototype=y.prototype,new $)}}(),n=Ce&&Ce.__assign||function(){return n=Object.assign||function(b){for(var d,y=1,$=arguments.length;y<$;y++){d=arguments[y];for(var z in d)Object.prototype.hasOwnProperty.call(d,z)&&(b[z]=d[z])}return b},n.apply(this,arguments)},r=Ce&&Ce.__awaiter||function(b,d,y,$){function z(P){return P instanceof y?P:new y(function(V){V(P)})}return new(y||(y=Promise))(function(P,V){function H(J){try{F($.next(J))}catch(fe){V(fe)}}function ee(J){try{F($.throw(J))}catch(fe){V(fe)}}function F(J){J.done?P(J.value):z(J.value).then(H,ee)}F(($=$.apply(b,d||[])).next())})},o=Ce&&Ce.__generator||function(b,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},$,z,P,V;return V={next:H(0),throw:H(1),return:H(2)},typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function H(F){return function(J){return ee([F,J])}}function ee(F){if($)throw new TypeError("Generator is already executing.");for(;y;)try{if($=1,z&&(P=F[0]&2?z.return:F[0]?z.throw||((P=z.return)&&P.call(z),0):z.next)&&!(P=P.call(z,F[1])).done)return P;switch(z=0,P&&(F=[F[0]&2,P.value]),F[0]){case 0:case 1:P=F;break;case 4:return y.label++,{value:F[1],done:!1};case 5:y.label++,z=F[1],F=[0];continue;case 7:F=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(F[0]===6||F[0]===2)){y=0;continue}if(F[0]===3&&(!P||F[1]>P[0]&&F[1]<P[3])){y.label=F[1];break}if(F[0]===6&&y.label<P[1]){y.label=P[1],P=F;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(F);break}P[2]&&y.ops.pop(),y.trys.pop();continue}F=d.call(b,y)}catch(J){F=[6,J],z=0}finally{$=P=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}},s=Ce&&Ce.__spreadArrays||function(){for(var b=0,d=0,y=arguments.length;d<y;d++)b+=arguments[d].length;for(var $=Array(b),z=0,d=0;d<y;d++)for(var P=arguments[d],V=0,H=P.length;V<H;V++,z++)$[z]=P[V];return $};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function b(){}return b.prototype.toString=function(){return"ErrorOAuth2"},b}();e.ErrorOAuth2=i;var l=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnknown"},d}(i);e.ErrorUnknown=l;var a=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorNoAuthCode"},d}(i);e.ErrorNoAuthCode=a;var p=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidReturnedStateParam"},d}(i);e.ErrorInvalidReturnedStateParam=p;var c=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidJson"},d}(i);e.ErrorInvalidJson=c;var k=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidScope"},d}(i);e.ErrorInvalidScope=k;var m=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidRequest"},d}(i);e.ErrorInvalidRequest=m;var C=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidToken"},d}(i);e.ErrorInvalidToken=C;var E=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAuthenticationGrant"},d}(i);e.ErrorAuthenticationGrant=E;var j=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnauthorizedClient"},d}(E);e.ErrorUnauthorizedClient=j;var K=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessDenied"},d}(E);e.ErrorAccessDenied=K;var G=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedResponseType"},d}(E);e.ErrorUnsupportedResponseType=G;var N=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorServerError"},d}(E);e.ErrorServerError=N;var U=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorTemporarilyUnavailable"},d}(E);e.ErrorTemporarilyUnavailable=U;var Q=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessTokenResponse"},d}(i);e.ErrorAccessTokenResponse=Q;var Ze=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidClient"},d}(Q);e.ErrorInvalidClient=Ze;var Me=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidGrant"},d}(Q);e.ErrorInvalidGrant=Me;var Xe=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedGrantType"},d}(Q);e.ErrorUnsupportedGrantType=Xe;var mt=function(){function b(){this.realm="",this.error=""}return b}();e.ErrorWWWAuthenticate=mt,e.RawErrorToErrorClassMap={invalid_request:m,invalid_grant:Me,unauthorized_client:j,access_denied:K,unsupported_response_type:G,invalid_scope:k,server_error:N,temporarily_unavailable:U,invalid_client:Ze,unsupported_grant_type:Xe,invalid_json:c,invalid_token:C};function et(b){return new(e.RawErrorToErrorClassMap[b]||l)}e.toErrorClass=et;function Ut(b){var d=b.slice(7).replace(/"/g,"").split(", ").map(function(y){var $,z=y.split("="),P=z[0],V=z[1];return $={},$[P]=V,$}).reduce(function(y,$){return n(n({},y),$)},{});return{realm:d.realm,error:d.error}}e.fromWWWAuthenticateHeaderStringToObject=Ut;var En="Authorization",kt="WWW-Authenticate";e.LOCALSTORAGE_ID="oauth2authcodepkce",e.LOCALSTORAGE_STATE=e.LOCALSTORAGE_ID+"-state",e.RECOMMENDED_CODE_VERIFIER_LENGTH=96,e.RECOMMENDED_STATE_LENGTH=32;var tt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",jt=function(){function b(d){return this.state={},this.config=d,this.recoverState(),this}return b.prototype.decorateFetchHTTPClient=function(d){var y=this;return function($,z){for(var P=[],V=2;V<arguments.length;V++)P[V-2]=arguments[V];return y.state.isHTTPDecoratorActive?y.getAccessToken().then(function(H){var ee=H.token,F=Object.assign({},z);return F.headers||(F.headers={}),F.headers[En]="Bearer "+ee.value,d.apply(void 0,s([$,F],P))}).then(function(H){if(H.ok||!H.headers.has(kt.toLowerCase()))return H;var ee=et(Ut(H.headers.get(kt.toLowerCase())).error);return ee instanceof C&&y.config.onAccessTokenExpiry(function(){return y.exchangeRefreshTokenForAccessToken()}),Promise.reject(ee)}):d.apply(void 0,s([$,z],P))}},b.prototype.isReturningFromAuthServer=function(){var d=b.extractParamFromUrl(location.href,"error");if(d)return Promise.reject(et(d));var y=b.extractParamFromUrl(location.href,"code");if(!y)return Promise.resolve(!1);var $=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),z=b.extractParamFromUrl(location.href,"state");return z!==$.stateQueryParam?(console.warn("state query string parameter doesn't match the one sent! Possible malicious activity somewhere."),Promise.reject(new p)):($.authorizationCode=y,$.hasAuthCodeBeenExchangedForAccessToken=!1,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify($)),this.setState($),Promise.resolve(!0))},b.prototype.fetchAuthorizationCode=function(d){return r(this,void 0,void 0,function(){var y,$,z,P,V,H,ee,F,J,fe,ze;return o(this,function(Ne){switch(Ne.label){case 0:return this.assertStateAndConfigArePresent(),y=this.config,$=y.clientId,z=y.extraAuthorizationParams,P=y.redirectUrl,V=y.scopes,[4,b.generatePKCECodes()];case 1:return H=Ne.sent(),ee=H.codeChallenge,F=H.codeVerifier,J=b.generateRandomState(e.RECOMMENDED_STATE_LENGTH),this.state=n(n({},this.state),{codeChallenge:ee,codeVerifier:F,stateQueryParam:J,isHTTPDecoratorActive:!0}),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state)),fe=this.config.authorizationUrl+"?response_type=code&"+("client_id="+encodeURIComponent($)+"&")+("redirect_uri="+encodeURIComponent(P)+"&")+("scope="+encodeURIComponent(V.join(" "))+"&")+("state="+J+"&")+("code_challenge="+encodeURIComponent(ee)+"&")+"code_challenge_method=S256",(z||d)&&(ze=n(n({},z),d),fe=fe+"&"+b.objectToQueryString(ze)),location.replace(fe),[2]}})})},b.prototype.getAccessToken=function(){var d=this;this.assertStateAndConfigArePresent();var y=this.config.onAccessTokenExpiry,$=this.state,z=$.accessToken,P=$.authorizationCode,V=$.explicitlyExposedTokens,H=$.hasAuthCodeBeenExchangedForAccessToken,ee=$.refreshToken,F=$.scopes;return P?this.authCodeForAccessTokenRequest?this.authCodeForAccessTokenRequest:!this.isAuthorized()||!H?(this.authCodeForAccessTokenRequest=this.exchangeAuthCodeForAccessToken(),this.authCodeForAccessTokenRequest):ee&&this.isAccessTokenExpired()?y(function(){return d.exchangeRefreshTokenForAccessToken()}):Promise.resolve({token:z,explicitlyExposedTokens:V,scopes:F,refreshToken:ee}):Promise.reject(new a)},b.prototype.exchangeRefreshTokenForAccessToken=function(){var d=this,y;this.assertStateAndConfigArePresent();var $=this.config,z=$.extraRefreshParams,P=$.clientId,V=$.tokenUrl,H=this.state.refreshToken;H||console.warn("No refresh token is present.");var ee=V,F="grant_type=refresh_token&"+("refresh_token="+((y=H)===null||y===void 0?void 0:y.value)+"&")+("client_id="+P);return z&&(F=ee+"&"+b.objectToQueryString(z)),fetch(ee,{method:"POST",body:F,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(J){return J.status>=400?J.json().then(function(fe){return Promise.reject(fe)}):J.json()}).then(function(J){var fe=J.access_token,ze=J.expires_in,Ne=J.refresh_token,nt=J.scope,qe=d.config.explicitlyExposedTokens,ve=[],xe={},rt={value:fe,expiry:new Date(Date.now()+parseInt(ze)*1e3).toString()};if(d.state.accessToken=rt,Ne){var _t={value:Ne};d.state.refreshToken=_t}qe&&(xe=Object.fromEntries(qe.map(function(Oe){return[Oe,J[Oe]]}).filter(function(Oe){Oe[0];var Ge=Oe[1];return Ge!==void 0})),d.state.explicitlyExposedTokens=xe),nt&&(ve=nt.split(" "),d.state.scopes=ve),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d.state));var Le={token:rt,scopes:ve};return qe&&(Le.explicitlyExposedTokens=xe),Le}).catch(function(J){var fe=d.config.onInvalidGrant,ze=J.error||"There was a network error.";switch(ze){case"invalid_grant":fe(function(){return d.fetchAuthorizationCode()});break}return Promise.reject(et(ze))})},b.prototype.getGrantedScopes=function(){return this.state.scopes},b.prototype.isHTTPDecoratorActive=function(d){this.state.isHTTPDecoratorActive=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state))},b.prototype.isAuthorized=function(){return!!this.state.accessToken},b.prototype.isAccessTokenExpired=function(){var d=this.state.accessToken;return!!(d&&new Date>=new Date(d.expiry))},b.prototype.reset=function(){this.setState({}),this.authCodeForAccessTokenRequest=void 0},b.prototype.assertStateAndConfigArePresent=function(){if(!this.state||!this.config)throw console.error("state:",this.state,"config:",this.config),new Error("state or config is not set.")},b.prototype.exchangeAuthCodeForAccessToken=function(d){var y=this;this.assertStateAndConfigArePresent();var $=this.state,z=$.authorizationCode,P=z===void 0?d:z,V=$.codeVerifier,H=V===void 0?"":V,ee=this.config,F=ee.clientId,J=ee.onInvalidGrant,fe=ee.redirectUrl;H?P||console.warn("No authorization grant code is being passed."):console.warn("No code verifier is being sent.");var ze=this.config.tokenUrl,Ne="grant_type=authorization_code&"+("code="+encodeURIComponent(P||"")+"&")+("redirect_uri="+encodeURIComponent(fe)+"&")+("client_id="+encodeURIComponent(F)+"&")+("code_verifier="+H);return fetch(ze,{method:"POST",body:Ne,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(nt){var qe=nt.json().catch(function(ve){return{error:"invalid_json"}});return nt.ok?qe.then(function(ve){var xe=ve.access_token,rt=ve.expires_in,_t=ve.refresh_token,Le=ve.scope,Oe=y.config.explicitlyExposedTokens,Ge=[],yt={};y.state.hasAuthCodeBeenExchangedForAccessToken=!0,y.authCodeForAccessTokenRequest=void 0;var Kt={value:xe,expiry:new Date(Date.now()+parseInt(rt)*1e3).toString()};if(y.state.accessToken=Kt,_t){var Cn={value:_t};y.state.refreshToken=Cn}Oe&&(yt=Object.fromEntries(Oe.map(function(ot){return[ot,ve[ot]]}).filter(function(ot){ot[0];var Gt=ot[1];return Gt!==void 0})),y.state.explicitlyExposedTokens=yt),Le&&(Ge=Le.split(" "),y.state.scopes=Ge),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(y.state));var qt={token:Kt,scopes:Ge};return Oe&&(qt.explicitlyExposedTokens=yt),qt}):qe.then(function(ve){var xe=ve.error;switch(xe){case"invalid_grant":J(function(){return y.fetchAuthorizationCode()});break}return Promise.reject(et(xe))})})},b.prototype.recoverState=function(){return this.state=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),this},b.prototype.setState=function(d){return this.state=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d)),this},b.base64urlEncode=function(d){var y=btoa(d);return y=y.replace(/\+/g,"-"),y=y.replace(/\//g,"_"),y=y.replace(/=/g,""),y},b.extractParamFromUrl=function(d,y){var $=d.split("?");if($.length<2)return"";$=$[1].split("#");var z=$[0].split("&").reduce(function(V,H){return V.concat(H.split("="))},[]);if(z.length<2)return"";var P=z.indexOf(y);return decodeURIComponent(P>=0?z[P+1]:"")},b.objectToQueryString=function(d){return Object.entries(d).map(function(y){var $=y[0],z=y[1];return $+"="+encodeURIComponent(z)}).join("&")},b.generatePKCECodes=function(){var d=new Uint32Array(e.RECOMMENDED_CODE_VERIFIER_LENGTH);crypto.getRandomValues(d);var y=b.base64urlEncode(Array.from(d).map(function($){return tt[$%tt.length]}).join(""));return crypto.subtle.digest("SHA-256",new TextEncoder().encode(y)).then(function($){for(var z=new Uint8Array($),P="",V=z.byteLength,H=0;H<V;H++)P+=String.fromCharCode(z[H]);return P}).then(b.base64urlEncode).then(function($){return{codeChallenge:$,codeVerifier:y}})},b.generateRandomState=function(d){var y=new Uint32Array(d);return crypto.getRandomValues(y),Array.from(y).map(function($){return tt[$%tt.length]}).join("")},b}();e.OAuth2AuthCodePKCE=jt}(Ce)),Ce}var sd=od();const id=new RegExp(`
`),ad=(e,t,n,r,o)=>e(n,o).then(s=>s.body).then(s=>{if(s==null)throw new Error("Response body is NULL");const i=s.getReader();return r&&r(()=>{i.cancel()}),new ReadableStream({start(l){const a=new TextDecoder,p=()=>{i.read().then(({done:c,value:k})=>{if(c){console.log("done",c),l.close();return}a.decode(k).split(id).map(C=>{if(C.trim().length>0)try{const j=JSON.parse(C),K=t.parse(j);console.log("stream",K),l.enqueue(K)}catch{console.error(`[${n}] Failed to make an object out of chunk:`,C)}}),p()})};p()}}).getReader()}),cd=e=>(t,n,r,o)=>{const s=[],i=[];let l=[];const a=C=>{const E=()=>{C.read().then(({done:j,value:K})=>{k(Ue(K)),j?m():setTimeout(E,0)}).catch(m)};E()},p=C=>{l.length>0&&(l.forEach(C),l=[]),s.push(C)},c=C=>{i.push(C)},k=Pe(C=>{s.length>0?s.find(E=>!E(C)):l.push(C)}),m=()=>{i.forEach(C=>C())};return ad(e,t,n,r,o).then(a).catch(()=>setTimeout(m,200)),{onMessage:p,onClose:c}},ld=["board:play","challenge:read","follow:read","tournament:write"],ud=`ucui-${location.host}`,Eo=`${location.protocol}//${location.host}${ri()}`,hd=()=>{const e=I("lichess/host");let t=null;const n=new sd.OAuth2AuthCodePKCE({authorizationUrl:`${e}/oauth`,tokenUrl:`${e}/api/token`,clientId:ud,scopes:ld,redirectUrl:Eo,onAccessTokenExpiry:a=>a(),onInvalidGrant:console.warn}),r=async()=>{try{await n.getAccessToken()&&await i()}catch(a){console.error(a)}if(!t)try{await n.isReturningFromAuthServer()&&(await i(),history.replaceState({auth:!0},"authenticate",Eo))}catch(a){console.error(a)}},o=async()=>{await n.fetchAuthorizationCode()},s=async()=>{t&&await t.httpClient(`${e}/api/token`,{method:"DELETE"}),localStorage.clear(),t=null},i=async()=>{const a=n.decorateFetchHTTPClient(window.fetch),c={...await(await a(`${e}/api/account`)).json(),httpClient:a,streamer:cd(a)};if(c.error)throw c.error;t=c};return{init:r,login:o,logout:s,user:()=>Pe(a=>({id:a.id,username:a.username,streamer:a.streamer,httpClient:a.httpClient}))(Ue(t))}},ct=hd();ct.init().then(()=>{Pe(t=>T("lichess/user",t))(ct.user())});let nn=!1;const si=()=>{nn||(nn=!0,I("lichess/user")?(T("online",!0),Df(t=>(ht("lichess/stream-events",n=>n.concat(t)),!0),()=>{nn=!1,T("online",!1),window.setTimeout(si,2e4)})):nn=!1)},fd=()=>me(u("button button-login",W("home/connect")),e=>e("click",async()=>{const t=Bo(()=>{ct.login().then(()=>{n(ct.user())})}),n=Pe(r=>{T("lichess/user",r)});cn(ct.user(),n,t)})),pd=()=>me(u("button button-logout","×"),e=>e("click",()=>ct.logout().then(()=>T("lichess/user",null)))),dd=e=>t=>{si(),Te(e),e.append(u("user",u("username",Pt("",`${I("lichess/host")}/@/${t.id}`,t.username)),pd()))},gd=e=>()=>{Te(e),e.append(fd())},md=e=>{const t=Pe(dd(e)),n=Bo(gd(e)),r=re("lichess/user"),o=()=>{cn(ct.user(),t,n)};r(o),o()},Co=e=>{Uf(t=>(ht("lichess/following",n=>n.filter(r=>r.id!==t.id).concat(t)),!1),async()=>{const t=await Wf(I("lichess/following").map(n=>n.id));for(const n of t){const r=e.querySelector(`[data-id="${n.id}"]`);r&&(n.online?r.classList.add("online"):r.classList.remove("online"))}})},_d=Pe(({classical:e,rapid:t})=>u("perfs",u("classical",`${W("players/classic")}: ${e?e.rating:"?"}`),u("rapid",`${W("players/rapid")}: ${t?t.rating:"?"}`))),vd=e=>me(u("result",u("username",e.username),_d(Ue(e.perfs))),t=>t("click",()=>{T("lichess/opponent",e),T("screen","challenge")})),bd=()=>{const e=dt(gh("","search"),r=>r("placeholder",W("players/username"))),t=u("results"),n=me(u("button submit",W("players/search")),r=>r("click",()=>{const o=e.value;Xs(o).then(s=>te(t)(vd(s)))}));return u("lookup",u("section",u("title",W("players/find"))),u("search-block",e,n),t)},So=e=>dt(u("user",me(u("username",e.username),t=>t("click",()=>{T("lichess/opponent",e),T("screen","challenge")})),u("activity")),t=>t("data-id",e.id)),wd=e=>me(u(`level level-${e}`,`${e}`),t=>t("click",()=>{T("lichess/opponent",{_tag:"lichess-ai",level:e}),T("screen","challenge")})),kd=[1,2,3,4,5,6,7,8],yd=()=>u("user lichess-ai",u("section",W("players/ai")),u("levels",u("label",W("players/ai-level")),...kd.map(wd))),ii=e=>{const t=u("users",...I("lichess/following").map(So)),n=ue(_e("↻","refresh"),()=>{Co(t)}),r=u("section",u("title",W("players/following")),n);e.append(u("players-inner",r,t,yd(),bd())),re("lichess/following")(()=>{te(t)(...I("lichess/following").map(So))}),Co(t)},Ed=e=>{switch(e.type){case"clock":return e.show;case"correspondence":return`${e.daysPerTurn} day`;case"unlimited":return"unlimited"}},Cd=e=>u("challenge",u("spec",u("challenger",e.challenger.name),u("time",Ed(e.timeControl))),u("actions",me(u("button button-accept",W("home/challenge-accept")),t=>t("click",()=>{Bp(e),T("screen","game")})),me(u("button button-decline",W("home/challenge-decline")),t=>t("click",()=>{Wp(e)})))),Ao=()=>{const e=I("lichess/challenges");return e.length>0?e.map(Cd):[u("waiting",W("home/challenge-wait"))]},$o=()=>u("footer",Pt("link","https://github.com/pierremarc/telechecs",W("home/link-git"))),Sd=()=>u("intro",co("home/tagline"),mh("board-image","https://raw.githubusercontent.com/pierremarc/telechecs/main/picture.jpg"),co("home/description")),Ad=()=>{const e=u("challenges",...Ao()),t=te(e);return re("lichess/challenges")(()=>{t(...Ao())}),u("challenge-block",u("section",u("title",W("home/challenges"))),e)},$d=()=>u("section create-game",qp()),Td=()=>u("section areana",ue(_e(W("arena/arena"),"arena"),()=>{Qf().then(({created:e,started:t})=>{T("lichess/arena-created",e),T("lichess/arena-started",t)}),T("screen","arena")})),To=e=>{const t=te(e),n=()=>{const r=u("login");md(r);const o=u("header",u("title","Téléchecs"),r);if(I("lichess/user")){const s=u("players");ii(s),t(u("home",o,s,Ad(),$d(),Td(),$o()))}else t(u("home",o,Sd(),$o()))};n(),re("lichess/user")(n)},Id="wakeLock"in navigator,Pd=()=>{if(Id){const e=re(...Gh().filter(a=>a!=="lockScreen"));let t=null;const n=a=>qh("lockScreen",p=>p!==a?Yn(a):Jn),r=()=>I("screen")==="game"?t===null?!0:!t.released:!1,o=()=>!!(I("screen")!=="game"&&t&&!t.released),s=()=>{navigator.wakeLock.request("screen").then(a=>{t=a,console.log("WakeLock acquired"),n(!0),t.addEventListener("release",()=>{n(!1),console.log("Navigator released lock sentinel")})}).catch(a=>{console.error("failed to lock screen",a),T("lichess/chat",xt({type:"chatLine",room:"spectator",username:"Téléchecs",text:`Failed to lock screen: ${a}`}))})},i=()=>{n(!1),t&&!t.released&&t.release().then(()=>{t=null}).catch(a=>console.error("failed to release wakelock",a))},l=()=>{r()?s():o()&&i()};e(l),l()}},Zd=e=>{switch(e.name){case"aborted":return W("end/aborted");case"mate":return W("end/mate");case"resign":return W("end/resign");case"stalemate":return W("end/stalemate");case"timeout":return W("end/timeout");case"draw":return W("end/draw");case"outoftime":return W("end/outoftime");case"cheat":return W("end/cheat");case"noStart":return W("end/noStart");case"created":case"started":case"unknownFinish":case"variantEnd":return"Don't know..."}},zd=e=>u("status",Zd(e.status)),Un=({winner:e})=>e===void 0?"½ - ½":e==="white"?" 1 - 0":"0 - 1",ai=e=>e.color===e.winner?u("result won",Un(e)):ws(e.color)===e.winner?u("result lost",Un(e)):u("result draw",Un(e)),Od=Pe(e=>u("section",ue("Rematch",()=>{Xs(e).then(t=>{T("lichess/opponent",t),T("screen","challenge")})}))),Rd=e=>u("section",yn("movelist","Review the game"),dt(Pt("link",`${I("lichess/host")}/${e.gameId}`,"Review the game on Lichess"),t=>t("target","_blank"))),Nd=e=>Pe(t=>{te(e)(ai(t),zd(t),Od(Ue(t.opponent.id)),Rd(t))}),xd=e=>{const t=u("info"),n=Nd(t),r=u("header",u("title","End of game"),Mt());n(Ue(I("lichess/game-info"))),re("lichess/game-info")(()=>n(Ue(I("lichess/game-info")))),e.append(u("end",r,t))},Ld={_tag:"pending"},Fd=()=>bt()===Fs()?oo().concat(Ld):oo(),Dd=(e,t,n)=>Ye("move",dr(t,vn(e.moves,n),ni),"  "),Md=()=>li(()=>u("hidden"),u("pending")),jn=(e,t,n)=>{switch(t._tag){case"pending":return Md();default:return Dd(e,t,n)}},Io=e=>Ye("normal",`${e+1}. `),Po=Pe(e=>sh(2,Fd()).map(([t,n],r)=>{const o=r*2;return t&&n?u("ply",Io(r),Ye("moves",jn(e,t,o),jn(e,n,o+1))):t?u("ply",Io(r),Ye("moves",jn(e,t,o))):u("empty")})),Ud=e=>me(u("button","Resign"),t=>t("click",()=>Ys(e.gameId))),jd=e=>me(u("button","Draw"),t=>t("click",()=>an(e.gameId,"yes"))),ci=(e,t)=>{const n=I("lichess/game-info");return n&&n.status.name==="started"?e(n):t},li=(e,t)=>{const n=I("lichess/game-info");return n&&n.status.name!=="created"&&n.status.name!=="started"?e(n):t},Zo=()=>ci(e=>[jd(e),Ud(e)],[]),zo=()=>li(ai,u("no-outcome")),Oo=()=>[ph("title","Moves"),ci(()=>me(u("to-game  to-button","↩"),e=>e("click",()=>T("screen","game"))),Mt())],Kd=e=>{const t=u("moves",...cn(Ue(I("lichess/game-state")),Po,Ir([u("no-moves")]))),n=u("header",...Oo()),r=u("actions",...Zo()),o=u("outcome",zo());e.append(u("movelist",n,u("listing",t),o,r));const s=te(t),i=te(o),l=te(r),a=te(n),p=re("lichess/game-state"),c=re("started","lichess/game-info");p(()=>{s(...cn(Ue(I("lichess/game-state")),Po,Ir([u("no-moves")])))}),c(()=>{a(...Oo()),l(...Zo()),i(zo())})},qd=e=>{const t=u("events"),n=lr("","Events"),r=()=>{Te(t),I("lichess/stream-events").forEach(o=>t.append(u("event"),dh("json",JSON.stringify(o,void 0,4))))};r(),e.append(n,t),re("lichess/stream-events")(r)},mr=e=>"_tag"in e&&e._tag==="lichess-ai",Gd=(e,t,n)=>({color:n,"clock.increment":t,"clock.limit":e*60,keepAliveStream:!1,rated:I("ratedChallenge"),variant:"standard"}),Bd=(e,t,n,r)=>({color:n,"clock.increment":t,"clock.limit":e*60,variant:"standard",level:r}),Ro=e=>{switch(e){case"white":return hr;case"black":return ur;case"random":return"⚄"}},Wd=(e,t,n,r)=>me(r,o=>o("click",()=>{mr(e)?Bf(Bd(t,n,I("challengeColor"),e.level)).then(s=>T("lichess/my-challenge",s)):Gf(e.username,Gd(t,n,I("challengeColor"))).then(s=>T("lichess/my-challenge",s))})),No=e=>mr(e)?`LichessAI ${e.level}`:e.username,Hd=(e,[t,n])=>u("challenge-create",Wd(e,t,n,u("time-control",u("time",t),u("label","minutes"),u("increment","+ .",ys(n.toString(),2,"0"))))),xo=()=>I("ratedChallenge")?u("toggle",u("selected",W("challenge/rated")),ue(_e(W("challenge/casual"),"casual"),()=>T("ratedChallenge",!1))):u("toggle",ue(_e(W("challenge/rated"),"rated"),()=>T("ratedChallenge",!0)),u("selected",W("challenge/casual"))),Kn=(e,t)=>t?u("selected",Ro(e)):ue(_e(Ro(e),e),()=>T("challengeColor",e)),Lo=()=>u("select",Kn("white",I("challengeColor")==="white"),Kn("random",I("challengeColor")==="random"),Kn("black",I("challengeColor")==="black")),Vd=e=>{const t=I("lichess/opponent");if(t){const n=u("choices",...ks.map(s=>Hd(t,s))),r=u("rated-selector",xo()),o=u("color-selector",Lo());e.append(u("challenge-page",u("header",u("title",`Challenge ${No(t)}`),Mt()),mr(t)?u("config",o):u("config",o,r),n)),re("lichess/my-challenge")(()=>{te(n)(u("waiting",`Waiting for ${No(t)} answer.`))}),re("ratedChallenge")(()=>{te(r)(xo())}),re("challengeColor")(()=>{te(o)(Lo())})}};let rn=null;const Qd=(e,t)=>{Te(e),e.classList.remove("hidden"),e.append(u("message",u("from",t.username),u("text",t.text)),ue("close",()=>{e.classList.add("hidden"),T("lichess/chat",null)})),rn!==null&&clearTimeout(rn),rn=window.setTimeout(()=>{T("lichess/chat",null),e.classList.add("hidden"),rn=null},4e3)},Jd=e=>{const t=u("chat-box hidden");e.append(t),re("lichess/chat")(()=>{const n=I("lichess/chat");n?Qd(t,n):Te(t)})},Yd=3e3,Xd=3e3;let Fo=null;const eg=e=>{const t=Date.now();Hf().then(()=>{const n=Date.now()-t,r=Math.max(0,Math.min(100,100-Math.round(n*100/Xd)));e(r)}).catch(()=>e(0))},tg=e=>{Fo===null&&(Fo=window.setInterval(()=>{I("online")||eg(e)},Yd),window.addEventListener("offline",()=>e(0)))},ng=e=>e>0&&!I("online")?T("online",!0):e===0&&I("online")?T("online",!1):void 0,rg=e=>{tg(ng);const t=u("online-status ok",u("icon"),u("label","Currently offline..."));re("online")(()=>{const n=I("online");n&&t.classList.contains("nok")?(t.classList.remove("nok"),t.classList.add("ok")):!n&&t.classList.contains("ok")&&(t.classList.remove("ok"),t.classList.add("nok"))}),e.append(t)},og=(e,t)=>({color:"random",increment:t,time:e,rated:I("ratedChallenge"),variant:"standard"}),sg=()=>T("lichess/seek",null),ig=(e,t,n)=>me(n,r=>r("click",()=>{const o=og(e,t);T("lichess/seek",rh(o)),Vf(o,sg).then(s=>T("lichess/seek",oh(o,s)))})),ag=([e,t])=>u("challenge-create",ig(e,t,u("time-control",u("time",e),u("label","minutes"),u("increment","+ .",ys(t.toString(),2,"0"))))),Do=()=>I("ratedChallenge")?u("toggle",u("selected",W("challenge/rated")),ue(_e(W("challenge/casual"),"casual"),()=>T("ratedChallenge",!1))):u("toggle",ue(_e(W("challenge/rated"),"rated"),()=>T("ratedChallenge",!0)),u("selected",W("challenge/casual"))),Mo=e=>{const t=gt("lichess/seek");t===null?e(...ks.map(ag)):t._tag==="sending"?e(u("waiting","Offer ",Ye("italic","en route"))):t._tag==="sent"&&e(u("waiting","Waiting for someone, anyone."),ue(_e("Stop waiting","stop-waiting"),()=>{t.cancel()}))},cg=e=>{const t=u("choices"),n=u("rated-selector",Do());e.append(u("challenge-page",u("header",u("title","Create game"),Mt()),u("config",n),t)),Mo(te(t)),re("lichess/seek","lichess/game-info")(()=>{Mo(te(t))}),re("ratedChallenge")(()=>{te(n)(Do())})},lg=()=>{const e=I("lichess/arena-join");e&&(clearInterval(e.interval),T("lichess/arena-join",null))},ug=e=>{const t=()=>{const r=I("lichess/arena-join");r&&Date.now()-r.since>6e4&&(clearInterval(r.interval),T("lichess/arena-join",null),n())},n=()=>{Jf(e).then(()=>{T("lichess/arena-join",{id:e,since:Date.now(),interval:window.setInterval(t,5e3)})}).catch(r=>T("lichess/chat",xt({room:"spectator",username:"lichess",type:"chatLine",text:r.error})))};n()},Uo=e=>e.toISOString().slice(11,16),hg=e=>u("time-control",`${e.limit/60}+${e.increment}`),Se=(e,t)=>t===void 0?u("info undefined",u("key",e)):u("info",u("key",e),u("value",t)),fg=e=>{var t,n;return[Se("Created by",e.createdBy),Se("Start time",Uo(new Date(e.startsAt))),Se("End time",Uo(new Date(e.finishesAt))),Se("Rated",e.rated?"Yes":"No"),Se("Players",e.nbPlayers),Se("Variant",e.variant.name),Se("Type",e.perf.name),Se("Max rating",(t=e.maxRating)==null?void 0:t.rating),Se("Min rating",(n=e.minRating)==null?void 0:n.rating),Se("Bots",e.botsAllowed?"Yes":"No"),Se("Min account age",e.minAccountAgeInDays),Se("Only titled",e.onlyTitled?"Yes":"No"),Se("Team member",e.teamMember)]},pg=e=>vh("tournament",u("",u("name",e.fullName),u("variant",e.variant.name),hg(e.clock)),ue(_e(W("arena/join"),"join"),()=>ug(e.id)),...fg(e)),dg=e=>u("join",lr("",W("arena/waiting")),ue(_e(W("arena/leave"),"leave"),lg)),jo=e=>{I("lichess/arena-join")?te(e)(dg()):te(e)(...I("lichess/arena-started").map(pg))},gg=e=>{const t=u("section",lr("",W("arena/started")),u("inner"));e.append(u("arena-page",u("header",u("title",W("arena/arena")),Mt()),t)),jo(t),re("lichess/arena-created","lichess/arena-started","lichess/arena-join")(()=>jo(t))},Ko=()=>{re("lichess/stream-events")(()=>{const t=I("lichess/stream-events");if(t.length>0){const n=t[t.length-1];n.type==="gameStart"?(T("lichess/game-info",n.game),T("lichess/challenges",[]),T("screen","game"),Ip(n.game.gameId)):n.type==="gameFinish"?(T("lichess/current-challenge",null),T("lichess/game-info",n.game),T("screen","end-game")):n.type==="challenge"?n.challenge.status==="created"&&ht("lichess/challenges",r=>r.concat(n.challenge)):n.type==="challengeCanceled"&&ht("lichess/challenges",r=>r.filter(o=>o.id===n.challenge.id))}})},mg=e=>{cp(),Gp(e),Pd(),To(e),Jd(document.body),rg(document.body),Ko();let t=["screen","lockScreen","lichess/chat","online"];re("screen")(()=>{switch(Bh(n=>t.includes(n)),Ko(),Te(e),I("screen")){case"home":return To(e);case"events":return qd(e);case"game":return rd(e);case"movelist":return hn(!1),Kd(e);case"challenge":return Vd(e);case"seek":return cg(e);case"follow":return ii(e);case"end-game":return hn(!1),xd(e);case"arena":return gg(e)}})};Pe(mg)(Ue(document.querySelector("#app")));
