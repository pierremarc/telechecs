var ji=Object.defineProperty;var Ki=(e,t,n)=>t in e?ji(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var te=(e,t,n)=>Ki(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Oo="none",Ro="some",Wn={tag:Oo},Hn=e=>({tag:Ro,value:e}),qi=e=>typeof e=="object"&&e!==null&&"tag"in e&&(e.tag===Oo||e.tag===Ro),Vn=e=>e.tag==="none",Ie=e=>t=>Vn(t)?Wn:Hn(e(t.value)),Er=e=>t=>Vn(t)?e:t.value,No=e=>t=>Vn(t)?e():t.value,Me=e=>e==null?Wn:Hn(e),rn=(e,t,n)=>n(t(e));function k(e,t,n){function r(l,i){var p;Object.defineProperty(l,"_zod",{value:l._zod??{},enumerable:!1}),(p=l._zod).traits??(p.traits=new Set),l._zod.traits.add(e),t(l,i);for(const c in a.prototype)c in l||Object.defineProperty(l,c,{value:a.prototype[c].bind(l)});l._zod.constr=a,l._zod.def=i}const o=(n==null?void 0:n.Parent)??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function a(l){var i;const p=n!=null&&n.Parent?new s:this;r(p,l),(i=p._zod).deferred??(i.deferred=[]);for(const c of p._zod.deferred)c();return p}return Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:l=>{var i,p;return n!=null&&n.Parent&&l instanceof n.Parent?!0:(p=(i=l==null?void 0:l._zod)==null?void 0:i.traits)==null?void 0:p.has(e)}}),Object.defineProperty(a,"name",{value:e}),a}class $t extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const xo={};function at(e){return xo}function Gi(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function Bi(e,t){return typeof t=="bigint"?t.toString():t}function Lo(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Qn(e){return e==null}function Jn(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Wi(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=Number.parseInt(e.toFixed(o).replace(".","")),a=Number.parseInt(t.toFixed(o).replace(".",""));return s%a/10**o}function re(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function an(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Fo(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function Et(e){return JSON.stringify(e)}function Mn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Hi=Lo(()=>{if(typeof navigator<"u"&&(navigator!=null&&navigator.userAgent.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function yr(e){if(Mn(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(Mn(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}const Vi=new Set(["string","number","symbol"]);function Zt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ht(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function z(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Qi(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Ji={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Yi(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return ht(e,{...e._zod.def,shape:n,checks:[]})}function Xi(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return ht(e,{...e._zod.def,shape:n,checks:[]})}function ea(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return an(this,"shape",r),r},checks:[]};return ht(e,n)}function ta(e,t){return ht(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return an(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function na(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)o[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return ht(t,{...t._zod.def,shape:o,checks:[]})}function ra(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)o[s]=new e({type:"nonoptional",innerType:r[s]});return ht(t,{...t._zod.def,shape:o,checks:[]})}function St(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function Yn(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function qt(e){return typeof e=="string"?e:e==null?void 0:e.message}function ct(e,t,n){var o,s,a,l,i,p;const r={...e,path:e.path??[]};if(!e.message){const c=qt((a=(s=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:s.error)==null?void 0:a.call(s,e))??qt((l=t==null?void 0:t.error)==null?void 0:l.call(t,e))??qt((i=n.customError)==null?void 0:i.call(n,e))??qt((p=n.localeError)==null?void 0:p.call(n,e))??"Invalid input";r.message=c}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function Xn(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function At(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const Do=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,Bi,2)},enumerable:!0})},Mo=k("$ZodError",Do),Uo=k("$ZodError",Do,{Parent:Error});function oa(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function sa(e,t){const n=t||function(s){return s.message},r={_errors:[]},o=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(l=>o({issues:l}));else if(a.code==="invalid_key")o({issues:a.issues});else if(a.code==="invalid_element")o({issues:a.issues});else if(a.path.length===0)r._errors.push(n(a));else{let l=r,i=0;for(;i<a.path.length;){const p=a.path[i];i===a.path.length-1?(l[p]=l[p]||{_errors:[]},l[p]._errors.push(n(a))):l[p]=l[p]||{_errors:[]},l=l[p],i++}}};return o(e),r}const ia=e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new $t;if(a.issues.length){const l=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>ct(i,s,at())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return a.value},aa=e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const l=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>ct(i,s,at())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return a.value},jo=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new $t;return s.issues.length?{success:!1,error:new(e??Mo)(s.issues.map(a=>ct(a,o,at())))}:{success:!0,data:s.value}},ca=jo(Uo),Ko=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(a=>ct(a,o,at())))}:{success:!0,data:s.value}},la=Ko(Uo),ua=/^[cC][^\s-]{8,}$/,ha=/^[0-9a-z]+$/,fa=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,pa=/^[0-9a-vA-V]{20}$/,da=/^[A-Za-z0-9]{27}$/,ga=/^[a-zA-Z0-9_-]{21}$/,ma=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,_a=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Cr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,va=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ba="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function ka(){return new RegExp(ba,"u")}const wa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ea=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,ya=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Ca=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Sa=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,qo=/^[A-Za-z0-9_-]*$/,$a=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,Aa=/^\+(?:[0-9]){6,14}[0-9]$/,Go="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ta=new RegExp(`^${Go}$`);function Bo(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function Ia(e){return new RegExp(`^${Bo(e)}$`)}function Pa(e){let t=`${Go}T${Bo(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}const za=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Za=/^\d+$/,Oa=/^-?\d+(?:\.\d+)?/i,Ra=/true|false/i,Na=/^[^A-Z]*$/,xa=/^[^a-z]*$/,Ee=k("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Wo={number:"number",bigint:"bigint",object:"date"},Ho=k("$ZodCheckLessThan",(e,t)=>{Ee.init(e,t);const n=Wo[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Vo=k("$ZodCheckGreaterThan",(e,t)=>{Ee.init(e,t);const n=Wo[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),La=k("$ZodCheckMultipleOf",(e,t)=>{Ee.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Wi(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Fa=k("$ZodCheckNumberFormat",(e,t)=>{var a;Ee.init(e,t),t.format=t.format||"float64";const n=(a=t.format)==null?void 0:a.includes("int"),r=n?"int":"number",[o,s]=Ji[t.format];e._zod.onattach.push(l=>{const i=l._zod.bag;i.format=t.format,i.minimum=o,i.maximum=s,n&&(i.pattern=Za)}),e._zod.check=l=>{const i=l.value;if(n){if(!Number.isInteger(i)){l.issues.push({expected:r,format:t.format,code:"invalid_type",input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?l.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):l.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}i<o&&l.issues.push({origin:"number",input:i,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),i>s&&l.issues.push({origin:"number",input:i,code:"too_big",maximum:s,inst:e})}}),Da=k("$ZodCheckMaxLength",(e,t)=>{Ee.init(e,t),e._zod.when=n=>{const r=n.value;return!Qn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const s=Xn(r);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Ma=k("$ZodCheckMinLength",(e,t)=>{Ee.init(e,t),e._zod.when=n=>{const r=n.value;return!Qn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const s=Xn(r);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Ua=k("$ZodCheckLengthEquals",(e,t)=>{Ee.init(e,t),e._zod.when=n=>{const r=n.value;return!Qn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,o=r.length;if(o===t.length)return;const s=Xn(r),a=o>t.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),cn=k("$ZodCheckStringFormat",(e,t)=>{var n;Ee.init(e,t),e._zod.onattach.push(r=>{const o=r._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),ja=k("$ZodCheckRegex",(e,t)=>{cn.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Ka=k("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Na),cn.init(e,t)}),qa=k("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=xa),cn.init(e,t)}),Ga=k("$ZodCheckIncludes",(e,t)=>{Ee.init(e,t);const n=Zt(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),Ba=k("$ZodCheckStartsWith",(e,t)=>{Ee.init(e,t);const n=new RegExp(`^${Zt(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),Wa=k("$ZodCheckEndsWith",(e,t)=>{Ee.init(e,t);const n=new RegExp(`.*${Zt(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),Ha=k("$ZodCheckOverwrite",(e,t)=>{Ee.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Va{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(a=>a),o=Math.min(...r.map(a=>a.length-a.trimStart().length)),s=r.map(a=>a.slice(o)).map(a=>" ".repeat(this.indent*2)+a);for(const a of s)this.content.push(a)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}}const Qa={major:4,minor:0,patch:0},ie=k("$ZodType",(e,t)=>{var o;var n;e??(e={}),re(e._zod,"id",()=>t.type+"_"+Fo(10)),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Qa;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const s of r)for(const a of s._zod.onattach)a(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const s=(a,l,i)=>{let p=St(a),c;for(const w of l){if(w._zod.when){if(!w._zod.when(a))continue}else if(p)continue;const m=a.issues.length,C=w._zod.check(a);if(C instanceof Promise&&(i==null?void 0:i.async)===!1)throw new $t;if(c||C instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await C,a.issues.length!==m&&(p||(p=St(a,m)))});else{if(a.issues.length===m)continue;p||(p=St(a,m))}}return c?c.then(()=>a):a};e._zod.run=(a,l)=>{const i=e._zod.parse(a,l);if(i instanceof Promise){if(l.async===!1)throw new $t;return i.then(p=>s(p,r,l))}return s(i,r,l)}}e["~standard"]={validate:s=>{var a;try{const l=ca(e,s);return l.success?{value:l.data}:{issues:(a=l.error)==null?void 0:a.issues}}catch{return la(e,s).then(i=>{var p;return i.success?{value:i.data}:{issues:(p=i.error)==null?void 0:p.issues}})}},vendor:"zod",version:1}}),er=k("$ZodString",(e,t)=>{var n;ie.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??za(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),ne=k("$ZodStringFormat",(e,t)=>{cn.init(e,t),er.init(e,t)}),Ja=k("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=_a),ne.init(e,t)}),Ya=k("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Cr(r))}else t.pattern??(t.pattern=Cr());ne.init(e,t)}),Xa=k("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=va),ne.init(e,t)}),ec=k("$ZodURL",(e,t)=>{ne.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:$a.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),tc=k("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=ka()),ne.init(e,t)}),nc=k("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=ga),ne.init(e,t)}),rc=k("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=ua),ne.init(e,t)}),oc=k("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=ha),ne.init(e,t)}),sc=k("$ZodULID",(e,t)=>{t.pattern??(t.pattern=fa),ne.init(e,t)}),ic=k("$ZodXID",(e,t)=>{t.pattern??(t.pattern=pa),ne.init(e,t)}),ac=k("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=da),ne.init(e,t)}),cc=k("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Pa(t)),ne.init(e,t)}),lc=k("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Ta),ne.init(e,t)}),uc=k("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Ia(t)),ne.init(e,t)}),hc=k("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=ma),ne.init(e,t)}),fc=k("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=wa),ne.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),pc=k("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Ea),ne.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),dc=k("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=ya),ne.init(e,t)}),gc=k("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Ca),ne.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Qo(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const mc=k("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Sa),ne.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Qo(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function _c(e){if(!qo.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Qo(n)}const vc=k("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=qo),ne.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{_c(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),bc=k("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Aa),ne.init(e,t)});function kc(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const wc=k("$ZodJWT",(e,t)=>{ne.init(e,t),e._zod.check=n=>{kc(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Jo=k("$ZodNumber",(e,t)=>{ie.init(e,t),e._zod.pattern=e._zod.bag.pattern??Oa,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),Ec=k("$ZodNumber",(e,t)=>{Fa.init(e,t),Jo.init(e,t)}),yc=k("$ZodBoolean",(e,t)=>{ie.init(e,t),e._zod.pattern=Ra,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),Cc=k("$ZodUnknown",(e,t)=>{ie.init(e,t),e._zod.parse=n=>n}),Sc=k("$ZodNever",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function Sr(e,t,n){e.issues.length&&t.issues.push(...Yn(n,e.issues)),t.value[n]=e.value}const $c=k("$ZodArray",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let a=0;a<o.length;a++){const l=o[a],i=t.element._zod.run({value:l,issues:[]},r);i instanceof Promise?s.push(i.then(p=>Sr(p,n,a))):Sr(i,n,a)}return s.length?Promise.all(s).then(()=>n):n}});function Gt(e,t,n){e.issues.length&&t.issues.push(...Yn(n,e.issues)),t.value[n]=e.value}function $r(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...Yn(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const Ac=k("$ZodObject",(e,t)=>{ie.init(e,t);const n=Lo(()=>{const w=Object.keys(t.shape);for(const C of w)if(!(t.shape[C]instanceof ie))throw new Error(`Invalid element at key "${C}": expected a Zod schema`);const m=Qi(t.shape);return{shape:t.shape,keys:w,keySet:new Set(w),numKeys:w.length,optionalKeys:new Set(m)}});re(e._zod,"propValues",()=>{const w=t.shape,m={};for(const C in w){const y=w[C]._zod;if(y.values){m[C]??(m[C]=new Set);for(const U of y.values)m[C].add(U)}}return m});const r=w=>{const m=new Va(["shape","payload","ctx"]),{keys:C,optionalKeys:y}=n.value,U=R=>{const M=Et(R);return`shape[${M}]._zod.run({ value: input[${M}], issues: [] }, ctx)`};m.write("const input = payload.value;");const j=Object.create(null);for(const R of C)j[R]=Fo(15);m.write("const newResult = {}");for(const R of C)if(y.has(R)){const M=j[R];m.write(`const ${M} = ${U(R)};`);const Q=Et(R);m.write(`
        if (${M}.issues.length) {
          if (input[${Q}] === undefined) {
            if (${Q} in input) {
              newResult[${Q}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${M}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${Q}, ...iss.path] : [${Q}],
              }))
            );
          }
        } else if (${M}.value === undefined) {
          if (${Q} in input) newResult[${Q}] = undefined;
        } else {
          newResult[${Q}] = ${M}.value;
        }
        `)}else{const M=j[R];m.write(`const ${M} = ${U(R)};`),m.write(`
          if (${M}.issues.length) payload.issues = payload.issues.concat(${M}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Et(R)}, ...iss.path] : [${Et(R)}]
          })));`),m.write(`newResult[${Et(R)}] = ${M}.value`)}m.write("payload.value = newResult;"),m.write("return payload;");const K=m.compile();return(R,M)=>K(w,R,M)};let o;const s=Mn,a=!xo.jitless,i=a&&Hi.value,{catchall:p}=t;let c;e._zod.parse=(w,m)=>{c??(c=n.value);const C=w.value;if(!s(C))return w.issues.push({expected:"object",code:"invalid_type",input:C,inst:e}),w;const y=[];if(a&&i&&(m==null?void 0:m.async)===!1&&m.jitless!==!0)o||(o=r(t.shape)),w=o(w,m);else{w.value={};const M=c.shape;for(const Q of c.keys){const Pe=M[Q],De=Pe._zod.run({value:C[Q],issues:[]},m),Je=Pe._zod.optin==="optional"&&Pe._zod.optout==="optional";De instanceof Promise?y.push(De.then(gt=>Je?$r(gt,w,Q,C):Gt(gt,w,Q))):Je?$r(De,w,Q,C):Gt(De,w,Q)}}if(!p)return y.length?Promise.all(y).then(()=>w):w;const U=[],j=c.keySet,K=p._zod,R=K.def.type;for(const M of Object.keys(C)){if(j.has(M))continue;if(R==="never"){U.push(M);continue}const Q=K.run({value:C[M],issues:[]},m);Q instanceof Promise?y.push(Q.then(Pe=>Gt(Pe,w,M))):Gt(Q,w,M)}return U.length&&w.issues.push({code:"unrecognized_keys",keys:U,input:C,inst:e}),y.length?Promise.all(y).then(()=>w):w}});function Ar(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(s=>ct(s,r,at())))}),t}const Tc=k("$ZodUnion",(e,t)=>{ie.init(e,t),re(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),re(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>Jn(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const s=[];for(const a of t.options){const l=a._zod.run({value:n.value,issues:[]},r);if(l instanceof Promise)s.push(l),o=!0;else{if(l.issues.length===0)return l;s.push(l)}}return o?Promise.all(s).then(a=>Ar(a,n,e,r)):Ar(s,n,e,r)}}),Ic=k("$ZodIntersection",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>{const{value:o}=n,s=t.left._zod.run({value:o,issues:[]},r),a=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||a instanceof Promise?Promise.all([s,a]).then(([i,p])=>Tr(n,i,p)):Tr(n,s,a)}});function Un(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(yr(e)&&yr(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const a=Un(e[s],t[s]);if(!a.valid)return{valid:!1,mergeErrorPath:[s,...a.mergeErrorPath]};o[s]=a.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],a=Un(o,s);if(!a.valid)return{valid:!1,mergeErrorPath:[r,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Tr(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),St(e))return e;const r=Un(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const Pc=k("$ZodEnum",(e,t)=>{ie.init(e,t);const n=Gi(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(r=>Vi.has(typeof r)).map(r=>typeof r=="string"?Zt(r):r.toString()).join("|")})$`),e._zod.parse=(r,o)=>{const s=r.value;return e._zod.values.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),zc=k("$ZodLiteral",(e,t)=>{ie.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?Zt(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),Zc=k("$ZodTransform",(e,t)=>{ie.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(a=>(n.value=a,n));if(o instanceof Promise)throw new $t;return n.value=o,n}}),Oc=k("$ZodOptional",(e,t)=>{ie.init(e,t),e._zod.optin="optional",e._zod.optout="optional",re(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),re(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Jn(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),Rc=k("$ZodNullable",(e,t)=>{ie.init(e,t),re(e._zod,"optin",()=>t.innerType._zod.optin),re(e._zod,"optout",()=>t.innerType._zod.optout),re(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Jn(n.source)}|null)$`):void 0}),re(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),Nc=k("$ZodDefault",(e,t)=>{ie.init(e,t),e._zod.optin="optional",re(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Ir(s,t)):Ir(o,t)}});function Ir(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const xc=k("$ZodPrefault",(e,t)=>{ie.init(e,t),e._zod.optin="optional",re(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Lc=k("$ZodNonOptional",(e,t)=>{ie.init(e,t),re(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Pr(s,e)):Pr(o,e)}});function Pr(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Fc=k("$ZodCatch",(e,t)=>{ie.init(e,t),re(e._zod,"optin",()=>t.innerType._zod.optin),re(e._zod,"optout",()=>t.innerType._zod.optout),re(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>ct(a,r,at()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>ct(s,r,at()))},input:n.value}),n.issues=[]),n)}}),Dc=k("$ZodPipe",(e,t)=>{ie.init(e,t),re(e._zod,"values",()=>t.in._zod.values),re(e._zod,"optin",()=>t.in._zod.optin),re(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>zr(s,t,r)):zr(o,t,r)}});function zr(e,t,n){return St(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const Mc=k("$ZodReadonly",(e,t)=>{ie.init(e,t),re(e._zod,"propValues",()=>t.innerType._zod.propValues),re(e._zod,"optin",()=>t.innerType._zod.optin),re(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(Zr):Zr(o)}});function Zr(e){return e.value=Object.freeze(e.value),e}const Uc=k("$ZodCustom",(e,t)=>{Ee.init(e,t),ie.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>Or(s,n,r,e));Or(o,n,r,e)}});function Or(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(At(o))}}class jc{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function Kc(){return new jc}const Bt=Kc();function qc(e,t){return new e({type:"string",...z(t)})}function Gc(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...z(t)})}function Rr(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...z(t)})}function Bc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...z(t)})}function Wc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...z(t)})}function Hc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...z(t)})}function Vc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...z(t)})}function Yo(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...z(t)})}function Qc(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...z(t)})}function Jc(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...z(t)})}function Yc(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...z(t)})}function Xc(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...z(t)})}function el(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...z(t)})}function tl(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...z(t)})}function nl(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...z(t)})}function rl(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...z(t)})}function ol(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...z(t)})}function sl(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...z(t)})}function il(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...z(t)})}function al(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...z(t)})}function cl(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...z(t)})}function ll(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...z(t)})}function ul(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...z(t)})}function hl(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...z(t)})}function fl(e,t){return new e({type:"string",format:"date",check:"string_format",...z(t)})}function pl(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...z(t)})}function dl(e,t){return new e({type:"string",format:"duration",check:"string_format",...z(t)})}function gl(e,t){return new e({type:"number",checks:[],...z(t)})}function ml(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...z(t)})}function _l(e,t){return new e({type:"boolean",...z(t)})}function vl(e){return new e({type:"unknown"})}function bl(e,t){return new e({type:"never",...z(t)})}function Nr(e,t){return new Ho({check:"less_than",...z(t),value:e,inclusive:!1})}function yn(e,t){return new Ho({check:"less_than",...z(t),value:e,inclusive:!0})}function xr(e,t){return new Vo({check:"greater_than",...z(t),value:e,inclusive:!1})}function Cn(e,t){return new Vo({check:"greater_than",...z(t),value:e,inclusive:!0})}function Lr(e,t){return new La({check:"multiple_of",...z(t),value:e})}function Xo(e,t){return new Da({check:"max_length",...z(t),maximum:e})}function on(e,t){return new Ma({check:"min_length",...z(t),minimum:e})}function es(e,t){return new Ua({check:"length_equals",...z(t),length:e})}function kl(e,t){return new ja({check:"string_format",format:"regex",...z(t),pattern:e})}function wl(e){return new Ka({check:"string_format",format:"lowercase",...z(e)})}function El(e){return new qa({check:"string_format",format:"uppercase",...z(e)})}function yl(e,t){return new Ga({check:"string_format",format:"includes",...z(t),includes:e})}function Cl(e,t){return new Ba({check:"string_format",format:"starts_with",...z(t),prefix:e})}function Sl(e,t){return new Wa({check:"string_format",format:"ends_with",...z(t),suffix:e})}function Ot(e){return new Ha({check:"overwrite",tx:e})}function $l(e){return Ot(t=>t.normalize(e))}function Al(){return Ot(e=>e.trim())}function Tl(){return Ot(e=>e.toLowerCase())}function Il(){return Ot(e=>e.toUpperCase())}function Pl(e,t,n){return new e({type:"array",element:t,...z(n)})}function zl(e,t,n){return new e({type:"custom",check:"custom",fn:t,...z(n)})}const Zl=k("ZodISODateTime",(e,t)=>{cc.init(e,t),ae.init(e,t)});function Ol(e){return hl(Zl,e)}const Rl=k("ZodISODate",(e,t)=>{lc.init(e,t),ae.init(e,t)});function Nl(e){return fl(Rl,e)}const xl=k("ZodISOTime",(e,t)=>{uc.init(e,t),ae.init(e,t)});function Ll(e){return pl(xl,e)}const Fl=k("ZodISODuration",(e,t)=>{hc.init(e,t),ae.init(e,t)});function Dl(e){return dl(Fl,e)}const Ml=(e,t)=>{Mo.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>sa(e,n)},flatten:{value:n=>oa(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},ln=k("ZodError",Ml,{Parent:Error}),Ul=ia(ln),jl=aa(ln),Kl=jo(ln),ql=Ko(ln),ce=k("ZodType",(e,t)=>(ie.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>ht(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>Ul(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>Kl(e,n,r),e.parseAsync=async(n,r)=>jl(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>ql(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(xu(n,r)),e.superRefine=n=>e.check(Lu(n)),e.overwrite=n=>e.check(Ot(n)),e.optional=()=>Mr(e),e.nullable=()=>Ur(e),e.nullish=()=>Mr(Ur(e)),e.nonoptional=n=>Tu(e,n),e.array=()=>du(e),e.or=n=>X([e,n]),e.and=n=>vu(e,n),e.transform=n=>jr(e,Eu(n)),e.default=n=>Su(e,n),e.prefault=n=>Au(e,n),e.catch=n=>Pu(e,n),e.pipe=n=>jr(e,n),e.readonly=()=>Ou(e),e.describe=n=>{const r=e.clone();return Bt.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=Bt.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Bt.get(e);const r=e.clone();return Bt.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),ts=k("_ZodString",(e,t)=>{er.init(e,t),ce.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(kl(...r)),e.includes=(...r)=>e.check(yl(...r)),e.startsWith=(...r)=>e.check(Cl(...r)),e.endsWith=(...r)=>e.check(Sl(...r)),e.min=(...r)=>e.check(on(...r)),e.max=(...r)=>e.check(Xo(...r)),e.length=(...r)=>e.check(es(...r)),e.nonempty=(...r)=>e.check(on(1,...r)),e.lowercase=r=>e.check(wl(r)),e.uppercase=r=>e.check(El(r)),e.trim=()=>e.check(Al()),e.normalize=(...r)=>e.check($l(...r)),e.toLowerCase=()=>e.check(Tl()),e.toUpperCase=()=>e.check(Il())}),Gl=k("ZodString",(e,t)=>{er.init(e,t),ts.init(e,t),e.email=n=>e.check(Gc(Bl,n)),e.url=n=>e.check(Yo(ns,n)),e.jwt=n=>e.check(ul(cu,n)),e.emoji=n=>e.check(Qc(Hl,n)),e.guid=n=>e.check(Rr(Fr,n)),e.uuid=n=>e.check(Bc(Wt,n)),e.uuidv4=n=>e.check(Wc(Wt,n)),e.uuidv6=n=>e.check(Hc(Wt,n)),e.uuidv7=n=>e.check(Vc(Wt,n)),e.nanoid=n=>e.check(Jc(Vl,n)),e.guid=n=>e.check(Rr(Fr,n)),e.cuid=n=>e.check(Yc(Ql,n)),e.cuid2=n=>e.check(Xc(Jl,n)),e.ulid=n=>e.check(el(Yl,n)),e.base64=n=>e.check(al(su,n)),e.base64url=n=>e.check(cl(iu,n)),e.xid=n=>e.check(tl(Xl,n)),e.ksuid=n=>e.check(nl(eu,n)),e.ipv4=n=>e.check(rl(tu,n)),e.ipv6=n=>e.check(ol(nu,n)),e.cidrv4=n=>e.check(sl(ru,n)),e.cidrv6=n=>e.check(il(ou,n)),e.e164=n=>e.check(ll(au,n)),e.datetime=n=>e.check(Ol(n)),e.date=n=>e.check(Nl(n)),e.time=n=>e.check(Ll(n)),e.duration=n=>e.check(Dl(n))});function Z(e){return qc(Gl,e)}const ae=k("ZodStringFormat",(e,t)=>{ne.init(e,t),ts.init(e,t)}),Bl=k("ZodEmail",(e,t)=>{Xa.init(e,t),ae.init(e,t)}),Fr=k("ZodGUID",(e,t)=>{Ja.init(e,t),ae.init(e,t)}),Wt=k("ZodUUID",(e,t)=>{Ya.init(e,t),ae.init(e,t)}),ns=k("ZodURL",(e,t)=>{ec.init(e,t),ae.init(e,t)});function Wl(e){return Yo(ns,e)}const Hl=k("ZodEmoji",(e,t)=>{tc.init(e,t),ae.init(e,t)}),Vl=k("ZodNanoID",(e,t)=>{nc.init(e,t),ae.init(e,t)}),Ql=k("ZodCUID",(e,t)=>{rc.init(e,t),ae.init(e,t)}),Jl=k("ZodCUID2",(e,t)=>{oc.init(e,t),ae.init(e,t)}),Yl=k("ZodULID",(e,t)=>{sc.init(e,t),ae.init(e,t)}),Xl=k("ZodXID",(e,t)=>{ic.init(e,t),ae.init(e,t)}),eu=k("ZodKSUID",(e,t)=>{ac.init(e,t),ae.init(e,t)}),tu=k("ZodIPv4",(e,t)=>{fc.init(e,t),ae.init(e,t)}),nu=k("ZodIPv6",(e,t)=>{pc.init(e,t),ae.init(e,t)}),ru=k("ZodCIDRv4",(e,t)=>{dc.init(e,t),ae.init(e,t)}),ou=k("ZodCIDRv6",(e,t)=>{gc.init(e,t),ae.init(e,t)}),su=k("ZodBase64",(e,t)=>{mc.init(e,t),ae.init(e,t)}),iu=k("ZodBase64URL",(e,t)=>{vc.init(e,t),ae.init(e,t)}),au=k("ZodE164",(e,t)=>{bc.init(e,t),ae.init(e,t)}),cu=k("ZodJWT",(e,t)=>{wc.init(e,t),ae.init(e,t)}),rs=k("ZodNumber",(e,t)=>{Jo.init(e,t),ce.init(e,t),e.gt=(r,o)=>e.check(xr(r,o)),e.gte=(r,o)=>e.check(Cn(r,o)),e.min=(r,o)=>e.check(Cn(r,o)),e.lt=(r,o)=>e.check(Nr(r,o)),e.lte=(r,o)=>e.check(yn(r,o)),e.max=(r,o)=>e.check(yn(r,o)),e.int=r=>e.check(V(r)),e.safe=r=>e.check(V(r)),e.positive=r=>e.check(xr(0,r)),e.nonnegative=r=>e.check(Cn(0,r)),e.negative=r=>e.check(Nr(0,r)),e.nonpositive=r=>e.check(yn(0,r)),e.multipleOf=(r,o)=>e.check(Lr(r,o)),e.step=(r,o)=>e.check(Lr(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Te(e){return gl(rs,e)}const lu=k("ZodNumberFormat",(e,t)=>{Ec.init(e,t),rs.init(e,t)});function V(e){return ml(lu,e)}const uu=k("ZodBoolean",(e,t)=>{yc.init(e,t),ce.init(e,t)});function B(e){return _l(uu,e)}const hu=k("ZodUnknown",(e,t)=>{Cc.init(e,t),ce.init(e,t)});function Dr(){return vl(hu)}const fu=k("ZodNever",(e,t)=>{Sc.init(e,t),ce.init(e,t)});function os(e){return bl(fu,e)}const pu=k("ZodArray",(e,t)=>{$c.init(e,t),ce.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(on(n,r)),e.nonempty=n=>e.check(on(1,n)),e.max=(n,r)=>e.check(Xo(n,r)),e.length=(n,r)=>e.check(es(n,r)),e.unwrap=()=>e.element});function du(e,t){return Pl(pu,e,t)}const ss=k("ZodObject",(e,t)=>{Ac.init(e,t),ce.init(e,t),re(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>bu(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Dr()}),e.loose=()=>e.clone({...e._zod.def,catchall:Dr()}),e.strict=()=>e.clone({...e._zod.def,catchall:os()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>ea(e,n),e.merge=n=>ta(e,n),e.pick=n=>Yi(e,n),e.omit=n=>Xi(e,n),e.partial=(...n)=>na(is,e,n[0]),e.required=(...n)=>ra(as,e,n[0])});function gu(e,t){const n={type:"object",get shape(){return an(this,"shape",{...e}),this.shape},...z(t)};return new ss(n)}function x(e,t){return new ss({type:"object",get shape(){return an(this,"shape",{...e}),this.shape},catchall:os(),...z(t)})}const mu=k("ZodUnion",(e,t)=>{Tc.init(e,t),ce.init(e,t),e.options=t.options});function X(e,t){return new mu({type:"union",options:e,...z(t)})}const _u=k("ZodIntersection",(e,t)=>{Ic.init(e,t),ce.init(e,t)});function vu(e,t){return new _u({type:"intersection",left:e,right:t})}const jn=k("ZodEnum",(e,t)=>{Pc.init(e,t),ce.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const a of r)if(n.has(a))s[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new jn({...t,checks:[],...z(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const a of r)if(n.has(a))delete s[a];else throw new Error(`Key ${a} not found in enum`);return new jn({...t,checks:[],...z(o),entries:s})}});function bu(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new jn({type:"enum",entries:n,...z(t)})}const ku=k("ZodLiteral",(e,t)=>{zc.init(e,t),ce.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function h(e,t){return new ku({type:"literal",values:Array.isArray(e)?e:[e],...z(t)})}const wu=k("ZodTransform",(e,t)=>{Zc.init(e,t),ce.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=s=>{if(typeof s=="string")n.issues.push(At(s,n.value,t));else{const a=s;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=n.value),a.inst??(a.inst=e),a.continue??(a.continue=!0),n.issues.push(At(a))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function Eu(e){return new wu({type:"transform",transform:e})}const is=k("ZodOptional",(e,t)=>{Oc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Mr(e){return new is({type:"optional",innerType:e})}const yu=k("ZodNullable",(e,t)=>{Rc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ur(e){return new yu({type:"nullable",innerType:e})}const Cu=k("ZodDefault",(e,t)=>{Nc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Su(e,t){return new Cu({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const $u=k("ZodPrefault",(e,t)=>{xc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Au(e,t){return new $u({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const as=k("ZodNonOptional",(e,t)=>{Lc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Tu(e,t){return new as({type:"nonoptional",innerType:e,...z(t)})}const Iu=k("ZodCatch",(e,t)=>{Fc.init(e,t),ce.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Pu(e,t){return new Iu({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const zu=k("ZodPipe",(e,t)=>{Dc.init(e,t),ce.init(e,t),e.in=t.in,e.out=t.out});function jr(e,t){return new zu({type:"pipe",in:e,out:t})}const Zu=k("ZodReadonly",(e,t)=>{Mc.init(e,t),ce.init(e,t)});function Ou(e){return new Zu({type:"readonly",innerType:e})}const Ru=k("ZodCustom",(e,t)=>{Uc.init(e,t),ce.init(e,t)});function Nu(e,t){const n=new Ee({check:"custom",...z(t)});return n._zod.check=e,n}function xu(e,t={}){return zl(Ru,e,t)}function Lu(e,t){const n=Nu(r=>(r.addIssue=o=>{if(typeof o=="string")r.issues.push(At(o,r.value,n._zod.def));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=n),s.continue??(s.continue=!n._zod.def.abort),r.issues.push(At(s))}},e(r.value,r)),t);return n}const Kr=X([h("en"),h("fr")]),Fu=e=>{switch(e){case"Pawn":return"p";case"Knight":return"n";case"Bishop":return"b";case"Rook":return"r";case"Queen":return"q";case"King":return"k"}},Sn=e=>{switch(e){case"p":return"Pawn";case"n":return"Knight";case"b":return"Bishop";case"r":return"Rook";case"q":return"Queen";case"k":return"King"}},Du=["A","B","C","D","E","F","G","H"],Mu=["1","2","3","4","5","6","7","8"],Be=e=>e[0],$n=e=>e[1],Uu=(e,t)=>e+t,ju=(e,t,n,r,o,s,a)=>({_tag:"Normal",role:e,from:t,to:n,capture:r,promotion:o,check:s,checkmate:a}),Ku=(e,t,n,r)=>({_tag:"EnPassant",from:e,to:t,check:n,checkmate:r}),Ht=(e,t,n,r)=>({_tag:"Castle",king:e,rook:t,check:n,checkmate:r}),tr=e=>{switch(e._tag){case"Castle":return"King";case"EnPassant":return"Pawn";case"Normal":return e.role}},cs=e=>{switch(e._tag){case"Castle":switch(e.king){case"E1":return e.rook==="H1"?"G1":"C1";case"E8":return e.rook==="H8"?"G8":"C8"}case"EnPassant":case"Normal":return e.to}},qu=e=>{switch(e._tag){case"Castle":return e.king;case"EnPassant":case"Normal":return e.from}},ls=e=>[qu(e),cs(e),e._tag==="Normal"&&e.promotion!==null?Fu(e.promotion):""].join("").toLowerCase(),us=e=>e==="black"?"white":"black",un=()=>({_tag:"none"}),Gu=e=>({_tag:"role",role:e}),Bu=(e,t)=>({_tag:"candidates",role:e,candidates:t}),Wu=e=>({_tag:"move",move:e}),Kn=e=>{switch(e._tag){case"none":return null;case"role":case"candidates":return e.role;case"move":return tr(e.move)}},hn=e=>({...e,timestamp:Date.now()}),Hu=e=>({_tag:"sending",since:Date.now(),request:e}),Vu=(e,t)=>({_tag:"sent",since:Date.now(),request:e,cancel:t}),Qu=(e,t)=>{const n=[[]];for(let r=0;r<t.length;r++){let o=Math.floor(r/e);o===n.length&&n.push([]),n[o].push(t[r])}return n},Ju=["localhost","127.0.0.1","10\\..+","172\\.16\\..+","192\\.168\\..+"].map(e=>new RegExp(e)),Yu=e=>Ju.some(t=>t.test(e)),hs=[[15,10],[30,20],[40,30],[60,60],[90,60],[120,60]],fs=(e,t,n=" ")=>(t=t>>0,n=String(typeof n<"u"?n:" "),e.length>t?String(e):(t=t-e.length,t>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(e))),ft=(e,t)=>(t((r,o)=>{e.setAttribute(r,o.toString())}),e),ge=(e,t)=>(t((r,o)=>{e.addEventListener(r,o)}),e);function Ae(e){for(;e.firstChild;)Xu(e.firstChild);return e}function Xu(e,t=!1){t||Ae(e);const n=e.parentNode;n&&n.removeChild(e)}const eh=e=>document.createElement(e),qr=e=>t=>t.appendChild(document.createTextNode(e)),fn=(e,t)=>{const n=eh(e);return n.setAttribute("class",t),n},th=e=>t=>{typeof t=="number"?qr(t.toLocaleString())(e):qr(t)(e)},nh=e=>t=>{e.appendChild(t)},Gr=(e,t)=>{typeof t=="number"||typeof t=="string"?th(e)(t):nh(e)(t)},ps=e=>t=>{qi(t)?Ie(n=>Gr(e,n))(t):Gr(e,t)},oe=e=>(...t)=>{const n=ps(e);Ae(e),t.forEach(n)},rh=e=>t=>t.classList.contains(e),nr=(...e)=>t=>(t.classList.add(...e),t),rr=(...e)=>t=>(t.classList.remove(...e),t),pt=(e,t,n)=>{const r=fn(e,t);return n.forEach(ps(r)),r},f=(e,...t)=>pt("div",e,t),Ke=(...e)=>pt("p","",e),Ve=(e,...t)=>pt("span",e,t),oh=(e,...t)=>pt("h1",e,t),sh=(e,...t)=>pt("h2",e,t),ih=(e,...t)=>pt("pre",e,t),ah=(e,t)=>ft(fn("input",e),n=>n("type",t)),Tt=(e,t,...n)=>ft(pt("a",e,n),r=>r("href",t)),ch=(e,t)=>{const n=fn("img",e);return n.setAttribute("src",t),n},lh=(e,t)=>ft(fn("audio",e),n=>{n("src",t)});var An,Br;function uh(){if(Br)return An;Br=1;function e(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function t(i,p,c,w,m){const C={move:i,variations:m};return p&&(C.suffix=p),c&&(C.nag=c),w!==null&&(C.comment=w),C}function n(...i){const[p,...c]=i;let w=p;for(const m of c)m!==null&&(w.variations=[m,...m.variations],m.variations=[],w=m);return p}function r(i,p){if(p.marker&&p.marker.comment){let c=p.root;for(;;){const w=c.variations[0];if(!w){c.comment=p.marker.comment;break}c=w}}return{headers:i,root:p.root,result:(p.marker&&p.marker.result)??void 0}}function o(i,p){function c(){this.constructor=i}c.prototype=p.prototype,i.prototype=new c}function s(i,p,c,w){var m=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(m,s.prototype),m.expected=p,m.found=c,m.location=w,m.name="SyntaxError",m}o(s,Error);function a(i,p,c){return c=c||" ",i.length>p?i:(p-=i.length,c+=c.repeat(p),i+c.slice(0,p))}s.prototype.format=function(i){var p="Error: "+this.message;if(this.location){var c=null,w;for(w=0;w<i.length;w++)if(i[w].source===this.location.source){c=i[w].text.split(/\r\n|\n|\r/g);break}var m=this.location.start,C=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(m):m,y=this.location.source+":"+C.line+":"+C.column;if(c){var U=this.location.end,j=a("",C.line.toString().length," "),K=c[m.line-1],R=m.line===U.line?U.column:K.length+1,M=R-m.column||1;p+=`
 --> `+y+`
`+j+` |
`+C.line+" | "+K+`
`+j+" | "+a("",m.column-1," ")+a("",M,"^")}else p+=`
 at `+y}return p},s.buildMessage=function(i,p){var c={literal:function(K){return'"'+m(K.text)+'"'},class:function(K){var R=K.parts.map(function(M){return Array.isArray(M)?C(M[0])+"-"+C(M[1]):C(M)});return"["+(K.inverted?"^":"")+R.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(K){return K.description}};function w(K){return K.charCodeAt(0).toString(16).toUpperCase()}function m(K){return K.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(R){return"\\x0"+w(R)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(R){return"\\x"+w(R)})}function C(K){return K.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(R){return"\\x0"+w(R)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(R){return"\\x"+w(R)})}function y(K){return c[K.type](K)}function U(K){var R=K.map(y),M,Q;if(R.sort(),R.length>0){for(M=1,Q=1;M<R.length;M++)R[M-1]!==R[M]&&(R[Q]=R[M],Q++);R.length=Q}switch(R.length){case 1:return R[0];case 2:return R[0]+" or "+R[1];default:return R.slice(0,-1).join(", ")+", or "+R[R.length-1]}}function j(K){return K?'"'+m(K)+'"':"end of input"}return"Expected "+U(i)+" but "+j(p)+" found."};function l(i,p){p=p!==void 0?p:{};var c={},w=p.grammarSource,m={pgn:mr},C=mr,y="[",U='"',j="]",K=".",R="O-O-O",M="O-O",Q="0-0-0",Pe="0-0",De="$",Je="{",gt="}",Ye=";",Lt="(",kn=")",bt="1-0",Xe="0-1",Ft="1/2-1/2",b="*",d=/^[a-zA-Z]/,E=/^[^"]/,$=/^[0-9]/,P=/^[.]/,A=/^[a-zA-Z1-8\-=]/,W=/^[+#]/,G=/^[!?]/,ee=/^[^}]/,F=/^[^\r\n]/,J=/^[ \t\r\n]/,he=Se("tag pair"),ze=fe("[",!1),Re=fe('"',!1),et=fe("]",!1),Ue=Se("tag name"),_e=Le([["a","z"],["A","Z"]],!1,!1),Ne=Se("tag value"),tt=Le(['"'],!0,!1),mt=Se("move number"),xe=Le([["0","9"]],!1,!1),Ze=fe(".",!1),je=Le(["."],!1,!1),kt=Se("standard algebraic notation"),Dt=fe("O-O-O",!1),wn=fe("O-O",!1),Mt=fe("0-0-0",!1),nt=fe("0-0",!1),Ut=Le([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),ti=Le(["+","#"],!1,!1),ni=Se("suffix annotation"),ur=Le(["!","?"],!1,!1),ri=Se("NAG"),oi=fe("$",!1),si=Se("brace comment"),ii=fe("{",!1),hr=Le(["}"],!0,!1),ai=fe("}",!1),ci=Se("rest of line comment"),li=fe(";",!1),fr=Le(["\r",`
`],!0,!1),ui=Se("variation"),hi=fe("(",!1),fi=fe(")",!1),pi=Se("game termination marker"),di=fe("1-0",!1),gi=fe("0-1",!1),mi=fe("1/2-1/2",!1),_i=fe("*",!1),vi=Se("whitespace"),pr=Le([" ","	","\r",`
`],!1,!1),bi=function(u,_){return r(u,_)},ki=function(u){return Object.fromEntries(u)},wi=function(u,_){return[u,_]},Ei=function(u,_){return{root:u,marker:_}},yi=function(u,_){return n(e(u),..._.flat())},Ci=function(u,_,v,N,L){return t(u,_,v,N,L)},Si=function(u){return u},$i=function(u){return u.replace(/[\r\n]+/g," ")},Ai=function(u){return u.trim()},Ti=function(u){return u},Ii=function(u,_){return{result:u,comment:_}},g=p.peg$currPos|0,_t=[{line:1,column:1}],Oe=g,jt=p.peg$maxFailExpected||[],S=p.peg$silentFails|0,wt;if(p.startRule){if(!(p.startRule in m))throw new Error(`Can't start parsing from rule "`+p.startRule+'".');C=m[p.startRule]}function fe(u,_){return{type:"literal",text:u,ignoreCase:_}}function Le(u,_,v){return{type:"class",parts:u,inverted:_,ignoreCase:v}}function Pi(){return{type:"end"}}function Se(u){return{type:"other",description:u}}function dr(u){var _=_t[u],v;if(_)return _;if(u>=_t.length)v=_t.length-1;else for(v=u;!_t[--v];);for(_=_t[v],_={line:_.line,column:_.column};v<u;)i.charCodeAt(v)===10?(_.line++,_.column=1):_.column++,v++;return _t[u]=_,_}function gr(u,_,v){var N=dr(u),L=dr(_),Y={source:w,start:{offset:u,line:N.line,column:N.column},end:{offset:_,line:L.line,column:L.column}};return Y}function O(u){g<Oe||(g>Oe&&(Oe=g,jt=[]),jt.push(u))}function zi(u,_,v){return new s(s.buildMessage(u,_),u,_,v)}function mr(){var u,_,v;return u=g,_=Zi(),v=Ni(),u=bi(_,v),u}function Zi(){var u,_,v;for(u=g,_=[],v=_r();v!==c;)_.push(v),v=_r();return v=ke(),u=ki(_),u}function _r(){var u,_,v,N,L,Y,rt;return S++,u=g,ke(),i.charCodeAt(g)===91?(_=y,g++):(_=c,S===0&&O(ze)),_!==c?(ke(),v=Oi(),v!==c?(ke(),i.charCodeAt(g)===34?(N=U,g++):(N=c,S===0&&O(Re)),N!==c?(L=Ri(),i.charCodeAt(g)===34?(Y=U,g++):(Y=c,S===0&&O(Re)),Y!==c?(ke(),i.charCodeAt(g)===93?(rt=j,g++):(rt=c,S===0&&O(et)),rt!==c?u=wi(v,L):(g=u,u=c)):(g=u,u=c)):(g=u,u=c)):(g=u,u=c)):(g=u,u=c),S--,u===c&&S===0&&O(he),u}function Oi(){var u,_,v;if(S++,u=g,_=[],v=i.charAt(g),d.test(v)?g++:(v=c,S===0&&O(_e)),v!==c)for(;v!==c;)_.push(v),v=i.charAt(g),d.test(v)?g++:(v=c,S===0&&O(_e));else _=c;return _!==c?u=i.substring(u,g):u=_,S--,u===c&&(_=c,S===0&&O(Ue)),u}function Ri(){var u,_,v;for(S++,u=g,_=[],v=i.charAt(g),E.test(v)?g++:(v=c,S===0&&O(tt));v!==c;)_.push(v),v=i.charAt(g),E.test(v)?g++:(v=c,S===0&&O(tt));return u=i.substring(u,g),S--,_=c,S===0&&O(Ne),u}function Ni(){var u,_,v;return u=g,_=vr(),ke(),v=Ui(),v===c&&(v=null),ke(),u=Ei(_,v),u}function vr(){var u,_,v,N;for(u=g,_=En(),_===c&&(_=null),v=[],N=br();N!==c;)v.push(N),N=br();return u=yi(_,v),u}function br(){var u,_,v,N,L,Y,rt,Kt;if(u=g,ke(),xi(),ke(),_=Li(),_!==c){for(v=Fi(),v===c&&(v=null),N=[],L=kr();L!==c;)N.push(L),L=kr();for(L=ke(),Y=En(),Y===c&&(Y=null),rt=[],Kt=wr();Kt!==c;)rt.push(Kt),Kt=wr();u=Ci(_,v,N,Y,rt)}else g=u,u=c;return u}function xi(){var u,_,v,N,L,Y;for(S++,u=g,_=[],v=i.charAt(g),$.test(v)?g++:(v=c,S===0&&O(xe));v!==c;)_.push(v),v=i.charAt(g),$.test(v)?g++:(v=c,S===0&&O(xe));if(i.charCodeAt(g)===46?(v=K,g++):(v=c,S===0&&O(Ze)),v!==c){for(N=ke(),L=[],Y=i.charAt(g),P.test(Y)?g++:(Y=c,S===0&&O(je));Y!==c;)L.push(Y),Y=i.charAt(g),P.test(Y)?g++:(Y=c,S===0&&O(je));_=[_,v,N,L],u=_}else g=u,u=c;return S--,u===c&&(_=c,S===0&&O(mt)),u}function Li(){var u,_,v,N,L,Y;if(S++,u=g,_=g,i.substr(g,5)===R?(v=R,g+=5):(v=c,S===0&&O(Dt)),v===c&&(i.substr(g,3)===M?(v=M,g+=3):(v=c,S===0&&O(wn)),v===c&&(i.substr(g,5)===Q?(v=Q,g+=5):(v=c,S===0&&O(Mt)),v===c&&(i.substr(g,3)===Pe?(v=Pe,g+=3):(v=c,S===0&&O(nt)),v===c))))if(v=g,N=i.charAt(g),d.test(N)?g++:(N=c,S===0&&O(_e)),N!==c){if(L=[],Y=i.charAt(g),A.test(Y)?g++:(Y=c,S===0&&O(Ut)),Y!==c)for(;Y!==c;)L.push(Y),Y=i.charAt(g),A.test(Y)?g++:(Y=c,S===0&&O(Ut));else L=c;L!==c?(N=[N,L],v=N):(g=v,v=c)}else g=v,v=c;return v!==c?(N=i.charAt(g),W.test(N)?g++:(N=c,S===0&&O(ti)),N===c&&(N=null),v=[v,N],_=v):(g=_,_=c),_!==c?u=i.substring(u,g):u=_,S--,u===c&&(_=c,S===0&&O(kt)),u}function Fi(){var u,_,v;for(S++,u=g,_=[],v=i.charAt(g),G.test(v)?g++:(v=c,S===0&&O(ur));v!==c;)_.push(v),_.length>=2?v=c:(v=i.charAt(g),G.test(v)?g++:(v=c,S===0&&O(ur)));return _.length<1?(g=u,u=c):u=_,S--,u===c&&(_=c,S===0&&O(ni)),u}function kr(){var u,_,v,N,L;if(S++,u=g,ke(),i.charCodeAt(g)===36?(_=De,g++):(_=c,S===0&&O(oi)),_!==c){if(v=g,N=[],L=i.charAt(g),$.test(L)?g++:(L=c,S===0&&O(xe)),L!==c)for(;L!==c;)N.push(L),L=i.charAt(g),$.test(L)?g++:(L=c,S===0&&O(xe));else N=c;N!==c?v=i.substring(v,g):v=N,v!==c?u=Si(v):(g=u,u=c)}else g=u,u=c;return S--,u===c&&S===0&&O(ri),u}function En(){var u;return u=Di(),u===c&&(u=Mi()),u}function Di(){var u,_,v,N,L;if(S++,u=g,i.charCodeAt(g)===123?(_=Je,g++):(_=c,S===0&&O(ii)),_!==c){for(v=g,N=[],L=i.charAt(g),ee.test(L)?g++:(L=c,S===0&&O(hr));L!==c;)N.push(L),L=i.charAt(g),ee.test(L)?g++:(L=c,S===0&&O(hr));v=i.substring(v,g),i.charCodeAt(g)===125?(N=gt,g++):(N=c,S===0&&O(ai)),N!==c?u=$i(v):(g=u,u=c)}else g=u,u=c;return S--,u===c&&(_=c,S===0&&O(si)),u}function Mi(){var u,_,v,N,L;if(S++,u=g,i.charCodeAt(g)===59?(_=Ye,g++):(_=c,S===0&&O(li)),_!==c){for(v=g,N=[],L=i.charAt(g),F.test(L)?g++:(L=c,S===0&&O(fr));L!==c;)N.push(L),L=i.charAt(g),F.test(L)?g++:(L=c,S===0&&O(fr));v=i.substring(v,g),u=Ai(v)}else g=u,u=c;return S--,u===c&&(_=c,S===0&&O(ci)),u}function wr(){var u,_,v,N;return S++,u=g,ke(),i.charCodeAt(g)===40?(_=Lt,g++):(_=c,S===0&&O(hi)),_!==c?(v=vr(),v!==c?(ke(),i.charCodeAt(g)===41?(N=kn,g++):(N=c,S===0&&O(fi)),N!==c?u=Ti(v):(g=u,u=c)):(g=u,u=c)):(g=u,u=c),S--,u===c&&S===0&&O(ui),u}function Ui(){var u,_,v;return S++,u=g,i.substr(g,3)===bt?(_=bt,g+=3):(_=c,S===0&&O(di)),_===c&&(i.substr(g,3)===Xe?(_=Xe,g+=3):(_=c,S===0&&O(gi)),_===c&&(i.substr(g,7)===Ft?(_=Ft,g+=7):(_=c,S===0&&O(mi)),_===c&&(i.charCodeAt(g)===42?(_=b,g++):(_=c,S===0&&O(_i))))),_!==c?(ke(),v=En(),v===c&&(v=null),u=Ii(_,v)):(g=u,u=c),S--,u===c&&(_=c,S===0&&O(pi)),u}function ke(){var u,_;for(S++,u=[],_=i.charAt(g),J.test(_)?g++:(_=c,S===0&&O(pr));_!==c;)u.push(_),_=i.charAt(g),J.test(_)?g++:(_=c,S===0&&O(pr));return S--,_=c,S===0&&O(vi),u}if(wt=C(),p.peg$library)return{peg$result:wt,peg$currPos:g,peg$FAILED:c,peg$maxFailExpected:jt,peg$maxFailPos:Oe};if(wt!==c&&g===i.length)return wt;throw wt!==c&&g<i.length&&O(Pi()),zi(jt,Oe<i.length?i.charAt(Oe):null,Oe<i.length?gr(Oe,Oe+1):gr(Oe,Oe))}return An={StartRules:["pgn"],SyntaxError:s,parse:l},An}var hh=uh();/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const en=0xffffffffffffffffn;function Tn(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function Wr(e,t){return e*t&en}function fh(e){return function(){let t=BigInt(e&en),n=BigInt(e>>64n&en);const r=Wr(Tn(Wr(t,5n),7n),9n);return n^=t,t=(Tn(t,24n)^n^n<<16n)&en,n=Tn(n,37n),e=n<<64n|t,r}}const pn=fh(0xa187eb39cdcaed8f31c4b365b102e01en),ph=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>pn()))),dh=Array.from({length:8},()=>pn()),gh=Array.from({length:16},()=>pn()),In=pn(),be="w",$e="b",le="p",qn="n",tn="b",Ct="r",We="q",ue="k",Pn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Vt{constructor(t,n){te(this,"color");te(this,"from");te(this,"to");te(this,"piece");te(this,"captured");te(this,"promotion");te(this,"flags");te(this,"san");te(this,"lan");te(this,"before");te(this,"after");const{color:r,piece:o,from:s,to:a,flags:l,captured:i,promotion:p}=n,c=de(s),w=de(a);this.color=r,this.piece=o,this.from=c,this.to=w,this.san=t._moveToSan(n,t._moves({legal:!0})),this.lan=c+w,this.before=t.fen(),t._makeMove(n),this.after=t.fen(),t._undoMove(),this.flags="";for(const m in q)q[m]&l&&(this.flags+=ot[m]);i&&(this.captured=i),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(ot.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(ot.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(ot.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(ot.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(ot.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(ot.BIG_PAWN)>-1}}const ve=-1,ot={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},q={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Gn={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},mh={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},_h={...Gn,...mh},D={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},zn={b:[16,32,17,15],w:[-16,-32,-17,-15]},Hr={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},vh=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],bh=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],kh={p:1,n:2,b:4,r:8,q:16,k:32},wh="pnbrqkPNBRQK",Vr=[qn,tn,Ct,We],Eh=7,yh=6,Ch=1,Sh=0,Qt={[ue]:q.KSIDE_CASTLE,[We]:q.QSIDE_CASTLE},qe={w:[{square:D.a1,flag:q.QSIDE_CASTLE},{square:D.h1,flag:q.KSIDE_CASTLE}],b:[{square:D.a8,flag:q.QSIDE_CASTLE},{square:D.h8,flag:q.KSIDE_CASTLE}]},$h={b:Ch,w:yh};function st(e){return e>>4}function It(e){return e&15}function ds(e){return"0123456789".indexOf(e)!==-1}function de(e){const t=It(e),n=st(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function yt(e){return e===be?$e:be}function Ah(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=t[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<o.length;a++){let l=0,i=!1;for(let p=0;p<o[a].length;p++)if(ds(o[a][p])){if(i)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(o[a][p],10),i=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[a][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,i=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:l}of s){if(!l.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((t[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(o[0]+o[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Th(e,t){const n=e.from,r=e.to,o=e.piece;let s=0,a=0,l=0;for(let i=0,p=t.length;i<p;i++){const c=t[i].from,w=t[i].to,m=t[i].piece;o===m&&n!==c&&r===w&&(s++,st(n)===st(c)&&a++,It(n)===It(c)&&l++)}return s>0?a>0&&l>0?de(n):l>0?de(n).charAt(1):de(n).charAt(0):""}function Ge(e,t,n,r,o,s=void 0,a=q.NORMAL){const l=st(r);if(o===le&&(l===Eh||l===Sh))for(let i=0;i<Vr.length;i++){const p=Vr[i];e.push({color:t,from:n,to:r,piece:o,captured:s,promotion:p,flags:a|q.PROMOTION})}else e.push({color:t,from:n,to:r,piece:o,captured:s,flags:a})}function Qr(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:le:(t=t.toLowerCase(),t==="o"?ue:t)}function Zn(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class gs{constructor(t=Pn,{skipValidation:n=!1}={}){te(this,"_board",new Array(128));te(this,"_turn",be);te(this,"_header",{});te(this,"_kings",{w:ve,b:ve});te(this,"_epSquare",-1);te(this,"_halfMoves",0);te(this,"_moveNumber",0);te(this,"_history",[]);te(this,"_comments",{});te(this,"_castling",{w:0,b:0});te(this,"_hash",0n);te(this,"_positionCount",new Map);this.load(t,{skipValidation:n})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:ve,b:ve},this._turn=be,this._castling={w:0,b:0},this._epSquare=ve,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{..._h},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:n=!1,preserveHeaders:r=!1}={}){let o=t.split(/\s+/);if(o.length>=2&&o.length<6){const l=["-","-","0","1"];t=o.concat(l.slice(-(6-o.length))).join(" ")}if(o=t.split(/\s+/),!n){const{ok:l,error:i}=Ah(t);if(!l)throw new Error(i)}const s=o[0];let a=0;this.clear({preserveHeaders:r});for(let l=0;l<s.length;l++){const i=s.charAt(l);if(i==="/")a+=8;else if(ds(i))a+=parseInt(i,10);else{const p=i<"a"?be:$e;this._put({type:i.toLowerCase(),color:p},de(a)),a++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=q.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=q.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=q.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=q.QSIDE_CASTLE),this._epSquare=o[3]==="-"?ve:D[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var a,l;let n=0,r="";for(let i=D.a8;i<=D.h1;i++){if(this._board[i]){n>0&&(r+=n,n=0);const{color:p,type:c}=this._board[i];r+=p===be?c.toUpperCase():c.toLowerCase()}else n++;i+1&136&&(n>0&&(r+=n),i!==D.h1&&(r+="/"),n=0,i+=8)}let o="";this._castling[be]&q.KSIDE_CASTLE&&(o+="K"),this._castling[be]&q.QSIDE_CASTLE&&(o+="Q"),this._castling[$e]&q.KSIDE_CASTLE&&(o+="k"),this._castling[$e]&q.QSIDE_CASTLE&&(o+="q"),o=o||"-";let s="-";if(this._epSquare!==ve)if(t)s=de(this._epSquare);else{const i=this._epSquare+(this._turn===be?16:-16),p=[i+1,i-1];for(const c of p){if(c&136)continue;const w=this._turn;if(((a=this._board[c])==null?void 0:a.color)===w&&((l=this._board[c])==null?void 0:l.type)===le){this._makeMove({color:w,from:c,to:this._epSquare,piece:le,captured:le,flags:q.EP_CAPTURE});const m=!this._isKingAttacked(w);if(this._undoMove(),m){s=de(this._epSquare);break}}}}return[r,this._turn,o,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:n,type:r}=this._board[t],o={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[r];return ph[o][s][t]}_epKey(){return this._epSquare===ve?0n:dh[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return gh[t]}_computeHash(){let t=0n;for(let n=D.a8;n<=D.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(t^=this._pieceKey(n))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=In),t}_updateSetup(t){this._history.length>0||(t!==Pn?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Pn)}get(t){return this._board[D[t]]}findPiece(t){var r;const n=[];for(let o=D.a8;o<=D.h1;o++){if(o&136){o+=7;continue}!this._board[o]||((r=this._board[o])==null?void 0:r.color)!==t.color||this._board[o].color===t.color&&this._board[o].type===t.type&&n.push(de(o))}return n}put({type:t,color:n},r){return this._put({type:t,color:n},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,n){this._hash^=this._pieceKey(t),this._board[t]=n,this._hash^=this._pieceKey(t)}_put({type:t,color:n},r){if(wh.indexOf(t.toLowerCase())===-1||!(r in D))return!1;const o=D[r];if(t==ue&&!(this._kings[n]==ve||this._kings[n]==o))return!1;const s=this._board[o];return s&&s.type===ue&&(this._kings[s.color]=ve),this._set(o,{type:t,color:n}),t===ue&&(this._kings[n]=o),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const n=this.get(t);return this._clear(D[t]),n&&n.type===ue&&(this._kings[n.color]=ve),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var r,o,s,a,l,i,p,c,w,m,C,y;this._hash^=this._castlingKey();const t=((r=this._board[D.e1])==null?void 0:r.type)===ue&&((o=this._board[D.e1])==null?void 0:o.color)===be,n=((s=this._board[D.e8])==null?void 0:s.type)===ue&&((a=this._board[D.e8])==null?void 0:a.color)===$e;(!t||((l=this._board[D.a1])==null?void 0:l.type)!==Ct||((i=this._board[D.a1])==null?void 0:i.color)!==be)&&(this._castling.w&=-65),(!t||((p=this._board[D.h1])==null?void 0:p.type)!==Ct||((c=this._board[D.h1])==null?void 0:c.color)!==be)&&(this._castling.w&=-33),(!n||((w=this._board[D.a8])==null?void 0:w.type)!==Ct||((m=this._board[D.a8])==null?void 0:m.color)!==$e)&&(this._castling.b&=-65),(!n||((C=this._board[D.h8])==null?void 0:C.type)!==Ct||((y=this._board[D.h8])==null?void 0:y.color)!==$e)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,a;if(this._epSquare===ve)return;const t=this._epSquare+(this._turn===be?-16:16),n=this._epSquare+(this._turn===be?16:-16),r=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==yt(this._turn)||((a=this._board[n])==null?void 0:a.type)!==le){this._hash^=this._epKey(),this._epSquare=ve;return}const o=l=>{var i,p;return!(l&136)&&((i=this._board[l])==null?void 0:i.color)===this._turn&&((p=this._board[l])==null?void 0:p.type)===le};r.some(o)||(this._hash^=this._epKey(),this._epSquare=ve)}_attacked(t,n,r){const o=[];for(let s=D.a8;s<=D.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==t)continue;const a=this._board[s],l=s-n;if(l===0)continue;const i=l+119;if(vh[i]&kh[a.type]){if(a.type===le){if(l>0&&a.color===be||l<=0&&a.color===$e)if(r)o.push(de(s));else return!0;continue}if(a.type==="n"||a.type==="k")if(r){o.push(de(s));continue}else return!0;const p=bh[i];let c=s+p,w=!1;for(;c!==n;){if(this._board[c]!=null){w=!0;break}c+=p}if(!w)if(r){o.push(de(s));continue}else return!0}}return r?o:!1}attackers(t,n){return n?this._attacked(n,D[t],!0):this._attacked(this._turn,D[t],!0)}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(yt(t),n)}hash(){return this._hash.toString(16)}isAttacked(t,n){return this._attacked(n,D[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let r=0,o=0;for(let s=D.a8;s<=D.h1;s++){if(o=(o+1)%2,s&136){s+=7;continue}const a=this._board[s];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===tn&&n.push(o),r++)}if(r===2)return!0;if(r===3&&(t[tn]===1||t[qn]===1))return!0;if(r===t[tn]+2){let s=0;const a=n.length;for(let l=0;l<a;l++)s+=n[l];if(s===0||s===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:r=void 0}={}){const o=this._moves({square:n,piece:r});return t?o.map(s=>new Vt(this,s)):o.map(s=>this._moveToSan(s,o))}_moves({legal:t=!0,piece:n=void 0,square:r=void 0}={}){var C;const o=r?r.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),a=[],l=this._turn,i=yt(l);let p=D.a8,c=D.h1,w=!1;if(o)if(o in D)p=c=D[o],w=!0;else return[];for(let y=p;y<=c;y++){if(y&136){y+=7;continue}if(!this._board[y]||this._board[y].color===i)continue;const{type:U}=this._board[y];let j;if(U===le){if(s&&s!==U)continue;j=y+zn[l][0],this._board[j]||(Ge(a,l,y,j,le),j=y+zn[l][1],$h[l]===st(y)&&!this._board[j]&&Ge(a,l,y,j,le,void 0,q.BIG_PAWN));for(let K=2;K<4;K++)j=y+zn[l][K],!(j&136)&&(((C=this._board[j])==null?void 0:C.color)===i?Ge(a,l,y,j,le,this._board[j].type,q.CAPTURE):j===this._epSquare&&Ge(a,l,y,j,le,le,q.EP_CAPTURE))}else{if(s&&s!==U)continue;for(let K=0,R=Hr[U].length;K<R;K++){const M=Hr[U][K];for(j=y;j+=M,!(j&136);){if(!this._board[j])Ge(a,l,y,j,U);else{if(this._board[j].color===l)break;Ge(a,l,y,j,U,this._board[j].type,q.CAPTURE);break}if(U===qn||U===ue)break}}}}if((s===void 0||s===ue)&&(!w||c===this._kings[l])){if(this._castling[l]&q.KSIDE_CASTLE){const y=this._kings[l],U=y+2;!this._board[y+1]&&!this._board[U]&&!this._attacked(i,this._kings[l])&&!this._attacked(i,y+1)&&!this._attacked(i,U)&&Ge(a,l,this._kings[l],U,ue,void 0,q.KSIDE_CASTLE)}if(this._castling[l]&q.QSIDE_CASTLE){const y=this._kings[l],U=y-2;!this._board[y-1]&&!this._board[y-2]&&!this._board[y-3]&&!this._attacked(i,this._kings[l])&&!this._attacked(i,y-1)&&!this._attacked(i,U)&&Ge(a,l,this._kings[l],U,ue,void 0,q.QSIDE_CASTLE)}}if(!t||this._kings[l]===-1)return a;const m=[];for(let y=0,U=a.length;y<U;y++)this._makeMove(a[y]),this._isKingAttacked(l)||m.push(a[y]),this._undoMove();return m}move(t,{strict:n=!1}={}){let r=null;if(typeof t=="string")r=this._moveFromSan(t,n);else if(typeof t=="object"){const s=this._moves();for(let a=0,l=s.length;a<l;a++)if(t.from===de(s[a].from)&&t.to===de(s[a].to)&&(!("promotion"in s[a])||t.promotion===s[a].promotion)){r=s[a];break}}if(!r)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const o=new Vt(this,r);return this._makeMove(r),this._incPositionCount(),o}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,n){this._hash^=this._pieceKey(t),this._board[n]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(n)}_makeMove(t){var o,s,a,l;const n=this._turn,r=yt(n);if(this._push(t),this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&q.EP_CAPTURE&&(this._turn===$e?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:n})),this._board[t.to].type===ue){if(this._kings[n]=t.to,t.flags&q.KSIDE_CASTLE){const i=t.to-1,p=t.to+1;this._movePiece(p,i)}else if(t.flags&q.QSIDE_CASTLE){const i=t.to+1,p=t.to-2;this._movePiece(p,i)}this._castling[n]=0}if(this._castling[n]){for(let i=0,p=qe[n].length;i<p;i++)if(t.from===qe[n][i].square&&this._castling[n]&qe[n][i].flag){this._castling[n]^=qe[n][i].flag;break}}if(this._castling[r]){for(let i=0,p=qe[r].length;i<p;i++)if(t.to===qe[r][i].square&&this._castling[r]&qe[r][i].flag){this._castling[r]^=qe[r][i].flag;break}}if(this._hash^=this._castlingKey(),t.flags&q.BIG_PAWN){let i;n===$e?i=t.to-16:i=t.to+16,!(t.to-1&136)&&((o=this._board[t.to-1])==null?void 0:o.type)===le&&((s=this._board[t.to-1])==null?void 0:s.color)===r||!(t.to+1&136)&&((a=this._board[t.to+1])==null?void 0:a.type)===le&&((l=this._board[t.to+1])==null?void 0:l.color)===r?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=ve}else this._epSquare=ve;t.piece===le?this._halfMoves=0:t.flags&(q.CAPTURE|q.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===$e&&this._moveNumber++,this._turn=r,this._hash^=In}undo(){const t=this._hash,n=this._undoMove();if(n){const r=new Vt(this,n);return this._decPositionCount(t),r}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=In;const r=this._turn,o=yt(r);if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:r})),n.captured)if(n.flags&q.EP_CAPTURE){let s;r===$e?s=n.to-16:s=n.to+16,this._set(s,{type:le,color:o})}else this._set(n.to,{type:n.captured,color:o});if(n.flags&(q.KSIDE_CASTLE|q.QSIDE_CASTLE)){let s,a;n.flags&q.KSIDE_CASTLE?(s=n.to+1,a=n.to-1):(s=n.to-2,a=n.to+1),this._movePiece(a,s)}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const r=[];let o=!1;for(const m in this._header)this._header[m]&&r.push(`[${m} "${this._header[m]}"]`+t),o=!0;o&&this._history.length&&r.push(t);const s=m=>{const C=this._comments[this.fen()];if(typeof C<"u"){const y=m.length>0?" ":"";m=`${m}${y}{${C}}`}return m},a=[];for(;this._history.length>0;)a.push(this._undoMove());const l=[];let i="";for(a.length===0&&l.push(s(""));a.length>0;){i=s(i);const m=a.pop();if(!m)break;if(!this._history.length&&m.color==="b"){const C=`${this._moveNumber}. ...`;i=i?`${i} ${C}`:C}else m.color==="w"&&(i.length&&l.push(i),i=this._moveNumber+".");i=i+" "+this._moveToSan(m,this._moves({legal:!0})),this._makeMove(m)}if(i.length&&l.push(s(i)),l.push(this._header.Result||"*"),n===0)return r.join("")+l.join(" ");const p=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},c=function(m,C){for(const y of C.split(" "))if(y){if(m+y.length>n){for(;p();)m--;r.push(t),m=0}r.push(y),m+=y.length,r.push(" "),m++}return p()&&m--,m};let w=0;for(let m=0;m<l.length;m++){if(w+l[m].length>n&&l[m].includes("{")){w=c(w,l[m]);continue}w+l[m].length>n&&m!==0?(r[r.length-1]===" "&&r.pop(),r.push(t),w=0):m!==0&&(r.push(" "),w++),r.push(l[m]),w+=l[m].length}return r.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}setHeader(t,n){return this._header[t]=n??Gn[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Gn[t]||null,!0):!1}getHeaders(){const t={};for(const[n,r]of Object.entries(this._header))r!==null&&(t[n]=r);return t}loadPgn(t,{strict:n=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(t=t.replace(new RegExp(r,"g"),`
`));const o=hh.parse(t);this.reset();const s=o.headers;let a="";for(const p in s)p.toLowerCase()==="fen"&&(a=s[p]),this.header(p,s[p]);if(!n)a&&this.load(a,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let l=o.root;for(;l;){if(l.move){const p=this._moveFromSan(l.move,n);if(p==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(p),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const i=o.result;i&&Object.keys(this._header).length&&this._header.Result!==i&&this.setHeader("Result",i)}_moveToSan(t,n){let r="";if(t.flags&q.KSIDE_CASTLE)r="O-O";else if(t.flags&q.QSIDE_CASTLE)r="O-O-O";else{if(t.piece!==le){const o=Th(t,n);r+=t.piece.toUpperCase()+o}t.flags&(q.CAPTURE|q.EP_CAPTURE)&&(t.piece===le&&(r+=de(t.from)[0]),r+="x"),r+=de(t.to),t.promotion&&(r+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(t,n=!1){let r=Zn(t);n||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O"));let o=Qr(r),s=this._moves({legal:!0,piece:o});for(let m=0,C=s.length;m<C;m++)if(r===Zn(this._moveToSan(s[m],s)))return s[m];if(n)return null;let a,l,i,p,c,w=!1;if(l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(a=l[1],i=l[2],p=l[3],c=l[4],i.length==1&&(w=!0)):(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(a=l[1],i=l[2],p=l[3],c=l[4],i.length==1&&(w=!0))),o=Qr(r),s=this._moves({legal:!0,piece:a||o}),!p)return null;for(let m=0,C=s.length;m<C;m++)if(i){if((!a||a.toLowerCase()==s[m].piece)&&D[i]==s[m].from&&D[p]==s[m].to&&(!c||c.toLowerCase()==s[m].promotion))return s[m];if(w){const y=de(s[m].from);if((!a||a.toLowerCase()==s[m].piece)&&D[p]==s[m].to&&(i==y[0]||i==y[1])&&(!c||c.toLowerCase()==s[m].promotion))return s[m]}}else if(r===Zn(this._moveToSan(s[m],s)).replace("x",""))return s[m];return null}ascii(){let t=`   +------------------------+
`;for(let n=D.a8;n<=D.h1;n++){if(It(n)===0&&(t+=" "+"87654321"[st(n)]+" |"),this._board[n]){const r=this._board[n].type,s=this._board[n].color===be?r.toUpperCase():r.toLowerCase();t+=" "+s+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let r=0;const o=this._turn;for(let s=0,a=n.length;s<a;s++)this._makeMove(n[s]),this._isKingAttacked(o)||(t-1>0?r+=this.perft(t-1):r++),this._undoMove();return r}turn(){return this._turn}board(){const t=[];let n=[];for(let r=D.a8;r<=D.h1;r++)this._board[r]==null?n.push(null):n.push({square:de(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t}squareColor(t){if(t in D){const n=D[t];return(st(n)+It(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],r=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;t?r.push(new Vt(this,o)):r.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return r}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const n=this._positionCount.get(t)??0;n===1?this._positionCount.delete(t):this._positionCount.set(t,n-1)}_pruneComments(){const t=[],n={},r=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)t.push(this._undoMove());for(r(this.fen());;){const o=t.pop();if(!o)break;this._makeMove(o),r(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const o of[ue,We])n[o]!==void 0&&(n[o]?this._castling[t]|=Qt[o]:this._castling[t]&=~Qt[o]);this._updateCastlingRights();const r=this.getCastlingRights(t);return(n[ue]===void 0||n[ue]===r[ue])&&(n[We]===void 0||n[We]===r[We])}getCastlingRights(t){return{[ue]:(this._castling[t]&Qt[ue])!==0,[We]:(this._castling[t]&Qt[We])!==0}}moveNumber(){return this._moveNumber}}const Ih=["Pawn","Bishop","Knight","Rook","Queen","King"],ms="♟",_s="♜",vs="♞",bs="♝",ks="♛",or="♚",ws="♙",Es="♖",ys="♘",Cs="♗",Ss="♕",sr="♔",Ph=nr("hidden"),zh=rr("hidden"),$s=e=>{const t=e.slice(0,2),n=e.slice(2,4),r=e[4];return{from:t,to:n,promotion:r}},Pt=e=>e.split(" ").filter(t=>t.trim().length>0),dn=(e,t)=>{const n=new gs;return(t===void 0?Pt(e):Pt(e).slice(0,t)).forEach(o=>n.move($s(o))),n.moves({verbose:!0}).map(o=>{n.move(o);const s=As(o,n.isCheck(),n.isCheckmate());return n.undo(),s})},As=(e,t,n)=>e.isKingsideCastle()?e.color=="w"?Ht("E1","H1",t,n):Ht("E8","H8",t,n):e.isQueensideCastle()?e.color=="w"?Ht("E1","A1",t,n):Ht("E8","A8",t,n):e.isEnPassant()?Ku(e.from.toUpperCase(),e.to.toUpperCase(),t,n):ju(Sn(e.piece),e.from.toUpperCase(),e.to.toUpperCase(),e.isCapture()?Sn(e.captured):null,e.isPromotion()?Sn(e.promotion):null,t,n),Ts=e=>{const t=new gs,n=[];for(const r of Pt(e)){const o=t.move($s(r));n.push(As(o,t.isCheck(),t.isCheckmate()))}return n},Zh=()=>{},vt=()=>{const e=T("lichess/game-state");return e?Pt(e.moves).length%2===0?"white":"black":null},Is=()=>{const e=Rt();return e?us(e):null},Rt=()=>{const e=T("lichess/game-info");return e?e.color:null},Jr=()=>{const e=T("lichess/game-state");return e?Ts(e.moves):[]},Ps=()=>T("lang")??"en",zs=()=>un(),Oh=()=>"home";let He={lang:null,screen:Oh(),clock:null,input:zs(),"input-san/file":null,"input-san/rank":null,started:!1,lockScreen:!1,online:!0,fullscreen:!1,ratedChallenge:!1,challengeColor:"random","lichess/host":"https://lichess.org","lichess/user":null,"lichess/stream-events":[],"lichess/challenges":[],"lichess/current-challenge":null,"lichess/my-challenge":null,"lichess/game-info":null,"lichess/game-state":null,"lichess/opponent":null,"lichess/following":[],"lichess/chat":null,"lichess/seek":null};const Zs=["lang"],Rh=()=>Zs.map(e=>{const t=localStorage.getItem(e);t!==null&&(He[e]=JSON.parse(t))});Rh();let zt=[];const lt=(e,t)=>{let n=T(e);He[e]=t(n),Zs.includes(e)&&localStorage.setItem(e,JSON.stringify(He[e]));const r=zt.filter(([o,s])=>o==e);for(const o of r){const s=o[1];s(e)}return e!=="clock"&&(console.groupCollapsed(e),console.debug("from",n),console.debug("to",He[e]),console.debug("subscribers",r),console.groupEnd()),T(e)},Nh=(e,t)=>Ie(n=>I(e,n))(t(T(e))),I=(e,t)=>lt(e,()=>t),T=e=>JSON.parse(JSON.stringify(He[e])),dt=e=>He[e],xh=()=>Object.keys(He),se=(...e)=>t=>zt=zt.concat(e.map(n=>[n,t])),Lh=e=>zt=zt.filter(([t,n])=>e(t));Yu(document.location.hostname)&&Object.assign(window,{UcuiState:He});const Fh=(e,t)=>Array.isArray(t)?t.map(n=>`${e}=${encodeURIComponent(n)}`).join("&"):`${e}=${encodeURIComponent(t)}`,ir=e=>Object.keys(e).map(t=>Fh(t,e[t])).join("&"),Dh=(e,t)=>`${e}?${ir(t)}`,Mh=(e="application/json")=>{const t=new Headers;return e!=="none"&&t.append("Content-Type",e),{mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},Os=e=>(t,n,r)=>{const o={method:"GET",...Mh(),...r};return e(n,o).then(s=>{if(s.ok)return s.json();throw s}).then(s=>{try{return t.parse(s)}catch(a){throw console.error("Failed to parse obj from",n),console.error("=>",s),a}})},Uh=Os(fetch),Rs=(e="application/x-www-form-urlencoded")=>{const t={};return e!=="none"&&(t["Content-Type"]=e),{method:"POST",mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},Ns=e=>(t,n,r,o)=>{const s={method:"POST",...Rs(),...o};return typeof r=="string"?(s.headers["Content-Type"]="text/plain",s.body=r):s.body=ir(r),e(n,s).then(a=>{if(a.ok)return a.json();throw a}).then(a=>{try{return t.parse(a)}catch(l){throw console.error("Failed to parse obj from",n),console.error("=>",a),l}})},jh=Ns(fetch),Fe=X([h("white"),h("black")]),xs=X([h("lobby"),h("friend"),h("ai"),h("api"),h("tournament"),h("position"),h("import"),h("importlive"),h("simul"),h("relay"),h("pool"),h("swiss"),h("arena")]),Kh=X([x({id:h(10),name:h("created")}),x({id:h(20),name:h("started")}),x({id:h(25),name:h("aborted")}),x({id:h(30),name:h("mate")}),x({id:h(31),name:h("resign")}),x({id:h(32),name:h("stalemate")}),x({id:h(33),name:h("timeout")}),x({id:h(34),name:h("draw")}),x({id:h(35),name:h("outoftime")}),x({id:h(36),name:h("cheat")}),x({id:h(37),name:h("noStart")}),x({id:h(38),name:h("unknownFinish")}),x({id:h(60),name:h("variantEnd")})]),gn=X([h("ultraBullet"),h("bullet"),h("blitz"),h("rapid"),h("classical"),h("correspondence")]),qh=x({id:Z(),username:Z(),rating:Te(),ratingDiff:Te().optional()}),Gh=x({id:Z().nullable(),username:Z(),rating:Te().optional(),ai:Te()}),mn=x({bot:B(),board:B()}),Nt=X([h("standard"),h("chess960"),h("crazyhouse"),h("antichess"),h("atomic"),h("horde"),h("kingOfTheHill"),h("racingKings"),h("threeCheck"),h("fromPosition")]),_n=x({key:Nt,name:Z(),short:Z().optional()}),Ls=x({id:Z(),fullId:Z(),gameId:Z(),fen:Z(),color:Fe,lastMove:Z(),source:xs,status:Kh,variant:_n,speed:gn,perf:Z(),rated:B(),hasMoved:B(),opponent:X([qh,Gh]),isMyTurn:B(),secondsLeft:Te().optional(),compat:mn,winner:Fe.optional(),ratingDiff:Te().optional(),tournamentId:Z().optional()}),Bh=x({type:h("gameStart"),game:Ls}),Wh=x({type:h("gameFinish"),game:Ls}),Hh=X([h("created"),h("offline"),h("canceled"),h("declined"),h("accepted")]),Yr=x({id:Z(),name:Z(),rating:Te(),title:Z().nullable(),flair:Z().optional(),patron:B().optional(),provisional:B().optional(),online:B().optional(),lag:Te().optional()}),Vh=x({type:h("clock"),limit:Te(),increment:Te(),show:Z()}),Qh=x({type:h("correspondence"),daysPerTurn:Te()}),Jh=x({type:h("unlimited")}),Yh=X([Vh,Qh,Jh]),ut=x({id:Z(),url:Wl(),status:Hh,challenger:Yr,destUser:Yr.nullable(),variant:_n,rated:B(),speed:gn,timeControl:Yh,color:X([Fe,h("random")]),finalColor:Fe,perf:x({icon:Z(),name:Z()}),direction:X([h("in"),h("out")]).optional(),initialFen:Z().optional()}),Xh=X([h("ultraBullet"),h("bullet"),h("blitz"),h("rapid"),h("classical"),h("correspondence"),h("chess960"),h("crazyhouse"),h("antichess"),h("atomic"),h("horde"),h("kingOfTheHill"),h("racingKings"),h("threeCheck")]),Fs=X([h("created"),h("started"),h("aborted"),h("mate"),h("resign"),h("stalemate"),h("timeout"),h("draw"),h("outoftime"),h("cheat"),h("noStart"),h("unknownFinish"),h("variantEnd")]);x({id:Z(),fullId:Z(),status:x({id:V(),name:Fs}),variant:_n,rated:B(),speed:gn,perf:Xh,direction:X([h("in"),h("out")]).optional(),fen:Z().optional(),turns:V().optional(),source:xs.optional(),createdAt:Te().optional(),player:Fe.optional()});const ef=x({type:h("challenge"),challenge:ut,compat:mn.optional()}),tf=x({type:h("challengeCanceled"),challenge:ut,compat:mn.optional()}),nf=X([h("generic"),h("later"),h("tooFast"),h("tooSlow"),h("timeControl"),h("rated"),h("casual"),h("standard"),h("variant"),h("noBot"),h("onlyBot")]),rf=ut.extend({declineReason:Z(),declineReasonKey:nf}),of=x({type:h("challengeDeclined"),challenge:rf,compat:mn.optional()}),sf=X([Bh,Wh,ef,tf,of]);x({in:ut.array(),out:ut.array()});const Ds=X([h("noAbort"),h("noRematch"),h("noGiveTime"),h("noClaimWin"),h("noEarlyDraw")]),af=x({rated:B(),"clock.limit":V(),"clock.increment":V(),color:X([Fe,h("random")]),variant:Nt,fen:Z().optional(),keepAliveStream:B(),rules:Ds.optional()});x({time:V(),increment:V(),rated:B().optional(),color:X([Fe,h("random")]),variant:Nt,ratingRange:Z().optional()});const cf=x({id:Z()}),lf=X([h(1),h(2),h(3),h(4),h(5),h(7),h(10),h(14)]),uf=x({rated:B(),days:lf,color:X([Fe,h("random")]),variant:Nt,fen:Z().optional(),keepAliveStream:B(),rules:Ds.optional()});X([af,uf]);x({"clock.limit":V(),"clock.increment":V(),color:X([Fe,h("random")]),variant:Nt,fen:Z().optional(),level:X([h(1),h(2),h(3),h(4),h(5),h(6),h(7),h(8)])});const xt=x({ok:B()}),hf=x({initial:V(),increment:V()}),ff=x({name:Z()}),ar=X([h("GM"),h("WGM"),h("IM"),h("WIM"),h("FM"),h("WFM"),h("NM"),h("CM"),h("WCM"),h("WNM"),h("LM"),h("BOT")]),pf=x({id:Z(),name:Z(),title:ar.nullable(),rating:V().nullable(),provisional:B().optional()}),df=x({aiLevel:V()}),Xr=X([pf,df]),Ms=x({type:h("gameState"),moves:Z(),wtime:V(),btime:V(),winc:V(),binc:V(),status:Fs,winner:Fe.optional(),wdraw:B().optional(),bdraw:B().optional(),wtakeback:B().optional(),btakeback:B().optional()}),gf=x({type:h("gameFull"),id:Z(),variant:_n,clock:hf,speed:gn,perf:ff,rated:B(),createdAt:V(),white:Xr,black:Xr,initialFen:Z(),state:Ms,tournamentId:Z().optional()}),mf=x({type:h("chatLine"),room:X([h("player"),h("spectator")]),username:Z(),text:Z()}),_f=x({type:h("opponentGone"),gone:B(),claimWinInSeconds:V()}),vf=X([Ms,gf,mf,_f]);x({gameId:Z(),move:Z(),offeringDraw:B().optional()});const pe=x({games:V(),rating:V(),rd:V(),prog:V(),prov:B().optional()}),bf=x({chess960:pe.optional(),atomic:pe.optional(),racingKings:pe.optional(),ultraBullet:pe.optional(),blitz:pe.optional(),kingOfTheHill:pe.optional(),threeCheck:pe.optional(),antichess:pe.optional(),crazyhouse:pe.optional(),bullet:pe.optional(),correspondence:pe.optional(),horde:pe.optional(),puzzle:pe.optional(),classical:pe.optional(),rapid:pe.optional(),storm:pe.optional(),racer:pe.optional(),streak:pe.optional()}),kf=x({flag:Z().optional(),location:Z().optional(),bio:Z().optional(),realName:Z().optional(),fideRating:V().optional(),uscfRating:V().optional(),ecfRating:V().optional(),cfcRating:V().optional(),rcfRating:V().optional(),dsbRating:V().optional(),links:Z().optional()}),wf=x({total:V(),tv:V()}),Us=gu({id:Z(),username:Z(),url:Z().optional(),perfs:bf.optional(),title:ar.optional(),flair:Z().optional(),createdAt:V().optional(),disabled:B().optional(),tosViolation:B().optional(),profile:kf.optional(),seenAt:V().optional(),playTime:wf.optional(),patron:B().optional(),verified:B().optional()}),Ef=x({id:Z(),name:Z(),flair:Z().optional(),title:ar.optional(),online:B().optional(),playing:B().optional(),streaming:B().optional(),patron:B().optional()});x({ids:Z(),withSignal:B().optional(),withGameIds:B().optional(),withGameMetas:B().optional()});const Ce=e=>[T("lichess/host"),e].join("/api"),yf=(e,t)=>{const n=dt("lichess/user");if(n){const r=n.streamer(sf,Ce("/stream/event"));return r.onMessage(e),r.onClose(t),!0}return!1},Cf=(e,t)=>{const n=dt("lichess/user");return n?(n.streamer(vf,Ce(`/board/game/stream/${e}`)).onMessage(t),!0):!1},Sf=(e,t)=>{const n=dt("lichess/user");if(n){const r=n.streamer(Us,Ce("/rel/following"));return r.onMessage(e),t&&r.onClose(t),!0}return!1},$f=(e=!1)=>{const t=dt("lichess/user");if(t)return Os(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),Uh},Qe=(e=!1)=>{const t=dt("lichess/user");if(t)return Ns(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),jh},Af=e=>Qe()(xt,Ce(`/challenge/${e}/accept`),{}),Tf=(e,t)=>Qe()(xt,Ce(`/challenge/${e}/decline`),{reason:t}),If=(e,t)=>Qe()(xt,Ce(`/board/game/${e}/move/${t}`),{}),js=e=>Qe()(xt,Ce(`/board/game/${e}/resign`),{}),nn=(e,t)=>Qe()(xt,Ce(`/board/game/${e}/draw/${t}`),{}),Ks=e=>Qe()(Us.array(),Ce("/users"),e).then(n=>{for(const r of n)if(r.id===e)return r;throw new Error("Failed to get a user with id: "+e)}),Pf=(e,t)=>Qe()(ut,Ce(`/challenge/${e}`),t),zf=e=>Qe()(ut,Ce("/challenge/ai"),e),Zf=e=>$f()(Ef.array(),Dh(Ce("/users/status"),{ids:e.join(",")})),Of=()=>fetch([T("lichess/host"),"__ping"].join("/"),{mode:"no-cors",cache:"default",redirect:"follow",credentials:"same-origin"}),Rf=(e,t)=>{const n=dt("lichess/user");return n?new Promise((r,o)=>{n.streamer(cf,Ce("/board/seek"),a=>{r(a)},{...Rs(),body:ir(e)}).onClose(t)}):Promise.reject("no-config")},Nf={"home/link-git":{en:"Source code & feedback",fr:"Code source & retours"},"home/connect":{en:"Connect",fr:"Connecter"},"home/challenges":{en:"Challenges",fr:"Défis"},"home/challenge-accept":{en:"Accept",fr:"Accepter"},"home/challenge-decline":{en:"Decline",fr:"Décliner"},"home/challenge-wait":{en:"Waiting to be challenged…",fr:"En attente d'un défi…"}},xf={"button/home":{en:"Home",fr:"Accueil"},"button/players":{en:"Players",fr:"Partenaires"},"button/create":{en:"Create a game",fr:"Initier une partie"}},Lf={"players/classic":{en:"Classic",fr:"Classique"},"players/rapid":{en:"Rapid",fr:"Rapide"},"players/username":{en:"Username",fr:"Bon d'utilisateurice"},"players/search":{en:"Search",fr:"Recherchez"},"players/find":{en:"Find player",fr:"Trouver un·e partenaire"},"players/ai":{en:"Play with Lichess AI",fr:"Jouer avec l'automate"},"players/ai-level":{en:"Level",fr:"Niveau"},"players/following":{en:"Players you follow",fr:"Les joueur·euses que vous suivez "}},Ff={"end/aborted":{en:"Game has been aborted",fr:"La partie a été annulée"},"end/mate":{en:"Mate",fr:"Échec et mat"},"end/resign":{en:"Resigned",fr:"Abandon"},"end/stalemate":{en:"Stalemate",fr:"Pat"},"end/timeout":{en:"Flagged",fr:"Perdue au temps"},"end/outoftime":{en:"Flagged",fr:"Perdue au temps"},"end/draw":{en:"Draw",fr:"Partie nulle"},"end/cheat":{en:"Cheat!",fr:"Triche"},"end/noStart":{en:"Game didn't dtart",fr:"La partie n'a pas commencé"}},Df={"challenge/rated":{en:"Rated",fr:"Classé"},"challenge/casual":{en:"Casual",fr:"Amical"}},Mf={"home/tagline":{en:()=>Ke(Ve("ucui","Téléchecs "),"is a ",Tt("",T("lichess/host")," Lichess")," client for players who prefer to play over the board."),fr:()=>Ke(Ve("ucui","Téléchecs "),"est une interface à ",Tt("",T("lichess/host")," Lichess")," pour les joueuses et joueurs qui préfèrent jouer sur un échiquier.")},"home/description":{en:()=>f("",Ke(`
            Connect this page with your Lichess account to create games or challenge players 
            from here.  
            `),Ke(`
            Once a game starts, you'll be presented with a black 
            screen where you'll see your opponent moves when they play, 
            and an input widget to enter your moves when it's your turn.
            And that will be all of it. 
            `),Ke("Enjoy!")),fr:()=>f("",Ke(`
            Connectez cette page à votre compte Lichess pour commencer à jouer.  
            `),Ke(`
            Lorsqu'une partie commence, les coups de l'adversaire 
            vous seront présentés de manière textuelle. 
            Et à votre tour de jouer, une interface de saisie 
            vous permettra de transmettre votre coup. 
            `),Ke("Bonne partie!"))}},Uf={"clock/flagged":{en:"Flag",fr:"Tombé"}},jf={...Nf,...xf,...Lf,...Ff,...Df,...Uf},Kf={...Mf},H=e=>jf[e][Ps()],eo=e=>Kf[e][Ps()](),qf=()=>{const e=document.location,n=new URL(e.href).searchParams.get("lang");if(n){try{const r=Kr.parse(n);I("lang",r)}catch{console.error("Failed to recognize lang",n)}return}if(T("lang")===null){try{const r=Kr.parse(navigator.language.split("-")[0]);I("lang",r)}catch{console.error("Failed to set lang from navigator",navigator.language)}return}},qs=e=>{const t=T("lichess/game-info"),n=T("lichess/game-state");if(Gs(),t&&n&&n.status==="started"){const r=window.setInterval(e,100);I("clock",{interval:r,gameId:t.gameId})}},Gs=()=>{const e=T("clock");e&&(clearInterval(e.interval),I("clock",null))},Gf=e=>{const t=T("clock"),n=T("lichess/game-state");!n&&t?Gs():n&&n.status==="started"&&!t&&qs(e)},Bf=e=>{const t=f("time white active","--:--"),n=f("time black","--:--");e.append(f("clock",t,n)),On({white:t,black:n}),oo({white:t,black:n}),se("lichess/game-state")(()=>{Gf(()=>On({white:t,black:n})),oo({white:t,black:n})}),qs(()=>{On({white:t,black:n})})},to="--:--",Wf=()=>f("flag",H("clock/flagged")),Hf=()=>{const e=T("lichess/game-info"),t=T("lichess/game-state"),n=vt();if(t&&e&&n){if(Pt(t.moves).length<2)return{white:Jt(t.wtime),black:Jt(t.btime)};const r=Date.now()-t.timestamp,o=n==="white"?t.wtime-r:t.wtime,s=n==="black"?t.btime-r:t.btime;return{white:Jt(o),black:Jt(s)}}else return{white:to,black:to}},On=({white:e,black:t})=>{const n=oe(e),r=oe(t),o=Hf();n(o.white),r(o.black)},{floor:Rn}=Math,Jt=e=>{if(e<=0)return Wf();const t=e/1e3,n=Rn(t%60),r=Rn(t/60%60),o=Rn(t/60/60),s=n<10?`0${n.toFixed(0)}`:`${n.toFixed(0)}`,a=r<10?`0${r.toFixed(0)}`:`${r.toFixed(0)}`,l=o<10?`0${o.toFixed(0)}`:`${o.toFixed(0)}`;return t>=3600?`${l}:${a}:${s}`:`${a}:${s}`},Vf=rr("active"),Qf=nr("active"),no=rh("active"),ro=(e,t)=>t&&!no(e)?Qf(e):!t&&no(e)?Vf(e):void 0,oo=({white:e,black:t})=>{const n=vt();ro(e,n=="white"),ro(t,n=="black")},Nn=(e,t=null,n=null,r,o,s=null)=>({_tag:"Normal",role:e,capture:r,to:o,rank:n,file:t,promotion:s}),so=e=>({_tag:"Castle",side:e}),Jf=(e,t,n)=>e.filter(r=>{switch(r._tag){case"Castle":return!1;case"EnPassant":return t=="Pawn"&&r.to===n;default:return n===r.to&&t===r.role}}),Yf=(e,t)=>{switch(e._tag){case"Normal":{if(e.role==="Pawn")return Nn("Pawn",e.capture!==null?Be(e.from):null,null,e.capture!==null,e.to,e.promotion);{let n=!1,r=!1,o=!1;for(const s of t)s._tag==="Normal"&&e.from!=s.from&&e.role==s.role&&e.to==s.to&&e.promotion==s.promotion&&(n=!0,$n(e.from)==$n(s.from)&&(o=!0),Be(e.from)==Be(s.from)&&(r=!0));return Nn(e.role,n&&(!r||o)?Be(e.from):null,r?$n(e.from):null,e.capture!==null,e.to,e.promotion)}}case"EnPassant":return Nn("Pawn",Be(e.from),null,!0,e.to,null);case"Castle":return Be(e.rook)<Be(e.king)?so("QueenSide"):so("KingSide")}},io=e=>{switch(e){case"Pawn":return"P";case"Rook":return"R";case"Knight":return"N";case"Bishop":return"B";case"Queen":return"Q";case"King":return"K"}},ao=(e,t)=>{switch(e){case"Pawn":return t==="white"?ws:ms;case"Rook":return t==="white"?Es:_s;case"Knight":return t==="white"?ys:vs;case"Bishop":return t==="white"?Cs:bs;case"Queen":return t==="white"?Ss:ks;case"King":return t==="white"?sr:or}},Xf=(e,t)=>{let n=[];return t._tag==="Normal"&&t.role!=="Pawn"&&(n=Jf(e,t.role,t.to)),Yf(t,n)},ep={symbol:!1,color:"white"},Bs={symbol:!0,color:"white"},tp=(e,t,{symbol:n,color:r})=>{const o=[];switch(t._tag){case"Normal":{t.role!=="Pawn"&&o.push(n?ao(t.role,r):io(t.role)),t.file!==null&&o.push(t.file.toLowerCase()),t.rank!==null&&o.push(t.rank),t.capture&&o.push("x"),o.push(t.to.toLowerCase()),t.promotion!==null&&o.push("=",n?ao(t.promotion,r):io(t.promotion));break}case"Castle":{t.side==="KingSide"?o.push("O","-","O"):o.push("O","-","O","-","O");break}case"null":o.push("--")}return e.checkmate?o.push("#"):e.check&&o.push("+"),o.join("")},cr=(e,t,n=ep)=>tp(e,Xf(t,e),n),co=(e,t)=>{const n=T("lichess/game-info"),r=T("lichess/game-state"),o=vt(),s=Rt();if(n&&r&&o&&s){const a=oe(t);if(oe(e)(Ve("name",n.opponent.username)),o===s){const i=Ts(r.moves),p=i.pop();if(p){const c=cr(p,dn(r.moves,i.length),Bs);a(c)}else a(f("idle",`Your turn to play ${o}`))}else a(f("compute"))}},np=e=>{const t=f("info"),n=f("state");co(t,n);const r=f("engine",t,n);e.append(r),se("lichess/game-state")(()=>co(t,n))},rp="/telechecs/",op=(...e)=>{var t="/",n=new RegExp(t+"{1,}","g");return e.join(t).replace(n,t)},Ws=(...e)=>op(rp,...e),sp=Ws("chess.ogg"),Hs=ft(lh("-",sp),e=>e("preload","auto"));document.body.append(Hs);const ip=()=>{Hs.play()},ap=e=>(I("input",un()),I("lichess/game-state",hn(e.state)),I("started",!0),!0),cp=e=>(I("input",un()),I("lichess/game-state",hn(e)),Rt()===vt()&&ip(),!0),lp=e=>(I("lichess/chat",hn(e)),!0),up=e=>{switch(e.type){case"gameFull":return ap(e);case"gameState":return cp(e);case"chatLine":return lp(e);case"opponentGone":return!0}},hp=e=>Cf(e,up),fp=e=>{const t=T("lichess/game-info");t&&If(t.gameId,ls(e))},pp=e=>I("input-san/file",e),dp=e=>I("input-san/rank",e),Vs=()=>{I("input-san/file",null),I("input-san/rank",null)},lo=(e,t)=>{switch(e){case"Pawn":return t==="black"?ms:ws;case"Rook":return t==="black"?_s:Es;case"Knight":return t==="black"?vs:ys;case"Bishop":return t==="black"?bs:Cs;case"Queen":return t==="black"?ks:Ss;case"King":return t==="black"?or:sr}},gp=(e,t)=>t.some(n=>{switch(n._tag){case"Normal":return n.role===e;case"Castle":return e==="King";case"EnPassant":return e==="Pawn"}}),uo=e=>e?"selected":"",mp=(e,t)=>Ih.map(n=>gp(n,t)?ge(f(`piece ${n}  ${uo(e===n)}`,lo(n,"black")),r=>r("click",()=>{Vs(),e===n?I("input",zs()):I("input",Gu(n))})):f(`piece ${n}  ${uo(e===n)}`,lo(n,"white"))),_p=e=>{Vs(),I("input",Wu(e)),fp(e)},vp=e=>t=>e.filter(n=>{switch(n._tag){case"Castle":{switch(t){case"G1":return n.king==="E1"&&n.rook=="H1";case"C1":return n.king==="E1"&&n.rook=="A1";case"G8":return n.king==="E8"&&n.rook=="H8";case"C8":return n.king==="E8"&&n.rook=="A8"}return!1}case"Normal":case"EnPassant":return n.to===t}}),bp=e=>t=>ge(f("move",cr(t,dn([e.moves,ls(t)].join(" ")),{symbol:!0,color:"black"})),n=>n("click",()=>{I("input-san/file",null),_p(t)})),kp=e=>{const t=T("lichess/game-state");return t?e.map(bp(t)):[]},wp=(e,t,n)=>{const r=new Set(n.map(cs).map(Be));return Du.map(o=>o===t?f(`button-select file file-${o} selected`,o.toLowerCase()):r.has(o)?ge(f(`button-select file file-${o} candidate`,o.toLowerCase()),s=>s("click",()=>{I("input",e),pp(o)})):f(`button-select file file-${o} nothing`,o.toLowerCase()))},Ep=(e,t,n)=>{const r=vp(n.filter(o=>tr(o)===Kn(e)));return Mu.map(o=>{if(t===null)return f(`button-select rank rank-${o} nothing`,o.toLowerCase());const s=Uu(t,o),a=r(s);return a.length===0?f(`button-select rank rank-${o} nothing`,o.toLowerCase()):o===T("input-san/rank")?f(`button-select rank rank-${o} selected`,o.toLowerCase()):ge(f(`button-select rank rank-${o} candidate`,o.toLowerCase()),l=>l("click",()=>{dp(o);const i=Kn(e);i&&I("input",Bu(i,a))}))})},yp=(e,t)=>{const n=e._tag==="candidates"?e.candidates:[],r=n.length===0?f("select hidden"):f("select",...kp(n)),o=T("input-san/file"),s=f("square-select files",...wp(e,o,t)),a=f("square-select ranks",...Ep(e,o,t));return[r,a,s]},Cp=e=>{const t=f("pieces"),n=f("moves"),r=f("input input-san",n,t);e.append(r);const o=()=>{const s=T("lichess/game-state");if(s&&vt()===Rt()){const a=oe(t),l=oe(n),i=T("input"),p=Kn(i),c=dn(s.moves);a(...mp(p,c)),(i._tag==="role"||i._tag==="candidates")&&c.length>0?(zh(n),l(...yp(i,c.filter(w=>tr(w)===i.role)))):(Ph(n),Ae(n))}else Ae(n),Ae(t)};se("lichess/game-state","lichess/game-info","input","input-san/file","input-san/rank")(o),o()},we=(e,t)=>({name:e,className:t??e}),Sp=e=>(typeof e=="string"?e:e.className).toLowerCase().split(" ").join("-"),$p=e=>typeof e=="string"||e instanceof HTMLElement?e:e.name,me=(e,t)=>ge(f(`button button-${Sp(e)}`,$p(e)),n=>n("click",t)),vn=(e,t)=>me(t,()=>I("screen",e)),bn=()=>vn("home",H("button/home")),Ap=()=>vn("seek",H("button/create"));let Bn=null;const Tp=e=>Bn=e,sn=e=>{Bn!==null&&(e?Bn.requestFullscreen().then(()=>I("fullscreen",!0)).catch(t=>console.warn("failed to enter fullscreen",t)):document.exitFullscreen().then(()=>I("fullscreen",!1)).catch(t=>console.warn("failed to exit fullscreen",t)))},Ip=e=>{I("lichess/current-challenge",e),I("lichess/challenges",[]),I("input",un()),Af(e.id)},Pp=e=>{lt("lichess/challenges",t=>t.filter(n=>n.id!==e.id)),Tf(e.id,"generic")},zp=e=>{const t=f("lock locked"),n=nr("locked"),r=rr("locked"),o=()=>T("lockScreen")?n(t):r(t);se("lockScreen")(o),o(),e.append(t)},ho="⛶",xn="½",Zp="⚐",Op="1.",Rp=()=>T("fullscreen")?me(we(ho,"fullscreen-off"),()=>sn(!1)):me(we(ho,"fullscreen-on"),()=>sn(!0)),Np=e=>{const t=Rt(),n=Is();if(e&&t&&n){if(t==="white"&&e.wdraw||t==="black"&&e.bdraw)return"me";if(n==="white"&&e.wdraw||n==="black"&&e.bdraw)return"other"}return"none"},xp=(e,t)=>{switch(Np(e)){case"me":return me(we(xn,"draw-waiting"),Zh);case"other":return f("draw-answer",f("icon",xn),me(we("Accept","draw-accept"),()=>nn(t.fullId,"yes")),me(we("Decline","draw-decline"),()=>{nn(t.fullId,"no"),lt("lichess/game-state",n=>n&&{...n,bdraw:!1,wdraw:!1})}));case"none":return me(we(xn,"draw-offer"),()=>nn(t.fullId,"yes"))}},Lp=e=>me(we(Zp,"resign"),()=>js(e.fullId)),Fp=(...e)=>{const t=f("anti-slip on",...e);let n=null;return t.addEventListener("click",()=>{n||(t.classList.remove("on"),n=window.setTimeout(()=>{n=null,t.classList.add("on")},6e3))}),t},Dp=e=>{const t=f("game-actions actions-view"),n=f("game-actions actions-game"),r=()=>{const o=T("lichess/game-state"),s=T("lichess/game-info");oe(t)(Rp(),vn("movelist",Op)),o&&s?oe(n)(Fp(xp(o,s),Lp(s))):Ae(n)};r(),e.append(t,n),se("lichess/game-info","lichess/game-state","fullscreen")(r)},Mp=e=>{np(e),Dp(e),Cp(e),Bf(e),zp(e)};var ye={},fo;function Up(){return fo||(fo=1,function(e){var t=ye&&ye.__extends||function(){var b=function(d,E){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,P){$.__proto__=P}||function($,P){for(var A in P)P.hasOwnProperty(A)&&($[A]=P[A])},b(d,E)};return function(d,E){b(d,E);function $(){this.constructor=d}d.prototype=E===null?Object.create(E):($.prototype=E.prototype,new $)}}(),n=ye&&ye.__assign||function(){return n=Object.assign||function(b){for(var d,E=1,$=arguments.length;E<$;E++){d=arguments[E];for(var P in d)Object.prototype.hasOwnProperty.call(d,P)&&(b[P]=d[P])}return b},n.apply(this,arguments)},r=ye&&ye.__awaiter||function(b,d,E,$){function P(A){return A instanceof E?A:new E(function(W){W(A)})}return new(E||(E=Promise))(function(A,W){function G(J){try{F($.next(J))}catch(he){W(he)}}function ee(J){try{F($.throw(J))}catch(he){W(he)}}function F(J){J.done?A(J.value):P(J.value).then(G,ee)}F(($=$.apply(b,d||[])).next())})},o=ye&&ye.__generator||function(b,d){var E={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},$,P,A,W;return W={next:G(0),throw:G(1),return:G(2)},typeof Symbol=="function"&&(W[Symbol.iterator]=function(){return this}),W;function G(F){return function(J){return ee([F,J])}}function ee(F){if($)throw new TypeError("Generator is already executing.");for(;E;)try{if($=1,P&&(A=F[0]&2?P.return:F[0]?P.throw||((A=P.return)&&A.call(P),0):P.next)&&!(A=A.call(P,F[1])).done)return A;switch(P=0,A&&(F=[F[0]&2,A.value]),F[0]){case 0:case 1:A=F;break;case 4:return E.label++,{value:F[1],done:!1};case 5:E.label++,P=F[1],F=[0];continue;case 7:F=E.ops.pop(),E.trys.pop();continue;default:if(A=E.trys,!(A=A.length>0&&A[A.length-1])&&(F[0]===6||F[0]===2)){E=0;continue}if(F[0]===3&&(!A||F[1]>A[0]&&F[1]<A[3])){E.label=F[1];break}if(F[0]===6&&E.label<A[1]){E.label=A[1],A=F;break}if(A&&E.label<A[2]){E.label=A[2],E.ops.push(F);break}A[2]&&E.ops.pop(),E.trys.pop();continue}F=d.call(b,E)}catch(J){F=[6,J],P=0}finally{$=A=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}},s=ye&&ye.__spreadArrays||function(){for(var b=0,d=0,E=arguments.length;d<E;d++)b+=arguments[d].length;for(var $=Array(b),P=0,d=0;d<E;d++)for(var A=arguments[d],W=0,G=A.length;W<G;W++,P++)$[P]=A[W];return $};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function b(){}return b.prototype.toString=function(){return"ErrorOAuth2"},b}();e.ErrorOAuth2=a;var l=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnknown"},d}(a);e.ErrorUnknown=l;var i=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorNoAuthCode"},d}(a);e.ErrorNoAuthCode=i;var p=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidReturnedStateParam"},d}(a);e.ErrorInvalidReturnedStateParam=p;var c=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidJson"},d}(a);e.ErrorInvalidJson=c;var w=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidScope"},d}(a);e.ErrorInvalidScope=w;var m=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidRequest"},d}(a);e.ErrorInvalidRequest=m;var C=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidToken"},d}(a);e.ErrorInvalidToken=C;var y=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAuthenticationGrant"},d}(a);e.ErrorAuthenticationGrant=y;var U=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnauthorizedClient"},d}(y);e.ErrorUnauthorizedClient=U;var j=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessDenied"},d}(y);e.ErrorAccessDenied=j;var K=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedResponseType"},d}(y);e.ErrorUnsupportedResponseType=K;var R=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorServerError"},d}(y);e.ErrorServerError=R;var M=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorTemporarilyUnavailable"},d}(y);e.ErrorTemporarilyUnavailable=M;var Q=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorAccessTokenResponse"},d}(a);e.ErrorAccessTokenResponse=Q;var Pe=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidClient"},d}(Q);e.ErrorInvalidClient=Pe;var De=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorInvalidGrant"},d}(Q);e.ErrorInvalidGrant=De;var Je=function(b){t(d,b);function d(){return b!==null&&b.apply(this,arguments)||this}return d.prototype.toString=function(){return"ErrorUnsupportedGrantType"},d}(Q);e.ErrorUnsupportedGrantType=Je;var gt=function(){function b(){this.realm="",this.error=""}return b}();e.ErrorWWWAuthenticate=gt,e.RawErrorToErrorClassMap={invalid_request:m,invalid_grant:De,unauthorized_client:U,access_denied:j,unsupported_response_type:K,invalid_scope:w,server_error:R,temporarily_unavailable:M,invalid_client:Pe,unsupported_grant_type:Je,invalid_json:c,invalid_token:C};function Ye(b){return new(e.RawErrorToErrorClassMap[b]||l)}e.toErrorClass=Ye;function Lt(b){var d=b.slice(7).replace(/"/g,"").split(", ").map(function(E){var $,P=E.split("="),A=P[0],W=P[1];return $={},$[A]=W,$}).reduce(function(E,$){return n(n({},E),$)},{});return{realm:d.realm,error:d.error}}e.fromWWWAuthenticateHeaderStringToObject=Lt;var kn="Authorization",bt="WWW-Authenticate";e.LOCALSTORAGE_ID="oauth2authcodepkce",e.LOCALSTORAGE_STATE=e.LOCALSTORAGE_ID+"-state",e.RECOMMENDED_CODE_VERIFIER_LENGTH=96,e.RECOMMENDED_STATE_LENGTH=32;var Xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",Ft=function(){function b(d){return this.state={},this.config=d,this.recoverState(),this}return b.prototype.decorateFetchHTTPClient=function(d){var E=this;return function($,P){for(var A=[],W=2;W<arguments.length;W++)A[W-2]=arguments[W];return E.state.isHTTPDecoratorActive?E.getAccessToken().then(function(G){var ee=G.token,F=Object.assign({},P);return F.headers||(F.headers={}),F.headers[kn]="Bearer "+ee.value,d.apply(void 0,s([$,F],A))}).then(function(G){if(G.ok||!G.headers.has(bt.toLowerCase()))return G;var ee=Ye(Lt(G.headers.get(bt.toLowerCase())).error);return ee instanceof C&&E.config.onAccessTokenExpiry(function(){return E.exchangeRefreshTokenForAccessToken()}),Promise.reject(ee)}):d.apply(void 0,s([$,P],A))}},b.prototype.isReturningFromAuthServer=function(){var d=b.extractParamFromUrl(location.href,"error");if(d)return Promise.reject(Ye(d));var E=b.extractParamFromUrl(location.href,"code");if(!E)return Promise.resolve(!1);var $=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),P=b.extractParamFromUrl(location.href,"state");return P!==$.stateQueryParam?(console.warn("state query string parameter doesn't match the one sent! Possible malicious activity somewhere."),Promise.reject(new p)):($.authorizationCode=E,$.hasAuthCodeBeenExchangedForAccessToken=!1,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify($)),this.setState($),Promise.resolve(!0))},b.prototype.fetchAuthorizationCode=function(d){return r(this,void 0,void 0,function(){var E,$,P,A,W,G,ee,F,J,he,ze;return o(this,function(Re){switch(Re.label){case 0:return this.assertStateAndConfigArePresent(),E=this.config,$=E.clientId,P=E.extraAuthorizationParams,A=E.redirectUrl,W=E.scopes,[4,b.generatePKCECodes()];case 1:return G=Re.sent(),ee=G.codeChallenge,F=G.codeVerifier,J=b.generateRandomState(e.RECOMMENDED_STATE_LENGTH),this.state=n(n({},this.state),{codeChallenge:ee,codeVerifier:F,stateQueryParam:J,isHTTPDecoratorActive:!0}),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state)),he=this.config.authorizationUrl+"?response_type=code&"+("client_id="+encodeURIComponent($)+"&")+("redirect_uri="+encodeURIComponent(A)+"&")+("scope="+encodeURIComponent(W.join(" "))+"&")+("state="+J+"&")+("code_challenge="+encodeURIComponent(ee)+"&")+"code_challenge_method=S256",(P||d)&&(ze=n(n({},P),d),he=he+"&"+b.objectToQueryString(ze)),location.replace(he),[2]}})})},b.prototype.getAccessToken=function(){var d=this;this.assertStateAndConfigArePresent();var E=this.config.onAccessTokenExpiry,$=this.state,P=$.accessToken,A=$.authorizationCode,W=$.explicitlyExposedTokens,G=$.hasAuthCodeBeenExchangedForAccessToken,ee=$.refreshToken,F=$.scopes;return A?this.authCodeForAccessTokenRequest?this.authCodeForAccessTokenRequest:!this.isAuthorized()||!G?(this.authCodeForAccessTokenRequest=this.exchangeAuthCodeForAccessToken(),this.authCodeForAccessTokenRequest):ee&&this.isAccessTokenExpired()?E(function(){return d.exchangeRefreshTokenForAccessToken()}):Promise.resolve({token:P,explicitlyExposedTokens:W,scopes:F,refreshToken:ee}):Promise.reject(new i)},b.prototype.exchangeRefreshTokenForAccessToken=function(){var d=this,E;this.assertStateAndConfigArePresent();var $=this.config,P=$.extraRefreshParams,A=$.clientId,W=$.tokenUrl,G=this.state.refreshToken;G||console.warn("No refresh token is present.");var ee=W,F="grant_type=refresh_token&"+("refresh_token="+((E=G)===null||E===void 0?void 0:E.value)+"&")+("client_id="+A);return P&&(F=ee+"&"+b.objectToQueryString(P)),fetch(ee,{method:"POST",body:F,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(J){return J.status>=400?J.json().then(function(he){return Promise.reject(he)}):J.json()}).then(function(J){var he=J.access_token,ze=J.expires_in,Re=J.refresh_token,et=J.scope,Ue=d.config.explicitlyExposedTokens,_e=[],Ne={},tt={value:he,expiry:new Date(Date.now()+parseInt(ze)*1e3).toString()};if(d.state.accessToken=tt,Re){var mt={value:Re};d.state.refreshToken=mt}Ue&&(Ne=Object.fromEntries(Ue.map(function(Ze){return[Ze,J[Ze]]}).filter(function(Ze){Ze[0];var je=Ze[1];return je!==void 0})),d.state.explicitlyExposedTokens=Ne),et&&(_e=et.split(" "),d.state.scopes=_e),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d.state));var xe={token:tt,scopes:_e};return Ue&&(xe.explicitlyExposedTokens=Ne),xe}).catch(function(J){var he=d.config.onInvalidGrant,ze=J.error||"There was a network error.";switch(ze){case"invalid_grant":he(function(){return d.fetchAuthorizationCode()});break}return Promise.reject(Ye(ze))})},b.prototype.getGrantedScopes=function(){return this.state.scopes},b.prototype.isHTTPDecoratorActive=function(d){this.state.isHTTPDecoratorActive=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state))},b.prototype.isAuthorized=function(){return!!this.state.accessToken},b.prototype.isAccessTokenExpired=function(){var d=this.state.accessToken;return!!(d&&new Date>=new Date(d.expiry))},b.prototype.reset=function(){this.setState({}),this.authCodeForAccessTokenRequest=void 0},b.prototype.assertStateAndConfigArePresent=function(){if(!this.state||!this.config)throw console.error("state:",this.state,"config:",this.config),new Error("state or config is not set.")},b.prototype.exchangeAuthCodeForAccessToken=function(d){var E=this;this.assertStateAndConfigArePresent();var $=this.state,P=$.authorizationCode,A=P===void 0?d:P,W=$.codeVerifier,G=W===void 0?"":W,ee=this.config,F=ee.clientId,J=ee.onInvalidGrant,he=ee.redirectUrl;G?A||console.warn("No authorization grant code is being passed."):console.warn("No code verifier is being sent.");var ze=this.config.tokenUrl,Re="grant_type=authorization_code&"+("code="+encodeURIComponent(A||"")+"&")+("redirect_uri="+encodeURIComponent(he)+"&")+("client_id="+encodeURIComponent(F)+"&")+("code_verifier="+G);return fetch(ze,{method:"POST",body:Re,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(et){var Ue=et.json().catch(function(_e){return{error:"invalid_json"}});return et.ok?Ue.then(function(_e){var Ne=_e.access_token,tt=_e.expires_in,mt=_e.refresh_token,xe=_e.scope,Ze=E.config.explicitlyExposedTokens,je=[],kt={};E.state.hasAuthCodeBeenExchangedForAccessToken=!0,E.authCodeForAccessTokenRequest=void 0;var Dt={value:Ne,expiry:new Date(Date.now()+parseInt(tt)*1e3).toString()};if(E.state.accessToken=Dt,mt){var wn={value:mt};E.state.refreshToken=wn}Ze&&(kt=Object.fromEntries(Ze.map(function(nt){return[nt,_e[nt]]}).filter(function(nt){nt[0];var Ut=nt[1];return Ut!==void 0})),E.state.explicitlyExposedTokens=kt),xe&&(je=xe.split(" "),E.state.scopes=je),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(E.state));var Mt={token:Dt,scopes:je};return Ze&&(Mt.explicitlyExposedTokens=kt),Mt}):Ue.then(function(_e){var Ne=_e.error;switch(Ne){case"invalid_grant":J(function(){return E.fetchAuthorizationCode()});break}return Promise.reject(Ye(Ne))})})},b.prototype.recoverState=function(){return this.state=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),this},b.prototype.setState=function(d){return this.state=d,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(d)),this},b.base64urlEncode=function(d){var E=btoa(d);return E=E.replace(/\+/g,"-"),E=E.replace(/\//g,"_"),E=E.replace(/=/g,""),E},b.extractParamFromUrl=function(d,E){var $=d.split("?");if($.length<2)return"";$=$[1].split("#");var P=$[0].split("&").reduce(function(W,G){return W.concat(G.split("="))},[]);if(P.length<2)return"";var A=P.indexOf(E);return decodeURIComponent(A>=0?P[A+1]:"")},b.objectToQueryString=function(d){return Object.entries(d).map(function(E){var $=E[0],P=E[1];return $+"="+encodeURIComponent(P)}).join("&")},b.generatePKCECodes=function(){var d=new Uint32Array(e.RECOMMENDED_CODE_VERIFIER_LENGTH);crypto.getRandomValues(d);var E=b.base64urlEncode(Array.from(d).map(function($){return Xe[$%Xe.length]}).join(""));return crypto.subtle.digest("SHA-256",new TextEncoder().encode(E)).then(function($){for(var P=new Uint8Array($),A="",W=P.byteLength,G=0;G<W;G++)A+=String.fromCharCode(P[G]);return A}).then(b.base64urlEncode).then(function($){return{codeChallenge:$,codeVerifier:E}})},b.generateRandomState=function(d){var E=new Uint32Array(d);return crypto.getRandomValues(E),Array.from(E).map(function($){return Xe[$%Xe.length]}).join("")},b}();e.OAuth2AuthCodePKCE=Ft}(ye)),ye}var jp=Up();const Kp=new RegExp(`
`),qp=(e,t,n,r,o)=>e(n,o).then(s=>s.body).then(s=>{if(s==null)throw new Error("Response body is NULL");const a=s.getReader();return r&&r(()=>{a.cancel()}),new ReadableStream({start(l){const i=new TextDecoder,p=()=>{a.read().then(({done:c,value:w})=>{if(c){console.log("done",c),l.close();return}i.decode(w).split(Kp).map(C=>{if(C.trim().length>0)try{const U=JSON.parse(C),j=t.parse(U);console.log("stream",j),l.enqueue(j)}catch{console.error(`[${n}] Failed to make an object out of chunk:`,C)}}),p()})};p()}}).getReader()}),Gp=e=>(t,n,r,o)=>{const s=[],a=[];let l=[];const i=C=>{const y=()=>{C.read().then(({done:U,value:j})=>{w(Me(j)),U?m():setTimeout(y,0)}).catch(m)};y()},p=C=>{l.length>0&&(l.forEach(C),l=[]),s.push(C)},c=C=>{a.push(C)},w=Ie(C=>{s.length>0?s.find(y=>!y(C)):l.push(C)}),m=()=>{a.forEach(C=>C())};return qp(e,t,n,r,o).then(i).catch(()=>setTimeout(m,200)),{onMessage:p,onClose:c}},Bp=["board:play","challenge:read","follow:read"],Wp=`ucui-${location.host}`,po=`${location.protocol}//${location.host}${Ws()}`,Hp=()=>{const e=T("lichess/host");let t=null;const n=new jp.OAuth2AuthCodePKCE({authorizationUrl:`${e}/oauth`,tokenUrl:`${e}/api/token`,clientId:Wp,scopes:Bp,redirectUrl:po,onAccessTokenExpiry:i=>i(),onInvalidGrant:console.warn}),r=async()=>{try{await n.getAccessToken()&&await a()}catch(i){console.error(i)}if(!t)try{await n.isReturningFromAuthServer()&&(await a(),history.replaceState({auth:!0},"authenticate",po))}catch(i){console.error(i)}},o=async()=>{await n.fetchAuthorizationCode()},s=async()=>{t&&await t.httpClient(`${e}/api/token`,{method:"DELETE"}),localStorage.clear(),t=null},a=async()=>{const i=n.decorateFetchHTTPClient(window.fetch),c={...await(await i(`${e}/api/account`)).json(),httpClient:i,streamer:Gp(i)};if(c.error)throw c.error;t=c};return{init:r,login:o,logout:s,user:()=>Ie(i=>({id:i.id,username:i.username,streamer:i.streamer,httpClient:i.httpClient}))(Me(t))}},it=Hp();it.init().then(()=>{Ie(t=>I("lichess/user",t))(it.user())});let Yt=!1;const Qs=()=>{Yt||(Yt=!0,T("lichess/user")?(I("online",!0),yf(t=>(lt("lichess/stream-events",n=>n.concat(t)),!0),()=>{Yt=!1,I("online",!1),window.setTimeout(Qs,2e4)})):Yt=!1)},Vp=()=>ge(f("button button-login",H("home/connect")),e=>e("click",async()=>{const t=No(()=>{it.login().then(()=>{n(it.user())})}),n=Ie(r=>{I("lichess/user",r)});rn(it.user(),n,t)})),Qp=()=>ge(f("button button-logout","×"),e=>e("click",()=>it.logout().then(()=>I("lichess/user",null)))),Jp=e=>t=>{Qs(),Ae(e),e.append(f("user",f("username",Tt("",`${T("lichess/host")}/@/${t.id}`,t.username)),Qp()))},Yp=e=>()=>{Ae(e),e.append(Vp())},Xp=e=>{const t=Ie(Jp(e)),n=No(Yp(e)),r=se("lichess/user"),o=()=>{rn(it.user(),t,n)};r(o),o()},go=e=>{Sf(t=>(lt("lichess/following",n=>n.filter(r=>r.id!==t.id).concat(t)),!1),async()=>{const t=await Zf(T("lichess/following").map(n=>n.id));for(const n of t){const r=e.querySelector(`[data-id="${n.id}"]`);r&&(n.online?r.classList.add("online"):r.classList.remove("online"))}})},ed=Ie(({classical:e,rapid:t})=>f("perfs",f("classical",`${H("players/classic")}: ${e?e.rating:"?"}`),f("rapid",`${H("players/rapid")}: ${t?t.rating:"?"}`))),td=e=>ge(f("result",f("username",e.username),ed(Me(e.perfs))),t=>t("click",()=>{I("lichess/opponent",e),I("screen","challenge")})),nd=()=>{const e=ft(ah("","search"),r=>r("placeholder",H("players/username"))),t=f("results"),n=ge(f("button submit",H("players/search")),r=>r("click",()=>{const o=e.value;Ks(o).then(s=>oe(t)(td(s)))}));return f("lookup",f("section",f("title",H("players/find"))),f("search-block",e,n),t)},mo=e=>ft(f("user",ge(f("username",e.username),t=>t("click",()=>{I("lichess/opponent",e),I("screen","challenge")})),f("activity")),t=>t("data-id",e.id)),rd=e=>ge(f(`level level-${e}`,`${e}`),t=>t("click",()=>{I("lichess/opponent",{_tag:"lichess-ai",level:e}),I("screen","challenge")})),od=[1,2,3,4,5,6,7,8],sd=()=>f("user lichess-ai",f("section",H("players/ai")),f("levels",f("label",H("players/ai-level")),...od.map(rd))),Js=e=>{const t=f("users",...T("lichess/following").map(mo)),n=me(we("↻","refresh"),()=>{go(t)}),r=f("section",f("title",H("players/following")),n);e.append(f("players-inner",r,t,sd(),nd())),se("lichess/following")(()=>{oe(t)(...T("lichess/following").map(mo))}),go(t)},id=e=>{switch(e.type){case"clock":return e.show;case"correspondence":return`${e.daysPerTurn} day`;case"unlimited":return"unlimited"}},ad=e=>f("challenge",f("spec",f("challenger",e.challenger.name),f("time",id(e.timeControl))),f("actions",ge(f("button button-accept",H("home/challenge-accept")),t=>t("click",()=>{Ip(e),I("screen","game")})),ge(f("button button-decline",H("home/challenge-decline")),t=>t("click",()=>{Pp(e)})))),_o=()=>{const e=T("lichess/challenges");return e.length>0?e.map(ad):[f("waiting",H("home/challenge-wait"))]},vo=()=>f("footer",Tt("link","https://github.com/pierremarc/telechecs",H("home/link-git"))),cd=()=>f("intro",eo("home/tagline"),ch("board-image","https://raw.githubusercontent.com/pierremarc/telechecs/main/picture.jpg"),eo("home/description")),ld=()=>{const e=f("challenges",..._o()),t=oe(e);return se("lichess/challenges")(()=>{t(..._o())}),f("challenge-block",f("section",f("title",H("home/challenges"))),e)},ud=()=>f("section create-game",Ap()),bo=e=>{const t=oe(e),n=()=>{const r=f("login");Xp(r);const o=f("header",f("title","Téléchecs"),r);if(T("lichess/user")){const s=f("players");Js(s),t(f("home",o,s,ld(),ud(),vo()))}else t(f("home",o,cd(),vo()))};n(),se("lichess/user")(n)},hd="wakeLock"in navigator,fd=()=>{if(hd){const e=se(...xh().filter(i=>i!=="lockScreen"));let t=null;const n=i=>Nh("lockScreen",p=>p!==i?Hn(i):Wn),r=()=>T("screen")==="game"?t===null?!0:!t.released:!1,o=()=>!!(T("screen")!=="game"&&t&&!t.released),s=()=>{navigator.wakeLock.request("screen").then(i=>{t=i,console.log("WakeLock acquired"),n(!0),t.addEventListener("release",()=>{n(!1),console.log("Navigator released lock sentinel")})}).catch(i=>{console.error("failed to lock screen",i),I("lichess/chat",hn({type:"chatLine",room:"spectator",username:"Téléchecs",text:`Failed to lock screen: ${i}`}))})},a=()=>{n(!1),t&&!t.released&&t.release().then(()=>{t=null}).catch(i=>console.error("failed to release wakelock",i))},l=()=>{r()?s():o()&&a()};e(l),l()}},pd=e=>{switch(e.name){case"aborted":return H("end/aborted");case"mate":return H("end/mate");case"resign":return H("end/resign");case"stalemate":return H("end/stalemate");case"timeout":return H("end/timeout");case"draw":return H("end/draw");case"outoftime":return H("end/outoftime");case"cheat":return H("end/cheat");case"noStart":return H("end/noStart");case"created":case"started":case"unknownFinish":case"variantEnd":return"Don't know..."}},dd=e=>f("status",pd(e.status)),Ln=({winner:e})=>e===void 0?"½ - ½":e==="white"?" 1 - 0":"0 - 1",Ys=e=>e.color===e.winner?f("result won",Ln(e)):us(e.color)===e.winner?f("result lost",Ln(e)):f("result draw",Ln(e)),gd=Ie(e=>f("section",me("Rematch",()=>{Ks(e).then(t=>{I("lichess/opponent",t),I("screen","challenge")})}))),md=e=>f("section",vn("movelist","Review the game"),ft(Tt("link",`${T("lichess/host")}/${e.gameId}`,"Review the game on Lichess"),t=>t("target","_blank"))),_d=e=>Ie(t=>{oe(e)(Ys(t),dd(t),gd(Me(t.opponent.id)),md(t))}),vd=e=>{const t=f("info"),n=_d(t),r=f("header",f("title","End of game"),bn());n(Me(T("lichess/game-info"))),se("lichess/game-info")(()=>n(Me(T("lichess/game-info")))),e.append(f("end",r,t))},bd={_tag:"pending"},kd=()=>vt()===Is()?Jr().concat(bd):Jr(),wd=(e,t,n)=>Ve("move",cr(t,dn(e.moves,n),Bs),"  "),Ed=()=>ei(()=>f("hidden"),f("pending")),Fn=(e,t,n)=>{switch(t._tag){case"pending":return Ed();default:return wd(e,t,n)}},ko=e=>Ve("normal",`${e+1}. `),wo=Ie(e=>Qu(2,kd()).map(([t,n],r)=>{const o=r*2;return t&&n?f("ply",ko(r),Ve("moves",Fn(e,t,o),Fn(e,n,o+1))):t?f("ply",ko(r),Ve("moves",Fn(e,t,o))):f("empty")})),yd=e=>ge(f("button","Resign"),t=>t("click",()=>js(e.gameId))),Cd=e=>ge(f("button","Draw"),t=>t("click",()=>nn(e.gameId,"yes"))),Xs=(e,t)=>{const n=T("lichess/game-info");return n&&n.status.name==="started"?e(n):t},ei=(e,t)=>{const n=T("lichess/game-info");return n&&n.status.name!=="created"&&n.status.name!=="started"?e(n):t},Eo=()=>Xs(e=>[Cd(e),yd(e)],[]),yo=()=>ei(Ys,f("no-outcome")),Co=()=>[sh("title","Moves"),Xs(()=>ge(f("to-game  to-button","↩"),e=>e("click",()=>I("screen","game"))),bn())],Sd=e=>{const t=f("moves",...rn(Me(T("lichess/game-state")),wo,Er([f("no-moves")]))),n=f("header",...Co()),r=f("actions",...Eo()),o=f("outcome",yo());e.append(f("movelist",n,f("listing",t),o,r));const s=oe(t),a=oe(o),l=oe(r),i=oe(n),p=se("lichess/game-state"),c=se("started","lichess/game-info");p(()=>{s(...rn(Me(T("lichess/game-state")),wo,Er([f("no-moves")])))}),c(()=>{i(...Co()),l(...Eo()),a(yo())})},$d=e=>{const t=f("events"),n=oh("","Events"),r=()=>{Ae(t),T("lichess/stream-events").forEach(o=>t.append(f("event"),ih("json",JSON.stringify(o,void 0,4))))};r(),e.append(n,t),se("lichess/stream-events")(r)},lr=e=>"_tag"in e&&e._tag==="lichess-ai",Ad=(e,t,n)=>({color:n,"clock.increment":t,"clock.limit":e*60,keepAliveStream:!1,rated:T("ratedChallenge"),variant:"standard"}),Td=(e,t,n,r)=>({color:n,"clock.increment":t,"clock.limit":e*60,variant:"standard",level:r}),So=e=>{switch(e){case"white":return sr;case"black":return or;case"random":return"⚄"}},Id=(e,t,n,r)=>ge(r,o=>o("click",()=>{lr(e)?zf(Td(t,n,T("challengeColor"),e.level)).then(s=>I("lichess/my-challenge",s)):Pf(e.username,Ad(t,n,T("challengeColor"))).then(s=>I("lichess/my-challenge",s))})),$o=e=>lr(e)?`LichessAI ${e.level}`:e.username,Pd=(e,[t,n])=>f("challenge-create",Id(e,t,n,f("time-control",f("time",t),f("label","minutes"),f("increment","+ .",fs(n.toString(),2,"0"))))),Ao=()=>T("ratedChallenge")?f("toggle",f("selected",H("challenge/rated")),me(we(H("challenge/casual"),"casual"),()=>I("ratedChallenge",!1))):f("toggle",me(we(H("challenge/rated"),"rated"),()=>I("ratedChallenge",!0)),f("selected",H("challenge/casual"))),Dn=(e,t)=>t?f("selected",So(e)):me(we(So(e),e),()=>I("challengeColor",e)),To=()=>f("select",Dn("white",T("challengeColor")==="white"),Dn("random",T("challengeColor")==="random"),Dn("black",T("challengeColor")==="black")),zd=e=>{const t=T("lichess/opponent");if(t){const n=f("choices",...hs.map(s=>Pd(t,s))),r=f("rated-selector",Ao()),o=f("color-selector",To());e.append(f("challenge-page",f("header",f("title",`Challenge ${$o(t)}`),bn()),lr(t)?f("config",o):f("config",o,r),n)),se("lichess/my-challenge")(()=>{oe(n)(f("waiting",`Waiting for ${$o(t)} answer.`))}),se("ratedChallenge")(()=>{oe(r)(Ao())}),se("challengeColor")(()=>{oe(o)(To())})}};let Xt=null;const Zd=(e,t)=>{Ae(e),e.classList.remove("hidden"),e.append(f("message",f("from",t.username),f("text",t.text)),me("close",()=>{e.classList.add("hidden"),I("lichess/chat",null)})),Xt!==null&&clearTimeout(Xt),Xt=window.setTimeout(()=>{I("lichess/chat",null),e.classList.add("hidden"),Xt=null},4e3)},Od=e=>{const t=f("chat-box hidden");e.append(t),se("lichess/chat")(()=>{const n=T("lichess/chat");n?Zd(t,n):Ae(t)})},Rd=3e3,Nd=3e3;let Io=null;const xd=e=>{const t=Date.now();Of().then(()=>{const n=Date.now()-t,r=Math.max(0,Math.min(100,100-Math.round(n*100/Nd)));e(r)}).catch(()=>e(0))},Ld=e=>{Io===null&&(Io=window.setInterval(()=>{T("online")||xd(e)},Rd),window.addEventListener("offline",()=>e(0)))},Fd=e=>e>0&&!T("online")?I("online",!0):e===0&&T("online")?I("online",!1):void 0,Dd=e=>{Ld(Fd);const t=f("online-status ok",f("icon"),f("label","Currently offline..."));se("online")(()=>{const n=T("online");n&&t.classList.contains("nok")?(t.classList.remove("nok"),t.classList.add("ok")):!n&&t.classList.contains("ok")&&(t.classList.remove("ok"),t.classList.add("nok"))}),e.append(t)},Md=(e,t)=>({color:"random",increment:t,time:e,rated:T("ratedChallenge"),variant:"standard"}),Ud=()=>I("lichess/seek",null),jd=(e,t,n)=>ge(n,r=>r("click",()=>{const o=Md(e,t);I("lichess/seek",Hu(o)),Rf(o,Ud).then(s=>I("lichess/seek",Vu(o,s)))})),Kd=([e,t])=>f("challenge-create",jd(e,t,f("time-control",f("time",e),f("label","minutes"),f("increment","+ .",fs(t.toString(),2,"0"))))),Po=()=>T("ratedChallenge")?f("toggle",f("selected",H("challenge/rated")),me(we(H("challenge/casual"),"casual"),()=>I("ratedChallenge",!1))):f("toggle",me(we(H("challenge/rated"),"rated"),()=>I("ratedChallenge",!0)),f("selected",H("challenge/casual"))),zo=e=>{const t=dt("lichess/seek");t===null?e(...hs.map(Kd)):t._tag==="sending"?e(f("waiting","Offer ",Ve("italic","en route"))):t._tag==="sent"&&e(f("waiting","Waiting for someone, anyone."),me(we("Stop waiting","stop-waiting"),()=>{t.cancel()}))},qd=e=>{const t=f("choices"),n=f("rated-selector",Po());e.append(f("challenge-page",f("header",f("title","Create game"),bn()),f("config",n),t)),zo(oe(t)),se("lichess/seek","lichess/game-info")(()=>{zo(oe(t))}),se("ratedChallenge")(()=>{oe(n)(Po())})},Zo=()=>{se("lichess/stream-events")(()=>{const t=T("lichess/stream-events");if(t.length>0){const n=t[t.length-1];n.type==="gameStart"?(I("lichess/game-info",n.game),I("lichess/challenges",[]),I("screen","game"),hp(n.game.gameId)):n.type==="gameFinish"?(I("lichess/current-challenge",null),I("lichess/game-info",n.game),I("screen","end-game")):n.type==="challenge"?n.challenge.status==="created"&&lt("lichess/challenges",r=>r.concat(n.challenge)):n.type==="challengeCanceled"&&lt("lichess/challenges",r=>r.filter(o=>o.id===n.challenge.id))}})},Gd=e=>{qf(),Tp(e),fd(),bo(e),Od(document.body),Dd(document.body),Zo();let t=["screen","lockScreen","lichess/chat","online"];se("screen")(()=>{switch(Lh(n=>t.includes(n)),Zo(),Ae(e),T("screen")){case"home":return bo(e);case"events":return $d(e);case"game":return Mp(e);case"movelist":return sn(!1),Sd(e);case"challenge":return zd(e);case"seek":return qd(e);case"follow":return Js(e);case"end-game":return sn(!1),vd(e)}})};Ie(Gd)(Me(document.querySelector("#app")));
