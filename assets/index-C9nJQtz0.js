var Us=Object.defineProperty;var Ds=(e,t,n)=>t in e?Us(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Q=(e,t,n)=>Ds(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Gr="none",Br="some",Sn={tag:Gr},An=e=>({tag:Br,value:e}),Ms=e=>typeof e=="object"&&e!==null&&"tag"in e&&(e.tag===Gr||e.tag===Br),Wr=e=>e.tag==="none",Xe=e=>t=>Wr(t)?Sn:An(e(t.value)),Hr=e=>t=>Wr(t)?e():t.value,$n=e=>e==null?Sn:An(e),Vr=(e,t,n)=>n(t(e)),js=e=>{switch(e){case"Pawn":return"p";case"Knight":return"n";case"Bishop":return"b";case"Rook":return"r";case"Queen":return"q";case"King":return"k"}},sn=e=>{switch(e){case"p":return"Pawn";case"n":return"Knight";case"b":return"Bishop";case"r":return"Rook";case"q":return"Queen";case"k":return"King"}},er=["A","B","C","D","E","F","G","H"],tr=["1","2","3","4","5","6","7","8"],xe=e=>e[0],Ut=e=>e[1],Ks=(e,t)=>e+t,qs=(e,t,n,r,o)=>({_tag:"Normal",role:e,from:t,to:n,capture:r,promotion:o}),Gs=(e,t)=>({_tag:"EnPassant",from:e,to:t}),zt=(e,t)=>({_tag:"Castle",king:e,rook:t}),Qr=e=>{switch(e._tag){case"Castle":return"King";case"EnPassant":return"Pawn";case"Normal":return e.role}},Bs=e=>{switch(e._tag){case"Castle":switch(e.king){case"E1":return e.rook==="H1"?"G1":"C1";case"E8":return e.rook==="H8"?"G8":"C8"}case"EnPassant":case"Normal":return e.to}},Ws=e=>{switch(e._tag){case"Castle":return e.king;case"EnPassant":case"Normal":return e.from}},Hs=e=>[Ws(e),Bs(e),e._tag==="Normal"&&e.promotion!==null?js(e.promotion):""].join("").toLowerCase(),Vs=()=>({_tag:"initial"}),Tn=(e,t,n)=>({_tag:"running",start_time:e,remaining_white:t,remaining_black:n}),nr=(e,t)=>({_tag:"flag",color:e,other:t}),Bt=()=>({_tag:"none"}),Qs=e=>({_tag:"role",role:e}),Js=e=>({_tag:"move",move:e}),Jr=e=>{switch(e._tag){case"none":return null;case"role":return e.role;case"move":return Qr(e.move)}},Ys=e=>e(),Xs=e=>navigator.clipboard.writeText(e).catch(t=>console.warn("Failed to set cliploard",e,t)),ei=["localhost","127.0.0.1","10\\..+","172\\.16\\..+","192\\.168\\..+"].map(e=>new RegExp(e)),ti=e=>ei.some(t=>t.test(e)),ni=e=>{let t=!1;return()=>{t||(t=!0,e())}},it=(e,t)=>(t((r,o)=>{e.setAttribute(r,o.toString())}),e),ze=(e,t)=>(t((r,o)=>{e.addEventListener(r,o)}),e);function Ie(e){for(;e.firstChild;)ri(e.firstChild);return e}function ri(e,t=!1){t||Ie(e);const n=e.parentNode;n&&n.removeChild(e)}const oi=e=>document.createElement(e),rr=e=>t=>t.appendChild(document.createTextNode(e)),Yr=(e,t)=>{const n=oi(e);return n.setAttribute("class",t),n},si=e=>t=>{typeof t=="number"?rr(t.toLocaleString())(e):rr(t)(e)},ii=e=>t=>{e.appendChild(t)},or=(e,t)=>{typeof t=="number"||typeof t=="string"?si(e)(t):ii(e)(t)},Xr=e=>t=>{Ms(t)?Xe(n=>or(e,n))(t):or(e,t)},Pe=e=>(...t)=>{const n=Xr(e);Ie(e),t.forEach(n)},ai=e=>t=>(t.classList.contains(e),t),Fe=(...e)=>t=>(t.classList.add(...e),t),Wt=(...e)=>t=>(t.classList.remove(...e),t),at=(e,t,n)=>{const r=Yr(e,t);return n.forEach(Xr(r)),r},x=(e,...t)=>at("div",e,t),eo=(e,...t)=>at("span",e,t),ci=(e,...t)=>at("h1",e,t),ui=(e,...t)=>at("h2",e,t),li=(e,...t)=>at("pre",e,t),hi=(e,t,...n)=>it(at("a",e,n),r=>r("href",t)),fi=(e,t)=>it(Yr("audio",e),n=>{n("src",t)});var an,sr;function pi(){if(sr)return an;sr=1;function e(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function t(i,h,c,k,f){const y={move:i,variations:f};return h&&(y.suffix=h),c&&(y.nag=c),k!==null&&(y.comment=k),y}function n(...i){const[h,...c]=i;let k=h;for(const f of c)f!==null&&(k.variations=[f,...f.variations],f.variations=[],k=f);return h}function r(i,h){if(h.marker&&h.marker.comment){let c=h.root;for(;;){const k=c.variations[0];if(!k){c.comment=h.marker.comment;break}c=k}}return{headers:i,root:h.root,result:(h.marker&&h.marker.result)??void 0}}function o(i,h){function c(){this.constructor=i}c.prototype=h.prototype,i.prototype=new c}function s(i,h,c,k){var f=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(f,s.prototype),f.expected=h,f.found=c,f.location=k,f.name="SyntaxError",f}o(s,Error);function a(i,h,c){return c=c||" ",i.length>h?i:(h-=i.length,c+=c.repeat(h),i+c.slice(0,h))}s.prototype.format=function(i){var h="Error: "+this.message;if(this.location){var c=null,k;for(k=0;k<i.length;k++)if(i[k].source===this.location.source){c=i[k].text.split(/\r\n|\n|\r/g);break}var f=this.location.start,y=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(f):f,w=this.location.source+":"+y.line+":"+y.column;if(c){var L=this.location.end,M=a("",y.line.toString().length," "),F=c[f.line-1],P=f.line===L.line?L.column:F.length+1,N=P-f.column||1;h+=`
 --> `+w+`
`+M+` |
`+y.line+" | "+F+`
`+M+" | "+a("",f.column-1," ")+a("",N,"^")}else h+=`
 at `+w}return h},s.buildMessage=function(i,h){var c={literal:function(F){return'"'+f(F.text)+'"'},class:function(F){var P=F.parts.map(function(N){return Array.isArray(N)?y(N[0])+"-"+y(N[1]):y(N)});return"["+(F.inverted?"^":"")+P.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(F){return F.description}};function k(F){return F.charCodeAt(0).toString(16).toUpperCase()}function f(F){return F.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+k(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+k(P)})}function y(F){return F.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+k(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+k(P)})}function w(F){return c[F.type](F)}function L(F){var P=F.map(w),N,G;if(P.sort(),P.length>0){for(N=1,G=1;N<P.length;N++)P[N-1]!==P[N]&&(P[G]=P[N],G++);P.length=G}switch(P.length){case 1:return P[0];case 2:return P[0]+" or "+P[1];default:return P.slice(0,-1).join(", ")+", or "+P[P.length-1]}}function M(F){return F?'"'+f(F)+'"':"end of input"}return"Expected "+L(i)+" but "+M(h)+" found."};function u(i,h){h=h!==void 0?h:{};var c={},k=h.grammarSource,f={pgn:Hn},y=Hn,w="[",L='"',M="]",F=".",P="O-O-O",N="O-O",G="0-0-0",ke="0-0",Te="$",De="{",tt="}",Me=";",Ct="(",nn=")",ct="1-0",je="0-1",St="1/2-1/2",v="*",p=/^[a-zA-Z]/,E=/^[^"]/,S=/^[0-9]/,$=/^[.]/,A=/^[a-zA-Z1-8\-=]/,K=/^[+#]/,j=/^[!?]/,V=/^[^}]/,O=/^[^\r\n]/,B=/^[ \t\r\n]/,ae=_e("tag pair"),Ee=ce("[",!1),Ce=ce('"',!1),Ke=ce("]",!1),Ze=_e("tag name"),le=$e([["a","z"],["A","Z"]],!1,!1),Se=_e("tag value"),qe=$e(['"'],!0,!1),nt=_e("move number"),Ae=$e([["0","9"]],!1,!1),we=ce(".",!1),Oe=$e(["."],!1,!1),ut=_e("standard algebraic notation"),At=ce("O-O-O",!1),rn=ce("O-O",!1),$t=ce("0-0-0",!1),Ge=ce("0-0",!1),Tt=$e([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Yo=$e(["+","#"],!1,!1),Xo=_e("suffix annotation"),jn=$e(["!","?"],!1,!1),es=_e("NAG"),ts=ce("$",!1),ns=_e("brace comment"),rs=ce("{",!1),Kn=$e(["}"],!0,!1),os=ce("}",!1),ss=_e("rest of line comment"),is=ce(";",!1),qn=$e(["\r",`
`],!0,!1),as=_e("variation"),cs=ce("(",!1),us=ce(")",!1),ls=_e("game termination marker"),hs=ce("1-0",!1),fs=ce("0-1",!1),ps=ce("1/2-1/2",!1),ds=ce("*",!1),gs=_e("whitespace"),Gn=$e([" ","	","\r",`
`],!1,!1),ms=function(l,g){return r(l,g)},_s=function(l){return Object.fromEntries(l)},vs=function(l,g){return[l,g]},bs=function(l,g){return{root:l,marker:g}},ks=function(l,g){return n(e(l),...g.flat())},Es=function(l,g,m,z,Z){return t(l,g,m,z,Z)},ws=function(l){return l},ys=function(l){return l.replace(/[\r\n]+/g," ")},Cs=function(l){return l.trim()},Ss=function(l){return l},As=function(l,g){return{result:l,comment:g}},d=h.peg$currPos|0,rt=[{line:1,column:1}],ye=d,It=h.peg$maxFailExpected||[],C=h.peg$silentFails|0,lt;if(h.startRule){if(!(h.startRule in f))throw new Error(`Can't start parsing from rule "`+h.startRule+'".');y=f[h.startRule]}function ce(l,g){return{type:"literal",text:l,ignoreCase:g}}function $e(l,g,m){return{type:"class",parts:l,inverted:g,ignoreCase:m}}function $s(){return{type:"end"}}function _e(l){return{type:"other",description:l}}function Bn(l){var g=rt[l],m;if(g)return g;if(l>=rt.length)m=rt.length-1;else for(m=l;!rt[--m];);for(g=rt[m],g={line:g.line,column:g.column};m<l;)i.charCodeAt(m)===10?(g.line++,g.column=1):g.column++,m++;return rt[l]=g,g}function Wn(l,g,m){var z=Bn(l),Z=Bn(g),W={source:k,start:{offset:l,line:z.line,column:z.column},end:{offset:g,line:Z.line,column:Z.column}};return W}function I(l){d<ye||(d>ye&&(ye=d,It=[]),It.push(l))}function Ts(l,g,m){return new s(s.buildMessage(l,g),l,g,m)}function Hn(){var l,g,m;return l=d,g=Is(),m=Zs(),l=ms(g,m),l}function Is(){var l,g,m;for(l=d,g=[],m=Vn();m!==c;)g.push(m),m=Vn();return m=pe(),l=_s(g),l}function Vn(){var l,g,m,z,Z,W,Be;return C++,l=d,pe(),i.charCodeAt(d)===91?(g=w,d++):(g=c,C===0&&I(Ee)),g!==c?(pe(),m=Ps(),m!==c?(pe(),i.charCodeAt(d)===34?(z=L,d++):(z=c,C===0&&I(Ce)),z!==c?(Z=zs(),i.charCodeAt(d)===34?(W=L,d++):(W=c,C===0&&I(Ce)),W!==c?(pe(),i.charCodeAt(d)===93?(Be=M,d++):(Be=c,C===0&&I(Ke)),Be!==c?l=vs(m,Z):(d=l,l=c)):(d=l,l=c)):(d=l,l=c)):(d=l,l=c)):(d=l,l=c),C--,l===c&&C===0&&I(ae),l}function Ps(){var l,g,m;if(C++,l=d,g=[],m=i.charAt(d),p.test(m)?d++:(m=c,C===0&&I(le)),m!==c)for(;m!==c;)g.push(m),m=i.charAt(d),p.test(m)?d++:(m=c,C===0&&I(le));else g=c;return g!==c?l=i.substring(l,d):l=g,C--,l===c&&(g=c,C===0&&I(Ze)),l}function zs(){var l,g,m;for(C++,l=d,g=[],m=i.charAt(d),E.test(m)?d++:(m=c,C===0&&I(qe));m!==c;)g.push(m),m=i.charAt(d),E.test(m)?d++:(m=c,C===0&&I(qe));return l=i.substring(l,d),C--,g=c,C===0&&I(Se),l}function Zs(){var l,g,m;return l=d,g=Qn(),pe(),m=Fs(),m===c&&(m=null),pe(),l=bs(g,m),l}function Qn(){var l,g,m,z;for(l=d,g=on(),g===c&&(g=null),m=[],z=Jn();z!==c;)m.push(z),z=Jn();return l=ks(g,m),l}function Jn(){var l,g,m,z,Z,W,Be,Pt;if(l=d,pe(),Os(),pe(),g=Rs(),g!==c){for(m=Ns(),m===c&&(m=null),z=[],Z=Yn();Z!==c;)z.push(Z),Z=Yn();for(Z=pe(),W=on(),W===c&&(W=null),Be=[],Pt=Xn();Pt!==c;)Be.push(Pt),Pt=Xn();l=Es(g,m,z,W,Be)}else d=l,l=c;return l}function Os(){var l,g,m,z,Z,W;for(C++,l=d,g=[],m=i.charAt(d),S.test(m)?d++:(m=c,C===0&&I(Ae));m!==c;)g.push(m),m=i.charAt(d),S.test(m)?d++:(m=c,C===0&&I(Ae));if(i.charCodeAt(d)===46?(m=F,d++):(m=c,C===0&&I(we)),m!==c){for(z=pe(),Z=[],W=i.charAt(d),$.test(W)?d++:(W=c,C===0&&I(Oe));W!==c;)Z.push(W),W=i.charAt(d),$.test(W)?d++:(W=c,C===0&&I(Oe));g=[g,m,z,Z],l=g}else d=l,l=c;return C--,l===c&&(g=c,C===0&&I(nt)),l}function Rs(){var l,g,m,z,Z,W;if(C++,l=d,g=d,i.substr(d,5)===P?(m=P,d+=5):(m=c,C===0&&I(At)),m===c&&(i.substr(d,3)===N?(m=N,d+=3):(m=c,C===0&&I(rn)),m===c&&(i.substr(d,5)===G?(m=G,d+=5):(m=c,C===0&&I($t)),m===c&&(i.substr(d,3)===ke?(m=ke,d+=3):(m=c,C===0&&I(Ge)),m===c))))if(m=d,z=i.charAt(d),p.test(z)?d++:(z=c,C===0&&I(le)),z!==c){if(Z=[],W=i.charAt(d),A.test(W)?d++:(W=c,C===0&&I(Tt)),W!==c)for(;W!==c;)Z.push(W),W=i.charAt(d),A.test(W)?d++:(W=c,C===0&&I(Tt));else Z=c;Z!==c?(z=[z,Z],m=z):(d=m,m=c)}else d=m,m=c;return m!==c?(z=i.charAt(d),K.test(z)?d++:(z=c,C===0&&I(Yo)),z===c&&(z=null),m=[m,z],g=m):(d=g,g=c),g!==c?l=i.substring(l,d):l=g,C--,l===c&&(g=c,C===0&&I(ut)),l}function Ns(){var l,g,m;for(C++,l=d,g=[],m=i.charAt(d),j.test(m)?d++:(m=c,C===0&&I(jn));m!==c;)g.push(m),g.length>=2?m=c:(m=i.charAt(d),j.test(m)?d++:(m=c,C===0&&I(jn)));return g.length<1?(d=l,l=c):l=g,C--,l===c&&(g=c,C===0&&I(Xo)),l}function Yn(){var l,g,m,z,Z;if(C++,l=d,pe(),i.charCodeAt(d)===36?(g=Te,d++):(g=c,C===0&&I(ts)),g!==c){if(m=d,z=[],Z=i.charAt(d),S.test(Z)?d++:(Z=c,C===0&&I(Ae)),Z!==c)for(;Z!==c;)z.push(Z),Z=i.charAt(d),S.test(Z)?d++:(Z=c,C===0&&I(Ae));else z=c;z!==c?m=i.substring(m,d):m=z,m!==c?l=ws(m):(d=l,l=c)}else d=l,l=c;return C--,l===c&&C===0&&I(es),l}function on(){var l;return l=xs(),l===c&&(l=Ls()),l}function xs(){var l,g,m,z,Z;if(C++,l=d,i.charCodeAt(d)===123?(g=De,d++):(g=c,C===0&&I(rs)),g!==c){for(m=d,z=[],Z=i.charAt(d),V.test(Z)?d++:(Z=c,C===0&&I(Kn));Z!==c;)z.push(Z),Z=i.charAt(d),V.test(Z)?d++:(Z=c,C===0&&I(Kn));m=i.substring(m,d),i.charCodeAt(d)===125?(z=tt,d++):(z=c,C===0&&I(os)),z!==c?l=ys(m):(d=l,l=c)}else d=l,l=c;return C--,l===c&&(g=c,C===0&&I(ns)),l}function Ls(){var l,g,m,z,Z;if(C++,l=d,i.charCodeAt(d)===59?(g=Me,d++):(g=c,C===0&&I(is)),g!==c){for(m=d,z=[],Z=i.charAt(d),O.test(Z)?d++:(Z=c,C===0&&I(qn));Z!==c;)z.push(Z),Z=i.charAt(d),O.test(Z)?d++:(Z=c,C===0&&I(qn));m=i.substring(m,d),l=Cs(m)}else d=l,l=c;return C--,l===c&&(g=c,C===0&&I(ss)),l}function Xn(){var l,g,m,z;return C++,l=d,pe(),i.charCodeAt(d)===40?(g=Ct,d++):(g=c,C===0&&I(cs)),g!==c?(m=Qn(),m!==c?(pe(),i.charCodeAt(d)===41?(z=nn,d++):(z=c,C===0&&I(us)),z!==c?l=Ss(m):(d=l,l=c)):(d=l,l=c)):(d=l,l=c),C--,l===c&&C===0&&I(as),l}function Fs(){var l,g,m;return C++,l=d,i.substr(d,3)===ct?(g=ct,d+=3):(g=c,C===0&&I(hs)),g===c&&(i.substr(d,3)===je?(g=je,d+=3):(g=c,C===0&&I(fs)),g===c&&(i.substr(d,7)===St?(g=St,d+=7):(g=c,C===0&&I(ps)),g===c&&(i.charCodeAt(d)===42?(g=v,d++):(g=c,C===0&&I(ds))))),g!==c?(pe(),m=on(),m===c&&(m=null),l=As(g,m)):(d=l,l=c),C--,l===c&&(g=c,C===0&&I(ls)),l}function pe(){var l,g;for(C++,l=[],g=i.charAt(d),B.test(g)?d++:(g=c,C===0&&I(Gn));g!==c;)l.push(g),g=i.charAt(d),B.test(g)?d++:(g=c,C===0&&I(Gn));return C--,g=c,C===0&&I(gs),l}if(lt=y(),h.peg$library)return{peg$result:lt,peg$currPos:d,peg$FAILED:c,peg$maxFailExpected:It,peg$maxFailPos:ye};if(lt!==c&&d===i.length)return lt;throw lt!==c&&d<i.length&&I($s()),Ts(It,ye<i.length?i.charAt(ye):null,ye<i.length?Wn(ye,ye+1):Wn(ye,ye))}return an={StartRules:["pgn"],SyntaxError:s,parse:u},an}var di=pi();/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Dt=0xffffffffffffffffn;function cn(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function ir(e,t){return e*t&Dt}function gi(e){return function(){let t=BigInt(e&Dt),n=BigInt(e>>64n&Dt);const r=ir(cn(ir(t,5n),7n),9n);return n^=t,t=(cn(t,24n)^n^n<<16n)&Dt,n=cn(n,37n),e=n<<64n|t,r}}const Ht=gi(0xa187eb39cdcaed8f31c4b365b102e01en),mi=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Ht()))),_i=Array.from({length:8},()=>Ht()),vi=Array.from({length:16},()=>Ht()),un=Ht(),fe="w",ve="b",se="p",vn="n",Mt="b",pt="r",Le="q",ie="k",ln="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Zt{constructor(t,n){Q(this,"color");Q(this,"from");Q(this,"to");Q(this,"piece");Q(this,"captured");Q(this,"promotion");Q(this,"flags");Q(this,"san");Q(this,"lan");Q(this,"before");Q(this,"after");const{color:r,piece:o,from:s,to:a,flags:u,captured:i,promotion:h}=n,c=ue(s),k=ue(a);this.color=r,this.piece=o,this.from=c,this.to=k,this.san=t._moveToSan(n,t._moves({legal:!0})),this.lan=c+k,this.before=t.fen(),t._makeMove(n),this.after=t.fen(),t._undoMove(),this.flags="";for(const f in U)U[f]&u&&(this.flags+=We[f]);i&&(this.captured=i),h&&(this.promotion=h,this.lan+=h)}isCapture(){return this.flags.indexOf(We.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(We.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(We.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(We.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(We.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(We.BIG_PAWN)>-1}}const he=-1,We={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},U={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},bn={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},bi={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},ki={...bn,...bi},R={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},hn={b:[16,32,17,15],w:[-16,-32,-17,-15]},ar={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Ei=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],wi=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],yi={p:1,n:2,b:4,r:8,q:16,k:32},Ci="pnbrqkPNBRQK",cr=[vn,Mt,pt,Le],Si=7,Ai=6,$i=1,Ti=0,Ot={[ie]:U.KSIDE_CASTLE,[Le]:U.QSIDE_CASTLE},Re={w:[{square:R.a1,flag:U.QSIDE_CASTLE},{square:R.h1,flag:U.KSIDE_CASTLE}],b:[{square:R.a8,flag:U.QSIDE_CASTLE},{square:R.h8,flag:U.KSIDE_CASTLE}]},Ii={b:$i,w:Ai};function He(e){return e>>4}function _t(e){return e&15}function to(e){return"0123456789".indexOf(e)!==-1}function ue(e){const t=_t(e),n=He(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function ht(e){return e===fe?ve:fe}function Pi(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=t[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<o.length;a++){let u=0,i=!1;for(let h=0;h<o[a].length;h++)if(to(o[a][h])){if(i)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};u+=parseInt(o[a][h],10),i=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[a][h]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};u+=1,i=!1}if(u!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:u}of s){if(!u.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((t[0].match(u)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(o[0]+o[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function zi(e,t){const n=e.from,r=e.to,o=e.piece;let s=0,a=0,u=0;for(let i=0,h=t.length;i<h;i++){const c=t[i].from,k=t[i].to,f=t[i].piece;o===f&&n!==c&&r===k&&(s++,He(n)===He(c)&&a++,_t(n)===_t(c)&&u++)}return s>0?a>0&&u>0?ue(n):u>0?ue(n).charAt(1):ue(n).charAt(0):""}function Ne(e,t,n,r,o,s=void 0,a=U.NORMAL){const u=He(r);if(o===se&&(u===Si||u===Ti))for(let i=0;i<cr.length;i++){const h=cr[i];e.push({color:t,from:n,to:r,piece:o,captured:s,promotion:h,flags:a|U.PROMOTION})}else e.push({color:t,from:n,to:r,piece:o,captured:s,flags:a})}function ur(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:se:(t=t.toLowerCase(),t==="o"?ie:t)}function fn(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class In{constructor(t=ln,{skipValidation:n=!1}={}){Q(this,"_board",new Array(128));Q(this,"_turn",fe);Q(this,"_header",{});Q(this,"_kings",{w:he,b:he});Q(this,"_epSquare",-1);Q(this,"_halfMoves",0);Q(this,"_moveNumber",0);Q(this,"_history",[]);Q(this,"_comments",{});Q(this,"_castling",{w:0,b:0});Q(this,"_hash",0n);Q(this,"_positionCount",new Map);this.load(t,{skipValidation:n})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:he,b:he},this._turn=fe,this._castling={w:0,b:0},this._epSquare=he,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...ki},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:n=!1,preserveHeaders:r=!1}={}){let o=t.split(/\s+/);if(o.length>=2&&o.length<6){const u=["-","-","0","1"];t=o.concat(u.slice(-(6-o.length))).join(" ")}if(o=t.split(/\s+/),!n){const{ok:u,error:i}=Pi(t);if(!u)throw new Error(i)}const s=o[0];let a=0;this.clear({preserveHeaders:r});for(let u=0;u<s.length;u++){const i=s.charAt(u);if(i==="/")a+=8;else if(to(i))a+=parseInt(i,10);else{const h=i<"a"?fe:ve;this._put({type:i.toLowerCase(),color:h},ue(a)),a++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=U.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=U.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=U.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=U.QSIDE_CASTLE),this._epSquare=o[3]==="-"?he:R[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var a,u;let n=0,r="";for(let i=R.a8;i<=R.h1;i++){if(this._board[i]){n>0&&(r+=n,n=0);const{color:h,type:c}=this._board[i];r+=h===fe?c.toUpperCase():c.toLowerCase()}else n++;i+1&136&&(n>0&&(r+=n),i!==R.h1&&(r+="/"),n=0,i+=8)}let o="";this._castling[fe]&U.KSIDE_CASTLE&&(o+="K"),this._castling[fe]&U.QSIDE_CASTLE&&(o+="Q"),this._castling[ve]&U.KSIDE_CASTLE&&(o+="k"),this._castling[ve]&U.QSIDE_CASTLE&&(o+="q"),o=o||"-";let s="-";if(this._epSquare!==he)if(t)s=ue(this._epSquare);else{const i=this._epSquare+(this._turn===fe?16:-16),h=[i+1,i-1];for(const c of h){if(c&136)continue;const k=this._turn;if(((a=this._board[c])==null?void 0:a.color)===k&&((u=this._board[c])==null?void 0:u.type)===se){this._makeMove({color:k,from:c,to:this._epSquare,piece:se,captured:se,flags:U.EP_CAPTURE});const f=!this._isKingAttacked(k);if(this._undoMove(),f){s=ue(this._epSquare);break}}}}return[r,this._turn,o,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:n,type:r}=this._board[t],o={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[r];return mi[o][s][t]}_epKey(){return this._epSquare===he?0n:_i[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return vi[t]}_computeHash(){let t=0n;for(let n=R.a8;n<=R.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(t^=this._pieceKey(n))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=un),t}_updateSetup(t){this._history.length>0||(t!==ln?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(ln)}get(t){return this._board[R[t]]}findPiece(t){var r;const n=[];for(let o=R.a8;o<=R.h1;o++){if(o&136){o+=7;continue}!this._board[o]||((r=this._board[o])==null?void 0:r.color)!==t.color||this._board[o].color===t.color&&this._board[o].type===t.type&&n.push(ue(o))}return n}put({type:t,color:n},r){return this._put({type:t,color:n},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,n){this._hash^=this._pieceKey(t),this._board[t]=n,this._hash^=this._pieceKey(t)}_put({type:t,color:n},r){if(Ci.indexOf(t.toLowerCase())===-1||!(r in R))return!1;const o=R[r];if(t==ie&&!(this._kings[n]==he||this._kings[n]==o))return!1;const s=this._board[o];return s&&s.type===ie&&(this._kings[s.color]=he),this._set(o,{type:t,color:n}),t===ie&&(this._kings[n]=o),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const n=this.get(t);return this._clear(R[t]),n&&n.type===ie&&(this._kings[n.color]=he),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var r,o,s,a,u,i,h,c,k,f,y,w;this._hash^=this._castlingKey();const t=((r=this._board[R.e1])==null?void 0:r.type)===ie&&((o=this._board[R.e1])==null?void 0:o.color)===fe,n=((s=this._board[R.e8])==null?void 0:s.type)===ie&&((a=this._board[R.e8])==null?void 0:a.color)===ve;(!t||((u=this._board[R.a1])==null?void 0:u.type)!==pt||((i=this._board[R.a1])==null?void 0:i.color)!==fe)&&(this._castling.w&=-65),(!t||((h=this._board[R.h1])==null?void 0:h.type)!==pt||((c=this._board[R.h1])==null?void 0:c.color)!==fe)&&(this._castling.w&=-33),(!n||((k=this._board[R.a8])==null?void 0:k.type)!==pt||((f=this._board[R.a8])==null?void 0:f.color)!==ve)&&(this._castling.b&=-65),(!n||((y=this._board[R.h8])==null?void 0:y.type)!==pt||((w=this._board[R.h8])==null?void 0:w.color)!==ve)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,a;if(this._epSquare===he)return;const t=this._epSquare+(this._turn===fe?-16:16),n=this._epSquare+(this._turn===fe?16:-16),r=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==ht(this._turn)||((a=this._board[n])==null?void 0:a.type)!==se){this._hash^=this._epKey(),this._epSquare=he;return}const o=u=>{var i,h;return!(u&136)&&((i=this._board[u])==null?void 0:i.color)===this._turn&&((h=this._board[u])==null?void 0:h.type)===se};r.some(o)||(this._hash^=this._epKey(),this._epSquare=he)}_attacked(t,n,r){const o=[];for(let s=R.a8;s<=R.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==t)continue;const a=this._board[s],u=s-n;if(u===0)continue;const i=u+119;if(Ei[i]&yi[a.type]){if(a.type===se){if(u>0&&a.color===fe||u<=0&&a.color===ve)if(r)o.push(ue(s));else return!0;continue}if(a.type==="n"||a.type==="k")if(r){o.push(ue(s));continue}else return!0;const h=wi[i];let c=s+h,k=!1;for(;c!==n;){if(this._board[c]!=null){k=!0;break}c+=h}if(!k)if(r){o.push(ue(s));continue}else return!0}}return r?o:!1}attackers(t,n){return n?this._attacked(n,R[t],!0):this._attacked(this._turn,R[t],!0)}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(ht(t),n)}hash(){return this._hash.toString(16)}isAttacked(t,n){return this._attacked(n,R[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let r=0,o=0;for(let s=R.a8;s<=R.h1;s++){if(o=(o+1)%2,s&136){s+=7;continue}const a=this._board[s];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===Mt&&n.push(o),r++)}if(r===2)return!0;if(r===3&&(t[Mt]===1||t[vn]===1))return!0;if(r===t[Mt]+2){let s=0;const a=n.length;for(let u=0;u<a;u++)s+=n[u];if(s===0||s===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:r=void 0}={}){const o=this._moves({square:n,piece:r});return t?o.map(s=>new Zt(this,s)):o.map(s=>this._moveToSan(s,o))}_moves({legal:t=!0,piece:n=void 0,square:r=void 0}={}){var y;const o=r?r.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),a=[],u=this._turn,i=ht(u);let h=R.a8,c=R.h1,k=!1;if(o)if(o in R)h=c=R[o],k=!0;else return[];for(let w=h;w<=c;w++){if(w&136){w+=7;continue}if(!this._board[w]||this._board[w].color===i)continue;const{type:L}=this._board[w];let M;if(L===se){if(s&&s!==L)continue;M=w+hn[u][0],this._board[M]||(Ne(a,u,w,M,se),M=w+hn[u][1],Ii[u]===He(w)&&!this._board[M]&&Ne(a,u,w,M,se,void 0,U.BIG_PAWN));for(let F=2;F<4;F++)M=w+hn[u][F],!(M&136)&&(((y=this._board[M])==null?void 0:y.color)===i?Ne(a,u,w,M,se,this._board[M].type,U.CAPTURE):M===this._epSquare&&Ne(a,u,w,M,se,se,U.EP_CAPTURE))}else{if(s&&s!==L)continue;for(let F=0,P=ar[L].length;F<P;F++){const N=ar[L][F];for(M=w;M+=N,!(M&136);){if(!this._board[M])Ne(a,u,w,M,L);else{if(this._board[M].color===u)break;Ne(a,u,w,M,L,this._board[M].type,U.CAPTURE);break}if(L===vn||L===ie)break}}}}if((s===void 0||s===ie)&&(!k||c===this._kings[u])){if(this._castling[u]&U.KSIDE_CASTLE){const w=this._kings[u],L=w+2;!this._board[w+1]&&!this._board[L]&&!this._attacked(i,this._kings[u])&&!this._attacked(i,w+1)&&!this._attacked(i,L)&&Ne(a,u,this._kings[u],L,ie,void 0,U.KSIDE_CASTLE)}if(this._castling[u]&U.QSIDE_CASTLE){const w=this._kings[u],L=w-2;!this._board[w-1]&&!this._board[w-2]&&!this._board[w-3]&&!this._attacked(i,this._kings[u])&&!this._attacked(i,w-1)&&!this._attacked(i,L)&&Ne(a,u,this._kings[u],L,ie,void 0,U.QSIDE_CASTLE)}}if(!t||this._kings[u]===-1)return a;const f=[];for(let w=0,L=a.length;w<L;w++)this._makeMove(a[w]),this._isKingAttacked(u)||f.push(a[w]),this._undoMove();return f}move(t,{strict:n=!1}={}){let r=null;if(typeof t=="string")r=this._moveFromSan(t,n);else if(typeof t=="object"){const s=this._moves();for(let a=0,u=s.length;a<u;a++)if(t.from===ue(s[a].from)&&t.to===ue(s[a].to)&&(!("promotion"in s[a])||t.promotion===s[a].promotion)){r=s[a];break}}if(!r)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const o=new Zt(this,r);return this._makeMove(r),this._incPositionCount(),o}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,n){this._hash^=this._pieceKey(t),this._board[n]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(n)}_makeMove(t){var o,s,a,u;const n=this._turn,r=ht(n);if(this._push(t),this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&U.EP_CAPTURE&&(this._turn===ve?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:n})),this._board[t.to].type===ie){if(this._kings[n]=t.to,t.flags&U.KSIDE_CASTLE){const i=t.to-1,h=t.to+1;this._movePiece(h,i)}else if(t.flags&U.QSIDE_CASTLE){const i=t.to+1,h=t.to-2;this._movePiece(h,i)}this._castling[n]=0}if(this._castling[n]){for(let i=0,h=Re[n].length;i<h;i++)if(t.from===Re[n][i].square&&this._castling[n]&Re[n][i].flag){this._castling[n]^=Re[n][i].flag;break}}if(this._castling[r]){for(let i=0,h=Re[r].length;i<h;i++)if(t.to===Re[r][i].square&&this._castling[r]&Re[r][i].flag){this._castling[r]^=Re[r][i].flag;break}}if(this._hash^=this._castlingKey(),t.flags&U.BIG_PAWN){let i;n===ve?i=t.to-16:i=t.to+16,!(t.to-1&136)&&((o=this._board[t.to-1])==null?void 0:o.type)===se&&((s=this._board[t.to-1])==null?void 0:s.color)===r||!(t.to+1&136)&&((a=this._board[t.to+1])==null?void 0:a.type)===se&&((u=this._board[t.to+1])==null?void 0:u.color)===r?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=he}else this._epSquare=he;t.piece===se?this._halfMoves=0:t.flags&(U.CAPTURE|U.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===ve&&this._moveNumber++,this._turn=r,this._hash^=un}undo(){const t=this._hash,n=this._undoMove();if(n){const r=new Zt(this,n);return this._decPositionCount(t),r}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=un;const r=this._turn,o=ht(r);if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:r})),n.captured)if(n.flags&U.EP_CAPTURE){let s;r===ve?s=n.to-16:s=n.to+16,this._set(s,{type:se,color:o})}else this._set(n.to,{type:n.captured,color:o});if(n.flags&(U.KSIDE_CASTLE|U.QSIDE_CASTLE)){let s,a;n.flags&U.KSIDE_CASTLE?(s=n.to+1,a=n.to-1):(s=n.to-2,a=n.to+1),this._movePiece(a,s)}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const r=[];let o=!1;for(const f in this._header)this._header[f]&&r.push(`[${f} "${this._header[f]}"]`+t),o=!0;o&&this._history.length&&r.push(t);const s=f=>{const y=this._comments[this.fen()];if(typeof y<"u"){const w=f.length>0?" ":"";f=`${f}${w}{${y}}`}return f},a=[];for(;this._history.length>0;)a.push(this._undoMove());const u=[];let i="";for(a.length===0&&u.push(s(""));a.length>0;){i=s(i);const f=a.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const y=`${this._moveNumber}. ...`;i=i?`${i} ${y}`:y}else f.color==="w"&&(i.length&&u.push(i),i=this._moveNumber+".");i=i+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(i.length&&u.push(s(i)),u.push(this._header.Result||"*"),n===0)return r.join("")+u.join(" ");const h=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},c=function(f,y){for(const w of y.split(" "))if(w){if(f+w.length>n){for(;h();)f--;r.push(t),f=0}r.push(w),f+=w.length,r.push(" "),f++}return h()&&f--,f};let k=0;for(let f=0;f<u.length;f++){if(k+u[f].length>n&&u[f].includes("{")){k=c(k,u[f]);continue}k+u[f].length>n&&f!==0?(r[r.length-1]===" "&&r.pop(),r.push(t),k=0):f!==0&&(r.push(" "),k++),r.push(u[f]),k+=u[f].length}return r.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}setHeader(t,n){return this._header[t]=n??bn[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=bn[t]||null,!0):!1}getHeaders(){const t={};for(const[n,r]of Object.entries(this._header))r!==null&&(t[n]=r);return t}loadPgn(t,{strict:n=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(t=t.replace(new RegExp(r,"g"),`
`));const o=di.parse(t);this.reset();const s=o.headers;let a="";for(const h in s)h.toLowerCase()==="fen"&&(a=s[h]),this.header(h,s[h]);if(!n)a&&this.load(a,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let u=o.root;for(;u;){if(u.move){const h=this._moveFromSan(u.move,n);if(h==null)throw new Error(`Invalid move in PGN: ${u.move}`);this._makeMove(h),this._incPositionCount()}u.comment!==void 0&&(this._comments[this.fen()]=u.comment),u=u.variations[0]}const i=o.result;i&&Object.keys(this._header).length&&this._header.Result!==i&&this.setHeader("Result",i)}_moveToSan(t,n){let r="";if(t.flags&U.KSIDE_CASTLE)r="O-O";else if(t.flags&U.QSIDE_CASTLE)r="O-O-O";else{if(t.piece!==se){const o=zi(t,n);r+=t.piece.toUpperCase()+o}t.flags&(U.CAPTURE|U.EP_CAPTURE)&&(t.piece===se&&(r+=ue(t.from)[0]),r+="x"),r+=ue(t.to),t.promotion&&(r+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(t,n=!1){let r=fn(t);n||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O"));let o=ur(r),s=this._moves({legal:!0,piece:o});for(let f=0,y=s.length;f<y;f++)if(r===fn(this._moveToSan(s[f],s)))return s[f];if(n)return null;let a,u,i,h,c,k=!1;if(u=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),u?(a=u[1],i=u[2],h=u[3],c=u[4],i.length==1&&(k=!0)):(u=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),u&&(a=u[1],i=u[2],h=u[3],c=u[4],i.length==1&&(k=!0))),o=ur(r),s=this._moves({legal:!0,piece:a||o}),!h)return null;for(let f=0,y=s.length;f<y;f++)if(i){if((!a||a.toLowerCase()==s[f].piece)&&R[i]==s[f].from&&R[h]==s[f].to&&(!c||c.toLowerCase()==s[f].promotion))return s[f];if(k){const w=ue(s[f].from);if((!a||a.toLowerCase()==s[f].piece)&&R[h]==s[f].to&&(i==w[0]||i==w[1])&&(!c||c.toLowerCase()==s[f].promotion))return s[f]}}else if(r===fn(this._moveToSan(s[f],s)).replace("x",""))return s[f];return null}ascii(){let t=`   +------------------------+
`;for(let n=R.a8;n<=R.h1;n++){if(_t(n)===0&&(t+=" "+"87654321"[He(n)]+" |"),this._board[n]){const r=this._board[n].type,s=this._board[n].color===fe?r.toUpperCase():r.toLowerCase();t+=" "+s+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let r=0;const o=this._turn;for(let s=0,a=n.length;s<a;s++)this._makeMove(n[s]),this._isKingAttacked(o)||(t-1>0?r+=this.perft(t-1):r++),this._undoMove();return r}turn(){return this._turn}board(){const t=[];let n=[];for(let r=R.a8;r<=R.h1;r++)this._board[r]==null?n.push(null):n.push({square:ue(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t}squareColor(t){if(t in R){const n=R[t];return(He(n)+_t(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],r=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;t?r.push(new Zt(this,o)):r.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return r}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const n=this._positionCount.get(t)??0;n===1?this._positionCount.delete(t):this._positionCount.set(t,n-1)}_pruneComments(){const t=[],n={},r=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)t.push(this._undoMove());for(r(this.fen());;){const o=t.pop();if(!o)break;this._makeMove(o),r(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const o of[ie,Le])n[o]!==void 0&&(n[o]?this._castling[t]|=Ot[o]:this._castling[t]&=~Ot[o]);this._updateCastlingRights();const r=this.getCastlingRights(t);return(n[ie]===void 0||n[ie]===r[ie])&&(n[Le]===void 0||n[Le]===r[Le])}getCastlingRights(t){return{[ie]:(this._castling[t]&Ot[ie])!==0,[Le]:(this._castling[t]&Ot[Le])!==0}}moveNumber(){return this._moveNumber}}const Zi=["Pawn","Bishop","Knight","Rook","Queen","King"],no="♟",ro="♜",oo="♞",so="♝",io="♛",ao="♚",co="♙",uo="♖",lo="♘",ho="♗",fo="♕",po="♔",Oi=Fe("hidden"),go=Wt("hidden"),Pn=e=>{const t=e.slice(0,2),n=e.slice(2,4),r=e[4];return{from:t,to:n,promotion:r}},Vt=e=>e.split(" ").filter(t=>t.trim().length>0),Ri=e=>{const t=new In;return Vt(e).forEach(n=>t.move(Pn(n))),t.moves({verbose:!0}).map(n=>n.isKingsideCastle()?n.color=="w"?zt("E1","H1"):zt("E8","H8"):n.isQueensideCastle()?n.color=="w"?zt("E1","A1"):zt("E8","A8"):n.isEnPassant()?Gs(n.from.toUpperCase(),n.to.toUpperCase()):qs(sn(n.piece),n.from.toUpperCase(),n.to.toUpperCase(),n.isCapture()?sn(n.captured):null,n.isPromotion()?sn(n.promotion):null))},Ni=e=>{const t=new In;Vt(e).forEach(r=>t.move(Pn(r)));const n=t.history();return n.length>0?n[n.length-1]:""},kn=e=>{const t=new In;return Vt(e).forEach(n=>t.move(Pn(n))),t.pgn()},Qt=()=>{const e=H("lichess/game-state");return e?Vt(e.moves).length%2===0?"white":"black":null},qt=()=>{const e=H("lichess/game-info");return e?e.color:null},mo=()=>Bt(),xi=()=>"home",Li=()=>Vs();let Ue={screen:xi(),clock:Li(),input:mo(),started:!1,lockScreen:!1,"lichess/host":"https://lichess.org","lichess/user":null,"lichess/stream-events":[],"lichess/challenges":[],"lichess/current-challenge":null,"lichess/game-info":null,"lichess/game-state":null};const _o=[],Fi=()=>_o.map(e=>{const t=localStorage.getItem(e);t!==null&&(Ue[e]=JSON.parse(t))});Fi();let vt=[];const Jt=(e,t)=>{let n=H(e);Ue[e]=t(n),_o.includes(e)&&localStorage.setItem(e,JSON.stringify(Ue[e]));const r=vt.filter(([o,s])=>o==e);for(const o of r){const s=o[1];s(e)}return e!=="clock"&&(console.groupCollapsed(e),console.debug("from",n),console.debug("to",Ue[e]),console.debug("subscribers",r),console.groupEnd()),H(e)},Ui=(e,t)=>Xe(n=>Y(e,n))(t(H(e))),Y=(e,t)=>Jt(e,()=>t),H=e=>JSON.parse(JSON.stringify(Ue[e])),zn=e=>Ue[e],Di=()=>Object.keys(Ue),be=(...e)=>t=>vt=vt.concat(e.map(n=>[n,t])),Mi=e=>vt=vt.filter(([t,n])=>e(t));ti(document.location.hostname)&&Object.assign(window,{UcuiState:Ue});const ji=(e,t)=>Array.isArray(t)?t.map(n=>`${e}=${encodeURIComponent(n)}`).join("&"):`${e}=${encodeURIComponent(t)}`,Ki=e=>Object.keys(e).map(t=>ji(t,e[t])).join("&"),qi=(e="application/x-www-form-urlencoded")=>{const t={};return e!=="none"&&(t["Content-Type"]=e),{method:"POST",mode:"cors",cache:"default",redirect:"follow",credentials:"same-origin",headers:t}},vo=e=>(t,n,r,o)=>{const s={method:"POST",body:Ki(r),...qi(),...o};return e(n,s).then(a=>{if(a.ok)return a.json();throw a}).then(a=>t.parse(a))},Gi=vo(fetch);function b(e,t,n){function r(u,i){var h;Object.defineProperty(u,"_zod",{value:u._zod??{},enumerable:!1}),(h=u._zod).traits??(h.traits=new Set),u._zod.traits.add(e),t(u,i);for(const c in a.prototype)c in u||Object.defineProperty(u,c,{value:a.prototype[c].bind(u)});u._zod.constr=a,u._zod.def=i}const o=(n==null?void 0:n.Parent)??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function a(u){var i;const h=n!=null&&n.Parent?new s:this;r(h,u),(i=h._zod).deferred??(i.deferred=[]);for(const c of h._zod.deferred)c();return h}return Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:u=>{var i,h;return n!=null&&n.Parent&&u instanceof n.Parent?!0:(h=(i=u==null?void 0:u._zod)==null?void 0:i.traits)==null?void 0:h.has(e)}}),Object.defineProperty(a,"name",{value:e}),a}class bt extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const bo={};function Ve(e){return bo}function Bi(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function Wi(e,t){return typeof t=="bigint"?t.toString():t}function ko(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Zn(e){return e==null}function On(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Hi(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=Number.parseInt(e.toFixed(o).replace(".","")),a=Number.parseInt(t.toFixed(o).replace(".",""));return s%a/10**o}function te(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function Rn(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Eo(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function ft(e){return JSON.stringify(e)}function En(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Vi=ko(()=>{try{const e=Function;return new e(""),!0}catch{return!1}});function lr(e){if(En(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(En(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}const Qi=new Set(["string","number","symbol"]);function wt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function et(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function T(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Ji(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Yi={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Xi(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return et(e,{...e._zod.def,shape:n,checks:[]})}function ea(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return et(e,{...e._zod.def,shape:n,checks:[]})}function ta(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return Rn(this,"shape",r),r},checks:[]};return et(e,n)}function na(e,t){return et(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Rn(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function ra(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)o[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return et(t,{...t._zod.def,shape:o,checks:[]})}function oa(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)o[s]=new e({type:"nonoptional",innerType:r[s]});return et(t,{...t._zod.def,shape:o,checks:[]})}function dt(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function Nn(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Rt(e){return typeof e=="string"?e:e==null?void 0:e.message}function Qe(e,t,n){var o,s,a,u,i,h;const r={...e,path:e.path??[]};if(!e.message){const c=Rt((a=(s=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:s.error)==null?void 0:a.call(s,e))??Rt((u=t==null?void 0:t.error)==null?void 0:u.call(t,e))??Rt((i=n.customError)==null?void 0:i.call(n,e))??Rt((h=n.localeError)==null?void 0:h.call(n,e))??"Invalid input";r.message=c}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function xn(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function kt(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const wo=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,Wi,2)},enumerable:!0})},yo=b("$ZodError",wo),Co=b("$ZodError",wo,{Parent:Error});function sa(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function ia(e,t){const n=t||function(s){return s.message},r={_errors:[]},o=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(u=>o({issues:u}));else if(a.code==="invalid_key")o({issues:a.issues});else if(a.code==="invalid_element")o({issues:a.issues});else if(a.path.length===0)r._errors.push(n(a));else{let u=r,i=0;for(;i<a.path.length;){const h=a.path[i];i===a.path.length-1?(u[h]=u[h]||{_errors:[]},u[h]._errors.push(n(a))):u[h]=u[h]||{_errors:[]},u=u[h],i++}}};return o(e),r}const aa=e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new bt;if(a.issues.length){const u=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>Qe(i,s,Ve())));throw Error.captureStackTrace(u,o==null?void 0:o.callee),u}return a.value},ca=e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const u=new((o==null?void 0:o.Err)??e)(a.issues.map(i=>Qe(i,s,Ve())));throw Error.captureStackTrace(u,o==null?void 0:o.callee),u}return a.value},So=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new bt;return s.issues.length?{success:!1,error:new(e??yo)(s.issues.map(a=>Qe(a,o,Ve())))}:{success:!0,data:s.value}},ua=So(Co),Ao=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(a=>Qe(a,o,Ve())))}:{success:!0,data:s.value}},la=Ao(Co),ha=/^[cC][^\s-]{8,}$/,fa=/^[0-9a-z]+$/,pa=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,da=/^[0-9a-vA-V]{20}$/,ga=/^[A-Za-z0-9]{27}$/,ma=/^[a-zA-Z0-9_-]{21}$/,_a=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,va=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,hr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,ba=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ka="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Ea(){return new RegExp(ka,"u")}const wa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ya=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Ca=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Sa=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Aa=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,$o=/^[A-Za-z0-9_-]*$/,$a=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,Ta=/^\+(?:[0-9]){6,14}[0-9]$/,To="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ia=new RegExp(`^${To}$`);function Io(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function Pa(e){return new RegExp(`^${Io(e)}$`)}function za(e){let t=`${To}T${Io(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}const Za=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Oa=/^\d+$/,Ra=/^-?\d+(?:\.\d+)?/i,Na=/true|false/i,xa=/^[^A-Z]*$/,La=/^[^a-z]*$/,ge=b("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Po={number:"number",bigint:"bigint",object:"date"},zo=b("$ZodCheckLessThan",(e,t)=>{ge.init(e,t);const n=Po[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Zo=b("$ZodCheckGreaterThan",(e,t)=>{ge.init(e,t);const n=Po[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Fa=b("$ZodCheckMultipleOf",(e,t)=>{ge.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Hi(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Ua=b("$ZodCheckNumberFormat",(e,t)=>{var a;ge.init(e,t),t.format=t.format||"float64";const n=(a=t.format)==null?void 0:a.includes("int"),r=n?"int":"number",[o,s]=Yi[t.format];e._zod.onattach.push(u=>{const i=u._zod.bag;i.format=t.format,i.minimum=o,i.maximum=s,n&&(i.pattern=Oa)}),e._zod.check=u=>{const i=u.value;if(n){if(!Number.isInteger(i)){u.issues.push({expected:r,format:t.format,code:"invalid_type",input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?u.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):u.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}i<o&&u.issues.push({origin:"number",input:i,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),i>s&&u.issues.push({origin:"number",input:i,code:"too_big",maximum:s,inst:e})}}),Da=b("$ZodCheckMaxLength",(e,t)=>{ge.init(e,t),e._zod.when=n=>{const r=n.value;return!Zn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const s=xn(r);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Ma=b("$ZodCheckMinLength",(e,t)=>{ge.init(e,t),e._zod.when=n=>{const r=n.value;return!Zn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const s=xn(r);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),ja=b("$ZodCheckLengthEquals",(e,t)=>{ge.init(e,t),e._zod.when=n=>{const r=n.value;return!Zn(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,o=r.length;if(o===t.length)return;const s=xn(r),a=o>t.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),Yt=b("$ZodCheckStringFormat",(e,t)=>{var n;ge.init(e,t),e._zod.onattach.push(r=>{const o=r._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),Ka=b("$ZodCheckRegex",(e,t)=>{Yt.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),qa=b("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=xa),Yt.init(e,t)}),Ga=b("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=La),Yt.init(e,t)}),Ba=b("$ZodCheckIncludes",(e,t)=>{ge.init(e,t);const n=wt(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),Wa=b("$ZodCheckStartsWith",(e,t)=>{ge.init(e,t);const n=new RegExp(`^${wt(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),Ha=b("$ZodCheckEndsWith",(e,t)=>{ge.init(e,t);const n=new RegExp(`.*${wt(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),Va=b("$ZodCheckOverwrite",(e,t)=>{ge.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Qa{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(a=>a),o=Math.min(...r.map(a=>a.length-a.trimStart().length)),s=r.map(a=>a.slice(o)).map(a=>" ".repeat(this.indent*2)+a);for(const a of s)this.content.push(a)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}}const Ja={major:4,minor:0,patch:0},X=b("$ZodType",(e,t)=>{var o;var n;e??(e={}),e._zod.id=t.type+"_"+Eo(10),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Ja;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const s of r)for(const a of s._zod.onattach)a(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const s=(a,u,i)=>{let h=dt(a),c;for(const k of u){if(k._zod.when){if(!k._zod.when(a))continue}else if(h)continue;const f=a.issues.length,y=k._zod.check(a);if(y instanceof Promise&&(i==null?void 0:i.async)===!1)throw new bt;if(c||y instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await y,a.issues.length!==f&&(h||(h=dt(a,f)))});else{if(a.issues.length===f)continue;h||(h=dt(a,f))}}return c?c.then(()=>a):a};e._zod.run=(a,u)=>{const i=e._zod.parse(a,u);if(i instanceof Promise){if(u.async===!1)throw new bt;return i.then(h=>s(h,r,u))}return s(i,r,u)}}e["~standard"]={validate:s=>{var a;try{const u=ua(e,s);return u.success?{value:u.data}:{issues:(a=u.error)==null?void 0:a.issues}}catch{return la(e,s).then(i=>{var h;return i.success?{value:i.data}:{issues:(h=i.error)==null?void 0:h.issues}})}},vendor:"zod",version:1}}),Ln=b("$ZodString",(e,t)=>{var n;X.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??Za(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),J=b("$ZodStringFormat",(e,t)=>{Yt.init(e,t),Ln.init(e,t)}),Ya=b("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=va),J.init(e,t)}),Xa=b("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=hr(r))}else t.pattern??(t.pattern=hr());J.init(e,t)}),ec=b("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=ba),J.init(e,t)}),tc=b("$ZodURL",(e,t)=>{J.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:$a.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),nc=b("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Ea()),J.init(e,t)}),rc=b("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=ma),J.init(e,t)}),oc=b("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=ha),J.init(e,t)}),sc=b("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=fa),J.init(e,t)}),ic=b("$ZodULID",(e,t)=>{t.pattern??(t.pattern=pa),J.init(e,t)}),ac=b("$ZodXID",(e,t)=>{t.pattern??(t.pattern=da),J.init(e,t)}),cc=b("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=ga),J.init(e,t)}),uc=b("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=za(t)),J.init(e,t)}),lc=b("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Ia),J.init(e,t)}),hc=b("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Pa(t)),J.init(e,t)}),fc=b("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=_a),J.init(e,t)}),pc=b("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=wa),J.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),dc=b("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=ya),J.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),gc=b("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=Ca),J.init(e,t)}),mc=b("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Sa),J.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Oo(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const _c=b("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Aa),J.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Oo(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function vc(e){if(!$o.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Oo(n)}const bc=b("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=$o),J.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{vc(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),kc=b("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Ta),J.init(e,t)});function Ec(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const wc=b("$ZodJWT",(e,t)=>{J.init(e,t),e._zod.check=n=>{Ec(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Ro=b("$ZodNumber",(e,t)=>{X.init(e,t),e._zod.pattern=e._zod.bag.pattern??Ra,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),yc=b("$ZodNumber",(e,t)=>{Ua.init(e,t),Ro.init(e,t)}),Cc=b("$ZodBoolean",(e,t)=>{X.init(e,t),e._zod.pattern=Na,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),Sc=b("$ZodUnknown",(e,t)=>{X.init(e,t),e._zod.parse=n=>n}),Ac=b("$ZodNever",(e,t)=>{X.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function fr(e,t,n){e.issues.length&&t.issues.push(...Nn(n,e.issues)),t.value[n]=e.value}const $c=b("$ZodArray",(e,t)=>{X.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let a=0;a<o.length;a++){const u=o[a],i=t.element._zod.run({value:u,issues:[]},r);i instanceof Promise?s.push(i.then(h=>fr(h,n,a))):fr(i,n,a)}return s.length?Promise.all(s).then(()=>n):n}});function Nt(e,t,n){e.issues.length&&t.issues.push(...Nn(n,e.issues)),t.value[n]=e.value}function pr(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...Nn(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const Tc=b("$ZodObject",(e,t)=>{X.init(e,t);const n=ko(()=>{const k=Object.keys(t.shape);for(const y of k)if(!(t.shape[y]instanceof X))throw new Error(`Invalid element at key "${y}": expected a Zod schema`);const f=Ji(t.shape);return{shape:t.shape,keys:k,keySet:new Set(k),numKeys:k.length,optionalKeys:new Set(f)}});te(e._zod,"propValues",()=>{const k=t.shape,f={};for(const y in k){const w=k[y]._zod;if(w.values){f[y]??(f[y]=new Set);for(const L of w.values)f[y].add(L)}}return f});const r=k=>{const f=new Qa(["shape","payload","ctx"]),{keys:y,optionalKeys:w}=n.value,L=P=>{const N=ft(P);return`shape[${N}]._zod.run({ value: input[${N}], issues: [] }, ctx)`};f.write("const input = payload.value;");const M=Object.create(null);for(const P of y)M[P]=Eo(15);f.write("const newResult = {}");for(const P of y)if(w.has(P)){const N=M[P];f.write(`const ${N} = ${L(P)};`);const G=ft(P);f.write(`
        if (${N}.issues.length) {
          if (input[${G}] === undefined) {
            if (${G} in input) {
              newResult[${G}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${N}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${G}, ...iss.path] : [${G}],
              }))
            );
          }
        } else if (${N}.value === undefined) {
          if (${G} in input) newResult[${G}] = undefined;
        } else {
          newResult[${G}] = ${N}.value;
        }
        `)}else{const N=M[P];f.write(`const ${N} = ${L(P)};`),f.write(`
          if (${N}.issues.length) payload.issues = payload.issues.concat(${N}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${ft(P)}, ...iss.path] : [${ft(P)}]
          })));`),f.write(`newResult[${ft(P)}] = ${N}.value`)}f.write("payload.value = newResult;"),f.write("return payload;");const F=f.compile();return(P,N)=>F(k,P,N)};let o;const s=En,a=!bo.jitless,i=a&&Vi.value,{catchall:h}=t;let c;e._zod.parse=(k,f)=>{c??(c=n.value);const y=k.value;if(!s(y))return k.issues.push({expected:"object",code:"invalid_type",input:y,inst:e}),k;const w=[];if(a&&i&&(f==null?void 0:f.async)===!1&&f.jitless!==!0)o||(o=r(t.shape)),k=o(k,f);else{k.value={};const N=c.shape;for(const G of c.keys){const ke=N[G],Te=ke._zod.run({value:y[G],issues:[]},f),De=ke._zod.optin==="optional"&&ke._zod.optout==="optional";Te instanceof Promise?w.push(Te.then(tt=>De?pr(tt,k,G,y):Nt(tt,k,G))):De?pr(Te,k,G,y):Nt(Te,k,G)}}if(!h)return w.length?Promise.all(w).then(()=>k):k;const L=[],M=c.keySet,F=h._zod,P=F.def.type;for(const N of Object.keys(y)){if(M.has(N))continue;if(P==="never"){L.push(N);continue}const G=F.run({value:y[N],issues:[]},f);G instanceof Promise?w.push(G.then(ke=>Nt(ke,k,N))):Nt(G,k,N)}return L.length&&k.issues.push({code:"unrecognized_keys",keys:L,input:y,inst:e}),w.length?Promise.all(w).then(()=>k):k}});function dr(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(s=>Qe(s,r,Ve())))}),t}const Ic=b("$ZodUnion",(e,t)=>{X.init(e,t),te(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),te(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>On(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const s=[];for(const a of t.options){const u=a._zod.run({value:n.value,issues:[]},r);if(u instanceof Promise)s.push(u),o=!0;else{if(u.issues.length===0)return u;s.push(u)}}return o?Promise.all(s).then(a=>dr(a,n,e,r)):dr(s,n,e,r)}}),Pc=b("$ZodIntersection",(e,t)=>{X.init(e,t),e._zod.parse=(n,r)=>{const{value:o}=n,s=t.left._zod.run({value:o,issues:[]},r),a=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||a instanceof Promise?Promise.all([s,a]).then(([i,h])=>gr(n,i,h)):gr(n,s,a)}});function wn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(lr(e)&&lr(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const a=wn(e[s],t[s]);if(!a.valid)return{valid:!1,mergeErrorPath:[s,...a.mergeErrorPath]};o[s]=a.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],a=wn(o,s);if(!a.valid)return{valid:!1,mergeErrorPath:[r,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function gr(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),dt(e))return e;const r=wn(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const zc=b("$ZodEnum",(e,t)=>{X.init(e,t);const n=Bi(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(r=>Qi.has(typeof r)).map(r=>typeof r=="string"?wt(r):r.toString()).join("|")})$`),e._zod.parse=(r,o)=>{const s=r.value;return e._zod.values.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),Zc=b("$ZodLiteral",(e,t)=>{X.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?wt(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),Oc=b("$ZodTransform",(e,t)=>{X.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(a=>(n.value=a,n));if(o instanceof Promise)throw new bt;return n.value=o,n}}),Rc=b("$ZodOptional",(e,t)=>{X.init(e,t),e._zod.optin="optional",e._zod.optout="optional",te(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),te(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${On(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),Nc=b("$ZodNullable",(e,t)=>{X.init(e,t),te(e._zod,"optin",()=>t.innerType._zod.optin),te(e._zod,"optout",()=>t.innerType._zod.optout),te(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${On(n.source)}|null)$`):void 0}),te(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),xc=b("$ZodDefault",(e,t)=>{X.init(e,t),e._zod.optin="optional",te(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>mr(s,t)):mr(o,t)}});function mr(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Lc=b("$ZodPrefault",(e,t)=>{X.init(e,t),e._zod.optin="optional",te(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Fc=b("$ZodNonOptional",(e,t)=>{X.init(e,t),te(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>_r(s,e)):_r(o,e)}});function _r(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Uc=b("$ZodCatch",(e,t)=>{X.init(e,t),te(e._zod,"optin",()=>t.innerType._zod.optin),te(e._zod,"optout",()=>t.innerType._zod.optout),te(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>Qe(a,r,Ve()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>Qe(s,r,Ve()))},input:n.value}),n.issues=[]),n)}}),Dc=b("$ZodPipe",(e,t)=>{X.init(e,t),te(e._zod,"values",()=>t.in._zod.values),te(e._zod,"optin",()=>t.in._zod.optin),te(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>vr(s,t,r)):vr(o,t,r)}});function vr(e,t,n){return dt(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const Mc=b("$ZodReadonly",(e,t)=>{X.init(e,t),te(e._zod,"propValues",()=>t.innerType._zod.propValues),te(e._zod,"optin",()=>t.innerType._zod.optin),te(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(br):br(o)}});function br(e){return e.value=Object.freeze(e.value),e}const jc=b("$ZodCustom",(e,t)=>{ge.init(e,t),X.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>kr(s,n,r,e));kr(o,n,r,e)}});function kr(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(kt(o))}}class Kc{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function qc(){return new Kc}const xt=qc();function Gc(e,t){return new e({type:"string",...T(t)})}function Bc(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...T(t)})}function Er(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...T(t)})}function Wc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...T(t)})}function Hc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...T(t)})}function Vc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...T(t)})}function Qc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...T(t)})}function No(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...T(t)})}function Jc(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...T(t)})}function Yc(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...T(t)})}function Xc(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...T(t)})}function eu(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...T(t)})}function tu(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...T(t)})}function nu(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...T(t)})}function ru(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...T(t)})}function ou(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...T(t)})}function su(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...T(t)})}function iu(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...T(t)})}function au(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...T(t)})}function cu(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...T(t)})}function uu(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...T(t)})}function lu(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...T(t)})}function hu(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...T(t)})}function fu(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...T(t)})}function pu(e,t){return new e({type:"string",format:"date",check:"string_format",...T(t)})}function du(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...T(t)})}function gu(e,t){return new e({type:"string",format:"duration",check:"string_format",...T(t)})}function mu(e,t){return new e({type:"number",checks:[],...T(t)})}function _u(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...T(t)})}function vu(e,t){return new e({type:"boolean",...T(t)})}function bu(e){return new e({type:"unknown"})}function ku(e,t){return new e({type:"never",...T(t)})}function wr(e,t){return new zo({check:"less_than",...T(t),value:e,inclusive:!1})}function pn(e,t){return new zo({check:"less_than",...T(t),value:e,inclusive:!0})}function yr(e,t){return new Zo({check:"greater_than",...T(t),value:e,inclusive:!1})}function dn(e,t){return new Zo({check:"greater_than",...T(t),value:e,inclusive:!0})}function Cr(e,t){return new Fa({check:"multiple_of",...T(t),value:e})}function xo(e,t){return new Da({check:"max_length",...T(t),maximum:e})}function Gt(e,t){return new Ma({check:"min_length",...T(t),minimum:e})}function Lo(e,t){return new ja({check:"length_equals",...T(t),length:e})}function Eu(e,t){return new Ka({check:"string_format",format:"regex",...T(t),pattern:e})}function wu(e){return new qa({check:"string_format",format:"lowercase",...T(e)})}function yu(e){return new Ga({check:"string_format",format:"uppercase",...T(e)})}function Cu(e,t){return new Ba({check:"string_format",format:"includes",...T(t),includes:e})}function Su(e,t){return new Wa({check:"string_format",format:"starts_with",...T(t),prefix:e})}function Au(e,t){return new Ha({check:"string_format",format:"ends_with",...T(t),suffix:e})}function yt(e){return new Va({check:"overwrite",tx:e})}function $u(e){return yt(t=>t.normalize(e))}function Tu(){return yt(e=>e.trim())}function Iu(){return yt(e=>e.toLowerCase())}function Pu(){return yt(e=>e.toUpperCase())}function zu(e,t,n){return new e({type:"array",element:t,...T(n)})}function Zu(e,t,n){return new e({type:"custom",check:"custom",fn:t,...T(n)})}const Ou=b("ZodISODateTime",(e,t)=>{uc.init(e,t),ee.init(e,t)});function Ru(e){return fu(Ou,e)}const Nu=b("ZodISODate",(e,t)=>{lc.init(e,t),ee.init(e,t)});function xu(e){return pu(Nu,e)}const Lu=b("ZodISOTime",(e,t)=>{hc.init(e,t),ee.init(e,t)});function Fu(e){return du(Lu,e)}const Uu=b("ZodISODuration",(e,t)=>{fc.init(e,t),ee.init(e,t)});function Du(e){return gu(Uu,e)}const Mu=(e,t)=>{yo.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>ia(e,n)},flatten:{value:n=>sa(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},Xt=b("ZodError",Mu,{Parent:Error}),ju=aa(Xt),Ku=ca(Xt),qu=So(Xt),Gu=Ao(Xt),oe=b("ZodType",(e,t)=>(X.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>et(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>ju(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>qu(e,n,r),e.parseAsync=async(n,r)=>Ku(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>Gu(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(Ll(n,r)),e.superRefine=n=>e.check(Fl(n)),e.overwrite=n=>e.check(yt(n)),e.optional=()=>$r(e),e.nullable=()=>Tr(e),e.nullish=()=>$r(Tr(e)),e.nonoptional=n=>Il(e,n),e.array=()=>gl(e),e.or=n=>re([e,n]),e.and=n=>bl(e,n),e.transform=n=>Ir(e,yl(n)),e.default=n=>Al(e,n),e.prefault=n=>Tl(e,n),e.catch=n=>zl(e,n),e.pipe=n=>Ir(e,n),e.readonly=()=>Rl(e),e.describe=n=>{const r=e.clone();return xt.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=xt.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return xt.get(e);const r=e.clone();return xt.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Fo=b("_ZodString",(e,t)=>{Ln.init(e,t),oe.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(Eu(...r)),e.includes=(...r)=>e.check(Cu(...r)),e.startsWith=(...r)=>e.check(Su(...r)),e.endsWith=(...r)=>e.check(Au(...r)),e.min=(...r)=>e.check(Gt(...r)),e.max=(...r)=>e.check(xo(...r)),e.length=(...r)=>e.check(Lo(...r)),e.nonempty=(...r)=>e.check(Gt(1,...r)),e.lowercase=r=>e.check(wu(r)),e.uppercase=r=>e.check(yu(r)),e.trim=()=>e.check(Tu()),e.normalize=(...r)=>e.check($u(...r)),e.toLowerCase=()=>e.check(Iu()),e.toUpperCase=()=>e.check(Pu())}),Bu=b("ZodString",(e,t)=>{Ln.init(e,t),Fo.init(e,t),e.email=n=>e.check(Bc(Wu,n)),e.url=n=>e.check(No(Uo,n)),e.jwt=n=>e.check(hu(ul,n)),e.emoji=n=>e.check(Jc(Vu,n)),e.guid=n=>e.check(Er(Sr,n)),e.uuid=n=>e.check(Wc(Lt,n)),e.uuidv4=n=>e.check(Hc(Lt,n)),e.uuidv6=n=>e.check(Vc(Lt,n)),e.uuidv7=n=>e.check(Qc(Lt,n)),e.nanoid=n=>e.check(Yc(Qu,n)),e.guid=n=>e.check(Er(Sr,n)),e.cuid=n=>e.check(Xc(Ju,n)),e.cuid2=n=>e.check(eu(Yu,n)),e.ulid=n=>e.check(tu(Xu,n)),e.base64=n=>e.check(cu(il,n)),e.base64url=n=>e.check(uu(al,n)),e.xid=n=>e.check(nu(el,n)),e.ksuid=n=>e.check(ru(tl,n)),e.ipv4=n=>e.check(ou(nl,n)),e.ipv6=n=>e.check(su(rl,n)),e.cidrv4=n=>e.check(iu(ol,n)),e.cidrv6=n=>e.check(au(sl,n)),e.e164=n=>e.check(lu(cl,n)),e.datetime=n=>e.check(Ru(n)),e.date=n=>e.check(xu(n)),e.time=n=>e.check(Fu(n)),e.duration=n=>e.check(Du(n))});function q(e){return Gc(Bu,e)}const ee=b("ZodStringFormat",(e,t)=>{J.init(e,t),Fo.init(e,t)}),Wu=b("ZodEmail",(e,t)=>{ec.init(e,t),ee.init(e,t)}),Sr=b("ZodGUID",(e,t)=>{Ya.init(e,t),ee.init(e,t)}),Lt=b("ZodUUID",(e,t)=>{Xa.init(e,t),ee.init(e,t)}),Uo=b("ZodURL",(e,t)=>{tc.init(e,t),ee.init(e,t)});function Hu(e){return No(Uo,e)}const Vu=b("ZodEmoji",(e,t)=>{nc.init(e,t),ee.init(e,t)}),Qu=b("ZodNanoID",(e,t)=>{rc.init(e,t),ee.init(e,t)}),Ju=b("ZodCUID",(e,t)=>{oc.init(e,t),ee.init(e,t)}),Yu=b("ZodCUID2",(e,t)=>{sc.init(e,t),ee.init(e,t)}),Xu=b("ZodULID",(e,t)=>{ic.init(e,t),ee.init(e,t)}),el=b("ZodXID",(e,t)=>{ac.init(e,t),ee.init(e,t)}),tl=b("ZodKSUID",(e,t)=>{cc.init(e,t),ee.init(e,t)}),nl=b("ZodIPv4",(e,t)=>{pc.init(e,t),ee.init(e,t)}),rl=b("ZodIPv6",(e,t)=>{dc.init(e,t),ee.init(e,t)}),ol=b("ZodCIDRv4",(e,t)=>{gc.init(e,t),ee.init(e,t)}),sl=b("ZodCIDRv6",(e,t)=>{mc.init(e,t),ee.init(e,t)}),il=b("ZodBase64",(e,t)=>{_c.init(e,t),ee.init(e,t)}),al=b("ZodBase64URL",(e,t)=>{bc.init(e,t),ee.init(e,t)}),cl=b("ZodE164",(e,t)=>{kc.init(e,t),ee.init(e,t)}),ul=b("ZodJWT",(e,t)=>{wc.init(e,t),ee.init(e,t)}),Do=b("ZodNumber",(e,t)=>{Ro.init(e,t),oe.init(e,t),e.gt=(r,o)=>e.check(yr(r,o)),e.gte=(r,o)=>e.check(dn(r,o)),e.min=(r,o)=>e.check(dn(r,o)),e.lt=(r,o)=>e.check(wr(r,o)),e.lte=(r,o)=>e.check(pn(r,o)),e.max=(r,o)=>e.check(pn(r,o)),e.int=r=>e.check(de(r)),e.safe=r=>e.check(de(r)),e.positive=r=>e.check(yr(0,r)),e.nonnegative=r=>e.check(dn(0,r)),e.negative=r=>e.check(wr(0,r)),e.nonpositive=r=>e.check(pn(0,r)),e.multipleOf=(r,o)=>e.check(Cr(r,o)),e.step=(r,o)=>e.check(Cr(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Je(e){return mu(Do,e)}const ll=b("ZodNumberFormat",(e,t)=>{yc.init(e,t),Do.init(e,t)});function de(e){return _u(ll,e)}const hl=b("ZodBoolean",(e,t)=>{Cc.init(e,t),oe.init(e,t)});function ne(e){return vu(hl,e)}const fl=b("ZodUnknown",(e,t)=>{Sc.init(e,t),oe.init(e,t)});function Ar(){return bu(fl)}const pl=b("ZodNever",(e,t)=>{Ac.init(e,t),oe.init(e,t)});function Mo(e){return ku(pl,e)}const dl=b("ZodArray",(e,t)=>{$c.init(e,t),oe.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(Gt(n,r)),e.nonempty=n=>e.check(Gt(1,n)),e.max=(n,r)=>e.check(xo(n,r)),e.length=(n,r)=>e.check(Lo(n,r)),e.unwrap=()=>e.element});function gl(e,t){return zu(dl,e,t)}const ml=b("ZodObject",(e,t)=>{Tc.init(e,t),oe.init(e,t),te(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>kl(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Ar()}),e.loose=()=>e.clone({...e._zod.def,catchall:Ar()}),e.strict=()=>e.clone({...e._zod.def,catchall:Mo()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>ta(e,n),e.merge=n=>na(e,n),e.pick=n=>Xi(e,n),e.omit=n=>ea(e,n),e.partial=(...n)=>ra(jo,e,n[0]),e.required=(...n)=>oa(Ko,e,n[0])});function D(e,t){return new ml({type:"object",get shape(){return Rn(this,"shape",{...e}),this.shape},catchall:Mo(),...T(t)})}const _l=b("ZodUnion",(e,t)=>{Ic.init(e,t),oe.init(e,t),e.options=t.options});function re(e,t){return new _l({type:"union",options:e,...T(t)})}const vl=b("ZodIntersection",(e,t)=>{Pc.init(e,t),oe.init(e,t)});function bl(e,t){return new vl({type:"intersection",left:e,right:t})}const yn=b("ZodEnum",(e,t)=>{zc.init(e,t),oe.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const a of r)if(n.has(a))s[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new yn({...t,checks:[],...T(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const a of r)if(n.has(a))delete s[a];else throw new Error(`Key ${a} not found in enum`);return new yn({...t,checks:[],...T(o),entries:s})}});function kl(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new yn({type:"enum",entries:n,...T(t)})}const El=b("ZodLiteral",(e,t)=>{Zc.init(e,t),oe.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function _(e,t){return new El({type:"literal",values:Array.isArray(e)?e:[e],...T(t)})}const wl=b("ZodTransform",(e,t)=>{Oc.init(e,t),oe.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=s=>{if(typeof s=="string")n.issues.push(kt(s,n.value,t));else{const a=s;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=n.value),a.inst??(a.inst=e),a.continue??(a.continue=!0),n.issues.push(kt(a))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function yl(e){return new wl({type:"transform",transform:e})}const jo=b("ZodOptional",(e,t)=>{Rc.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function $r(e){return new jo({type:"optional",innerType:e})}const Cl=b("ZodNullable",(e,t)=>{Nc.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Tr(e){return new Cl({type:"nullable",innerType:e})}const Sl=b("ZodDefault",(e,t)=>{xc.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Al(e,t){return new Sl({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const $l=b("ZodPrefault",(e,t)=>{Lc.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Tl(e,t){return new $l({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Ko=b("ZodNonOptional",(e,t)=>{Fc.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Il(e,t){return new Ko({type:"nonoptional",innerType:e,...T(t)})}const Pl=b("ZodCatch",(e,t)=>{Uc.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function zl(e,t){return new Pl({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Zl=b("ZodPipe",(e,t)=>{Dc.init(e,t),oe.init(e,t),e.in=t.in,e.out=t.out});function Ir(e,t){return new Zl({type:"pipe",in:e,out:t})}const Ol=b("ZodReadonly",(e,t)=>{Mc.init(e,t),oe.init(e,t)});function Rl(e){return new Ol({type:"readonly",innerType:e})}const Nl=b("ZodCustom",(e,t)=>{jc.init(e,t),oe.init(e,t)});function xl(e,t){const n=new ge({check:"custom",...T(t)});return n._zod.check=e,n}function Ll(e,t={}){return Zu(Nl,e,t)}function Fl(e,t){const n=xl(r=>(r.addIssue=o=>{if(typeof o=="string")r.issues.push(kt(o,r.value,n._zod.def));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=n),s.continue??(s.continue=!n._zod.def.abort),r.issues.push(kt(s))}},e(r.value,r)),t);return n}const Ye=re([_("white"),_("black")]),Ul=re([_("lobby"),_("friend"),_("ai"),_("api"),_("tournament"),_("position"),_("import"),_("importlive"),_("simul"),_("relay"),_("pool"),_("swiss")]),Dl=re([D({id:_(10),name:_("created")}),D({id:_(20),name:_("started")}),D({id:_(25),name:_("aborted")}),D({id:_(30),name:_("mate")}),D({id:_(31),name:_("resign")}),D({id:_(32),name:_("stalemate")}),D({id:_(33),name:_("timeout")}),D({id:_(34),name:_("draw")}),D({id:_(35),name:_("outoftime")}),D({id:_(36),name:_("cheat")}),D({id:_(37),name:_("noStart")}),D({id:_(38),name:_("unknownFinish")}),D({id:_(60),name:_("variantEnd")})]),Fn=re([_("ultraBullet"),_("bullet"),_("blitz"),_("rapid"),_("classical"),_("correspondence")]),Ml=D({id:q(),username:q(),rating:Je()}),en=D({bot:ne(),board:ne()}),Un=re([_("standard"),_("chess960"),_("crazyhouse"),_("antichess"),_("atomic"),_("horde"),_("kingOfTheHill"),_("racingKings"),_("threeCheck"),_("fromPosition")]),Dn=D({key:Un,name:q(),short:q().optional()}),qo=D({id:q(),fullId:q(),gameId:q(),fen:q(),color:Ye,lastMove:q(),source:Ul,status:Dl,variant:Dn,speed:Fn,perf:q(),rated:ne(),hasMoved:ne(),opponent:Ml,isMyTurn:ne(),secondsLeft:Je().optional(),compat:en,winner:Ye.optional()}),jl=D({type:_("gameStart"),game:qo}),Kl=D({type:_("gameFinish"),game:qo}),ql=re([_("created"),_("offline"),_("canceled"),_("declined"),_("accepted")]),Pr=D({id:q(),name:q(),rating:Je(),title:q().nullable(),flair:q().optional(),patron:ne().optional(),provisional:ne().optional(),online:ne().optional(),lag:Je().optional()}),Gl=D({type:_("clock"),limit:Je(),increment:Je(),show:q()}),Bl=D({type:_("correspondence"),daysPerTurn:Je()}),Wl=D({type:_("unlimited")}),Hl=re([Gl,Bl,Wl]),Et=D({id:q(),url:Hu(),status:ql,challenger:Pr,destUser:Pr.nullable(),variant:Dn,rated:ne(),speed:Fn,timeControl:Hl,color:re([Ye,_("random")]),finalColor:Ye,perf:D({icon:q(),name:q()}),direction:re([_("in"),_("out")]).optional(),initialFen:q().optional()}),Vl=D({type:_("challenge"),challenge:Et,compat:en.optional()}),Ql=D({type:_("challengeCanceled"),challenge:Et,compat:en.optional()}),Jl=re([_("generic"),_("later"),_("tooFast"),_("tooSlow"),_("timeControl"),_("rated"),_("casual"),_("standard"),_("variant"),_("noBot"),_("onlyBot")]),Yl=Et.extend({declineReason:q(),declineReasonKey:Jl}),Xl=D({type:_("challengeDeclined"),challenge:Yl,compat:en.optional()}),eh=re([jl,Kl,Vl,Ql,Xl]);D({in:Et.array(),out:Et.array()});const Go=re([_("noAbort"),_("noRematch"),_("noGiveTime"),_("noClaimWin"),_("noEarlyDraw")]),th=D({rated:ne(),"clock.limit":de(),"clock.increment":de(),color:re([Ye,_("random")]),variant:Un,fen:q().optional(),keepAliveStream:ne(),rules:Go}),nh=re([_(1),_(2),_(3),_(4),_(5),_(7),_(10),_(14)]),rh=D({rated:ne(),days:nh,color:re([Ye,_("random")]),variant:Un,fen:q().optional(),keepAliveStream:ne(),rules:Go});re([th,rh]);const Bo=D({ok:ne()}),oh=D({initial:de(),increment:de()}),sh=D({name:q()}),ih=re([_("GM"),_("WGM"),_("IM"),_("WIM"),_("FM"),_("WFM"),_("NM"),_("CM"),_("WCM"),_("WNM"),_("LM"),_("BOT")]),zr=D({aiLevel:de().optional(),id:q(),name:q(),title:ih.nullable(),rating:de().nullable(),provisional:ne()}),ah=re([_("created"),_("started"),_("aborted"),_("mate"),_("resign"),_("stalemate"),_("timeout"),_("draw"),_("outoftime"),_("cheat"),_("noStart"),_("unknownFinish"),_("variantEnd")]),Wo=D({type:_("gameState"),moves:q(),wtime:de(),btime:de(),winc:de(),binc:de(),status:ah,winner:Ye.optional(),wdraw:ne().optional(),bdraw:ne().optional(),wtakeback:ne().optional(),btakeback:ne().optional()}),ch=D({type:_("gameFull"),id:q(),variant:Dn,clock:oh,speed:Fn,perf:sh,rated:ne(),createdAt:de(),white:zr,black:zr,initialFen:q(),state:Wo,tournamentId:q().optional()}),uh=D({type:_("chatLine"),room:re([_("player"),_("spectator")]),username:q(),text:q()}),lh=D({type:_("opponentGone"),gone:ne(),claimWinInSeconds:de()}),hh=re([Wo,ch,uh,lh]);D({gameId:q(),move:q(),offeringDraw:ne().optional()});const tn=e=>[H("lichess/host"),e].join("/api"),fh=e=>{const t=zn("lichess/user");return t?(t.streamer(eh,tn("/stream/event")).onMessage(e),!0):!1},ph=(e,t)=>{const n=zn("lichess/user");return n?(n.streamer(hh,tn(`/board/game/stream/${e}`)).onMessage(t),!0):!1},Ho=(e=!1)=>{const t=zn("lichess/user");if(t)return vo(t.httpClient);if(e)throw new Error("Missing user: generic http client");return console.warn("Missing user: generic http client"),Gi},dh=e=>Ho()(Bo,tn(`/challenge/${e}/accept`),{}),gh=(e,t)=>Ho()(Bo,tn(`/board/game/${e}/move/${t}`),{}),gt=x("time white active","--:--"),Mn=x("time black","--:--"),mh=e=>{e.append(x("clock",gt,Mn)),Nr(),Rr(),be("clock")(Nr),be("lichess/game-state","clock")(Rr)};let Vo=null;const Cn=()=>clearInterval(Vo??void 0),_h=(e,t)=>{const n=Date.now();ot=0,jt=e,st=0,Kt=t,Cn(),Vo=window.setInterval(()=>Jt("clock",r=>{const o=kh(r);return o._tag==="flag"&&Cn(),o}),100),Y("clock",Tn(n,0,0))};let ot=0,st=0,jt=0,Kt=0;const{floor:gn}=Math,Ft=e=>{const t=e/1e3,n=gn(t%60),r=gn(t/60%60),o=gn(t/60/60),s=n<10?`0${n.toFixed(0)}`:`${n.toFixed(0)}`,a=r<10?`0${r.toFixed(0)}`:`${r.toFixed(0)}`,u=o<10?`0${o.toFixed(0)}`:`${o.toFixed(0)}`;return t>=3600?`${u}:${a}:${s}`:`${a}:${s}`},vh=Wt("active"),bh=Fe("active"),Zr=ai("active"),Or=(e,t)=>t&&!Zr(e)?bh(e):!t&&Zr(e)?vh(e):void 0,Rr=()=>{const e=Qt();Or(gt,e=="white"),Or(Mn,e=="black")},Nr=()=>{const e=Pe(gt),t=Pe(Mn),n=Fe("flag"),r=H("clock");switch(r._tag){case"flag":{r.color==="white"?(n(gt),t(Ft(r.other)),e("00:00")):(n(gt),e(Ft(r.other)),t("00:00"));break}case"running":{t(Ft(r.remaining_black)),e(Ft(r.remaining_white));break}case"initial":{t("--:--"),e("--:--");break}}},kh=e=>{if(e._tag==="running"){let t=Date.now(),n=ot+st,o=t-e.start_time-n;return Ys(()=>{switch(Qt()){case"white":return ot+=o;case"black":return st+=o}}),st>=Kt?nr("black",jt-ot):ot>=jt?nr("white",Kt-st):Tn(e.start_time,jt-ot,Kt-st)}return{...e}},xr=(e,t)=>{const n=H("lichess/game-info"),r=H("lichess/game-state"),o=Qt(),s=qt();if(n&&r&&o&&s){const a=Pe(t);Pe(e)(eo("name",n.opponent.username)),a(o===s?Ni(r.moves):x("compute"))}},Eh=e=>{const t=x("info"),n=x("state"),r=ze(x("to-list to-button","↪"),s=>s("click",()=>Y("screen","movelist")));xr(t,n);const o=x("engine",t,n,r);e.append(o),be("lichess/game-state")(()=>xr(t,n))},wh="/telechecs/",yh=(...e)=>{var t="/",n=new RegExp(t+"{1,}","g");return e.join(t).replace(n,t)},Qo=(...e)=>yh(wh,...e),Ch=Qo("chess.ogg"),Jo=it(fi("-",Ch),e=>e("preload","auto"));document.body.append(Jo);const Sh=()=>{Jo.play()},Ah=e=>(Y("input",Bt()),Y("lichess/game-state",e.state),Y("started",!0),!0),$h=e=>(console.debug("handleMove",e),Sh(),Y("input",Bt()),Y("lichess/game-state",e),H("clock")._tag==="initial"?_h(e.wtime,e.btime):Jt("clock",t=>t._tag==="running"?{...t,remaining_black:e.btime,remaining_white:e.wtime}:Tn(Date.now(),e.wtime,e.btime)),!0),Th=e=>{switch(e.type){case"gameFull":return Ah(e);case"gameState":return $h(e);case"chatLine":case"opponentGone":return!0}},Ih=e=>ph(e,Th),Ph=e=>{const t=H("lichess/game-info");t&&gh(t.gameId,Hs(e))},mn=(e,t=null,n=null,r,o,s=null)=>({_tag:"Normal",role:e,capture:r,to:o,rank:n,file:t,promotion:s}),Lr=e=>({_tag:"Castle",side:e}),zh=(e,t,n)=>e.filter(r=>{switch(r._tag){case"Castle":return!1;case"EnPassant":return t=="Pawn"&&r.to===n;default:return n===r.to&&t===r.role}}),Zh=(e,t)=>{switch(e._tag){case"Normal":{if(e.role==="Pawn")return mn("Pawn",e.capture!==null?xe(e.from):null,null,e.capture!==null,e.to,e.promotion);{let n=!1,r=!1,o=!1;for(const s of t)s._tag==="Normal"&&e.from!=s.from&&e.role==s.role&&e.to==s.to&&e.promotion==s.promotion&&(n=!0,Ut(e.from)==Ut(s.from)&&(o=!0),xe(e.from)==xe(s.from)&&(r=!0));return mn(e.role,n&&(!r||o)?xe(e.from):null,r?Ut(e.from):null,e.capture!==null,e.to,e.promotion)}}case"EnPassant":return mn("Pawn",xe(e.from),null,!0,e.to,null);case"Castle":return xe(e.rook)<xe(e.king)?Lr("QueenSide"):Lr("KingSide")}},Fr=e=>{switch(e){case"Pawn":return"P";case"Rook":return"R";case"Knight":return"N";case"Bishop":return"B";case"Queen":return"Q";case"King":return"K"}},Ur=(e,t)=>{switch(e){case"Pawn":return t==="white"?co:no;case"Rook":return t==="white"?uo:ro;case"Knight":return t==="white"?lo:oo;case"Bishop":return t==="white"?ho:so;case"Queen":return t==="white"?fo:io;case"King":return t==="white"?po:ao}},Oh=(e,t)=>{let n=[];return t._tag==="Normal"&&t.role!=="Pawn"&&(n=zh(e,t.role,t.to)),Zh(t,n)},Rh={symbol:!1,color:"white"},Nh=(e,{symbol:t,color:n})=>{const r=[];switch(e._tag){case"Normal":{e.role!=="Pawn"&&r.push(t?Ur(e.role,n):Fr(e.role)),e.file!==null&&r.push(e.file.toLowerCase()),e.rank!==null&&r.push(e.rank),e.capture&&r.push("x"),r.push(e.to.toLowerCase()),e.promotion!==null&&r.push("=",t?Ur(e.promotion,n):Fr(e.promotion));break}case"Castle":{e.side==="KingSide"?r.push("O","-","O"):r.push("O","-","O","-","O");break}case"null":r.push("--")}return r.join("")},xh=(e,t,n=Rh)=>Nh(Oh(t,e),n),Dr=(e,t)=>{switch(e){case"Pawn":return t==="black"?no:co;case"Rook":return t==="black"?ro:uo;case"Knight":return t==="black"?oo:lo;case"Bishop":return t==="black"?so:ho;case"Queen":return t==="black"?io:fo;case"King":return t==="black"?ao:po}},Lh=(e,t)=>t.some(n=>{switch(n._tag){case"Normal":return n.role===e;case"Castle":return e==="King";case"EnPassant":return e==="Pawn"}}),Mr=e=>e?"selected":"",Fh=(e,t)=>Zi.map(n=>Lh(n,t)?ze(x(`piece ${n}  ${Mr(e===n)}`,Dr(n,"black")),r=>r("click",()=>e===n?Y("input",mo()):Y("input",Qs(n)))):x(`piece ${n}  ${Mr(e===n)}`,Dr(n,"white"))),Uh=e=>{Y("input",Js(e)),Ph(e)},Dh=e=>t=>e.filter(n=>{switch(n._tag){case"Castle":{switch(t){case"G1":return n.king==="E1"&&n.rook=="H1";case"C1":return n.king==="E1"&&n.rook=="A1";case"G8":return n.king==="E8"&&n.rook=="H8";case"C8":return n.king==="E8"&&n.rook=="A8"}return!1}case"Normal":case"EnPassant":return n.to===t}}),Mh=(e,t)=>{const n=Pe(e);return r=>{n(...r.map(o=>ze(x("move",xh(o,t,{symbol:!0,color:"black"})),s=>s("click",()=>Uh(o))))),go(e)}},jh=(e,t)=>{const n=Fe("selected-file"),r=Fe("selected-rank"),o=Fe("dim"),s=Fe("selected"),a=Wt("selected-file","selected-rank","selected","dim"),u=xe(e),i=Ut(e);t.map(h=>{h.querySelectorAll(".square").forEach(c=>{a(c);const k=c.getAttribute("data-file"),f=c.getAttribute("data-rank"),y=u===k,w=i===f;!y&&!w?o(c):y&&w?s(c):y?n(c):w&&r(c)}),h.querySelectorAll(".ord").forEach(c=>{const k=c.getAttribute("data-file"),f=c.getAttribute("data-rank");u===k||i===f?s(c):a(c)})})},Kh=(e,t)=>{const n=Dh(t.filter(c=>Qr(c)===Jr(e))),r=qt()==="black"?tr:tr.slice(0).reverse(),o=qt()==="white"?er:er.slice(0).reverse(),s=x("rank",...[x("ord")].concat(o.map(c=>it(x("ord",c.toLowerCase()),k=>{k("data-file",c)}))).concat(x("ord padder"))),a=x("select hidden"),u=Mh(a,t),h=r.map(c=>x(`rank ${c} `,it(x("ord",c),k=>k("data-rank",c)),...o.map(k=>{const f=Ks(k,c),y=n(f);return y.length==0?x(`square ${f}`):it(ze(x(`square  ${f} target`,x("label",f.toLowerCase())),w=>w("click",()=>{u(y),jh(f,h)})),w=>{w("data-file",k),w("data-rank",c)})}),x("ord padder"))).concat(s);return[a].concat(h)},qh=e=>{const t=x("pieces"),n=x("moves"),r=x("input",n,t);e.append(r);const o=()=>{const s=H("lichess/game-state");if(s&&Qt()===qt()){const a=Pe(t),u=Pe(n),i=H("input"),h=Jr(i),c=Ri(s.moves);a(...Fh(h,c)),i._tag==="role"&&c.length>0?(go(n),u(...Kh(i,c))):(Oi(n),Ie(n))}else Ie(n),Ie(t)};be("lichess/game-state","input")(o),o()},Gh=e=>{const t=[];for(const r of H("lichess/stream-events"))r.type==="challenge"&&r.challenge.status==="created"&&t.push(r.challenge);const n=t.find(r=>r.id===e);n&&(Y("lichess/current-challenge",n),Y("input",Bt()),dh(n.id))},Bh=e=>{const t=x("lock locked"),n=Fe("locked"),r=Wt("locked"),o=()=>H("lockScreen")?n(t):r(t);be("lockScreen")(o),o(),e.append(t)},Wh=e=>{Eh(e),qh(e),mh(e),Bh(e)};var me={},jr;function Hh(){return jr||(jr=1,function(e){var t=me&&me.__extends||function(){var v=function(p,E){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,$){S.__proto__=$}||function(S,$){for(var A in $)$.hasOwnProperty(A)&&(S[A]=$[A])},v(p,E)};return function(p,E){v(p,E);function S(){this.constructor=p}p.prototype=E===null?Object.create(E):(S.prototype=E.prototype,new S)}}(),n=me&&me.__assign||function(){return n=Object.assign||function(v){for(var p,E=1,S=arguments.length;E<S;E++){p=arguments[E];for(var $ in p)Object.prototype.hasOwnProperty.call(p,$)&&(v[$]=p[$])}return v},n.apply(this,arguments)},r=me&&me.__awaiter||function(v,p,E,S){function $(A){return A instanceof E?A:new E(function(K){K(A)})}return new(E||(E=Promise))(function(A,K){function j(B){try{O(S.next(B))}catch(ae){K(ae)}}function V(B){try{O(S.throw(B))}catch(ae){K(ae)}}function O(B){B.done?A(B.value):$(B.value).then(j,V)}O((S=S.apply(v,p||[])).next())})},o=me&&me.__generator||function(v,p){var E={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},S,$,A,K;return K={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(K[Symbol.iterator]=function(){return this}),K;function j(O){return function(B){return V([O,B])}}function V(O){if(S)throw new TypeError("Generator is already executing.");for(;E;)try{if(S=1,$&&(A=O[0]&2?$.return:O[0]?$.throw||((A=$.return)&&A.call($),0):$.next)&&!(A=A.call($,O[1])).done)return A;switch($=0,A&&(O=[O[0]&2,A.value]),O[0]){case 0:case 1:A=O;break;case 4:return E.label++,{value:O[1],done:!1};case 5:E.label++,$=O[1],O=[0];continue;case 7:O=E.ops.pop(),E.trys.pop();continue;default:if(A=E.trys,!(A=A.length>0&&A[A.length-1])&&(O[0]===6||O[0]===2)){E=0;continue}if(O[0]===3&&(!A||O[1]>A[0]&&O[1]<A[3])){E.label=O[1];break}if(O[0]===6&&E.label<A[1]){E.label=A[1],A=O;break}if(A&&E.label<A[2]){E.label=A[2],E.ops.push(O);break}A[2]&&E.ops.pop(),E.trys.pop();continue}O=p.call(v,E)}catch(B){O=[6,B],$=0}finally{S=A=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},s=me&&me.__spreadArrays||function(){for(var v=0,p=0,E=arguments.length;p<E;p++)v+=arguments[p].length;for(var S=Array(v),$=0,p=0;p<E;p++)for(var A=arguments[p],K=0,j=A.length;K<j;K++,$++)S[$]=A[K];return S};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function v(){}return v.prototype.toString=function(){return"ErrorOAuth2"},v}();e.ErrorOAuth2=a;var u=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorUnknown"},p}(a);e.ErrorUnknown=u;var i=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorNoAuthCode"},p}(a);e.ErrorNoAuthCode=i;var h=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorInvalidReturnedStateParam"},p}(a);e.ErrorInvalidReturnedStateParam=h;var c=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorInvalidJson"},p}(a);e.ErrorInvalidJson=c;var k=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorInvalidScope"},p}(a);e.ErrorInvalidScope=k;var f=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorInvalidRequest"},p}(a);e.ErrorInvalidRequest=f;var y=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorInvalidToken"},p}(a);e.ErrorInvalidToken=y;var w=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorAuthenticationGrant"},p}(a);e.ErrorAuthenticationGrant=w;var L=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorUnauthorizedClient"},p}(w);e.ErrorUnauthorizedClient=L;var M=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorAccessDenied"},p}(w);e.ErrorAccessDenied=M;var F=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorUnsupportedResponseType"},p}(w);e.ErrorUnsupportedResponseType=F;var P=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorServerError"},p}(w);e.ErrorServerError=P;var N=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorTemporarilyUnavailable"},p}(w);e.ErrorTemporarilyUnavailable=N;var G=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorAccessTokenResponse"},p}(a);e.ErrorAccessTokenResponse=G;var ke=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorInvalidClient"},p}(G);e.ErrorInvalidClient=ke;var Te=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorInvalidGrant"},p}(G);e.ErrorInvalidGrant=Te;var De=function(v){t(p,v);function p(){return v!==null&&v.apply(this,arguments)||this}return p.prototype.toString=function(){return"ErrorUnsupportedGrantType"},p}(G);e.ErrorUnsupportedGrantType=De;var tt=function(){function v(){this.realm="",this.error=""}return v}();e.ErrorWWWAuthenticate=tt,e.RawErrorToErrorClassMap={invalid_request:f,invalid_grant:Te,unauthorized_client:L,access_denied:M,unsupported_response_type:F,invalid_scope:k,server_error:P,temporarily_unavailable:N,invalid_client:ke,unsupported_grant_type:De,invalid_json:c,invalid_token:y};function Me(v){return new(e.RawErrorToErrorClassMap[v]||u)}e.toErrorClass=Me;function Ct(v){var p=v.slice(7).replace(/"/g,"").split(", ").map(function(E){var S,$=E.split("="),A=$[0],K=$[1];return S={},S[A]=K,S}).reduce(function(E,S){return n(n({},E),S)},{});return{realm:p.realm,error:p.error}}e.fromWWWAuthenticateHeaderStringToObject=Ct;var nn="Authorization",ct="WWW-Authenticate";e.LOCALSTORAGE_ID="oauth2authcodepkce",e.LOCALSTORAGE_STATE=e.LOCALSTORAGE_ID+"-state",e.RECOMMENDED_CODE_VERIFIER_LENGTH=96,e.RECOMMENDED_STATE_LENGTH=32;var je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",St=function(){function v(p){return this.state={},this.config=p,this.recoverState(),this}return v.prototype.decorateFetchHTTPClient=function(p){var E=this;return function(S,$){for(var A=[],K=2;K<arguments.length;K++)A[K-2]=arguments[K];return E.state.isHTTPDecoratorActive?E.getAccessToken().then(function(j){var V=j.token,O=Object.assign({},$);return O.headers||(O.headers={}),O.headers[nn]="Bearer "+V.value,p.apply(void 0,s([S,O],A))}).then(function(j){if(j.ok||!j.headers.has(ct.toLowerCase()))return j;var V=Me(Ct(j.headers.get(ct.toLowerCase())).error);return V instanceof y&&E.config.onAccessTokenExpiry(function(){return E.exchangeRefreshTokenForAccessToken()}),Promise.reject(V)}):p.apply(void 0,s([S,$],A))}},v.prototype.isReturningFromAuthServer=function(){var p=v.extractParamFromUrl(location.href,"error");if(p)return Promise.reject(Me(p));var E=v.extractParamFromUrl(location.href,"code");if(!E)return Promise.resolve(!1);var S=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),$=v.extractParamFromUrl(location.href,"state");return $!==S.stateQueryParam?(console.warn("state query string parameter doesn't match the one sent! Possible malicious activity somewhere."),Promise.reject(new h)):(S.authorizationCode=E,S.hasAuthCodeBeenExchangedForAccessToken=!1,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(S)),this.setState(S),Promise.resolve(!0))},v.prototype.fetchAuthorizationCode=function(p){return r(this,void 0,void 0,function(){var E,S,$,A,K,j,V,O,B,ae,Ee;return o(this,function(Ce){switch(Ce.label){case 0:return this.assertStateAndConfigArePresent(),E=this.config,S=E.clientId,$=E.extraAuthorizationParams,A=E.redirectUrl,K=E.scopes,[4,v.generatePKCECodes()];case 1:return j=Ce.sent(),V=j.codeChallenge,O=j.codeVerifier,B=v.generateRandomState(e.RECOMMENDED_STATE_LENGTH),this.state=n(n({},this.state),{codeChallenge:V,codeVerifier:O,stateQueryParam:B,isHTTPDecoratorActive:!0}),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state)),ae=this.config.authorizationUrl+"?response_type=code&"+("client_id="+encodeURIComponent(S)+"&")+("redirect_uri="+encodeURIComponent(A)+"&")+("scope="+encodeURIComponent(K.join(" "))+"&")+("state="+B+"&")+("code_challenge="+encodeURIComponent(V)+"&")+"code_challenge_method=S256",($||p)&&(Ee=n(n({},$),p),ae=ae+"&"+v.objectToQueryString(Ee)),location.replace(ae),[2]}})})},v.prototype.getAccessToken=function(){var p=this;this.assertStateAndConfigArePresent();var E=this.config.onAccessTokenExpiry,S=this.state,$=S.accessToken,A=S.authorizationCode,K=S.explicitlyExposedTokens,j=S.hasAuthCodeBeenExchangedForAccessToken,V=S.refreshToken,O=S.scopes;return A?this.authCodeForAccessTokenRequest?this.authCodeForAccessTokenRequest:!this.isAuthorized()||!j?(this.authCodeForAccessTokenRequest=this.exchangeAuthCodeForAccessToken(),this.authCodeForAccessTokenRequest):V&&this.isAccessTokenExpired()?E(function(){return p.exchangeRefreshTokenForAccessToken()}):Promise.resolve({token:$,explicitlyExposedTokens:K,scopes:O,refreshToken:V}):Promise.reject(new i)},v.prototype.exchangeRefreshTokenForAccessToken=function(){var p=this,E;this.assertStateAndConfigArePresent();var S=this.config,$=S.extraRefreshParams,A=S.clientId,K=S.tokenUrl,j=this.state.refreshToken;j||console.warn("No refresh token is present.");var V=K,O="grant_type=refresh_token&"+("refresh_token="+((E=j)===null||E===void 0?void 0:E.value)+"&")+("client_id="+A);return $&&(O=V+"&"+v.objectToQueryString($)),fetch(V,{method:"POST",body:O,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(B){return B.status>=400?B.json().then(function(ae){return Promise.reject(ae)}):B.json()}).then(function(B){var ae=B.access_token,Ee=B.expires_in,Ce=B.refresh_token,Ke=B.scope,Ze=p.config.explicitlyExposedTokens,le=[],Se={},qe={value:ae,expiry:new Date(Date.now()+parseInt(Ee)*1e3).toString()};if(p.state.accessToken=qe,Ce){var nt={value:Ce};p.state.refreshToken=nt}Ze&&(Se=Object.fromEntries(Ze.map(function(we){return[we,B[we]]}).filter(function(we){we[0];var Oe=we[1];return Oe!==void 0})),p.state.explicitlyExposedTokens=Se),Ke&&(le=Ke.split(" "),p.state.scopes=le),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(p.state));var Ae={token:qe,scopes:le};return Ze&&(Ae.explicitlyExposedTokens=Se),Ae}).catch(function(B){var ae=p.config.onInvalidGrant,Ee=B.error||"There was a network error.";switch(Ee){case"invalid_grant":ae(function(){return p.fetchAuthorizationCode()});break}return Promise.reject(Me(Ee))})},v.prototype.getGrantedScopes=function(){return this.state.scopes},v.prototype.isHTTPDecoratorActive=function(p){this.state.isHTTPDecoratorActive=p,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state))},v.prototype.isAuthorized=function(){return!!this.state.accessToken},v.prototype.isAccessTokenExpired=function(){var p=this.state.accessToken;return!!(p&&new Date>=new Date(p.expiry))},v.prototype.reset=function(){this.setState({}),this.authCodeForAccessTokenRequest=void 0},v.prototype.assertStateAndConfigArePresent=function(){if(!this.state||!this.config)throw console.error("state:",this.state,"config:",this.config),new Error("state or config is not set.")},v.prototype.exchangeAuthCodeForAccessToken=function(p){var E=this;this.assertStateAndConfigArePresent();var S=this.state,$=S.authorizationCode,A=$===void 0?p:$,K=S.codeVerifier,j=K===void 0?"":K,V=this.config,O=V.clientId,B=V.onInvalidGrant,ae=V.redirectUrl;j?A||console.warn("No authorization grant code is being passed."):console.warn("No code verifier is being sent.");var Ee=this.config.tokenUrl,Ce="grant_type=authorization_code&"+("code="+encodeURIComponent(A||"")+"&")+("redirect_uri="+encodeURIComponent(ae)+"&")+("client_id="+encodeURIComponent(O)+"&")+("code_verifier="+j);return fetch(Ee,{method:"POST",body:Ce,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(Ke){var Ze=Ke.json().catch(function(le){return{error:"invalid_json"}});return Ke.ok?Ze.then(function(le){var Se=le.access_token,qe=le.expires_in,nt=le.refresh_token,Ae=le.scope,we=E.config.explicitlyExposedTokens,Oe=[],ut={};E.state.hasAuthCodeBeenExchangedForAccessToken=!0,E.authCodeForAccessTokenRequest=void 0;var At={value:Se,expiry:new Date(Date.now()+parseInt(qe)*1e3).toString()};if(E.state.accessToken=At,nt){var rn={value:nt};E.state.refreshToken=rn}we&&(ut=Object.fromEntries(we.map(function(Ge){return[Ge,le[Ge]]}).filter(function(Ge){Ge[0];var Tt=Ge[1];return Tt!==void 0})),E.state.explicitlyExposedTokens=ut),Ae&&(Oe=Ae.split(" "),E.state.scopes=Oe),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(E.state));var $t={token:At,scopes:Oe};return we&&($t.explicitlyExposedTokens=ut),$t}):Ze.then(function(le){var Se=le.error;switch(Se){case"invalid_grant":B(function(){return E.fetchAuthorizationCode()});break}return Promise.reject(Me(Se))})})},v.prototype.recoverState=function(){return this.state=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),this},v.prototype.setState=function(p){return this.state=p,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(p)),this},v.base64urlEncode=function(p){var E=btoa(p);return E=E.replace(/\+/g,"-"),E=E.replace(/\//g,"_"),E=E.replace(/=/g,""),E},v.extractParamFromUrl=function(p,E){var S=p.split("?");if(S.length<2)return"";S=S[1].split("#");var $=S[0].split("&").reduce(function(K,j){return K.concat(j.split("="))},[]);if($.length<2)return"";var A=$.indexOf(E);return decodeURIComponent(A>=0?$[A+1]:"")},v.objectToQueryString=function(p){return Object.entries(p).map(function(E){var S=E[0],$=E[1];return S+"="+encodeURIComponent($)}).join("&")},v.generatePKCECodes=function(){var p=new Uint32Array(e.RECOMMENDED_CODE_VERIFIER_LENGTH);crypto.getRandomValues(p);var E=v.base64urlEncode(Array.from(p).map(function(S){return je[S%je.length]}).join(""));return crypto.subtle.digest("SHA-256",new TextEncoder().encode(E)).then(function(S){for(var $=new Uint8Array(S),A="",K=$.byteLength,j=0;j<K;j++)A+=String.fromCharCode($[j]);return A}).then(v.base64urlEncode).then(function(S){return{codeChallenge:S,codeVerifier:E}})},v.generateRandomState=function(p){var E=new Uint32Array(p);return crypto.getRandomValues(E),Array.from(E).map(function(S){return je[S%je.length]}).join("")},v}();e.OAuth2AuthCodePKCE=St}(me)),me}var Vh=Hh();const Qh=new RegExp(`
`),Jh=(e,t,n,r)=>e(n,r).then(o=>o.body).then(o=>{if(o==null)throw new Error("Response body is NULL");const s=o.getReader();return new ReadableStream({start(a){const u=new TextDecoder,i=()=>{s.read().then(({done:h,value:c})=>{if(h){console.log("done",h),a.close();return}u.decode(c).split(Qh).map(f=>{if(f.trim().length>0)try{const w=JSON.parse(f),L=t.parse(w);console.log("stream",L),a.enqueue(L)}catch{console.error("Failed to make an object out of chunk:",f)}}),i()})};i()}}).getReader()}),Yh=e=>(t,n,r)=>{const o=[],s=[];let a=[];const u=f=>{const y=()=>{f.read().then(({done:w,value:L})=>{c($n(L)),w?k():setTimeout(y,0)})};y()},i=f=>{a.length>0&&(a.forEach(f),a=[]),o.push(f)},h=f=>{s.push(f)},c=Xe(f=>{o.length>0?o.find(y=>!y(f)):a.push(f)}),k=()=>{s.forEach(f=>f())};return Jh(e,t,n,r).then(u).catch(console.error),{onMessage:i,onClose:h}},Xh=["board:play","challenge:read"],ef=`ucui-${location.host}`,tf=`${location.protocol}//${location.host}${Qo()}`,nf=()=>{const e=H("lichess/host");let t=null;const n=new Vh.OAuth2AuthCodePKCE({authorizationUrl:`${e}/oauth`,tokenUrl:`${e}/api/token`,clientId:ef,scopes:Xh,redirectUrl:tf,onAccessTokenExpiry:i=>i(),onInvalidGrant:console.warn}),r=async()=>{try{await n.getAccessToken()&&await a()}catch(i){console.error(i)}if(!t)try{await n.isReturningFromAuthServer()&&await a()}catch(i){console.error(i)}},o=async()=>{await n.fetchAuthorizationCode()},s=async()=>{t&&await t.httpClient(`${e}/api/token`,{method:"DELETE"}),localStorage.clear(),t=null},a=async()=>{const i=n.decorateFetchHTTPClient(window.fetch),c={...await(await i(`${e}/api/account`)).json(),httpClient:i,streamer:Yh(i)};if(c.error)throw c.error;t=c};return{init:r,login:o,logout:s,user:()=>Xe(i=>({id:i.id,username:i.username,streamer:i.streamer,httpClient:i.httpClient}))($n(t))}},mt=nf(),rf=ni(()=>mt.init().then(()=>console.log("Auth#init returned")));let _n=!1;const of=()=>{_n||(_n=!0,H("lichess/user")?fh(t=>(Jt("lichess/stream-events",n=>n.concat(t)),!0)):_n=!1)},sf=()=>ze(x("button button-login","login"),e=>e("click",async()=>{const t=Hr(()=>{mt.login().then(()=>{n(mt.user())})}),n=Xe(r=>{Y("lichess/user",r)});Vr(mt.user(),n,t)})),af=e=>t=>{of(),Ie(e),e.append(x("user",t.username,ze(x("navigate","events"),n=>n("click",()=>Y("screen","events")))))},cf=e=>()=>{Ie(e),e.append(sf())},uf=e=>{rf();const t=Xe(af(e)),n=Hr(cf(e)),r=be("lichess/user"),o=()=>{Vr(mt.user(),t,n)};r(o),o()},lf=e=>{switch(e.type){case"clock":return e.show;case"correspondence":return`${e.daysPerTurn} day`;case"unlimited":return"unlimited"}},hf=e=>ze(x("button button-play",`${e.challenger.name} --- ${lf(e.timeControl)}`),t=>t("click",()=>{Gh(e.id),Y("screen","game")})),Kr=e=>{const t=x("footer",hi("link","https://github.com/pierremarc/telechecs","Source code & feedback")),n=x("intro",eo("ucui","Téléchecs "),`
  is a Lichess client for OTB maniacs. Enjoy! 
    `),r=x("challenges"),o=Pe(r);be("lichess/stream-events")(()=>{const u=[];for(const i of H("lichess/stream-events"))i.type==="challenge"&&i.challenge.status==="created"&&u.push(i.challenge);o(...u.map(hf))});const a=x("login");uf(a),e.append(x("home",n,a,r,t))},ff="wakeLock"in navigator,pf=()=>{if(ff){const e=be(...Di().filter(i=>i!=="lockScreen"));let t=null;const n=i=>Ui("lockScreen",h=>h!==i?An(i):Sn),r=()=>H("screen")==="game"?t===null?!0:!t.released:!1,o=()=>!!(H("screen")!=="game"&&t&&!t.released),s=()=>{navigator.wakeLock.request("screen").then(i=>{t=i,console.log("WakeLock acquired"),n(!0),t.addEventListener("release",()=>{n(!1),console.log("Navigator released lock sentinel")})}).catch(i=>console.error("failed to lock screen",i))},a=()=>{n(!1),t&&!t.released&&t.release().then(()=>{t=null}).catch(i=>console.error("failed to release wakelock",i))},u=()=>{r()?s():o()&&a()};e(u),u()}},df=()=>ze(x("button","Copy PGN"),e=>e("click",()=>{const t=H("lichess/game-state");t&&Xs(kn(t.moves))})),gf=()=>[df()],mf=()=>x("header",ui("title","Moves"),ze(x("to-game  to-button","↩"),e=>e("click",()=>Y("screen","game")))),_f=e=>{const t=H("lichess/game-state"),n=x("moves",t?kn(t.moves):"---"),r=x("actions",...gf());e.append(x("movelist",mf(),x("listing",n),r));const o=Pe(n);be("lichess/game-state")(()=>{const a=H("lichess/game-state");o(a?kn(a.moves):"---")})},vf=e=>{const t=x("events"),n=ci("","Events"),r=()=>{Ie(t),H("lichess/stream-events").forEach(o=>t.append(x("event"),li("json",JSON.stringify(o,void 0,4))))};r(),e.append(n,t),be("lichess/stream-events")(r)},bf=e=>t=>t&&document.location.hostname!=="localhost"?e.requestFullscreen().then(()=>console.log("enter fullscreen")).catch(n=>console.warn("failed to enter fullscreen",n)):document.exitFullscreen().then(()=>console.log("exir fullscreen")).catch(n=>console.warn("failed to exit fullscreen",n)),qr=()=>{be("lichess/stream-events")(()=>{const t=H("lichess/stream-events");if(t.length>0){const n=t[t.length-1];n.type==="gameStart"?(Y("screen","game"),Y("lichess/game-info",n.game),Ih(n.game.gameId)):n.type==="gameFinish"&&(Cn(),Y("lichess/current-challenge",null),Y("lichess/game-info",null),Y("lichess/game-state",null),Y("screen","home"))}})},kf=e=>{pf(),Kr(e),qr();const t=bf(e);let n=["screen","lockScreen"];be("screen")(()=>{switch(Mi(r=>n.includes(r)),qr(),Ie(e),H("screen")){case"home":return t(!1),Kr(e);case"events":return t(!1),vf(e);case"game":return t(!0),Wh(e);case"movelist":return t(!1),_f(e)}})};Xe(kf)($n(document.querySelector("#app")));
